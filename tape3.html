<!DOCTYPE html>
<html lang="en">
<head>
<title>PLAY: The Noise</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
body{margin:0;overflow:hidden;background:#000;font-family:'Courier New',monospace;touch-action:none}
canvas{display:block}
#ui{position:absolute;top:10px;left:10px;color:#ff66aa;font-size:1.2rem;pointer-events:none}
#start{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#ff66aa;border:2px solid #ff66aa;padding:20px;background:#000;cursor:pointer}
</style>
</head>
<body>
<div id="ui">HP: <span id="hp">100</span>%</div>
<div id="start">CLICK TO START<br><small>(Drag/Touch to move)</small></div>
<canvas id="c"></canvas>
<script>
const c = document.getElementById('c');
const ctx = c.getContext('2d');
let w,h,raf;
let p = {x:0, y:0};
let bullets = [];
let hp = 100;
let frame = 0;
let active = false;
const words = ["FAKE", "LEAVE", "IGNORE", "DOUBT", "END"];

function resize(){
  w = c.width = window.innerWidth;
  h = c.height = window.innerHeight;
  p.x = w/2; p.y = h/2;
}
window.onresize=resize;
resize();

// Input
window.addEventListener('touchmove', e=>{
  e.preventDefault();
  p.x = e.touches[0].clientX;
  p.y = e.touches[0].clientY;
}, {passive:false});
window.addEventListener('mousemove', e=>{
  if(active){p.x = e.clientX; p.y = e.clientY;}
});

document.getElementById('start').onclick = function(){
  this.style.display='none';
  active = true;
  loop();
};

function loop(){
  if(!active) return;
  ctx.fillStyle = 'rgba(5,0,2,0.3)'; // Trails
  ctx.fillRect(0,0,w,h);
  
  // Player
  ctx.shadowBlur = 20;
  ctx.shadowColor = '#ff66aa';
  ctx.fillStyle = '#fff';
  ctx.beginPath();
  ctx.arc(p.x, p.y, 8, 0, Math.PI*2);
  ctx.fill();
  ctx.shadowBlur = 0;

  // Spawning
  if(frame % 15 === 0){
    const word = words[Math.floor(Math.random()*words.length)];
    bullets.push({
      x: Math.random()*w,
      y: -20,
      vy: Math.random()*3 + 2,
      text: word
    });
  }

  // Logic
  ctx.fillStyle = '#aa66ff';
  ctx.font = '16px monospace';
  ctx.textAlign = 'center';
  
  for(let i=bullets.length-1; i>=0; i--){
    let b = bullets[i];
    b.y += b.vy;
    ctx.fillText(b.text, b.x, b.y);
    
    // Collision
    const dx = p.x - b.x;
    const dy = p.y - b.y;
    if(Math.sqrt(dx*dx + dy*dy) < 30){
      hp -= 10;
      document.getElementById('hp').textContent = hp;
      bullets.splice(i,1);
      c.style.filter = "invert(1)";
      setTimeout(()=>c.style.filter="none", 50);
    }
    
    if(b.y > h) bullets.splice(i,1);
  }

  if(hp <= 0){
    alert("Don't let the noise win. Try again.");
    hp = 100; bullets = [];
  }

  frame++;
  if(frame > 1000){
    active = false;
    ctx.fillStyle = '#000';
    ctx.fillRect(0,0,w,h);
    ctx.fillStyle = '#ff66aa';
    ctx.font = '30px monospace';
    ctx.fillText("NOISE CLEARED.", w/2, h/2);
    
    let s = JSON.parse(localStorage.getItem('minji_archive_v1')||'{}');
    s.tape3 = {complete:true};
    localStorage.setItem('minji_archive_v1', JSON.stringify(s));
    
    setTimeout(()=>window.location.href='index.html', 3000);
  } else {
    raf = requestAnimationFrame(loop);
  }
}
</script>
</body>
</html>
