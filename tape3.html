<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>SIDE C: The Grey Zone</title>
<style>
/* Simplified Bullet Hell Engine */
body{background:#000;margin:0;overflow:hidden;touch-action:none;display:flex;justify-content:center;align-items:center;height:100vh}
canvas{border:2px solid #fff;background:#111;max-width:100%;max-height:100%}
.overlay{position:absolute;color:#fff;font-family:'Courier New';text-align:center;pointer-events:none}
.controls{position:absolute;bottom:20px;width:100%;text-align:center;display:none} /* Show on mobile if needed */
.back{position:fixed;top:10px;left:10px;color:#555;text-decoration:none;border:1px solid #333;padding:5px;z-index:99;font-family:monospace}
</style>
</head>
<body>
<a href="index.html" class="back">â—€ EJECT</a>
<canvas id="game" width="400" height="600"></canvas>
<div class="overlay" id="msg">TOUCH/ARROWS TO MOVE<br>DODGE THE DOUBT</div>
<audio id="bgm" src="LOST.mp3" loop autoplay></audio>

<script>
const cvs = document.getElementById('game');
const ctx = cvs.getContext('2d');
const bgm = document.getElementById('bgm');
bgm.volume=0.5;

let player = {x:200, y:500, r:10};
let bullets = [];
let frame = 0;
let hp = 100;
let gameover = false;
let won = false;
let time = 0;
const DURATION = 1000; // Frames to survive

// Touch controls
cvs.addEventListener('touchmove', e=>{
  e.preventDefault();
  const rect = cvs.getBoundingClientRect();
  player.x = (e.touches[0].clientX - rect.left) * (cvs.width/rect.width);
  player.y = (e.touches[0].clientY - rect.top) * (cvs.height/rect.height);
}, {passive:false});

// Mouse/Keyboard
window.addEventListener('mousemove', e=>{
  const rect = cvs.getBoundingClientRect();
  player.x = (e.clientX - rect.left) * (cvs.width/rect.width);
  player.y = (e.clientY - rect.top) * (cvs.height/rect.height);
});

function spawn(){
  if(frame % 10 === 0){
    bullets.push({
      x: Math.random()*cvs.width,
      y: -20,
      vx: (Math.random()-0.5)*2,
      vy: Math.random()*3 + 2,
      text: ["DOUBT", "FEAR", "OVERTHINK", "JEALOUSY"][Math.floor(Math.random()*4)]
    });
  }
}

function update(){
  if(gameover || won) return;
  
  time++;
  if(time > DURATION){
    won = true;
    endGame(true);
    return;
  }

  ctx.fillStyle = 'rgba(0,0,0,0.2)';
  ctx.fillRect(0,0,cvs.width,cvs.height);

  // Player
  ctx.fillStyle = '#00d4aa';
  ctx.beginPath();
  ctx.arc(player.x, player.y, player.r, 0, Math.PI*2);
  ctx.fill();

  // Bullets
  ctx.fillStyle = '#cc4444';
  ctx.font = "12px monospace";
  for(let i=bullets.length-1; i>=0; i--){
    let b = bullets[i];
    b.x += b.vx;
    b.y += b.vy;
    ctx.fillText(b.text, b.x, b.y);

    // Collision
    let dx = player.x - b.x;
    let dy = player.y - b.y;
    if(Math.sqrt(dx*dx + dy*dy) < 20){
      hp -= 10;
      bullets.splice(i, 1);
      if(hp <= 0) endGame(false);
    }

    if(b.y > cvs.height) bullets.splice(i, 1);
  }

  spawn();
  
  // HUD
  ctx.fillStyle = '#fff';
  ctx.fillText("HP: " + hp, 10, 20);
  ctx.fillText("SURVIVE: " + (DURATION-time), 300, 20);
  
  frame++;
  requestAnimationFrame(update);
}

function endGame(victory){
  gameover = true;
  ctx.fillStyle = 'rgba(0,0,0,0.8)';
  ctx.fillRect(0,0,cvs.width,cvs.height);
  ctx.fillStyle = victory ? '#00d4aa' : '#cc4444';
  ctx.font = "30px monospace";
  ctx.textAlign = "center";
  if(victory){
    ctx.fillText("SIGNAL CLEAR", cvs.width/2, cvs.height/2);
    ctx.font = "16px monospace";
    ctx.fillText("You survived the grey zone.", cvs.width/2, cvs.height/2 + 40);
    const s=JSON.parse(localStorage.getItem('minji_archive_v1')||'{}');
    s.tape3=true;
    localStorage.setItem('minji_archive_v1',JSON.stringify(s));
    setTimeout(()=>window.location.href='index.html', 3000);
  } else {
    ctx.fillText("OVERTHINKING...", cvs.width/2, cvs.height/2);
    setTimeout(()=>location.reload(), 2000);
  }
}

update();
</script>
</body>
</html>
