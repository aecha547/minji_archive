<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>SIDE A: SOIL — THE SEED OF MANY ENDINGS</title>
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Cdefs%3E%3CradialGradient id='sg' cx='50%25' cy='50%25'%3E%3Cstop offset='0%25' stop-color='%23a8e6a3' stop-opacity='.8'/%3E%3Cstop offset='100%25' stop-color='%23558b2f' stop-opacity='.4'/%3E%3C/radialGradient%3E%3C/defs%3E%3Crect width='32' height='32' fill='%23050505'/%3E%3Cellipse cx='16' cy='18' rx='6' ry='9' fill='url(%23sg)' transform='rotate(-10 16 18)'/%3E%3Cellipse cx='16' cy='11' rx='3' ry='2' fill='%23c8e6c9' transform='rotate(-10 16 11)'/%3E%3Cpath d='M12 6 Q16 2 20 6' stroke='%2381c784' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E">
<style>
@import url('https://fonts.googleapis.com/css2?family=VT323&family=Caveat:wght@400;500;600;700&family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,300;1,400&family=EB+Garamond:ital,wght@0,400;0,500;0,600;1,400&display=swap');

/* ═══════════════════════════════════════════════════════════════════════════
   DESIGN TOKENS — Warm, earthy palette with CRT aesthetics
   ═══════════════════════════════════════════════════════════════════════════ */
:root {
  /* Core palette */
  --bg-deep: #020202;
  --bg: #050505;
  --bg-warm: #0a0605;
  
  /* Earth tones — primary identity */
  --earth-deep: #3d2b1f;
  --earth: #5c4033;
  --earth-light: #8b6914;
  --earth-glow: #a67c52;
  --earth-pale: #d4a574;
  
  /* Pink/Magenta — her voice */
  --pink-deep: #6b1a3a;
  --pink: #9d3355;
  --pink-light: #c45c7a;
  --pink-soft: #e899ab;
  --pink-glow: #ff6b9d;
  
  /* Gold — your voice, memory */
  --gold-deep: #705825;
  --gold: #a88c3d;
  --gold-light: #cbb868;
  --gold-glow: #e8d9a0;
  
  /* Emotional states */
  --trust: #5a8a4a;
  --guard: #4a4a5a;
  --love: #c45c7a;
  --fear: #3a3a4a;
  
  /* Neutral */
  --white: #e8e4e0;
  --dim: #6a6560;
  --muted: #4a4540;
  
  /* Typography */
  --font-crt: 'VT323', monospace;
  --font-hand: 'Caveat', cursive;
  --font-serif: 'Cormorant Garamond', serif;
  --font-body: 'EB Garamond', serif;
  
  /* Timing */
  --ease-smooth: cubic-bezier(0.4, 0, 0.2, 1);
  --ease-bounce: cubic-bezier(0.34, 1.56, 0.64, 1);
  --ease-dramatic: cubic-bezier(0.2, 0, 0.13, 1);
}

/* ═══════════════════════════════════════════════════════════════════════════
   BASE RESET
   ═══════════════════════════════════════════════════════════════════════════ */
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
html, body { 
  height: 100%; 
  overflow: hidden; 
  background: var(--bg-deep); 
  font-family: var(--font-body);
  color: var(--white);
  -webkit-tap-highlight-color: transparent;
  user-select: none;
}

/* ═══════════════════════════════════════════════════════════════════════════
   VHS BACKGROUND LAYER — Particle system + noise
   ═══════════════════════════════════════════════════════════════════════════ */
#vhs-layer {
  position: fixed;
  inset: 0;
  z-index: 0;
  pointer-events: none;
  overflow: hidden;
}

#vhs-canvas {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  opacity: 0.6;
}

#noise-layer {
  position: fixed;
  inset: 0;
  z-index: 2;
  pointer-events: none;
  opacity: 0.03;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
}

/* Ambient particles */
#particles {
  position: fixed;
  inset: 0;
  z-index: 1;
  pointer-events: none;
  overflow: hidden;
}

.particle {
  position: absolute;
  border-radius: 50%;
  pointer-events: none;
  will-change: transform, opacity;
}

/* ═══════════════════════════════════════════════════════════════════════════
   BACKGROUND SCENES — Living, breathing environments
   ═══════════════════════════════════════════════════════════════════════════ */
#bg-scenes {
  position: fixed;
  inset: 0;
  z-index: 1;
  pointer-events: none;
  opacity: 0;
  transition: opacity 4s var(--ease-smooth);
}

#bg-scenes.active { opacity: 0.3; }

.bg-scene {
  position: absolute;
  inset: 0;
  opacity: 0;
  transition: opacity 5s var(--ease-smooth);
  overflow: hidden;
}

.bg-scene.active { opacity: 1; }
.bg-scene svg {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
}

/* Scene-specific animations — kept concise */
.scene-seed .soil { animation: soilPulse 12s ease-in-out infinite; }
@keyframes soilPulse { 0%, 100% { opacity: 0.4; } 50% { opacity: 0.7; } }

.scene-seed .roots { animation: rootGrow 10s ease-in-out infinite; transform-origin: top; }
@keyframes rootGrow { 0%, 100% { transform: scaleY(0.5); opacity: 0.2; } 50% { transform: scaleY(1); opacity: 0.6; } }

.scene-seed .main-stem { transform-origin: bottom; animation: stemRise 10s ease-in-out infinite; }
@keyframes stemRise { 0%, 100% { transform: scaleY(0.3); } 50% { transform: scaleY(1); } }

.scene-seed .stem-segment { animation: stemSway 6s ease-in-out infinite; transform-origin: bottom; }
@keyframes stemSway { 0%, 100% { transform: rotate(-3deg); } 50% { transform: rotate(3deg); } }

.scene-seed .leaf { transform-origin: bottom left; animation: leafUnfold 8s ease-in-out infinite; }
.scene-seed .leaf:nth-child(2) { animation-delay: 0.5s; transform-origin: bottom right; }
.scene-seed .leaf:nth-child(3) { animation-delay: 1s; }
.scene-seed .leaf:nth-child(4) { animation-delay: 1.5s; transform-origin: bottom right; }
@keyframes leafUnfold { 0%, 100% { transform: rotate(0deg) scale(0.3); opacity: 0.2; } 50% { transform: rotate(25deg) scale(1); opacity: 1; } }

.scene-seed .flower-center { animation: flowerPulse 4s ease-in-out infinite; }
@keyframes flowerPulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }

.scene-seed .petal { transform-origin: center bottom; animation: petalBloom 7s ease-in-out infinite; }
.scene-seed .petal:nth-child(2) { animation-delay: 0.2s; }
.scene-seed .petal:nth-child(3) { animation-delay: 0.4s; }
.scene-seed .petal:nth-child(4) { animation-delay: 0.6s; }
.scene-seed .petal:nth-child(5) { animation-delay: 0.8s; }
@keyframes petalBloom { 0%, 100% { transform: scale(0.2); opacity: 0.15; } 50% { transform: scale(1); opacity: 1; } }

.scene-seed .pollen { animation: pollenFloat 6s ease-in-out infinite; }
.scene-seed .pollen:nth-child(2) { animation-delay: 1s; }
.scene-seed .pollen:nth-child(3) { animation-delay: 2s; }
.scene-seed .pollen:nth-child(4) { animation-delay: 3s; }
.scene-seed .pollen:nth-child(5) { animation-delay: 4s; }
@keyframes pollenFloat { 0%, 100% { opacity: 0; transform: translate(0, 0); } 50% { opacity: 0.6; transform: translate(30px, -40px); } }

.scene-seed .butterfly { animation: butterflyFloat 18s ease-in-out infinite; }
@keyframes butterflyFloat { 0%, 100% { transform: translate(0, 0); } 25% { transform: translate(50px, -40px); } 50% { transform: translate(100px, 0); } 75% { transform: translate(50px, 30px); } }

.scene-seed .butterfly-wing { animation: wingFlutter 0.12s ease-in-out infinite; transform-origin: center; }
@keyframes wingFlutter { 0%, 100% { transform: scaleX(1); } 50% { transform: scaleX(0.2); } }

.scene-seed .water-drop { animation: waterDrop 5s ease-in-out infinite; }
.scene-seed .water-drop:nth-child(2) { animation-delay: 1.5s; }
.scene-seed .water-drop:nth-child(3) { animation-delay: 3s; }
@keyframes waterDrop { 0% { opacity: 0; transform: translateY(-30px); } 15% { opacity: 0.7; } 100% { opacity: 0; transform: translateY(120px); } }

.scene-seed .glow-aura { animation: glowPulse 8s ease-in-out infinite; }
@keyframes glowPulse { 0%, 100% { opacity: 0.1; transform: scale(1); } 50% { opacity: 0.35; transform: scale(1.3); } }

.scene-seed .grass { animation: grassWave 4s ease-in-out infinite; transform-origin: bottom; }
.scene-seed .grass:nth-child(2) { animation-delay: 0.15s; }
.scene-seene .grass:nth-child(3) { animation-delay: 0.3s; }
.scene-seed .grass:nth-child(4) { animation-delay: 0.45s; }
@keyframes grassWave { 0%, 100% { transform: rotate(-8deg); } 50% { transform: rotate(8deg); } }

/* ═══════════════════════════════════════════════════════════════════════════
   CRT SCREEN EFFECTS
   ═══════════════════════════════════════════════════════════════════════════ */
.crt-screen {
  position: relative;
  overflow: hidden;
  min-height: 100vh;
}

.crt-screen::before {
  content: '';
  position: absolute;
  inset: 0;
  background: repeating-linear-gradient(
    0deg,
    transparent,
    transparent 2px,
    rgba(0, 0, 0, 0.15) 2px,
    rgba(0, 0, 0, 0.15) 4px
  );
  pointer-events: none;
  z-index: 100;
}

.crt-screen::after {
  content: '';
  position: absolute;
  inset: 0;
  background: radial-gradient(ellipse at center, transparent 40%, rgba(0, 0, 0, 0.8) 100%);
  pointer-events: none;
  z-index: 101;
}

.scan-bar {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 8px;
  background: linear-gradient(180deg, transparent, rgba(255, 255, 255, 0.04), transparent);
  opacity: 0.5;
  z-index: 102;
  pointer-events: none;
  animation: scanbar 6s linear infinite;
}

@keyframes scanbar {
  from { top: -6%; }
  to { top: 106%; }
}

.tracking-bar {
  position: fixed;
  left: 0;
  width: 100%;
  height: 6px;
  background: linear-gradient(180deg, transparent, rgba(255, 255, 255, 0.08), transparent);
  opacity: 0;
  z-index: 103;
  pointer-events: none;
  transition: opacity 0.3s;
}

.tracking-bar.on {
  opacity: 1;
  animation: trackDrift 4s linear infinite;
}

@keyframes trackDrift {
  0% { top: -3%; }
  100% { top: 103%; }
}

/* ═══════════════════════════════════════════════════════════════════════════
   LOADING OVERLAY — The seed awakens
   ═══════════════════════════════════════════════════════════════════════════ */
#loading-overlay {
  position: fixed;
  inset: 0;
  z-index: 9999;
  background: var(--bg-deep);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  opacity: 1;
  transition: opacity 2s var(--ease-smooth);
}

#loading-overlay.hidden {
  opacity: 0;
  pointer-events: none;
}

.seed-loading {
  width: clamp(100px, 25vw, 140px);
  height: clamp(100px, 25vw, 140px);
  animation: seedPulse 4s ease-in-out infinite;
  filter: drop-shadow(0 0 30px rgba(168, 230, 163, 0.5));
}

@keyframes seedPulse {
  0%, 100% { transform: scale(1) rotate(-10deg); }
  50% { transform: scale(1.1) rotate(-10deg); }
}

#loading-overlay h1 {
  font-family: var(--font-serif);
  font-size: clamp(1.4rem, 4vw, 2rem);
  font-weight: 400;
  color: var(--earth-glow);
  letter-spacing: 2px;
  text-shadow: 0 0 40px var(--earth);
  text-align: center;
  margin-top: 24px;
  animation: titleGlow 3s ease-in-out infinite;
}

@keyframes titleGlow {
  0%, 100% { opacity: 0.7; text-shadow: 0 0 30px var(--earth); }
  50% { opacity: 1; text-shadow: 0 0 50px var(--earth-glow); }
}

#loading-overlay .sub {
  font-family: var(--font-hand);
  font-size: clamp(1rem, 2.5vw, 1.3rem);
  color: var(--earth-pale);
  margin-top: 12px;
  opacity: 0.6;
}

.boot-text {
  color: var(--earth);
  font-family: var(--font-crt);
  font-size: clamp(12px, 2vw, 14px);
  margin-top: 40px;
  text-align: left;
  width: min(320px, 80vw);
  line-height: 2.2;
  min-height: 140px;
  white-space: pre-wrap;
}

.boot-cursor {
  display: inline-block;
  width: 8px;
  height: 1.1em;
  background: var(--earth);
  vertical-align: text-bottom;
  margin-left: 2px;
  animation: blink 0.8s step-end infinite;
}

@keyframes blink { 50% { opacity: 0; } }

/* ═══════════════════════════════════════════════════════════════════════════
   HEADER
   ═══════════════════════════════════════════════════════════════════════════ */
.header {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 50;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 20px;
  background: linear-gradient(180deg, rgba(0, 0, 0, 0.85), transparent);
}

.back-btn {
  color: var(--dim);
  text-decoration: none;
  font-family: var(--font-crt);
  font-size: 0.9rem;
  transition: all 0.5s var(--ease-smooth);
}

.back-btn:hover {
  color: var(--earth-glow);
  text-shadow: 0 0 15px var(--earth);
}

.tape-label {
  background: linear-gradient(180deg, #f5efe5, #d8d0c0);
  color: #1a1510;
  padding: 5px 14px;
  font-family: var(--font-crt);
  font-size: 0.65rem;
  text-transform: uppercase;
  letter-spacing: 2px;
  border: 1px solid #888;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.4);
}

.scene-counter {
  font-family: var(--font-crt);
  font-size: 12px;
  color: var(--dim);
  letter-spacing: 2px;
}

/* ═══════════════════════════════════════════════════════════════════════════
   MAIN CONTENT CONTAINER
   ═══════════════════════════════════════════════════════════════════════════ */
.main {
  position: relative;
  z-index: 10;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
  padding: 90px 24px 50px;
  transition: opacity 1.5s var(--ease-smooth);
}

.main.fade-out { opacity: 0; }

/* ═══════════════════════════════════════════════════════════════════════════
   SHEEPY NARRATOR — The gentle guide
   ═══════════════════════════════════════════════════════════════════════════ */
.sheepy-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 18px;
  margin-bottom: 36px;
  opacity: 0;
  transform: translateY(-25px);
  transition: all 1.2s var(--ease-smooth);
}

.sheepy-container.show { opacity: 1; transform: translateY(0); }
.sheepy-container.hide { opacity: 0; transform: translateY(-30px) scale(0.95); }

.sheepy-glow {
  width: clamp(130px, 30vw, 170px);
  height: clamp(130px, 30vw, 170px);
  background: radial-gradient(circle, rgba(92, 64, 51, 0.35) 0%, rgba(92, 64, 51, 0.1) 45%, transparent 70%);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  animation: sheepyGlow 5s ease-in-out infinite;
  position: relative;
}

@keyframes sheepyGlow {
  0%, 100% { transform: scale(1); opacity: 0.8; }
  50% { transform: scale(1.08); opacity: 1; }
}

.sheepy-glow::before {
  content: '';
  position: absolute;
  inset: -25px;
  background: radial-gradient(circle, rgba(166, 124, 82, 0.2) 0%, transparent 70%);
  border-radius: 50%;
  animation: sheepyAura 7s ease-in-out infinite;
}

@keyframes sheepyAura {
  0%, 100% { transform: scale(1) rotate(0deg); opacity: 0.5; }
  50% { transform: scale(1.25) rotate(180deg); opacity: 0.9; }
}

.sheepy-text {
  font-family: var(--font-serif);
  font-size: clamp(1rem, 2.5vw, 1.3rem);
  font-weight: 400;
  color: var(--earth-pale);
  text-align: center;
  max-width: 400px;
  line-height: 2.2;
  min-height: 3.5em;
}

.sheepy-text .hand {
  font-family: var(--font-hand);
  font-size: 1.25em;
  color: var(--gold-glow);
  text-shadow: 0 0 15px rgba(232, 217, 160, 0.4);
}

.sheepy-text .whisper {
  font-style: italic;
  opacity: 0.7;
  font-size: 0.9em;
}

/* ═══════════════════════════════════════════════════════════════════════════
   SCENE NARRATIVE — Typography matters
   ═══════════════════════════════════════════════════════════════════════════ */
.scene {
  max-width: 540px;
  width: 100%;
  text-align: center;
}

.scene p {
  font-family: var(--font-serif);
  font-size: clamp(1rem, 2.5vw, 1.35rem);
  font-weight: 400;
  line-height: 2.4;
  color: var(--white);
  margin-bottom: 22px;
  opacity: 0;
  transform: translateY(15px);
  transition: all 1s var(--ease-smooth);
}

.scene p.show { opacity: 1; transform: translateY(0); }
.scene p.hide { opacity: 0; transform: translateY(-12px); }

.scene .narrator {
  color: var(--dim);
  font-style: italic;
  font-size: 0.92em;
}

.scene .her {
  color: var(--pink-soft);
  text-shadow: 0 0 20px rgba(228, 153, 171, 0.3);
}

.scene .me {
  color: var(--gold-light);
  text-shadow: 0 0 20px rgba(203, 184, 104, 0.3);
}

.scene .memory {
  color: var(--earth-pale);
  font-style: italic;
  font-size: 0.88em;
  opacity: 0.85;
  border-left: 2px solid var(--earth);
  padding-left: 16px;
  margin: 20px auto;
  max-width: 420px;
  text-align: left;
  line-height: 2.2;
}

.scene .moment {
  color: var(--pink-glow);
  font-weight: 500;
  font-size: 1.1em;
  text-shadow: 0 0 30px rgba(255, 107, 157, 0.5);
  letter-spacing: 1px;
}

.scene .time {
  color: var(--dim);
  font-family: var(--font-crt);
  font-size: 0.85em;
  letter-spacing: 3px;
}

.scene .phone {
  color: var(--pink-light);
  font-family: var(--font-crt);
  font-size: 0.95em;
  letter-spacing: 0.5px;
  opacity: 0.9;
}

/* ═══════════════════════════════════════════════════════════════════════════
   CHOICES — The weight of decisions
   ═══════════════════════════════════════════════════════════════════════════ */
.choices {
  width: 100%;
  max-width: 480px;
  display: flex;
  flex-direction: column;
  gap: 14px;
  opacity: 0;
  transform: translateY(25px);
  transition: all 1.2s 0.4s var(--ease-smooth);
}

.choices.show { opacity: 1; transform: translateY(0); }

.choice {
  width: 100%;
  padding: 18px 22px;
  background: linear-gradient(145deg, rgba(15, 8, 5, 0.95), rgba(8, 4, 2, 0.98));
  border: 1px solid rgba(92, 64, 51, 0.3);
  border-radius: 8px;
  color: var(--white);
  font-family: var(--font-serif);
  font-size: clamp(1rem, 2.2vw, 1.2rem);
  text-align: left;
  cursor: pointer;
  transition: all 0.5s var(--ease-smooth);
  position: relative;
  overflow: hidden;
}

.choice::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(90deg, transparent, rgba(166, 124, 82, 0.08), transparent);
  transform: translateX(-100%);
  transition: transform 0.7s var(--ease-smooth);
}

.choice:hover:not(:disabled)::before {
  transform: translateX(100%);
}

.choice:hover:not(:disabled) {
  border-color: var(--earth-glow);
  transform: translateX(8px);
  box-shadow: 
    0 6px 25px rgba(92, 64, 51, 0.2),
    inset 0 0 30px rgba(166, 124, 82, 0.05);
}

.choice:disabled {
  cursor: default;
  opacity: 0.4;
}

.choice.selected {
  border-color: var(--earth);
  background: linear-gradient(145deg, rgba(92, 64, 51, 0.2), rgba(92, 64, 51, 0.08));
  box-shadow: 0 0 40px rgba(166, 124, 82, 0.25);
}

.choice .choice-text {
  display: block;
  margin-bottom: 10px;
  line-height: 1.5;
}

.choice .effect {
  display: block;
  font-size: 0.8rem;
  color: var(--earth-pale);
  font-family: var(--font-crt);
  font-style: italic;
  letter-spacing: 1px;
}

.choice .preview {
  display: block;
  font-size: 0.72rem;
  color: var(--dim);
  margin-top: 8px;
  font-family: var(--font-hand);
}

/* ═══════════════════════════════════════════════════════════════════════════
   MEMORY MATCH GAME
   ═══════════════════════════════════════════════════════════════════════════ */
.match-container {
  width: 100%;
  max-width: 440px;
  opacity: 0;
  transform: scale(0.96);
  transition: all 1.2s var(--ease-smooth);
}

.match-container.show { opacity: 1; transform: scale(1); }

.match-header {
  text-align: center;
  margin-bottom: 24px;
}

.match-title {
  font-size: clamp(1rem, 2.2vw, 1.25rem);
  font-family: var(--font-crt);
  color: var(--earth-glow);
  letter-spacing: 0.25em;
  text-shadow: 0 0 25px rgba(166, 124, 82, 0.4);
  margin-bottom: 10px;
}

.match-subtitle {
  font-family: var(--font-hand);
  font-size: 1.1rem;
  color: var(--earth-pale);
  opacity: 0.7;
}

.match-stakes {
  display: flex;
  justify-content: center;
  gap: 36px;
  margin: 20px 0;
}

.stake {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 6px;
}

.stake-label {
  font-size: 10px;
  font-family: var(--font-crt);
  color: var(--dim);
  letter-spacing: 2px;
}

.stake-value {
  font-size: 20px;
  font-family: var(--font-crt);
  color: var(--gold);
}

.hearts {
  display: flex;
  gap: 4px;
}

.heart {
  width: 14px;
  height: 14px;
  fill: var(--pink-glow);
  opacity: 0.25;
  transition: all 0.4s var(--ease-smooth);
}

.heart.active {
  opacity: 1;
  filter: drop-shadow(0 0 6px var(--pink-glow));
}

.heart.lost {
  opacity: 0.15;
  fill: var(--dim);
}

.match-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 12px;
}

.match-card {
  aspect-ratio: 1;
  background: linear-gradient(145deg, #1a1410, #0d0a08);
  border: 2px solid #2a2015;
  border-radius: 14px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: var(--font-hand);
  font-size: clamp(0.75rem, 1.7vw, 0.95rem);
  color: var(--dim);
  cursor: pointer;
  transition: all 0.5s var(--ease-smooth);
  position: relative;
  overflow: hidden;
}

.match-card::before {
  content: '';
  position: absolute;
  inset: 0;
  background: radial-gradient(circle at center, rgba(166, 124, 82, 0.15) 0%, transparent 70%);
  opacity: 0;
  transition: opacity 0.4s;
}

.match-card:hover:not(.flipped):not(.matched)::before { opacity: 1; }

.match-card:hover:not(.flipped):not(.matched) {
  border-color: #3a2a1f;
  transform: scale(1.04);
  box-shadow: 0 6px 25px rgba(0, 0, 0, 0.5);
}

.match-card.flipped,
.match-card.matched {
  background: linear-gradient(145deg, #2a1a10, #1a0c08);
  border-color: var(--earth);
}

.match-card.flipped .card-inner,
.match-card.matched .card-inner {
  opacity: 1;
  transform: rotateY(0);
}

.card-inner {
  opacity: 0;
  transform: rotateY(90deg);
  transition: all 0.6s var(--ease-smooth);
  color: var(--earth-pale);
  text-align: center;
  padding: 8px;
  line-height: 1.6;
}

.match-card.matched {
  border-color: var(--trust);
  box-shadow: 0 0 25px rgba(90, 138, 74, 0.3);
}

.match-card.matched .card-inner {
  color: var(--trust);
}

.match-card.wrong {
  animation: shake 0.35s;
  border-color: #aa4444;
}

.match-story {
  margin-top: 28px;
  text-align: center;
  min-height: 70px;
  font-family: var(--font-serif);
  font-size: 1.05rem;
  color: var(--gold-light);
  font-style: italic;
  line-height: 2;
  opacity: 0;
  transform: translateY(12px);
  transition: all 0.7s var(--ease-smooth);
}

.match-story.show {
  opacity: 1;
  transform: translateY(0);
}

/* ═══════════════════════════════════════════════════════════════════════════
   HUD — Emotional state visualization
   ═══════════════════════════════════════════════════════════════════════════ */
.hud {
  position: fixed;
  bottom: 20px;
  right: 20px;
  z-index: 50;
  text-align: right;
  opacity: 0;
  transform: translateX(25px);
  transition: all 1.2s var(--ease-smooth);
}

.hud.show { opacity: 1; transform: translateX(0); }

.hud-title {
  font-size: 10px;
  font-family: var(--font-crt);
  color: var(--dim);
  letter-spacing: 3px;
  margin-bottom: 10px;
  text-transform: uppercase;
}

.meter {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 12px;
}

.meter-label {
  font-size: 11px;
  font-family: var(--font-crt);
  color: var(--dim);
  width: 55px;
  text-align: right;
}

.meter-bar {
  width: 110px;
  height: 7px;
  background: #0a0a0a;
  border-radius: 4px;
  overflow: hidden;
  border: 1px solid #1a1a1a;
}

.meter-fill {
  height: 100%;
  transition: width 0.8s var(--ease-smooth);
  border-radius: 3px;
}

.meter-fill.trust {
  background: linear-gradient(90deg, var(--earth-deep), var(--earth-glow));
  box-shadow: 0 0 10px rgba(166, 124, 82, 0.3);
}

.meter-fill.guard {
  background: linear-gradient(90deg, #2a2a35, #4a4a55);
}

.meter-value {
  font-size: 13px;
  font-family: var(--font-crt);
  color: var(--earth-pale);
  min-width: 28px;
}

/* ═══════════════════════════════════════════════════════════════════════════
   CONTINUE HINT
   ═══════════════════════════════════════════════════════════════════════════ */
.hint {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  color: var(--gold);
  font-family: var(--font-crt);
  font-size: 0.85rem;
  opacity: 0;
  letter-spacing: 2px;
  transition: opacity 0.6s;
  animation: hintPulse 3s ease-in-out infinite;
}

.hint.show { opacity: 0.6; }

@keyframes hintPulse {
  0%, 100% { opacity: 0.25; transform: translateX(-50%) translateY(0); }
  50% { opacity: 0.7; transform: translateX(-50%) translateY(-4px); }
}

/* ═══════════════════════════════════════════════════════════════════════════
   VISUAL EFFECTS — Glitch, pulse, shake
   ═══════════════════════════════════════════════════════════════════════════ */
.glitch-overlay {
  position: fixed;
  inset: 0;
  z-index: 200;
  pointer-events: none;
  opacity: 0;
  background: repeating-linear-gradient(
    0deg,
    transparent,
    transparent 2px,
    rgba(255, 107, 157, 0.1) 2px,
    rgba(255, 107, 157, 0.1) 4px
  );
  transition: opacity 0.25s;
}

.glitch-overlay.on {
  opacity: 1;
  animation: glitchFlash 0.18s ease-out;
}

@keyframes glitchFlash {
  0% { opacity: 0.5; }
  100% { opacity: 0; }
}

.emotional-pulse {
  position: fixed;
  inset: 0;
  z-index: 150;
  pointer-events: none;
  opacity: 0;
  background: radial-gradient(
    circle at var(--cx, 50%) var(--cy, 50%),
    rgba(166, 124, 82, 0.2) 0%,
    transparent 55%
  );
  transition: opacity 1.5s;
}

.emotional-pulse.on {
  opacity: 1;
  animation: pulseExpand 2.5s ease-out;
}

@keyframes pulseExpand {
  0% { transform: scale(0.4); opacity: 0; }
  40% { opacity: 1; }
  100% { transform: scale(2.5); opacity: 0; }
}

.screen-shake {
  animation: screenShake 0.6s ease-out;
}

@keyframes screenShake {
  0%, 100% { transform: translate(0); }
  10% { transform: translate(-3px, 2px); }
  30% { transform: translate(3px, -2px); }
  50% { transform: translate(-2px, 3px); }
  70% { transform: translate(2px, -3px); }
  90% { transform: translate(-1px, 1px); }
}

@keyframes shake {
  10%, 90% { transform: translate(-2px); }
  20%, 80% { transform: translate(2px); }
  30%, 50%, 70% { transform: translate(-4px); }
  40%, 60% { transform: translate(4px); }
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(12px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes burstIn {
  from { transform: scale(1.4); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}

/* ═══════════════════════════════════════════════════════════════════════════
   AUDIO CONTROL
   ═══════════════════════════════════════════════════════════════════════════ */
.audio-btn {
  position: fixed;
  top: 12px;
  right: 12px;
  z-index: 200;
  background: rgba(0, 0, 0, 0.7);
  border: 1px solid #2a2520;
  border-radius: 4px;
  color: var(--dim);
  font-family: var(--font-crt);
  font-size: 11px;
  padding: 5px 12px;
  cursor: pointer;
  transition: all 0.4s var(--ease-smooth);
}

.audio-btn:hover,
.audio-btn.on {
  color: var(--earth-glow);
  border-color: var(--earth);
  box-shadow: 0 0 15px rgba(166, 124, 82, 0.2);
}

/* ═══════════════════════════════════════════════════════════════════════════
   TOUCH RIPPLE
   ═══════════════════════════════════════════════════════════════════════════ */
.touch-ripple {
  position: fixed;
  border-radius: 50%;
  pointer-events: none;
  z-index: 9999;
  border: 2px solid var(--earth);
  animation: touchRipple 0.9s ease-out forwards;
  opacity: 0;
}

@keyframes touchRipple {
  0% { transform: scale(0); opacity: 0.7; }
  100% { transform: scale(4.5); opacity: 0; }
}

/* ═══════════════════════════════════════════════════════════════════════════
   RATING BADGE
   ═══════════════════════════════════════════════════════════════════════════ */
.rating-badge {
  position: fixed;
  bottom: 20px;
  left: 20px;
  background: rgba(0, 0, 0, 0.6);
  padding: 7px 14px;
  border-radius: 4px;
  border: 1px solid #2a2520;
  font-family: var(--font-crt);
  font-size: 10px;
  color: var(--earth-pale);
  z-index: 50;
  opacity: 0;
  transition: opacity 1.2s;
}

.rating-badge.show { opacity: 0.6; }

/* ═══════════════════════════════════════════════════════════════════════════
   RESPONSIVE
   ═══════════════════════════════════════════════════════════════════════════ */
@media (max-width: 600px) {
  .main { padding: 80px 18px 40px; }
  .choices { gap: 12px; }
  .choice { padding: 16px 18px; }
  .match-grid { gap: 10px; }
  .match-card { font-size: 0.7rem; }
}
</style>
</head>
<body>

<!-- Loading Overlay -->
<div id="loading-overlay">
  <svg class="seed-loading" viewBox="0 0 100 100">
    <defs>
      <radialGradient id="sgLoad" cx="50%" cy="50%">
        <stop offset="0%" stop-color="#a8e6a3" stop-opacity="0.7"/>
        <stop offset="100%" stop-color="#558b2f" stop-opacity="0.25"/>
      </radialGradient>
      <filter id="seedGlow">
        <feGaussianBlur stdDeviation="2" result="blur"/>
        <feMerge>
          <feMergeNode in="blur"/>
          <feMergeNode in="SourceGraphic"/>
        </feMerge>
      </filter>
    </defs>
    <ellipse cx="50" cy="50" rx="20" ry="32" fill="url(#sgLoad)" transform="rotate(-15 50 50)" filter="url(#seedGlow)">
      <animate attributeName="ry" values="32;35;32" dur="3s" repeatCount="indefinite"/>
    </ellipse>
    <ellipse cx="50" cy="36" rx="7" ry="4" fill="#c8e6c9" transform="rotate(-15 50 36)"/>
    <path d="M40 18 Q50 4 60 18" stroke="#81c784" stroke-width="2.5" fill="none" stroke-linecap="round">
      <animate attributeName="d" values="M40 18 Q50 4 60 18;M40 15 Q50 0 60 15;M40 18 Q50 4 60 18" dur="3s" repeatCount="indefinite"/>
    </path>
  </svg>
  <h1>SIDE A: SOIL</h1>
  <div class="sub">where it all began</div>
  <div class="boot-text" id="boot-text"></div>
</div>

<!-- Main CRT Screen -->
<div class="crt-screen">
  <div class="scan-bar"></div>
  <div class="tracking-bar" id="tracking"></div>
  
  <!-- VHS Background -->
  <div id="vhs-layer">
    <canvas id="vhs-canvas"></canvas>
  </div>
  <div id="noise-layer"></div>
  <div id="particles"></div>
  
  <!-- Background Scenes -->
  <div id="bg-scenes">
    <!-- Scene: Seed Growing -->
    <div class="bg-scene scene-seed active" data-scene="0">
      <svg viewBox="0 0 400 300" preserveAspectRatio="xMidYMid slice">
        <defs>
          <linearGradient id="soilGrad" x1="0%" y1="0%" x2="0%" y2="100%">
            <stop offset="0%" stop-color="#3d2b1f"/>
            <stop offset="50%" stop-color="#2a1a0a"/>
            <stop offset="100%" stop-color="#150a05"/>
          </linearGradient>
          <linearGradient id="stemGrad" x1="0%" y1="100%" x2="0%" y2="0%">
            <stop offset="0%" stop-color="#558b2f" stop-opacity="0.7"/>
            <stop offset="100%" stop-color="#a8e6a3" stop-opacity="0.6"/>
          </linearGradient>
          <radialGradient id="flowerGrad" cx="50%" cy="50%">
            <stop offset="0%" stop-color="#ffb3cc" stop-opacity="0.8"/>
            <stop offset="100%" stop-color="#ff6b9d" stop-opacity="0.6"/>
          </radialGradient>
          <radialGradient id="glowAura" cx="50%" cy="30%">
            <stop offset="0%" stop-color="#a8e6a3" stop-opacity="0.2"/>
            <stop offset="100%" stop-color="transparent"/>
          </radialGradient>
          <linearGradient id="skyGrad" x1="0%" y1="0%" x2="0%" y2="100%">
            <stop offset="0%" stop-color="#0a0a12"/>
            <stop offset="100%" stop-color="#050508"/>
          </linearGradient>
        </defs>
        
        <!-- Sky -->
        <rect x="0" y="0" width="400" height="200" fill="url(#skyGrad)"/>
        
        <!-- Glow aura -->
        <ellipse class="glow-aura" cx="200" cy="70" rx="120" ry="100" fill="url(#glowAura)"/>
        
        <!-- Soil -->
        <rect class="soil" x="0" y="200" width="400" height="100" fill="url(#soilGrad)"/>
        
        <!-- Grass blades -->
        <g class="grass-group">
          <path class="grass" d="M50 200 Q52 180 48 165" stroke="#3a5a2a" stroke-width="2" fill="none" opacity="0.5"/>
          <path class="grass" d="M80 200 Q85 175 78 158" stroke="#3a5a2a" stroke-width="2" fill="none" opacity="0.4"/>
          <path class="grass" d="M320 200 Q322 178 318 162" stroke="#3a5a2a" stroke-width="2" fill="none" opacity="0.5"/>
          <path class="grass" d="M350 200 Q355 172 348 155" stroke="#3a5a2a" stroke-width="2" fill="none" opacity="0.4"/>
        </g>
        
        <!-- Roots -->
        <g class="roots" transform="translate(200, 200)">
          <path d="M0 0 Q-25 35 -50 60" stroke="#4a3020" stroke-width="4" fill="none" opacity="0.5"/>
          <path d="M0 0 Q20 40 35 70" stroke="#4a3020" stroke-width="4" fill="none" opacity="0.5"/>
          <path d="M0 0 Q-8 50 -20 85" stroke="#4a3020" stroke-width="3" fill="none" opacity="0.35"/>
          <path d="M0 0 Q12 45 25 80" stroke="#4a3020" stroke-width="3" fill="none" opacity="0.35"/>
        </g>
        
        <!-- Main stem -->
        <g transform="translate(200, 200)">
          <g class="main-stem">
            <g class="stem-segment">
              <path d="M0 0 Q-8 -40 0 -80" stroke="url(#stemGrad)" stroke-width="8" fill="none"/>
            </g>
            <g class="stem-segment" transform="translate(0, -80)">
              <path d="M0 0 Q8 -35 0 -70" stroke="url(#stemGrad)" stroke-width="6" fill="none"/>
            </g>
          </g>
          
          <!-- Lower leaves -->
          <g transform="translate(0, -55)">
            <path class="leaf" d="M0 0 Q-40 -18 -55 15 Q-35 22 0 8 Z" fill="url(#stemGrad)"/>
            <path class="leaf" d="M0 0 Q40 -18 55 15 Q35 22 0 8 Z" fill="url(#stemGrad)"/>
          </g>
          
          <!-- Upper leaves -->
          <g transform="translate(0, -100)">
            <path class="leaf" d="M0 0 Q-35 -12 -48 12 Q-30 18 0 6 Z" fill="url(#stemGrad)"/>
            <path class="leaf" d="M0 0 Q35 -12 48 12 Q30 18 0 6 Z" fill="url(#stemGrad)"/>
          </g>
        </g>
        
        <!-- Flower -->
        <g transform="translate(200, 65)">
          <ellipse class="petal" cx="0" cy="-25" rx="14" ry="28" fill="url(#flowerGrad)"/>
          <ellipse class="petal" cx="24" cy="-8" rx="14" ry="28" fill="url(#flowerGrad)" transform="rotate(72)"/>
          <ellipse class="petal" cx="15" cy="20" rx="14" ry="28" fill="url(#flowerGrad)" transform="rotate(144)"/>
          <ellipse class="petal" cx="-15" cy="20" rx="14" ry="28" fill="url(#flowerGrad)" transform="rotate(216)"/>
          <ellipse class="petal" cx="-24" cy="-8" rx="14" ry="28" fill="url(#flowerGrad)" transform="rotate(288)"/>
          <circle class="flower-center" cx="0" cy="0" r="12" fill="#d4af37" opacity="0.7"/>
        </g>
        
        <!-- Pollen particles -->
        <circle class="pollen" cx="175" cy="55" r="2.5" fill="#d4af37" opacity="0.5"/>
        <circle class="pollen" cx="225" cy="45" r="2" fill="#d4af37" opacity="0.4"/>
        <circle class="pollen" cx="200" cy="40" r="2.5" fill="#d4af37" opacity="0.5"/>
        <circle class="pollen" cx="185" cy="70" r="1.5" fill="#d4af37" opacity="0.35"/>
        <circle class="pollen" cx="215" cy="60" r="2" fill="#d4af37" opacity="0.45"/>
        
        <!-- Water drops -->
        <ellipse class="water-drop" cx="140" cy="100" rx="2.5" ry="5" fill="#5588bb" opacity="0.35"/>
        <ellipse class="water-drop" cx="260" cy="120" rx="2" ry="4" fill="#5588bb" opacity="0.3"/>
        <ellipse class="water-drop" cx="180" cy="140" rx="2" ry="4.5" fill="#5588bb" opacity="0.25"/>
        
        <!-- Butterfly -->
        <g class="butterfly" transform="translate(70, 95)">
          <ellipse class="butterfly-wing" cx="-8" cy="0" rx="8" ry="5" fill="#ff6b9d" opacity="0.5"/>
          <ellipse class="butterfly-wing" cx="8" cy="0" rx="8" ry="5" fill="#ff6b9d" opacity="0.5"/>
          <ellipse cx="0" cy="0" rx="2" ry="5" fill="#9d3355" opacity="0.6"/>
        </g>
        
        <!-- Second butterfly -->
        <g class="butterfly" transform="translate(310, 130)" style="animation-delay: 5s;">
          <ellipse class="butterfly-wing" cx="-6" cy="0" rx="6" ry="4" fill="#ffb3cc" opacity="0.4"/>
          <ellipse class="butterfly-wing" cx="6" cy="0" rx="6" ry="4" fill="#ffb3cc" opacity="0.4"/>
          <ellipse cx="0" cy="0" rx="1.5" ry="4" fill="#c45c7a" opacity="0.5"/>
        </g>
      </svg>
    </div>
  </div>
  
  <!-- Effects layers -->
  <div class="glitch-overlay" id="glitch"></div>
  <div class="emotional-pulse" id="pulse"></div>
  
  <!-- Header -->
  <div class="header">
    <a href="index.html" class="back-btn">◀ EJECT</a>
    <div class="tape-label">SIDE A: SOIL</div>
    <div class="scene-counter" id="counter"></div>
  </div>
  
  <!-- Audio button -->
  <button class="audio-btn" id="audio-btn">♪ SOUND OFF</button>
  
  <!-- Main content -->
  <div class="main" id="main">
    <div class="sheepy-container" id="sheepy">
      <div class="sheepy-glow" id="sglow"></div>
      <div class="sheepy-text" id="stxt"></div>
    </div>
    <div class="scene" id="scene"></div>
    <div class="choices" id="choices"></div>
    <div class="match-container" id="match" style="display: none;"></div>
  </div>
  
  <!-- HUD -->
  <div class="hud" id="hud">
    <div class="hud-title">Emotional State</div>
    <div class="meter">
      <span class="meter-label">TRUST</span>
      <div class="meter-bar">
        <div class="meter-fill trust" id="tbar" style="width: 0%;"></div>
      </div>
      <span class="meter-value" id="tval">0</span>
    </div>
    <div class="meter">
      <span class="meter-label">GUARD</span>
      <div class="meter-bar">
        <div class="meter-fill guard" id="gbar" style="width: 0%;"></div>
      </div>
      <span class="meter-value" id="gval">0</span>
    </div>
  </div>
  
  <!-- Continue hint -->
  <div class="hint" id="hint">[ TAP TO CONTINUE ]</div>
  
  <!-- Rating badge -->
  <div class="rating-badge" id="rating">SIDE A: SOIL</div>
</div>

<script>
'use strict';

/* ═══════════════════════════════════════════════════════════════════════════
   UTILITIES
   ═══════════════════════════════════════════════════════════════════════════ */
const $ = id => document.getElementById(id);
const sleep = ms => new Promise(r => setTimeout(r, ms));
const rand = (min, max) => Math.random() * (max - min) + min;
const clamp = (v, min, max) => Math.max(min, Math.min(max, v));

/* ═══════════════════════════════════════════════════════════════════════════
   STATE MANAGEMENT — Inline decision engine
   ═══════════════════════════════════════════════════════════════════════════ */
const EFFECTS = {
  e_trust_1: { type: 'stat', stat: 'trust', delta: 1 },
  e_trust_2: { type: 'stat', stat: 'trust', delta: 2 },
  e_trust_3: { type: 'stat', stat: 'trust', delta: 3 },
  e_guard_1: { type: 'stat', stat: 'guard', delta: 1 },
  e_guard_2: { type: 'stat', stat: 'guard', delta: 2 },
  e_replied_fast: { type: 'flag' },
  e_replied_slow: { type: 'flag' },
  e_first_impression_eager: { type: 'flag' },
  e_first_impression_guarded: { type: 'flag' },
  e_first_impression_passive: { type: 'flag' },
  e_hesitated: { type: 'flag' },
  e_honesty_moment: { type: 'flag' },
  e_tension_built: { type: 'flag' },
  e_caught_smiling: { type: 'flag' },
  e_warmth_shown: { type: 'flag' },
  e_curious: { type: 'flag' },
  e_learning_her_language: { type: 'flag' },
  e_sought_connection: { type: 'flag' },
  e_time_invested: { type: 'flag' },
  e_shared_laughter: { type: 'flag' },
  e_game_memory: { type: 'flag' },
  e_observer_role: { type: 'flag' },
  e_vulnerability_shown: { type: 'flag' },
  e_playful_dynamic: { type: 'flag' },
  e_physical_contact: { type: 'flag' },
  e_intimacy_first: { type: 'flag' },
  e_crossed_boundary: { type: 'flag' },
  e_distance_kept: { type: 'flag' },
  e_safety_chose: { type: 'flag' },
  e_observer_deepened: { type: 'flag' },
  e_silent_caring: { type: 'flag' },
  e_voice_heard_3am: { type: 'flag' },
  e_sunrise_together: { type: 'flag' },
  e_missed_moment: { type: 'flag' },
  e_voice_shared: { type: 'flag' },
  e_intimate_medium: { type: 'flag' },
  e_territorial: { type: 'flag' },
  e_claimed_space: { type: 'flag' },
  e_jealousy_shown: { type: 'flag' },
  e_jealousy_hidden: { type: 'flag' },
  e_sought_place: { type: 'flag' },
  e_different_answer: { type: 'flag' },
  e_mask_worn: { type: 'flag' },
  e_feeling_denied: { type: 'flag' },
  e_fear_chose: { type: 'flag' },
  e_retreated: { type: 'flag' },
  e_committed: { type: 'flag' },
  e_patience_shown: { type: 'flag' },
  e_soil_rich: { type: 'arc' },
  e_soil_rocky: { type: 'arc' },
  e_soil_barren: { type: 'arc' },
  e_high_stakes: { type: 'flag' },
  e_full_investment: { type: 'flag' },
  e_cautious_hope: { type: 'flag' },
  e_waiting_still: { type: 'flag' },
  e_time_needed: { type: 'flag' }
};

const DECISIONS = {
  d_tape1_reply_speed: {
    options: [
      { id: 'reply_immediately', effects: ['e_trust_1', 'e_replied_fast', 'e_first_impression_eager'] },
      { id: 'wait_hours', effects: ['e_guard_1', 'e_replied_slow', 'e_first_impression_guarded'] },
      { id: 'stare_screen', effects: ['e_replied_slow', 'e_first_impression_passive', 'e_hesitated'] }
    ]
  },
  d_tape1_sigma_reaction: {
    options: [
      { id: 'call_annoying', effects: ['e_guard_1', 'e_honesty_moment', 'e_tension_built'] },
      { id: 'say_nothing_smile', effects: ['e_trust_1', 'e_caught_smiling', 'e_warmth_shown'] },
      { id: 'ask_meaning', effects: ['e_curious', 'e_learning_her_language', 'e_sought_connection'] }
    ]
  },
  d_tape1_princess_tycoon: {
    options: [
      { id: 'play_complain', effects: ['e_trust_1', 'e_time_invested', 'e_shared_laughter', 'e_game_memory'] },
      { id: 'refuse_watch', effects: ['e_guard_1', 'e_observer_role', 'e_game_memory'] },
      { id: 'make_challenge', effects: ['e_trust_1', 'e_vulnerability_shown', 'e_playful_dynamic', 'e_game_memory'] }
    ]
  },
  d_tape1_scratch: {
    options: [
      { id: 'take_hand', effects: ['e_trust_2', 'e_physical_contact', 'e_intimacy_first', 'e_crossed_boundary'] },
      { id: 'look_away', effects: ['e_guard_1', 'e_distance_kept', 'e_safety_chose'] },
      { id: 'file_away', effects: ['e_observer_deepened', 'e_silent_caring'] }
    ]
  },
  d_tape1_late_night: {
    options: [
      { id: 'call_now', effects: ['e_trust_2', 'e_vulnerability_shown', 'e_voice_heard_3am', 'e_sunrise_together'] },
      { id: 'text_back_safe', effects: ['e_guard_1', 'e_safety_chose', 'e_missed_moment'] },
      { id: 'voice_note', effects: ['e_trust_1', 'e_vulnerability_shown', 'e_voice_shared', 'e_intimate_medium'] }
    ]
  },
  d_tape1_jealousy: {
    options: [
      { id: 'tell_her_busy', effects: ['e_guard_1', 'e_territorial', 'e_claimed_space', 'e_jealousy_shown'] },
      { id: 'annoying_how', effects: ['e_trust_1', 'e_sought_place', 'e_jealousy_shown', 'e_different_answer'] },
      { id: 'change_subject', effects: ['e_mask_worn', 'e_jealousy_hidden', 'e_feeling_denied'] }
    ]
  },
  d_tape1_realization: {
    options: [
      { id: 'pull_back', effects: ['e_guard_2', 'e_fear_chose', 'e_retreated'] },
      { id: 'lean_in', effects: ['e_trust_2', 'e_vulnerability_shown', 'e_committed'] },
      { id: 'watch_grow', effects: ['e_observer_deepened', 'e_patience_shown'] }
    ]
  },
  d_tape1_soil_choice: {
    options: [
      { id: 'rich_soil', effects: ['e_trust_3', 'e_soil_rich', 'e_high_stakes', 'e_full_investment'] },
      { id: 'rocky_soil', effects: ['e_guard_2', 'e_soil_rocky', 'e_cautious_hope'] },
      { id: 'barren_soil', effects: ['e_soil_barren', 'e_waiting_still', 'e_time_needed'] }
    ]
  }
};

const State = {
  trust: 0,
  guard: 0,
  flags: new Set(),
  choices: {},
  
  apply(effectIds) {
    const results = [];
    for (const id of effectIds) {
      const e = EFFECTS[id];
      if (!e) continue;
      if (e.type === 'stat') {
        this[e.stat] = clamp(this[e.stat] + e.delta, 0, 100);
        results.push({ type: 'stat', stat: e.stat, delta: e.delta });
      } else {
        this.flags.add(id);
        results.push({ type: e.type, id });
      }
    }
    return results;
  },
  
  hasFlag(id) {
    return this.flags.has(id);
  },
  
  save() {
    try {
      const s = JSON.parse(localStorage.getItem('seed_archive_v3') || '{}');
      s.tape1 = {
        complete: true,
        trust: this.trust,
        guard: this.guard,
        soil: this.hasFlag('e_soil_rich') ? 'rich' : this.hasFlag('e_soil_rocky') ? 'rocky' : 'barren',
        flags: [...this.flags]
      };
      localStorage.setItem('seed_archive_v3', JSON.stringify(s));
    } catch {}
  },
  
  updateHUD() {
    $('tbar').style.width = Math.min(this.trust, 100) + '%';
    $('gbar').style.width = Math.min(this.guard, 100) + '%';
    $('tval').textContent = this.trust;
    $('gval').textContent = this.guard;
  }
};

/* ═══════════════════════════════════════════════════════════════════════════
   AUDIO ENGINE — Rich procedural sound design with ambient music
   ═══════════════════════════════════════════════════════════════════════════ */
const Audio = {
  ctx: null,
  master: null,
  musicGain: null,
  sfxGain: null,
  on: false,
  musicNodes: [],
  
  // Initialize audio context
  init() {
    if (this.ctx) return;
    
    this.ctx = new (window.AudioContext || window.webkitAudioContext)();
    
    // Master gain
    this.master = this.ctx.createGain();
    this.master.gain.value = 0;
    this.master.connect(this.ctx.destination);
    
    // Music bus
    this.musicGain = this.ctx.createGain();
    this.musicGain.gain.value = 0.4;
    this.musicGain.connect(this.master);
    
    // SFX bus
    this.sfxGain = this.ctx.createGain();
    this.sfxGain.gain.value = 0.7;
    this.sfxGain.connect(this.master);
  },
  
  resume() {
    if (this.ctx?.state === 'suspended') {
      this.ctx.resume();
    }
  },
  
  // Set master volume with fade
  vol(v, time = 0.5) {
    if (!this.master) return;
    const t = this.ctx.currentTime;
    this.master.gain.cancelScheduledValues(t);
    this.master.gain.setValueAtTime(this.master.gain.value, t);
    this.master.gain.linearRampToValueAtTime(v, t + time);
  },
  
  // === AMBIENT MUSIC SYSTEM ===
  startAmbient() {
    if (!this.ctx) return;
    
    // Stop any existing music
    this.stopAmbient();
    
    const now = this.ctx.currentTime;
    
    // Deep drone bass
    const drone = this.ctx.createOscillator();
    drone.type = 'sine';
    drone.frequency.value = 55; // A1
    const droneGain = this.ctx.createGain();
    droneGain.gain.setValueAtTime(0, now);
    droneGain.gain.linearRampToValueAtTime(0.08, now + 3);
    drone.connect(droneGain);
    droneGain.connect(this.musicGain);
    drone.start();
    this.musicNodes.push({ node: drone, gain: droneGain });
    
    // Sub-bass
    const sub = this.ctx.createOscillator();
    sub.type = 'sine';
    sub.frequency.value = 27.5; // A0
    const subGain = this.ctx.createGain();
    subGain.gain.setValueAtTime(0, now);
    subGain.gain.linearRampToValueAtTime(0.05, now + 4);
    sub.connect(subGain);
    subGain.connect(this.musicGain);
    sub.start();
    this.musicNodes.push({ node: sub, gain: subGain });
    
    // Harmonic pad
    const padFreqs = [110, 165, 220, 330]; // Am chord
    padFreqs.forEach((freq, i) => {
      const osc = this.ctx.createOscillator();
      osc.type = 'sine';
      osc.frequency.value = freq;
      const gain = this.ctx.createGain();
      gain.gain.setValueAtTime(0, now);
      gain.gain.linearRampToValueAtTime(0.02 + i * 0.005, now + 5);
      
      // Add subtle detune LFO
      const lfo = this.ctx.createOscillator();
      lfo.type = 'sine';
      lfo.frequency.value = 0.1 + Math.random() * 0.2;
      const lfoGain = this.ctx.createGain();
      lfoGain.gain.value = 1.5;
      lfo.connect(lfoGain);
      lfoGain.connect(osc.frequency);
      lfo.start();
      
      osc.connect(gain);
      gain.connect(this.musicGain);
      osc.start();
      this.musicNodes.push({ node: osc, gain, lfo });
    });
    
    // Gentle noise texture
    const noiseBuffer = this.ctx.createBuffer(1, this.ctx.sampleRate * 2, this.ctx.sampleRate);
    const noiseData = noiseBuffer.getChannelData(0);
    for (let i = 0; i < noiseData.length; i++) {
      noiseData[i] = (Math.random() * 2 - 1) * 0.5;
    }
    const noise = this.ctx.createBufferSource();
    noise.buffer = noiseBuffer;
    noise.loop = true;
    const noiseFilter = this.ctx.createBiquadFilter();
    noiseFilter.type = 'lowpass';
    noiseFilter.frequency.value = 200;
    const noiseGain = this.ctx.createGain();
    noiseGain.gain.setValueAtTime(0, now);
    noiseGain.gain.linearRampToValueAtTime(0.015, now + 6);
    noise.connect(noiseFilter);
    noiseFilter.connect(noiseGain);
    noiseGain.connect(this.musicGain);
    noise.start();
    this.musicNodes.push({ node: noise, gain: noiseGain });
    
    // Occasional melodic fragments
    this.playMelodicFragment();
  },
  
  playMelodicFragment() {
    if (!this.on || !this.ctx) return;
    
    const notes = [220, 261.63, 293.66, 329.63, 392]; // A minor pentatonic
    const note = notes[Math.floor(Math.random() * notes.length)];
    
    const osc = this.ctx.createOscillator();
    osc.type = 'sine';
    osc.frequency.value = note;
    
    const gain = this.ctx.createGain();
    const now = this.ctx.currentTime;
    gain.gain.setValueAtTime(0, now);
    gain.gain.linearRampToValueAtTime(0.03, now + 0.1);
    gain.gain.exponentialRampToValueAtTime(0.001, now + 2);
    
    osc.connect(gain);
    gain.connect(this.musicGain);
    osc.start(now);
    osc.stop(now + 2.5);
    
    // Schedule next fragment
    setTimeout(() => this.playMelodicFragment(), 8000 + Math.random() * 12000);
  },
  
  stopAmbient() {
    const now = this.ctx?.currentTime || 0;
    this.musicNodes.forEach(({ node, gain, lfo }) => {
      try {
        if (gain) {
          gain.gain.cancelScheduledValues(now);
          gain.gain.linearRampToValueAtTime(0, now + 2);
        }
        setTimeout(() => {
          try { node.stop(); } catch {}
          if (lfo) try { lfo.stop(); } catch {}
        }, 2500);
      } catch {}
    });
    this.musicNodes = [];
  },
  
  // === SOUND EFFECTS ===
  
  // Typing sound
  type() {
    if (!this.ctx || !this.on) return;
    const now = this.ctx.currentTime;
    const osc = this.ctx.createOscillator();
    const gain = this.ctx.createGain();
    osc.type = 'square';
    osc.frequency.value = 800 + Math.random() * 400;
    gain.gain.setValueAtTime(0.025, now);
    gain.gain.exponentialRampToValueAtTime(0.001, now + 0.03);
    osc.connect(gain);
    gain.connect(this.sfxGain);
    osc.start(now);
    osc.stop(now + 0.04);
  },
  
  // Soft click/tap
  click() {
    if (!this.ctx || !this.on) return;
    const now = this.ctx.currentTime;
    const osc = this.ctx.createOscillator();
    const gain = this.ctx.createGain();
    osc.type = 'sine';
    osc.frequency.value = 1200;
    gain.gain.setValueAtTime(0.08, now);
    gain.gain.exponentialRampToValueAtTime(0.001, now + 0.08);
    osc.connect(gain);
    gain.connect(this.sfxGain);
    osc.start(now);
    osc.stop(now + 0.1);
  },
  
  // Choice hover
  hover() {
    if (!this.ctx || !this.on) return;
    const now = this.ctx.currentTime;
    const osc = this.ctx.createOscillator();
    const gain = this.ctx.createGain();
    osc.type = 'sine';
    osc.frequency.value = 440;
    gain.gain.setValueAtTime(0.03, now);
    gain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);
    osc.connect(gain);
    gain.connect(this.sfxGain);
    osc.start(now);
    osc.stop(now + 0.12);
  },
  
  // Choice select
  select() {
    if (!this.ctx || !this.on) return;
    const now = this.ctx.currentTime;
    
    // Two-tone confirmation
    [440, 660].forEach((freq, i) => {
      const osc = this.ctx.createOscillator();
      const gain = this.ctx.createGain();
      osc.type = 'sine';
      osc.frequency.value = freq;
      gain.gain.setValueAtTime(0, now + i * 0.08);
      gain.gain.linearRampToValueAtTime(0.06, now + i * 0.08 + 0.02);
      gain.gain.exponentialRampToValueAtTime(0.001, now + i * 0.08 + 0.25);
      osc.connect(gain);
      gain.connect(this.sfxGain);
      osc.start(now + i * 0.08);
      osc.stop(now + i * 0.08 + 0.3);
    });
  },
  
  // Emotional moment
  emotional() {
    if (!this.ctx || !this.on) return;
    const now = this.ctx.currentTime;
    
    // Rising arpeggio
    [220, 277, 330, 440].forEach((freq, i) => {
      const osc = this.ctx.createOscillator();
      const gain = this.ctx.createGain();
      osc.type = 'sine';
      osc.frequency.value = freq;
      gain.gain.setValueAtTime(0, now + i * 0.12);
      gain.gain.linearRampToValueAtTime(0.05, now + i * 0.12 + 0.05);
      gain.gain.exponentialRampToValueAtTime(0.001, now + i * 0.12 + 0.8);
      osc.connect(gain);
      gain.connect(this.sfxGain);
      osc.start(now + i * 0.12);
      osc.stop(now + i * 0.12 + 1);
    });
  },
  
  // Glitch/distortion
  glitch() {
    if (!this.ctx || !this.on) return;
    const now = this.ctx.currentTime;
    
    // Noise burst
    const bufferSize = this.ctx.sampleRate * 0.1;
    const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);
    const data = buffer.getChannelData(0);
    for (let i = 0; i < bufferSize; i++) {
      data[i] = (Math.random() * 2 - 1) * (1 - i / bufferSize);
    }
    const noise = this.ctx.createBufferSource();
    noise.buffer = buffer;
    const gain = this.ctx.createGain();
    gain.gain.value = 0.1;
    noise.connect(gain);
    gain.connect(this.sfxGain);
    noise.start(now);
    
    // Low rumble
    const osc = this.ctx.createOscillator();
    osc.type = 'sawtooth';
    osc.frequency.value = 50;
    const oscGain = this.ctx.createGain();
    oscGain.gain.setValueAtTime(0.06, now);
    oscGain.gain.exponentialRampToValueAtTime(0.001, now + 0.15);
    osc.connect(oscGain);
    oscGain.connect(this.sfxGain);
    osc.start(now);
    osc.stop(now + 0.2);
  },
  
  // Power on
  powerOn() {
    if (!this.ctx || !this.on) return;
    const now = this.ctx.currentTime;
    
    // Rising tone
    const osc = this.ctx.createOscillator();
    osc.type = 'sawtooth';
    osc.frequency.setValueAtTime(30, now);
    osc.frequency.exponentialRampToValueAtTime(120, now + 0.5);
    const gain = this.ctx.createGain();
    gain.gain.setValueAtTime(0, now);
    gain.gain.linearRampToValueAtTime(0.08, now + 0.1);
    gain.gain.linearRampToValueAtTime(0.04, now + 0.4);
    gain.gain.linearRampToValueAtTime(0, now + 0.8);
    osc.connect(gain);
    gain.connect(this.sfxGain);
    osc.start(now);
    osc.stop(now + 1);
    
    // Noise sweep
    setTimeout(() => {
      const bufferSize = this.ctx.sampleRate * 0.4;
      const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);
      const data = buffer.getChannelData(0);
      for (let i = 0; i < bufferSize; i++) {
        data[i] = Math.random() * 2 - 1;
      }
      const noise = this.ctx.createBufferSource();
      noise.buffer = buffer;
      const filter = this.ctx.createBiquadFilter();
      filter.type = 'bandpass';
      filter.frequency.setValueAtTime(200, this.ctx.currentTime);
      filter.frequency.exponentialRampToValueAtTime(2000, this.ctx.currentTime + 0.3);
      filter.Q.value = 2;
      const ng = this.ctx.createGain();
      ng.gain.setValueAtTime(0.1, this.ctx.currentTime);
      ng.gain.exponentialRampToValueAtTime(0.001, this.ctx.currentTime + 0.4);
      noise.connect(filter);
      filter.connect(ng);
      ng.connect(this.sfxGain);
      noise.start();
    }, 200);
  },
  
  // Transition whoosh
  whoosh() {
    if (!this.ctx || !this.on) return;
    const now = this.ctx.currentTime;
    
    const bufferSize = this.ctx.sampleRate * 0.5;
    const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);
    const data = buffer.getChannelData(0);
    for (let i = 0; i < bufferSize; i++) {
      data[i] = (Math.random() * 2 - 1) * Math.sin(i / bufferSize * Math.PI);
    }
    const noise = this.ctx.createBufferSource();
    noise.buffer = buffer;
    const filter = this.ctx.createBiquadFilter();
    filter.type = 'bandpass';
    filter.frequency.value = 800;
    filter.Q.value = 1;
    const gain = this.ctx.createGain();
    gain.gain.value = 0.06;
    noise.connect(filter);
    filter.connect(gain);
    gain.connect(this.sfxGain);
    noise.start(now);
  },
  
  // Memory match sounds
  flip() {
    if (!this.ctx || !this.on) return;
    const now = this.ctx.currentTime;
    const osc = this.ctx.createOscillator();
    osc.type = 'triangle';
    osc.frequency.value = 300;
    const gain = this.ctx.createGain();
    gain.gain.setValueAtTime(0.05, now);
    gain.gain.exponentialRampToValueAtTime(0.001, now + 0.08);
    osc.connect(gain);
    gain.connect(this.sfxGain);
    osc.start(now);
    osc.stop(now + 0.1);
  },
  
  match() {
    if (!this.ctx || !this.on) return;
    const now = this.ctx.currentTime;
    [392, 523, 659].forEach((freq, i) => {
      const osc = this.ctx.createOscillator();
      osc.type = 'sine';
      osc.frequency.value = freq;
      const gain = this.ctx.createGain();
      gain.gain.setValueAtTime(0, now + i * 0.1);
      gain.gain.linearRampToValueAtTime(0.05, now + i * 0.1 + 0.02);
      gain.gain.exponentialRampToValueAtTime(0.001, now + i * 0.1 + 0.4);
      osc.connect(gain);
      gain.connect(this.sfxGain);
      osc.start(now + i * 0.1);
      osc.stop(now + i * 0.1 + 0.5);
    });
  },
  
  wrong() {
    if (!this.ctx || !this.on) return;
    const now = this.ctx.currentTime;
    const osc = this.ctx.createOscillator();
    osc.type = 'sawtooth';
    osc.frequency.value = 100;
    const gain = this.ctx.createGain();
    gain.gain.setValueAtTime(0.08, now);
    gain.gain.exponentialRampToValueAtTime(0.001, now + 0.2);
    osc.connect(gain);
    gain.connect(this.sfxGain);
    osc.start(now);
    osc.stop(now + 0.25);
  },
  
  complete() {
    if (!this.ctx || !this.on) return;
    const now = this.ctx.currentTime;
    [392, 494, 587, 784].forEach((freq, i) => {
      const osc = this.ctx.createOscillator();
      osc.type = 'sine';
      osc.frequency.value = freq;
      const gain = this.ctx.createGain();
      gain.gain.setValueAtTime(0, now + i * 0.15);
      gain.gain.linearRampToValueAtTime(0.06, now + i * 0.15 + 0.05);
      gain.gain.exponentialRampToValueAtTime(0.001, now + i * 0.15 + 0.8);
      osc.connect(gain);
      gain.connect(this.sfxGain);
      osc.start(now + i * 0.15);
      osc.stop(now + i * 0.15 + 1);
    });
  },
  
  // Boot sequence beep
  bootBeep() {
    if (!this.ctx || !this.on) return;
    const now = this.ctx.currentTime;
    const osc = this.ctx.createOscillator();
    osc.type = 'square';
    osc.frequency.value = 800;
    const gain = this.ctx.createGain();
    gain.gain.setValueAtTime(0.04, now);
    gain.gain.exponentialRampToValueAtTime(0.001, now + 0.05);
    osc.connect(gain);
    gain.connect(this.sfxGain);
    osc.start(now);
    osc.stop(now + 0.06);
  },
  
  // Ensure audio is enabled
  ensure() {
    this.init();
    this.resume();
    if (!this.on) {
      this.on = true;
      this.vol(0.5, 0.8);
      $('audio-btn').textContent = '♪ SOUND ON';
      $('audio-btn').classList.add('on');
      this.startAmbient();
    }
  },
  
  // Toggle audio
  toggle() {
    this.init();
    this.resume();
    this.on = !this.on;
    
    if (this.on) {
      this.vol(0.5, 0.8);
      $('audio-btn').textContent = '♪ SOUND ON';
      $('audio-btn').classList.add('on');
      this.startAmbient();
    } else {
      this.vol(0, 0.5);
      $('audio-btn').textContent = '♪ SOUND OFF';
      $('audio-btn').classList.remove('on');
      this.stopAmbient();
    }
  }
};

/* ═══════════════════════════════════════════════════════════════════════════
   VHS BACKGROUND RENDERER
   ═══════════════════════════════════════════════════════════════════════════ */
const VHS = {
  canvas: null,
  ctx: null,
  w: 0,
  h: 0,
  particles: [],
  
  init() {
    this.canvas = $('vhs-canvas');
    this.ctx = this.canvas.getContext('2d');
    this.resize();
    window.addEventListener('resize', () => this.resize());
    
    // Create floating particles
    for (let i = 0; i < 50; i++) {
      this.particles.push({
        x: Math.random() * this.w,
        y: Math.random() * this.h,
        vx: (Math.random() - 0.5) * 0.4,
        vy: -0.15 - Math.random() * 0.3,
        size: 1 + Math.random() * 4,
        opacity: 0.015 + Math.random() * 0.06,
        phase: Math.random() * Math.PI * 2
      });
    }
    
    this.animate();
  },
  
  resize() {
    this.w = this.canvas.width = innerWidth;
    this.h = this.canvas.height = innerHeight;
  },
  
  animate() {
    const c = this.ctx;
    const w = this.w;
    const h = this.h;
    
    if (!w) {
      requestAnimationFrame(() => this.animate());
      return;
    }
    
    // Fade trail
    c.fillStyle = 'rgba(5, 5, 5, 0.08)';
    c.fillRect(0, 0, w, h);
    
    // Draw particles
    for (const p of this.particles) {
      p.x += p.vx + Math.sin(p.phase += 0.003) * 0.4;
      p.y += p.vy;
      
      // Wrap around
      if (p.y < -15) {
        p.y = h + 15;
        p.x = Math.random() * w;
      }
      if (p.x < -15) p.x = w + 15;
      if (p.x > w + 15) p.x = -15;
      
      c.beginPath();
      c.arc(p.x, p.y, p.size, 0, Math.PI * 2);
      c.fillStyle = `rgba(166, 124, 82, ${p.opacity})`;
      c.fill();
    }
    
    // Occasional scan line
    if (Math.random() < 0.01) {
      c.fillStyle = 'rgba(166, 124, 82, 0.02)';
      c.fillRect(0, Math.random() * h, w, 2 + Math.random() * 8);
    }
    
    requestAnimationFrame(() => this.animate());
  }
};

/* ═══════════════════════════════════════════════════════════════════════════
   PARTICLE SYSTEM
   ═══════════════════════════════════════════════════════════════════════════ */
const Particles = {
  pool: [],
  animations: [],
  idx: 0,
  interval: null,
  
  init() {
    for (let i = 0; i < 25; i++) {
      const p = document.createElement('div');
      p.className = 'particle';
      p.style.cssText = 'opacity: 0; width: 3px; height: 3px;';
      $('particles').appendChild(p);
      this.pool.push(p);
      this.animations.push(null);
    }
  },
  
  spawn() {
    const i = this.idx++ % 25;
    if (this.animations[i]) {
      this.animations[i].cancel();
    }
    
    const p = this.pool[i];
    const size = 2 + Math.random() * 5;
    const duration = 12000 + Math.random() * 18000;
    const dx = (Math.random() - 0.5) * 100;
    const opacity = 0.03 + Math.random() * 0.12;
    
    p.style.cssText = `
      left: ${Math.random() * 100}%;
      bottom: -12px;
      width: ${size}px;
      height: ${size}px;
      background: radial-gradient(circle, rgba(166, 124, 82, 0.2), transparent);
      opacity: 0;
    `;
    
    this.animations[i] = p.animate([
      { transform: 'translateY(0) translateX(0)', opacity: 0 },
      { opacity: opacity, offset: 0.1 },
      { opacity: opacity, offset: 0.9 },
      { transform: `translateY(calc(-100vh - 25px)) translateX(${dx}px)`, opacity: 0 }
    ], {
      duration,
      fill: 'forwards'
    });
  },
  
  start() {
    if (!this.interval) {
      this.interval = setInterval(() => this.spawn(), 1500);
    }
  },
  
  stop() {
    clearInterval(this.interval);
    this.interval = null;
  }
};

/* ═══════════════════════════════════════════════════════════════════════════
   TOUCH RIPPLE
   ═══════════════════════════════════════════════════════════════════════════ */
document.addEventListener('pointerdown', e => {
  const ripple = document.createElement('div');
  ripple.className = 'touch-ripple';
  ripple.style.left = (e.clientX - 20) + 'px';
  ripple.style.top = (e.clientY - 20) + 'px';
  ripple.style.width = ripple.style.height = '40px';
  document.body.appendChild(ripple);
  setTimeout(() => ripple.remove(), 900);
}, { passive: true });

/* ═══════════════════════════════════════════════════════════════════════════
   SHEEPY NARRATOR
   ═══════════════════════════════════════════════════════════════════════════ */
const Sheepy = {
  moods: {
    nervous: 'M-5 5 Q-3 2 0 4 Q3 6 5 4',
    happy: 'M-6 3 Q0 10 6 3',
    sad: 'M-6 6 Q0 1 6 6',
    thoughtful: 'M-4 4 Q0 6 4 4',
    excited: 'M-6 2 Q0 10 6 2'
  },
  
  svg(size, mood = 'nervous', hold = false) {
    const mouth = this.moods[mood] || this.moods.nervous;
    return `
      <svg width="${size}" height="${size}" viewBox="0 0 120 120" style="animation: bounce 4s infinite">
        <ellipse cx="60" cy="78" rx="35" ry="28" fill="#e8e0d8"/>
        <ellipse cx="38" cy="72" rx="12" ry="10" fill="#fafafa"/>
        <ellipse cx="82" cy="72" rx="12" ry="10" fill="#fafafa"/>
        <ellipse cx="60" cy="35" rx="20" ry="16" fill="#ffeef0"/>
        <ellipse cx="33" cy="26" rx="7" ry="5" fill="#d8c8b8" transform="rotate(-18 33 26)"/>
        <ellipse cx="87" cy="26" rx="7" ry="5" fill="#d8c8b8" transform="rotate(18 87 26)"/>
        <ellipse cx="50" cy="32" rx="4" ry="5" fill="#222">
          <animate attributeName="ry" values="5;5;0.5;5;5" keyTimes="0;0.42;0.5;0.58;1" dur="4s" repeatCount="indefinite"/>
        </ellipse>
        <ellipse cx="70" cy="32" rx="4" ry="5" fill="#222">
          <animate attributeName="ry" values="5;5;0.5;5;5" keyTimes="0;0.42;0.5;0.58;1" dur="4s" repeatCount="indefinite"/>
        </ellipse>
        <circle cx="51" cy="30" r="1.5" fill="#fff"/>
        <circle cx="71" cy="30" r="1.5" fill="#fff"/>
        <ellipse cx="60" cy="42" rx="3" ry="2" fill="#c8a898"/>
        <g transform="translate(60 50)">
          <path d="${mouth}" stroke="#c8a898" stroke-width="2" fill="none" stroke-linecap="round"/>
        </g>
        ${hold ? `
          <g transform="translate(80 54)">
            <rect width="20" height="14" rx="2" fill="#fff5e6" stroke="#8b6914" stroke-width="1"/>
            <circle cx="10" cy="7" r="3" fill="#8b6914"/>
          </g>
        ` : ''}
      </svg>
    `;
  },
  
  show(mood, hold = false) {
    $('sglow').innerHTML = this.svg(120, mood, hold);
  },
  
  async say(text, speed = 30) {
    const el = $('stxt');
    el.innerHTML = '';
    
    for (let i = 0; i < text.length; i++) {
      if (text[i] === '<') {
        const j = text.indexOf('>', i);
        el.innerHTML += text.substring(i, j + 1);
        i = j;
      } else {
        el.innerHTML += text[i];
        Audio.type();
        await sleep(speed);
      }
    }
  }
};

/* ═══════════════════════════════════════════════════════════════════════════
   UI HELPERS
   ═══════════════════════════════════════════════════════════════════════════ */
const UI = {
  scene: $('scene'),
  choices: $('choices'),
  match: $('match'),
  hint: $('hint'),
  
  clear() {
    this.scene.innerHTML = '';
    this.choices.innerHTML = '';
    this.choices.classList.remove('show');
    this.match.style.display = 'none';
    this.hint.classList.remove('show');
  },
  
  p(html) {
    const el = document.createElement('p');
    el.innerHTML = html;
    this.scene.appendChild(el);
    return el;
  },
  
  async show(el, duration = 700) {
    el.classList.add('show');
    await sleep(duration);
  },
  
  waitClick() {
    return new Promise(resolve => {
      this.hint.classList.add('show');
      
      const handler = () => {
        this.hint.classList.remove('show');
        document.removeEventListener('click', handler);
        document.removeEventListener('keydown', keyHandler);
        resolve();
      };
      
      const keyHandler = e => {
        if (e.key === 'Enter' || e.key === ' ') {
          handler();
        }
      };
      
      document.addEventListener('click', handler);
      document.addEventListener('keydown', keyHandler);
    });
  }
};

/* ═══════════════════════════════════════════════════════════════════════════
   VISUAL EFFECTS
   ═══════════════════════════════════════════════════════════════════════════ */
const VFX = {
  glitch() {
    $('glitch').classList.add('on');
    Audio.glitch();
    setTimeout(() => $('glitch').classList.remove('on'), 200);
  },
  
  pulse(x = 50, y = 50) {
    const el = $('pulse');
    el.style.setProperty('--cx', x + '%');
    el.style.setProperty('--cy', y + '%');
    el.classList.remove('on');
    void el.offsetWidth; // Force reflow
    el.classList.add('on');
    setTimeout(() => el.classList.remove('on'), 2500);
  },
  
  emotional() {
    Audio.emotional();
    this.pulse();
    $('main').classList.add('screen-shake');
    setTimeout(() => $('main').classList.remove('screen-shake'), 600);
  },
  
  flash() {
    $('tracking').classList.add('on');
    setTimeout(() => $('tracking').classList.remove('on'), 1000);
  }
};

const updateCounter = (current, total) => {
  $('counter').textContent = `${current}/${total}`;
};

/* ═══════════════════════════════════════════════════════════════════════════
   CHOICE SYSTEM
   ═══════════════════════════════════════════════════════════════════════════ */
function choose(decisionId, options) {
  return new Promise(resolve => {
    UI.choices.innerHTML = '';
    
    const decision = DECISIONS[decisionId];
    
    for (const opt of options) {
      const btn = document.createElement('button');
      btn.className = 'choice';
      btn.innerHTML = `<span class="choice-text">${opt.text}</span>`;
      
      if (opt.preview) {
        btn.innerHTML += `<span class="preview">${opt.preview}</span>`;
      }
      
      // Hover sound
      btn.addEventListener('mouseenter', () => Audio.hover());
      
      btn.onclick = () => {
        Audio.select();
        
        // Disable all buttons
        document.querySelectorAll('.choice').forEach(b => b.disabled = true);
        btn.classList.add('selected');
        
        // Apply effects
        const optDef = decision?.options?.find(o => o.id === opt.id);
        if (optDef) {
          const results = State.apply(optDef.effects);
          State.choices[decisionId] = opt.id;
          State.updateHUD();
          
          // Show stat changes
          const trustDelta = results.filter(r => r.type === 'stat' && r.stat === 'trust')
            .reduce((sum, r) => sum + r.delta, 0);
          const guardDelta = results.filter(r => r.type === 'stat' && r.stat === 'guard')
            .reduce((sum, r) => sum + r.delta, 0);
          
          let effectText = '';
          if (trustDelta > 0) effectText += `Trust +${trustDelta}  `;
          if (guardDelta > 0) effectText += `Guard +${guardDelta}`;
          if (effectText) {
            btn.innerHTML += `<span class="effect">${effectText.trim()}</span>`;
          }
        }
        
        // Emotional effect
        if (opt.emotional) {
          VFX.emotional();
        }
        
        setTimeout(() => resolve(opt.id), 1800);
      };
      
      UI.choices.appendChild(btn);
    }
    
    UI.choices.classList.add('show');
  });
}

/* ═══════════════════════════════════════════════════════════════════════════
   MEMORY MATCH GAME
   ═══════════════════════════════════════════════════════════════════════════ */
const PAIRS = [
  { id: 1, a: 'finger slip', b: 'fate disguised', story: 'She\'ll call it an accident for months. You\'ll let her. Both of you know better.' },
  { id: 2, a: '"i\'m sigma"', b: 'zero apology', story: 'Most people apologize for existing. She walked in like she built the room.' },
  { id: 3, a: 'princess tycoon', b: 'two hours gone', story: 'Your castle looked like a depressed shoebox. Hers had seventeen turrets.' },
  { id: 4, a: 'the scratch', b: 'three seconds', story: 'You held her hand for three seconds over a scratch that didn\'t matter.' },
  { id: 5, a: '450 → 80', b: 'learning patience', story: 'For her, you slowed down. She never asked. You just did.' },
  { id: 6, a: '3:08 AM', b: 'sunrise on phone', story: 'Her voice at 3 AM sounds different. Softer. Only for you.' },
  { id: 7, a: '"he\'s annoying"', b: 'your jaw set', story: 'She mentioned another guy. Your body reacted before your brain.' },
  { id: 8, a: '"whatever"', b: 'screenshot saved', story: 'You said you didn\'t care. Then you saved the conversation.' }
];

function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

async function memoryMatch() {
  UI.clear();
  $('match').style.display = 'block';
  $('match').classList.add('show');
  
  $('match').innerHTML = `
    <div class="match-header">
      <div class="match-title">MEMORY MATCH</div>
      <div class="match-subtitle">Each pair reveals something you buried</div>
    </div>
    <div class="match-stakes">
      <div class="stake">
        <span class="stake-label">PAIRS</span>
        <span class="stake-value" id="pc">0/8</span>
      </div>
      <div class="stake">
        <span class="stake-label">FOCUS</span>
        <div class="hearts" id="hearts">${'<svg class="heart active" viewBox="0 0 14 14"><path d="M7 12 Q2 7 7 2 Q12 7 7 12" fill="currentColor"/></svg>'.repeat(3)}</div>
      </div>
    </div>
    <div class="match-grid" id="mgrid"></div>
    <div class="match-story" id="mstory"></div>
  `;
  
  // Prepare cards
  const cards = [];
  PAIRS.forEach(p => {
    cards.push({ pid: p.id, text: p.a, story: p.story });
    cards.push({ pid: p.id, text: p.b, story: p.story });
  });
  shuffle(cards);
  
  const grid = $('mgrid');
  const story = $('mstory');
  let flipped = [];
  let matched = 0;
  let hearts = 3;
  let locked = false;
  
  const updateHearts = () => {
    const h = $('hearts').querySelectorAll('.heart');
    h.forEach((x, i) => {
      x.classList.toggle('lost', i >= hearts);
      x.classList.toggle('active', i < hearts);
    });
  };
  
  cards.forEach(c => {
    const card = document.createElement('div');
    card.className = 'match-card';
    card.innerHTML = `<div class="card-inner">${c.text}</div>`;
    
    card.onclick = () => {
      if (locked || card.classList.contains('flipped') || card.classList.contains('matched')) return;
      
      Audio.flip();
      card.classList.add('flipped');
      flipped.push({ card, pid: c.pid });
      
      if (flipped.length === 2) {
        locked = true;
        
        if (flipped[0].pid === flipped[1].pid) {
          // Match!
          Audio.match();
          matched++;
          
          const p = PAIRS.find(x => x.id === flipped[0].pid);
          if (p) {
            story.textContent = p.story;
            story.classList.add('show');
          }
          
          $('pc').textContent = `${matched}/8`;
          
          setTimeout(() => {
            flipped.forEach(f => f.card.classList.add('matched'));
            flipped = [];
            locked = false;
            
            if (matched >= 8) {
              setTimeout(() => {
                VFX.emotional();
                Audio.complete();
              }, 600);
            }
          }, 500);
        } else {
          // No match
          hearts--;
          updateHearts();
          Audio.wrong();
          flipped.forEach(f => f.card.classList.add('wrong'));
          
          setTimeout(() => {
            flipped.forEach(f => {
              f.card.classList.remove('flipped', 'wrong');
            });
            flipped = [];
            locked = false;
            
            if (hearts <= 0) {
              // Reset game
              hearts = 3;
              matched = 0;
              updateHearts();
              document.querySelectorAll('.match-card').forEach(c => {
                c.classList.remove('flipped', 'matched', 'wrong');
              });
              $('pc').textContent = '0/8';
              story.textContent = 'Focus. These memories matter.';
              story.classList.add('show');
            }
          }, 800);
        }
      }
    };
    
    grid.appendChild(card);
  });
  
  return new Promise(resolve => {
    const interval = setInterval(() => {
      if (matched >= 8) {
        clearInterval(interval);
        setTimeout(resolve, 1500);
      }
    }, 200);
  });
}

/* ═══════════════════════════════════════════════════════════════════════════
   BOOT SEQUENCE
   ═══════════════════════════════════════════════════════════════════════════ */
async function typeBootLine(el, text, speed = 20) {
  for (let i = 0; i < text.length; i++) {
    el.textContent += text[i];
    Audio.bootBeep();
    await sleep(speed);
  }
  el.textContent += '\n';
}

async function boot() {
  const bt = $('boot-text');
  
  await sleep(1200);
  await typeBootLine(bt, '> SEED ARCHIVE v3.0', 16);
  await sleep(500);
  await typeBootLine(bt, '> LOADING SIDE A: SOIL...', 18);
  await sleep(400);
  await typeBootLine(bt, '> 8 DECISIONS DETECTED', 14);
  await sleep(350);
  await typeBootLine(bt, '> EMOTIONAL PAYLOAD: ARMED', 16);
  await sleep(400);
  await typeBootLine(bt, '> SHEEPY PROTOCOL: ACTIVE', 14);
  await sleep(350);
  await typeBootLine(bt, '> AUDIO ENGINE: ONLINE', 15);
  await sleep(300);
  
  // Enable audio
  Audio.ensure();
  Audio.powerOn();
  
  await typeBootLine(bt, '> READY.', 25);
  
  const cursor = document.createElement('span');
  cursor.className = 'boot-cursor';
  bt.appendChild(cursor);
  
  await sleep(1500);
  $('loading-overlay').classList.add('hidden');
  await sleep(2500);
  
  // Start the story
  story();
}

/* ═══════════════════════════════════════════════════════════════════════════
   MAIN STORY — Deeply rewritten narrative with proper pacing
   ═══════════════════════════════════════════════════════════════════════════ */
async function story() {
  // Initialize systems
  VHS.init();
  Particles.init();
  Particles.start();
  $('bg-scenes').classList.add('active');
  $('hud').classList.add('show');
  $('rating').classList.add('show');
  State.updateHUD();
  
  const TOTAL_SCENES = 20;
  let idx = 0;
  let p;
  
  // ═══ ACT 1: THE ACCIDENT ═══
  idx++;
  updateCounter(idx, TOTAL_SCENES);
  VFX.flash();
  
  $('sheepy').classList.add('show');
  Sheepy.show('nervous', true);
  await Sheepy.say('<span class="hand">baa.</span> Before this starts...', 35);
  await sleep(600);
  await Sheepy.say('I need you to understand: he almost didn\'t reply.', 28);
  await sleep(500);
  await Sheepy.say('That\'s important. <span class="whisper">The almost is the whole story.</span>', 25);
  await sleep(800);
  $('sheepy').classList.add('hide');
  await sleep(700);
  $('sheepy').classList.remove('show', 'hide');
  
  UI.clear();
  
  p = UI.p('<span class="time">2:47 PM. Tuesday. You\'re doing nothing important.</span>');
  await UI.show(p, 800);
  await sleep(400);
  
  p = UI.p('<span class="narrator">Your phone buzzes. Unknown number. The message is clearly meant for someone else.</span>');
  await UI.show(p, 700);
  await sleep(350);
  
  p = UI.p('<span class="phone">omg wait wrong person lmaooo</span>');
  await UI.show(p, 600);
  await sleep(300);
  
  p = UI.p('<span class="narrator">That should have been the end of it.</span>');
  await UI.show(p, 700);
  await sleep(400);
  
  p = UI.p('<span class="memory">You will think about this moment for months. The ordinary Tuesday that split your life into before and after.</span>');
  await UI.show(p, 900);
  await sleep(500);
  await UI.waitClick();
  
  const c1 = await choose('d_tape1_reply_speed', [
    { text: 'Reply instantly. Something sarcastic.', id: 'reply_immediately', preview: 'Curiosity dressed as humor', emotional: true },
    { text: 'Wait three hours. Craft something casual.', id: 'wait_hours', preview: 'Protection over connection' },
    { text: 'Stare at it. Thumb hovering. Paralyzed.', id: 'stare_screen', preview: 'Feeling before acting' }
  ]);
  
  // ═══ ACT 2: FIRST CONTACT ═══
  idx++;
  updateCounter(idx, TOTAL_SCENES);
  Audio.whoosh();
  UI.clear();
  
  if (c1 === 'reply_immediately') {
    p = UI.p('<span class="phone">lol who were you trying to text 💀</span>');
    await UI.show(p, 600);
    await sleep(400);
    
    p = UI.p('<span class="narrator">Forty-seven seconds. That\'s how fast you replied to a stranger.</span>');
    await UI.show(p, 750);
    await sleep(400);
    
    p = UI.p('<span class="me">Later you\'ll tell yourself it was boredom. You weren\'t bored. You were curious. There is a canyon of difference between those two things.</span>');
    await UI.show(p, 850);
    await sleep(450);
    
    p = UI.p('<span class="memory">Curiosity is just hope trying to look casual.</span>');
    await UI.show(p, 900);
    await sleep(500);
  } else if (c1 === 'wait_hours') {
    p = UI.p('<span class="narrator">Three hours. You draft the reply four times. Delete it twice.</span>');
    await UI.show(p, 750);
    await sleep(400);
    
    p = UI.p('<span class="phone">happens to the best of us</span>');
    await UI.show(p, 550);
    await sleep(350);
    
    p = UI.p('<span class="narrator">Six words. Eleven minutes of editing. She\'ll never know.</span>');
    await UI.show(p, 750);
    await sleep(400);
    
    p = UI.p('<span class="memory">The distance between what you feel and what you show could fill an ocean.</span>');
    await UI.show(p, 900);
    await sleep(500);
  } else {
    p = UI.p('<span class="narrator">Your thumb hovers. The screen dims. You lock it. Unlock it. Lock it.</span>');
    await UI.show(p, 750);
    await sleep(400);
    
    p = UI.p('<span class="phone">hello?? u there lol</span>');
    await UI.show(p, 550);
    await sleep(350);
    
    p = UI.p('<span class="me">She texted again. She didn\'t have to. The universe just made the choice for you.</span>');
    await UI.show(p, 800);
    await sleep(400);
    
    p = UI.p('<span class="memory">Sometimes the most honest thing you can do is freeze. It means something already matters.</span>');
    await UI.show(p, 900);
    await sleep(500);
  }
  await UI.waitClick();
  
  // ═══ ACT 3: SIGMA ═══
  idx++;
  updateCounter(idx, TOTAL_SCENES);
  Audio.whoosh();
  UI.clear();
  
  p = UI.p('<span class="her">"I\'m sigma."</span>');
  await UI.show(p, 800);
  await sleep(450);
  
  p = UI.p('<span class="narrator">She says this mid-bite of something. Doesn\'t even look up. Like it\'s a weather report.</span>');
  await UI.show(p, 750);
  await sleep(400);
  
  p = UI.p('<span class="narrator">Most people enter your life apologizing for the space they take up. She walks in like she designed the floor plan.</span>');
  await UI.show(p, 850);
  await sleep(450);
  
  p = UI.p('<span class="me">It is the most absurd thing anyone has ever said to you with a straight face. Your mouth does something you don\'t authorize.</span>');
  await UI.show(p, 800);
  await sleep(450);
  await UI.waitClick();
  
  const c2 = await choose('d_tape1_sigma_reaction', [
    { text: '"That\'s genuinely the most unhinged thing anyone has said to me."', id: 'call_annoying', preview: 'Push back. See what happens.' },
    { text: 'Say nothing. You\'re fighting your own face.', id: 'say_nothing_smile', preview: 'Let her in silently', emotional: true },
    { text: '"Explain. Use small words."', id: 'ask_meaning', preview: 'Genuine curiosity' }
  ]);
  
  idx++;
  updateCounter(idx, TOTAL_SCENES);
  Audio.whoosh();
  UI.clear();
  
  if (c2 === 'call_annoying') {
    p = UI.p('<span class="narrator">She laughs. Not politely. Full volume. Like you just told the funniest joke she\'s heard all year.</span>');
    await UI.show(p, 800);
    await sleep(400);
    
    p = UI.p('<span class="her">"Good. Annoyed means you\'re paying attention."</span>');
    await UI.show(p, 650);
    await sleep(400);
    
    p = UI.p('<span class="me">She\'s right. Which annoys you more. Which she also notices.</span>');
    await UI.show(p, 750);
    await sleep(400);
    
    p = UI.p('<span class="memory">Some people test you by being soft. She tests you by being impossible. You respect impossible.</span>');
    await UI.show(p, 900);
    await sleep(500);
  } else if (c2 === 'say_nothing_smile') {
    VFX.emotional();
    
    p = UI.p('<span class="narrator">Your mouth curves. You kill it immediately. Too late.</span>');
    await UI.show(p, 750);
    await sleep(400);
    
    p = UI.p('<span class="her">"Caught you."</span>');
    await UI.show(p, 550);
    await sleep(400);
    
    p = UI.p('<span class="narrator">Two words. Said with the confidence of someone who has been watching you closer than you realized.</span>');
    await UI.show(p, 800);
    await sleep(400);
    
    p = UI.p('<span class="memory">The first crack in your wall was just a smile you couldn\'t suppress. That\'s how every fortress falls.</span>');
    await UI.show(p, 900);
    await sleep(500);
  } else {
    p = UI.p('<span class="her">"It means I don\'t need anyone to tell me I\'m worth something. I already know."</span>');
    await UI.show(p, 750);
    await sleep(400);
    
    p = UI.p('<span class="narrator">She says this without arrogance. Like stating that water is wet.</span>');
    await UI.show(p, 750);
    await sleep(400);
    
    p = UI.p('<span class="me">You have never met someone this certain of themselves. It terrifies you. It also makes you want to stay.</span>');
    await UI.show(p, 850);
    await sleep(450);
    
    p = UI.p('<span class="memory">Understanding someone is the first form of intimacy. You just took the first step.</span>');
    await UI.show(p, 900);
    await sleep(500);
  }
  await UI.waitClick();
  
  // ═══ ACT 4: PRINCESS TYCOON ═══
  idx++;
  updateCounter(idx, TOTAL_SCENES);
  Audio.whoosh();
  UI.clear();
  
  p = UI.p('<span class="her">"play princess tycoon with me"</span>');
  await UI.show(p, 650);
  await sleep(400);
  
  p = UI.p('<span class="narrator">Princess. Tycoon. On Roblox. She is dead serious.</span>');
  await UI.show(p, 750);
  await sleep(400);
  
  p = UI.p('<span class="narrator">You are a person who has opinions about competitive games. Princess Tycoon is not a competitive game. It is a game for eight-year-olds.</span>');
  await UI.show(p, 850);
  await sleep(450);
  
  p = UI.p('<span class="me">You should say no. Every part of you that has ever been cool says no.</span>');
  await UI.show(p, 700);
  await sleep(450);
  await UI.waitClick();
  
  const c3 = await choose('d_tape1_princess_tycoon', [
    { text: 'Play. Complain the entire time. Have the best night of your month.', id: 'play_complain', preview: 'Show up completely', emotional: true },
    { text: 'Refuse. Watch her play. Run commentary like it\'s an esport.', id: 'refuse_watch', preview: 'Keep your dignity' },
    { text: '"Only if you promise to lose." Make it personal.', id: 'make_challenge', preview: 'Engage on your terms' }
  ]);
  
  idx++;
  updateCounter(idx, TOTAL_SCENES);
  Audio.whoosh();
  UI.clear();
  
  if (c3 === 'play_complain') {
    p = UI.p('<span class="narrator">Two hours. Your castle looks like a depressed shoebox. Hers has seventeen turrets and a moat.</span>');
    await UI.show(p, 850);
    await sleep(450);
    
    p = UI.p('<span class="narrator">She laughs so hard at your castle she chokes on water. You pretend to be offended.</span>');
    await UI.show(p, 750);
    await sleep(400);
    
    p = UI.p('<span class="me">It is objectively the worst game you have ever played. You will play it again tomorrow. And the day after. And you will never admit why.</span>');
    await UI.show(p, 900);
    await sleep(500);
    
    p = UI.p('<span class="memory">Time is the only currency that can\'t be faked. You just spent two hours on turrets you didn\'t want, for a person you didn\'t expect.</span>');
    await UI.show(p, 950);
    await sleep(550);
  } else if (c3 === 'refuse_watch') {
    p = UI.p('<span class="me">"Your turret placement is objectively wrong."</span>');
    await UI.show(p, 600);
    await sleep(400);
    
    p = UI.p('<span class="her">"Your FACE is objectively wrong."</span>');
    await UI.show(p, 550);
    await sleep(400);
    
    p = UI.p('<span class="narrator">You watch for forty minutes. Your commentary makes her laugh harder than the game. You pretend that doesn\'t matter.</span>');
    await UI.show(p, 850);
    await sleep(450);
    
    p = UI.p('<span class="memory">Distance is just another way of being present. She knows you\'re there. That\'s the point.</span>');
    await UI.show(p, 900);
    await sleep(500);
  } else {
    VFX.emotional();
    
    p = UI.p('<span class="her">"deal"</span>');
    await UI.show(p, 500);
    await sleep(400);
    
    p = UI.p('<span class="narrator">She wins. She wins by a margin that suggests she has been playing this game since birth.</span>');
    await UI.show(p, 750);
    await sleep(400);
    
    p = UI.p('<span class="her">"i didn\'t promise to TRY to lose 😈"</span>');
    await UI.show(p, 650);
    await sleep(400);
    
    p = UI.p('<span class="me">You are not angry. You are impressed. And you are in more trouble than you thought.</span>');
    await UI.show(p, 800);
    await sleep(450);
    
    p = UI.p('<span class="memory">Losing to someone and smiling about it is the body\'s way of waving a white flag.</span>');
    await UI.show(p, 900);
    await sleep(500);
  }
  await UI.waitClick();
  
  // ═══ ACT 5: MEMORY MATCH ═══
  idx++;
  updateCounter(idx, TOTAL_SCENES);
  
  $('sheepy').classList.add('show');
  Sheepy.show('thoughtful');
  await Sheepy.say('Pause. Before we go further...', 30);
  await sleep(500);
  await Sheepy.say('Prove you remember what matters.', 28);
  await sleep(500);
  $('sheepy').classList.add('hide');
  await sleep(700);
  $('sheepy').classList.remove('show', 'hide');
  
  await memoryMatch();
  
  idx++;
  updateCounter(idx, TOTAL_SCENES);
  UI.clear();
  
  $('sheepy').classList.add('show');
  Sheepy.show('happy');
  await Sheepy.say('Good. You remember more than you let on.', 28);
  await sleep(500);
  await Sheepy.say('<span class="hand">Now. The hard part.</span>', 25);
  await sleep(600);
  $('sheepy').classList.add('hide');
  await sleep(700);
  $('sheepy').classList.remove('show', 'hide');
  await UI.waitClick();
  
  // ═══ ACT 6: THE SCRATCH ═══
  idx++;
  updateCounter(idx, TOTAL_SCENES);
  Audio.whoosh();
  UI.clear();
  
  p = UI.p('<span class="narrator">Weeks blur. You stop counting the days since you met. It\'s just... continuous now.</span>');
  await UI.show(p, 850);
  await sleep(450);
  
  p = UI.p('<span class="narrator">Then one day: a scratch on her hand. Small. The kind most people wouldn\'t notice.</span>');
  await UI.show(p, 750);
  await sleep(400);
  
  p = UI.p('<span class="me">You notice it before she does. You notice everything about her now. You didn\'t ask for this superpower.</span>');
  await UI.show(p, 850);
  await sleep(450);
  await UI.waitClick();
  
  const c4 = await choose('d_tape1_scratch', [
    { text: '"Show me." Take her hand before you can overthink it.', id: 'take_hand', preview: 'Cross the line', emotional: true },
    { text: '"Be more careful." Look away. Swallow it.', id: 'look_away', preview: 'Protect the wall' },
    { text: 'Say nothing. Add it to the catalog of things you noticed.', id: 'file_away', preview: 'Silent devotion' }
  ]);
  
  idx++;
  updateCounter(idx, TOTAL_SCENES);
  Audio.whoosh();
  UI.clear();
  
  if (c4 === 'take_hand') {
    VFX.emotional();
    
    p = UI.p('<span class="narrator">You take her hand. Turn it over. The scratch is nothing.</span>');
    await UI.show(p, 800);
    await sleep(450);
    
    p = UI.p('<span class="narrator">Three seconds. You hold her hand for three seconds examining a wound that doesn\'t exist.</span>');
    await UI.show(p, 850);
    await sleep(450);
    
    p = UI.p('<span class="narrator">She doesn\'t pull away. She doesn\'t breathe.</span>');
    await UI.show(p, 750);
    await sleep(400);
    
    p = UI.p('<span class="me">Neither of you mentions this. Ever. Both of you replay it at 2 AM for weeks.</span>');
    await UI.show(p, 850);
    await sleep(450);
    
    p = UI.p('<span class="memory">The first touch is never the dramatic one. It\'s the one disguised as concern. The one you can both pretend was nothing.</span>');
    await UI.show(p, 950);
    await sleep(550);
  } else if (c4 === 'look_away') {
    p = UI.p('<span class="me">"Be more careful," you say. Casual. Like you say that to everyone.</span>');
    await UI.show(p, 750);
    await sleep(400);
    
    p = UI.p('<span class="narrator">You don\'t say that to everyone. She knows. You know she knows.</span>');
    await UI.show(p, 750);
    await sleep(400);
    
    p = UI.p('<span class="memory">Caring out loud and caring in silence hurt different amounts. Silence hurts you. Sound would hurt her. You chose your pain.</span>');
    await UI.show(p, 950);
    await sleep(550);
  } else {
    p = UI.p('<span class="narrator">You file it away. Her scratches. Her laugh pattern. The way she tucks hair behind her left ear when she\'s nervous.</span>');
    await UI.show(p, 850);
    await sleep(450);
    
    p = UI.p('<span class="me">You\'re building a cathedral of observations about someone who doesn\'t know it exists.</span>');
    await UI.show(p, 850);
    await sleep(450);
    
    p = UI.p('<span class="memory">Observation is devotion\'s quietest dialect.</span>');
    await UI.show(p, 900);
    await sleep(500);
  }
  await UI.waitClick();
  
  // ═══ ACT 7: 3 AM ═══
  idx++;
  updateCounter(idx, TOTAL_SCENES);
  Audio.whoosh();
  UI.clear();
  
  p = UI.p('<span class="time">11:47 PM → 1:23 AM → 3:08 AM</span>');
  await UI.show(p, 800);
  await sleep(450);
  
  p = UI.p('<span class="narrator">The texts get later. You never initiate. But your phone is always in your hand. She doesn\'t know that. Or maybe she does.</span>');
  await UI.show(p, 850);
  await sleep(450);
  
  p = UI.p('<span class="phone">can\'t sleep</span>');
  await UI.show(p, 500);
  await sleep(350);
  
  p = UI.p('<span class="phone">talk to me</span>');
  await UI.show(p, 500);
  await sleep(400);
  
  p = UI.p('<span class="me">Four words. The most honest sentence she has ever sent you. Because at 3 AM nobody has the energy to lie.</span>');
  await UI.show(p, 900);
  await sleep(500);
  await UI.waitClick();
  
  const c5 = await choose('d_tape1_late_night', [
    { text: 'Call her. Right now. Let 3 AM mean something.', id: 'call_now', preview: 'Choose presence over safety', emotional: true },
    { text: 'Text back. Stay in the safe lane.', id: 'text_back_safe', preview: 'Keep your distance' },
    { text: 'Send a voice note. Your real voice at 3 AM.', id: 'voice_note', preview: 'The middle path' }
  ]);
  
  idx++;
  updateCounter(idx, TOTAL_SCENES);
  Audio.whoosh();
  UI.clear();
  
  if (c5 === 'call_now') {
    VFX.emotional();
    
    p = UI.p('<span class="narrator">You call. She picks up on the first ring. Which means she was holding her phone too.</span>');
    await UI.show(p, 850);
    await sleep(450);
    
    p = UI.p('<span class="her">"you actually called"</span>');
    await UI.show(p, 550);
    await sleep(400);
    
    p = UI.p('<span class="me">"You asked me to."</span>');
    await UI.show(p, 550);
    await sleep(400);
    
    p = UI.p('<span class="narrator">You talk until the light changes. Neither of you says anything important. Everything is important.</span>');
    await UI.show(p, 850);
    await sleep(450);
    
    p = UI.p('<span class="memory">Some nights get written in ink that doesn\'t wash out. This one stained everything.</span>');
    await UI.show(p, 950);
    await sleep(550);
  } else if (c5 === 'text_back_safe') {
    p = UI.p('<span class="phone">what\'s keeping you up</span>');
    await UI.show(p, 550);
    await sleep(400);
    
    p = UI.p('<span class="phone">idk just thinking</span>');
    await UI.show(p, 550);
    await sleep(400);
    
    p = UI.p('<span class="narrator">You want to ask: about what? About who? About us? You type and delete six things.</span>');
    await UI.show(p, 850);
    await sleep(450);
    
    p = UI.p('<span class="me">You send a meme instead. Safety has a price tag and you just paid it.</span>');
    await UI.show(p, 800);
    await sleep(450);
    
    p = UI.p('<span class="memory">The distance between what you typed and what you sent could fill a novel.</span>');
    await UI.show(p, 950);
    await sleep(550);
  } else {
    p = UI.p('<span class="narrator">Your voice at 3 AM. Unguarded. The version of you that only exists when the lights are off.</span>');
    await UI.show(p, 850);
    await sleep(450);
    
    p = UI.p('<span class="me">"I\'m here. What\'s on your mind?"</span>');
    await UI.show(p, 650);
    await sleep(400);
    
    p = UI.p('<span class="narrator">She sends one back. Five minutes long. You will never tell anyone what she said. Ever.</span>');
    await UI.show(p, 850);
    await sleep(450);
    
    p = UI.p('<span class="memory">A voice at 3 AM is a letter that can\'t be screenshotted. That\'s why it feels safe.</span>');
    await UI.show(p, 950);
    await sleep(550);
  }
  await UI.waitClick();
  
  // ═══ ACT 8: JEALOUSY ═══
  idx++;
  updateCounter(idx, TOTAL_SCENES);
  Audio.whoosh();
  UI.clear();
  
  p = UI.p('<span class="her">"this guy keeps trying to talk to me lol he\'s so annoying"</span>');
  await UI.show(p, 700);
  await sleep(400);
  
  p = UI.p('<span class="narrator">She says it casually. Dismissively.</span>');
  await UI.show(p, 650);
  await sleep(400);
  
  p = UI.p('<span class="me">Your jaw sets. Something in your chest tightens. You did not authorize this reaction. Your body doesn\'t care about authorization.</span>');
  await UI.show(p, 850);
  await sleep(450);
  
  p = UI.p('<span class="memory">Jealousy is just your subconscious filing a police report: something valuable is at risk.</span>');
  await UI.show(p, 950);
  await sleep(550);
  await UI.waitClick();
  
  const c6 = await choose('d_tape1_jealousy', [
    { text: '"Tell him you\'re busy." Let the silence do the talking.', id: 'tell_her_busy', preview: 'Territorial honesty' },
    { text: '"Annoying like me, or actually annoying?"', id: 'annoying_how', preview: 'Seek your place', emotional: true },
    { text: 'Change the subject. Pretend your blood pressure is normal.', id: 'change_subject', preview: 'Deny everything' }
  ]);
  
  idx++;
  updateCounter(idx, TOTAL_SCENES);
  Audio.whoosh();
  UI.clear();
  
  if (c6 === 'tell_her_busy') {
    VFX.glitch();
    
    p = UI.p('<span class="me">"Tell him you\'re busy."</span>');
    await UI.show(p, 600);
    await sleep(400);
    
    p = UI.p('<span class="narrator">Four words. She hears the fifth one: <em>with me.</em></span>');
    await UI.show(p, 800);
    await sleep(450);
    
    p = UI.p('<span class="narrator">She doesn\'t mention him again. Neither do you. The territory has been quietly, irrevocably claimed.</span>');
    await UI.show(p, 850);
    await sleep(450);
    
    p = UI.p('<span class="memory">You didn\'t ask her to choose you. You just made sure she knew you were an option.</span>');
    await UI.show(p, 950);
    await sleep(550);
  } else if (c6 === 'annoying_how') {
    VFX.emotional();
    
    p = UI.p('<span class="me">"Annoying like me, or actually annoying?"</span>');
    await UI.show(p, 600);
    await sleep(400);
    
    p = UI.p('<span class="narrator">She laughs. Stops. Something in her face rearranges itself.</span>');
    await UI.show(p, 750);
    await sleep(400);
    
    p = UI.p('<span class="her">"you\'re not annoying. you\'re... different."</span>');
    await UI.show(p, 650);
    await sleep(450);
    
    p = UI.p('<span class="me">"Different" is the most dangerous word in her vocabulary. You screenshot the message. Hate yourself for it. Keep the screenshot anyway.</span>');
    await UI.show(p, 900);
    await sleep(500);
    
    p = UI.p('<span class="memory">"Different" from her means: I have a category for everyone else, and then there\'s you.</span>');
    await UI.show(p, 950);
    await sleep(550);
  } else {
    p = UI.p('<span class="me">"anyway did you see that meme"</span>');
    await UI.show(p, 550);
    await sleep(400);
    
    p = UI.p('<span class="narrator">Subject changed. Crisis averted. Heart rate: not averted.</span>');
    await UI.show(p, 750);
    await sleep(400);
    
    p = UI.p('<span class="me">She sees through it. She always sees through it. She doesn\'t call you out. That\'s worse.</span>');
    await UI.show(p, 850);
    await sleep(450);
    
    p = UI.p('<span class="memory">The mask of indifference fits perfectly. That\'s the problem. It shouldn\'t fit this well.</span>');
    await UI.show(p, 950);
    await sleep(550);
  }
  await UI.waitClick();
  
  // ═══ ACT 9: REALIZATION ═══
  idx++;
  updateCounter(idx, TOTAL_SCENES);
  Audio.whoosh();
  UI.clear();
  
  p = UI.p('<span class="narrator">It doesn\'t happen all at once. There\'s no movie moment.</span>');
  await UI.show(p, 850);
  await sleep(450);
  
  p = UI.p('<span class="narrator">It\'s just that one day you realize you\'ve been checking your phone every four minutes. For weeks.</span>');
  await UI.show(p, 850);
  await sleep(450);
  
  p = UI.p('<span class="narrator">And the thought of her not texting back—</span>');
  await UI.show(p, 700);
  await sleep(600);
  
  p = UI.p('<span class="moment">Unthinkable.</span>');
  await UI.show(p, 1000);
  VFX.emotional();
  await sleep(600);
  
  p = UI.p('<span class="me">The seed is already in the ground. You didn\'t plant it. Nobody asked permission. It just... grew.</span>');
  await UI.show(p, 900);
  await sleep(500);
  await UI.waitClick();
  
  const c7 = await choose('d_tape1_realization', [
    { text: 'Pull back. Protect what\'s left of your walls.', id: 'pull_back', preview: 'Fear wins this round' },
    { text: 'Lean in. Whatever this is, let it happen.', id: 'lean_in', preview: 'Choose courage', emotional: true },
    { text: 'Do nothing. Watch. Wait. See what grows.', id: 'watch_grow', preview: 'Patient acceptance' }
  ]);
  
  // ═══ ACT 10: SOIL ═══
  idx++;
  updateCounter(idx, TOTAL_SCENES);
  Audio.whoosh();
  UI.clear();
  
  $('sheepy').classList.add('show');
  Sheepy.show('thoughtful');
  await Sheepy.say('A seed doesn\'t choose where it falls.', 30);
  await sleep(600);
  await Sheepy.say('But the soil chooses whether to hold it.', 28);
  await sleep(600);
  await Sheepy.say('<span class="hand">What kind of soil are you?</span>', 25);
  await sleep(700);
  $('sheepy').classList.add('hide');
  await sleep(700);
  $('sheepy').classList.remove('show', 'hide');
  
  const soilChoice = await choose('d_tape1_soil_choice', [
    { text: 'Rich soil. "I want this to grow. I\'ll water it myself."', id: 'rich_soil', preview: 'All in. No safety net.', emotional: true },
    { text: 'Rocky soil. "I\'m afraid. But I won\'t stop it."', id: 'rocky_soil', preview: 'Guarded. But open.' },
    { text: 'Frozen ground. "I\'m not ready. Not yet."', id: 'barren_soil', preview: 'The seed waits.' }
  ]);
  
  idx++;
  updateCounter(idx, TOTAL_SCENES);
  Audio.whoosh();
  UI.clear();
  
  if (State.hasFlag('e_soil_rich')) {
    VFX.emotional();
    
    p = UI.p('<span class="me">The soil is warm here. Soft enough to hold something fragile.</span>');
    await UI.show(p, 850);
    await sleep(450);
    
    p = UI.p('<span class="me">You let yourself sink in. Not all the way. But enough to mean it.</span>');
    await UI.show(p, 800);
    await sleep(450);
    
    p = UI.p('<span class="narrator" style="color: var(--trust)">The seed has found good ground.</span>');
    await UI.show(p, 900);
    await sleep(500);
    
    p = UI.p('<span class="memory">Rich soil doesn\'t promise growth. It just says: whatever you become, I\'m here for it.</span>');
    await UI.show(p, 1000);
    await sleep(600);
  } else if (State.hasFlag('e_soil_rocky')) {
    p = UI.p('<span class="me">The soil is cold. Hard in places. But between the stones there are gaps.</span>');
    await UI.show(p, 850);
    await sleep(450);
    
    p = UI.p('<span class="me">Roots might find the spaces. It will be harder. But nothing grown easily survives the winter.</span>');
    await UI.show(p, 900);
    await sleep(500);
    
    p = UI.p('<span class="narrator" style="color: var(--earth-pale)">The seed will work harder. It might grow stronger for it.</span>');
    await UI.show(p, 900);
    await sleep(500);
    
    p = UI.p('<span class="memory">The flowers that push through rock are the ones nobody can pick.</span>');
    await UI.show(p, 1000);
    await sleep(600);
  } else {
    p = UI.p('<span class="me">The ground is frozen. Nothing moves. But there\'s a crack. There\'s always a crack.</span>');
    await UI.show(p, 850);
    await sleep(450);
    
    p = UI.p('<span class="narrator" style="color: var(--dim)">Dormancy isn\'t death. Seeds can wait years.</span>');
    await UI.show(p, 850);
    await sleep(450);
    
    p = UI.p('<span class="memory">The patient seed outlasts the impatient gardener. Time is on its side.</span>');
    await UI.show(p, 1000);
    await sleep(600);
  }
  await UI.waitClick();
  
  // ═══ END ═══
  idx++;
  updateCounter(idx, TOTAL_SCENES);
  Audio.whoosh();
  UI.clear();
  
  $('sheepy').classList.add('show');
  Sheepy.show('happy');
  await Sheepy.say('SIDE A is done.', 28);
  await sleep(500);
  await Sheepy.say('The seed is in the ground now.', 26);
  await sleep(500);
  await Sheepy.say('What happens next depends on the weather.', 24);
  await sleep(500);
  await Sheepy.say('<span class="hand">And the weather is always changing.</span>', 22);
  await sleep(800);
  
  State.save();
  Audio.complete();
  VFX.pulse();
  
  await sleep(2000);
  UI.clear();
  
  p = UI.p('<span class="narrator" style="text-align: center; font-size: 1.2em; color: var(--earth-glow)">END OF SIDE A — EJECTING...</span>');
  await UI.show(p, 1000);
  await sleep(3000);
  
  window.location.href = 'index.html';
}

/* ═══════════════════════════════════════════════════════════════════════════
   EVENT LISTENERS
   ═══════════════════════════════════════════════════════════════════════════ */
$('audio-btn').addEventListener('click', () => Audio.toggle());
document.addEventListener('contextmenu', e => e.preventDefault());

// Start
boot();
</script>
</body>
</html>
