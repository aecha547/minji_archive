<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>SIDE A: SOIL — THE SEED OF MANY ENDINGS</title>
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Cdefs%3E%3CradialGradient id='sg' cx='50%25' cy='50%25'%3E%3Cstop offset='0%25' stop-color='%23a8e6a3' stop-opacity='.8'/%3E%3Cstop offset='100%25' stop-color='%23558b2f' stop-opacity='.4'/%3E%3C/radialGradient%3E%3C/defs%3E%3Crect width='32' height='32' fill='%23050505'/%3E%3Cellipse cx='16' cy='18' rx='6' ry='9' fill='url(%23sg)' transform='rotate(-10 16 18)'/%3E%3Cellipse cx='16' cy='11' rx='3' ry='2' fill='%23c8e6c9' transform='rotate(-10 16 11)'/%3E%3Cpath d='M12 6 Q16 2 20 6' stroke='%2381c784' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E">
<style>
@import url('https://fonts.googleapis.com/css2?family=VT323&family=Caveat:wght@400;600;700&family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,300;1,400&family=EB+Garamond:ital,wght@0,400;0,500;0,600;1,400&family=Space+Mono:wght@400;700&family=DM+Serif+Display:ital@0;1&display=swap');

/* ═══════════════════════════════════════════════════════════════════
   DESIGN TOKENS — Warm earthy palette with emotional depth
   ═══════════════════════════════════════════════════════════════════ */
:root {
  --bg-deep: #010101;
  --bg: #030303;
  --bg-warm: #080605;
  
  --earth-deep: #2d1f15;
  --earth: #4a3528;
  --earth-light: #7a5a35;
  --earth-glow: #9a7050;
  --earth-pale: #c9a080;
  
  --pink-deep: #5a1025;
  --pink: #802845;
  --pink-light: #b04865;
  --pink-soft: #d87895;
  --pink-glow: #ff5080;
  
  --gold-deep: #604815;
  --gold: #907030;
  --gold-light: #b89850;
  --gold-glow: #e0c080;
  
  --snap-yellow: #FFFC00;
  --discord-blue: #5865F2;
  --tiktok-cyan: #00f2ea;
  --tiktok-pink: #ff0050;
  
  --trust: #4a8040;
  --guard: #3a3a4a;
  
  --white: #e0dcd5;
  --dim: #5a5550;
  --muted: #3a3530;
  
  --font-crt: 'VT323', monospace;
  --font-hand: 'Caveat', cursive;
  --font-serif: 'Cormorant Garamond', serif;
  --font-body: 'EB Garamond', serif;
  --font-mono: 'Space Mono', monospace;
  --font-display: 'DM Serif Display', serif;
  
  --ease-smooth: cubic-bezier(0.4, 0, 0.2, 1);
  --ease-bounce: cubic-bezier(0.34, 1.56, 0.64, 1);
  --ease-dramatic: cubic-bezier(0.2, 0, 0.13, 1);
  --ease-spring: cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
html, body { 
  height: 100%; 
  overflow: hidden; 
  background: var(--bg-deep); 
  font-family: var(--font-body);
  color: var(--white);
  -webkit-tap-highlight-color: transparent;
  user-select: none;
}

/* ═══════════════════════════════════════════════════════════════════
   VHS BACKGROUND LAYER — Atmospheric particle system
   ═══════════════════════════════════════════════════════════════════ */
#vhs-layer {
  position: fixed;
  inset: 0;
  z-index: 0;
  pointer-events: none;
  overflow: hidden;
}

#vhs-canvas {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  opacity: 0.7;
}

#noise-layer {
  position: fixed;
  inset: 0;
  z-index: 2;
  pointer-events: none;
  opacity: 0.04;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
  animation: noiseShift 0.5s steps(5) infinite;
}

@keyframes noiseShift {
  0%, 100% { transform: translate(0, 0); }
  25% { transform: translate(-2%, -2%); }
  50% { transform: translate(2%, 0); }
  75% { transform: translate(-1%, 2%); }
}

/* ═══════════════════════════════════════════════════════════════════
   BEDROOM SCENE — Vector coordinate system (1000x800 logical units)
   ═══════════════════════════════════════════════════════════════════ */
#bedroom-scene {
  position: fixed;
  inset: 0;
  z-index: 10;
  pointer-events: auto;
  opacity: 0;
  transition: opacity 2s var(--ease-smooth);
}

#bedroom-scene.active {
  opacity: 1;
}

#bedroom-svg {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  overflow: visible;
}

/* Room item hover effects */
.room-item {
  transition: filter 0.4s var(--ease-smooth), transform 0.3s var(--ease-smooth);
  cursor: pointer;
}

.room-item:hover {
  filter: brightness(1.3) drop-shadow(0 0 15px rgba(224, 192, 128, 0.4));
  transform: scale(1.02);
}

.room-item:focus {
  outline: 2px solid var(--gold-glow);
  outline-offset: 4px;
}

/* ═══════════════════════════════════════════════════════════════════
   CRT EFFECTS
   ═══════════════════════════════════════════════════════════════════ */
.crt-screen {
  position: relative;
  overflow: hidden;
  min-height: 100vh;
}

.crt-screen::before {
  content: '';
  position: absolute;
  inset: 0;
  background: repeating-linear-gradient(
    0deg,
    transparent,
    transparent 2px,
    rgba(0, 0, 0, 0.18) 2px,
    rgba(0, 0, 0, 0.18) 4px
  );
  pointer-events: none;
  z-index: 100;
}

.crt-screen::after {
  content: '';
  position: absolute;
  inset: 0;
  background: radial-gradient(ellipse at center, transparent 35%, rgba(0, 0, 0, 0.85) 100%);
  pointer-events: none;
  z-index: 101;
}

.scan-bar {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 10px;
  background: linear-gradient(180deg, transparent, rgba(255, 255, 255, 0.05), transparent);
  opacity: 0.6;
  z-index: 102;
  pointer-events: none;
  animation: scanbar 7s linear infinite;
}

@keyframes scanbar {
  from { top: -8%; }
  to { top: 108%; }
}

/* ═══════════════════════════════════════════════════════════════════
   LOADING OVERLAY
   ═══════════════════════════════════════════════════════════════════ */
#loading-overlay {
  position: fixed;
  inset: 0;
  z-index: 9999;
  background: var(--bg-deep);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  opacity: 1;
  transition: opacity 2.5s var(--ease-smooth);
}

#loading-overlay.hidden {
  opacity: 0;
  pointer-events: none;
}

.seed-loading {
  width: clamp(110px, 28vw, 160px);
  height: clamp(110px, 28vw, 160px);
  animation: seedPulse 5s ease-in-out infinite;
  filter: drop-shadow(0 0 40px rgba(168, 230, 163, 0.6));
}

@keyframes seedPulse {
  0%, 100% { transform: scale(1) rotate(-12deg); }
  50% { transform: scale(1.12) rotate(-12deg); }
}

#loading-overlay h1 {
  font-family: var(--font-display);
  font-size: clamp(1.6rem, 5vw, 2.4rem);
  font-weight: 400;
  color: var(--earth-glow);
  letter-spacing: 4px;
  text-shadow: 0 0 50px var(--earth);
  text-align: center;
  margin-top: 28px;
  animation: titleGlow 4s ease-in-out infinite;
}

@keyframes titleGlow {
  0%, 100% { opacity: 0.65; text-shadow: 0 0 40px var(--earth); }
  50% { opacity: 1; text-shadow: 0 0 60px var(--earth-glow); }
}

#loading-overlay .sub {
  font-family: var(--font-hand);
  font-size: clamp(1.1rem, 3vw, 1.4rem);
  color: var(--earth-pale);
  margin-top: 14px;
  opacity: 0.55;
}

.boot-text {
  color: var(--earth);
  font-family: var(--font-crt);
  font-size: clamp(13px, 2.2vw, 15px);
  margin-top: 50px;
  text-align: left;
  width: min(340px, 85vw);
  line-height: 2.4;
  min-height: 160px;
  white-space: pre-wrap;
}

.boot-cursor {
  display: inline-block;
  width: 10px;
  height: 1.2em;
  background: var(--earth);
  vertical-align: text-bottom;
  margin-left: 3px;
  animation: blink 0.9s step-end infinite;
}

@keyframes blink { 50% { opacity: 0; } }

/* ═══════════════════════════════════════════════════════════════════
   HEADER
   ═══════════════════════════════════════════════════════════════════ */
.header {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 50;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 18px 24px;
  background: linear-gradient(180deg, rgba(0, 0, 0, 0.9), transparent);
  pointer-events: none;
}

.header > * {
  pointer-events: auto;
}

.back-btn {
  color: var(--dim);
  text-decoration: none;
  font-family: var(--font-crt);
  font-size: 0.95rem;
  transition: all 0.6s var(--ease-smooth);
}

.back-btn:hover {
  color: var(--earth-glow);
  text-shadow: 0 0 20px var(--earth);
}

.tape-label {
  background: linear-gradient(180deg, #f5efe5, #d8d0c0);
  color: #1a1510;
  padding: 6px 16px;
  font-family: var(--font-crt);
  font-size: 0.7rem;
  text-transform: uppercase;
  letter-spacing: 2px;
  border: 1px solid #888;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
}

.scene-counter {
  font-family: var(--font-crt);
  font-size: 13px;
  color: var(--dim);
  letter-spacing: 2px;
}

/* ═══════════════════════════════════════════════════════════════════
   MAIN CONTENT — Fixed layout with breathing room
   ═══════════════════════════════════════════════════════════════════ */
.main {
  position: fixed;
  inset: 0;
  z-index: 20;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  padding: 100px 28px 160px;
  pointer-events: none;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: none;
}

.main::-webkit-scrollbar { display: none; }

/* ═══════════════════════════════════════════════════════════════════
   SHEEPY NARRATOR
   ═══════════════════════════════════════════════════════════════════ */
.sheepy-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
  margin-bottom: 45px;
  opacity: 0;
  transform: translateY(-30px);
  transition: all 1.4s var(--ease-smooth);
  position: relative;
  pointer-events: auto;
}

.sheepy-container.show { opacity: 1; transform: translateY(0); }
.sheepy-container.hide { opacity: 0; transform: translateY(-35px) scale(0.92); }

.sheepy-glow {
  width: clamp(140px, 32vw, 180px);
  height: clamp(140px, 32vw, 180px);
  background: radial-gradient(circle, rgba(74, 53, 40, 0.4) 0%, rgba(74, 53, 40, 0.1) 45%, transparent 70%);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  animation: sheepyGlow 6s ease-in-out infinite;
  position: relative;
}

@keyframes sheepyGlow {
  0%, 100% { transform: scale(1); opacity: 0.75; }
  50% { transform: scale(1.1); opacity: 1; }
}

.sheepy-text {
  font-family: var(--font-serif);
  font-size: clamp(1.05rem, 2.8vw, 1.4rem);
  font-weight: 400;
  color: var(--earth-pale);
  text-align: center;
  max-width: 420px;
  line-height: 2.4;
  min-height: 4em;
}

.sheepy-text .hand {
  font-family: var(--font-hand);
  font-size: 1.3em;
  color: var(--gold-glow);
  text-shadow: 0 0 20px rgba(224, 192, 128, 0.5);
}

.sheepy-text .whisper {
  font-style: italic;
  opacity: 0.65;
  font-size: 0.9em;
}

.sheepy-controls {
  position: absolute;
  bottom: -50px;
  display: flex;
  gap: 14px;
  opacity: 0.75;
  transition: opacity 0.5s;
}

.sheepy-container:hover .sheepy-controls {
  opacity: 1;
}

.speed-btn {
  background: rgba(0, 0, 0, 0.7);
  border: 1px solid var(--earth);
  border-radius: 6px;
  color: var(--earth-pale);
  font-family: var(--font-crt);
  font-size: 12px;
  padding: 6px 14px;
  cursor: pointer;
  transition: all 0.4s var(--ease-smooth);
  pointer-events: auto;
}

.speed-btn:hover,
.speed-btn.active {
  background: var(--earth);
  color: #fff;
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(74, 53, 40, 0.4);
}

/* ═══════════════════════════════════════════════════════════════════
   SCENE NARRATIVE — No overlap, proper spacing
   ═══════════════════════════════════════════════════════════════════ */
.scene {
  max-width: 580px;
  width: 100%;
  text-align: center;
  pointer-events: auto;
  padding-bottom: clamp(80px, 12vh, 140px);
}

.scene p {
  font-family: var(--font-serif);
  font-size: clamp(1.05rem, 2.8vw, 1.4rem);
  font-weight: 400;
  line-height: 2.8;
  color: var(--white);
  margin-bottom: clamp(24px, 4.5vh, 44px);
  opacity: 0;
  transform: translateY(20px);
  transition: all 1.2s var(--ease-smooth);
  max-width: 100%;
  word-wrap: break-word;
}

.scene p.show {
  opacity: 1;
  transform: translateY(0);
  animation: breatheIn 1.2s var(--ease-smooth) forwards;
}

@keyframes breatheIn {
  from { opacity: 0; transform: translateY(22px); }
  to { opacity: 1; transform: translateY(0); }
}

.scene .narrator {
  color: var(--dim);
  font-style: italic;
  font-size: 0.9em;
}

.scene .her {
  color: var(--pink-soft);
  text-shadow: 0 0 25px rgba(216, 120, 149, 0.4);
}

.scene .me {
  color: var(--gold-light);
  text-shadow: 0 0 25px rgba(184, 152, 80, 0.4);
}

.scene .memory {
  color: var(--earth-pale);
  font-style: italic;
  font-size: 0.85em;
  opacity: 0.8;
  border-left: 3px solid var(--earth);
  padding: 18px 22px;
  margin: clamp(28px, 5vh, 48px) auto;
  max-width: 440px;
  text-align: left;
  line-height: 2.6;
  background: rgba(74, 53, 40, 0.08);
  border-radius: 0 8px 8px 0;
}

.scene .moment {
  color: var(--pink-glow);
  font-weight: 500;
  font-size: 1.15em;
  text-shadow: 0 0 40px rgba(255, 80, 128, 0.6);
  letter-spacing: 2px;
  display: block;
  margin: clamp(24px, 5vh, 44px) auto;
}

.scene .time {
  color: var(--dim);
  font-family: var(--font-crt);
  font-size: 0.85em;
  letter-spacing: 4px;
  display: block;
  margin-bottom: clamp(20px, 4vh, 36px);
}

.scene .snapchat {
  color: var(--snap-yellow);
  font-family: var(--font-mono);
  font-weight: 700;
  text-shadow: 0 0 15px rgba(255, 252, 0, 0.4);
}

/* ═══════════════════════════════════════════════════════════════════
   CHOICES — Proper spacing, no cut-off
   ═══════════════════════════════════════════════════════════════════ */
.choices {
  width: 100%;
  max-width: 500px;
  display: flex;
  flex-direction: column;
  gap: clamp(16px, 3vh, 24px);
  opacity: 0;
  transform: translateY(30px);
  transition: all 1.4s 0.5s var(--ease-smooth);
  margin-top: clamp(20px, 4vh, 36px);
  padding-bottom: clamp(80px, 12vh, 120px);
  pointer-events: auto;
}

.choices.show { opacity: 1; transform: translateY(0); }

.choice {
  width: 100%;
  padding: clamp(18px, 3vh, 24px) clamp(22px, 4vw, 28px);
  background: linear-gradient(145deg, rgba(18, 10, 6, 0.97), rgba(8, 4, 2, 0.99));
  border: 1px solid rgba(74, 53, 40, 0.35);
  border-radius: 10px;
  color: var(--white);
  font-family: var(--font-serif);
  font-size: clamp(1.05rem, 2.4vw, 1.25rem);
  text-align: left;
  cursor: pointer;
  transition: all 0.6s var(--ease-smooth);
  position: relative;
  overflow: hidden;
  pointer-events: auto;
}

.choice::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(90deg, transparent, rgba(154, 112, 80, 0.1), transparent);
  transform: translateX(-100%);
  transition: transform 0.8s var(--ease-smooth);
}

.choice:hover:not(:disabled)::before {
  transform: translateX(100%);
}

.choice:hover:not(:disabled) {
  border-color: var(--earth-glow);
  transform: translateX(10px);
  box-shadow: 
    0 8px 30px rgba(74, 53, 40, 0.25),
    inset 0 0 35px rgba(154, 112, 80, 0.06);
}

.choice:disabled {
  cursor: default;
  opacity: 0.35;
}

.choice.selected {
  border-color: var(--earth);
  background: linear-gradient(145deg, rgba(74, 53, 40, 0.25), rgba(74, 53, 40, 0.1));
  box-shadow: 0 0 50px rgba(154, 112, 80, 0.3);
}

/* ═══════════════════════════════════════════════════════════════════
   PHONE — foreignObject for text wrapping + Toggle button
   ═══════════════════════════════════════════════════════════════════ */
.phone-toggle {
  position: fixed;
  bottom: clamp(70px, 10vh, 100px);
  right: 24px;
  z-index: 55;
  background: rgba(0, 0, 0, 0.7);
  border: 1px solid var(--snap-yellow);
  border-radius: 50%;
  width: 44px;
  height: 44px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  opacity: 0;
  transition: all 0.5s var(--ease-smooth);
  pointer-events: none;
}

.phone-toggle.show {
  opacity: 0.7;
  pointer-events: auto;
}

.phone-toggle:hover {
  opacity: 1;
  transform: scale(1.1);
  box-shadow: 0 0 20px rgba(255, 252, 0, 0.3);
}

.phone-toggle svg {
  width: 22px;
  height: 22px;
  fill: var(--snap-yellow);
}

#phone-container {
  position: fixed;
  left: 50%;
  bottom: 80px;
  transform: translate(-50%, 100%);
  z-index: 100;
  width: clamp(280px, 40vw, 320px);
  height: auto;
  transition: transform 0.5s var(--ease-spring);
  pointer-events: auto;
}

#phone-container.active {
  transform: translate(-50%, 0);
}

.phone-svg {
  width: 100%;
  height: auto;
  filter: drop-shadow(0 0 60px rgba(0, 0, 0, 0.9)) drop-shadow(0 20px 60px rgba(0, 0, 0, 0.5));
}

/* HTML screen inside SVG for text wrapping */
#phone-html-screen {
  position: absolute;
  top: 12%;
  left: 8%;
  width: 84%;
  height: 76%;
  overflow-y: auto;
  overflow-x: hidden;
  padding: 10px;
  display: flex;
  flex-direction: column;
  gap: 8px;
  scrollbar-width: thin;
  scrollbar-color: rgba(255,255,255,0.2) transparent;
}

#phone-html-screen::-webkit-scrollbar {
  width: 4px;
}

#phone-html-screen::-webkit-scrollbar-thumb {
  background: rgba(255,255,255,0.2);
  border-radius: 2px;
}

.msg-bubble {
  max-width: 85%;
  padding: 10px 14px;
  border-radius: 16px;
  font-family: var(--font-mono);
  font-size: 13px;
  line-height: 1.5;
  word-wrap: break-word;
  overflow-wrap: break-word;
  animation: msgPop 0.3s var(--ease-spring);
}

@keyframes msgPop {
  from { opacity: 0; transform: scale(0.9) translateY(10px); }
  to { opacity: 1; transform: scale(1) translateY(0); }
}

.msg-her { 
  align-self: flex-start; 
  background: rgba(42, 18, 32, 0.95); 
  color: #d87895; 
  border-left: 2px solid #802845;
  border-radius: 16px 16px 16px 4px;
}

.msg-me { 
  align-self: flex-end; 
  background: rgba(18, 34, 24, 0.95); 
  color: #b89850; 
  border-right: 2px solid #907030;
  border-radius: 16px 16px 4px 16px;
}

/* ═══════════════════════════════════════════════════════════════════
   ROOM MODAL — Diegetic interactions
   ═══════════════════════════════════════════════════════════════════ */
.room-modal {
  position: fixed;
  inset: 0;
  z-index: 300;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0, 0, 0, 0.85);
  backdrop-filter: blur(12px);
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.5s var(--ease-smooth);
}

.room-modal.show {
  opacity: 1;
  pointer-events: auto;
}

.room-modal-content {
  max-width: min(600px, 90vw);
  max-height: 80vh;
  background: linear-gradient(145deg, #1a1510, #0a0805);
  border: 1px solid var(--earth);
  border-radius: 16px;
  padding: clamp(24px, 4vw, 40px);
  overflow-y: auto;
  position: relative;
  animation: modalSlide 0.5s var(--ease-bounce);
  box-shadow: 0 25px 80px rgba(0, 0, 0, 0.8), 0 0 40px rgba(154, 112, 80, 0.1);
}

@keyframes modalSlide {
  from { transform: translateY(30px) scale(0.95); opacity: 0; }
  to { transform: translateY(0) scale(1); opacity: 1; }
}

.modal-close {
  position: absolute;
  top: 14px;
  right: 14px;
  background: none;
  border: 1px solid var(--dim);
  border-radius: 50%;
  width: 36px;
  height: 36px;
  color: var(--dim);
  font-size: 18px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s var(--ease-smooth);
}

.modal-close:hover { 
  color: var(--white); 
  border-color: var(--white);
  transform: rotate(90deg);
}

.modal-title {
  font-family: var(--font-display);
  font-size: clamp(1.2rem, 3vw, 1.6rem);
  color: var(--earth-glow);
  margin-bottom: 16px;
}

.modal-meta {
  font-family: var(--font-hand);
  font-size: 0.95rem;
  color: var(--dim);
  margin-top: 16px;
  font-style: italic;
  line-height: 1.6;
}

/* ═══════════════════════════════════════════════════════════════════
   ★ CONTINUE PROMPT — CRITICAL FIX for mobile touch
   ═══════════════════════════════════════════════════════════════════ */
#continue-overlay {
  position: fixed;
  inset: 0;
  z-index: 198;
  cursor: pointer;
  display: none;
  /* CRITICAL: transparent bg doesn't capture touches on mobile Safari/Chrome */
  background: rgba(0, 0, 0, 0.005);
  -webkit-tap-highlight-color: rgba(0,0,0,0);
}

#continue-overlay.show {
  display: block;
}

.continue-prompt {
  position: fixed;
  bottom: clamp(28px, 6vh, 55px);
  left: 50%;
  transform: translateX(-50%);
  z-index: 199;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.6s var(--ease-smooth);
}

.continue-prompt.show {
  opacity: 1;
  pointer-events: auto;
}

.continue-text {
  color: var(--gold);
  font-family: var(--font-crt);
  font-size: 0.9rem;
  letter-spacing: 3px;
  animation: promptPulse 3s ease-in-out infinite;
}

@keyframes promptPulse {
  0%, 100% { opacity: 0.45; transform: translateY(0); }
  50% { opacity: 1; transform: translateY(-5px); }
}

.continue-icon {
  width: 48px;
  height: 48px;
  border: 2px solid var(--gold);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  animation: iconPulse 2.5s ease-in-out infinite;
  background: rgba(0, 0, 0, 0.4);
}

@keyframes iconPulse {
  0%, 100% { transform: scale(1); opacity: 0.65; }
  50% { transform: scale(1.15); opacity: 1; }
}

.continue-icon svg {
  width: 22px;
  height: 22px;
  fill: var(--gold);
  transform: rotate(90deg);
}

/* ═══════════════════════════════════════════════════════════════════
   HUD
   ═══════════════════════════════════════════════════════════════════ */
.hud {
  position: fixed;
  bottom: 24px;
  right: 24px;
  z-index: 50;
  text-align: right;
  opacity: 0;
  transform: translateX(30px);
  transition: all 1.4s var(--ease-smooth);
  pointer-events: none;
}

.hud.show { opacity: 1; transform: translateX(0); }

.meter {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 14px;
}

.meter-label {
  font-size: 12px;
  font-family: var(--font-crt);
  color: var(--dim);
  width: 60px;
  text-align: right;
}

.meter-bar {
  width: 120px;
  height: 8px;
  background: #0a0a0a;
  border-radius: 5px;
  overflow: hidden;
  border: 1px solid #1a1a1a;
}

.meter-fill {
  height: 100%;
  transition: width 1s var(--ease-smooth);
  border-radius: 4px;
}

.meter-fill.trust {
  background: linear-gradient(90deg, var(--earth-deep), var(--earth-glow));
  box-shadow: 0 0 12px rgba(154, 112, 80, 0.4);
}

.meter-fill.guard {
  background: linear-gradient(90deg, #252530, #454555);
}

.meter-value {
  font-size: 14px;
  font-family: var(--font-crt);
  color: var(--earth-pale);
  min-width: 32px;
}

/* ═══════════════════════════════════════════════════════════════════
   MEMORY MATCH
   ═══════════════════════════════════════════════════════════════════ */
.match-container {
  width: 100%;
  max-width: 460px;
  opacity: 0;
  transform: scale(0.95);
  transition: all 1.4s var(--ease-smooth);
  pointer-events: auto;
}

.match-container.show { opacity: 1; transform: scale(1); }

.match-header {
  text-align: center;
  margin-bottom: 28px;
}

.match-title {
  font-size: clamp(1.05rem, 2.4vw, 1.3rem);
  font-family: var(--font-crt);
  color: var(--earth-glow);
  letter-spacing: 0.3em;
  text-shadow: 0 0 30px rgba(154, 112, 80, 0.5);
  margin-bottom: 12px;
}

.match-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 14px;
}

.match-card {
  aspect-ratio: 1;
  background: linear-gradient(145deg, #1a1410, #0d0a08);
  border: 2px solid #2a2015;
  border-radius: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: var(--font-hand);
  font-size: clamp(0.75rem, 1.8vw, 0.95rem);
  color: var(--dim);
  cursor: pointer;
  transition: all 0.6s var(--ease-smooth);
  position: relative;
  overflow: hidden;
}

.match-card:hover:not(.flipped):not(.matched) {
  border-color: #3a2a1f;
  transform: scale(1.06);
  box-shadow: 0 8px 30px rgba(0, 0, 0, 0.6);
}

.match-card.flipped,
.match-card.matched {
  background: linear-gradient(145deg, #2a1a10, #1a0c08);
  border-color: var(--earth);
}

.card-inner {
  opacity: 0;
  transform: rotateY(90deg);
  transition: all 0.7s var(--ease-smooth);
  color: var(--earth-pale);
  text-align: center;
  padding: 10px;
  line-height: 1.7;
}

.match-card.flipped .card-inner,
.match-card.matched .card-inner {
  opacity: 1;
  transform: rotateY(0);
}

.match-card.matched {
  border-color: var(--trust);
  box-shadow: 0 0 30px rgba(74, 128, 64, 0.35);
}

/* ═══════════════════════════════════════════════════════════════════
   AUDIO & MISC
   ═══════════════════════════════════════════════════════════════════ */
.audio-btn {
  position: fixed;
  top: 14px;
  right: 14px;
  z-index: 200;
  background: rgba(0, 0, 0, 0.75);
  border: 1px solid #2a2520;
  border-radius: 5px;
  color: var(--dim);
  font-family: var(--font-crt);
  font-size: 12px;
  padding: 6px 14px;
  cursor: pointer;
  transition: all 0.5s var(--ease-smooth);
  pointer-events: auto;
}

.audio-btn:hover,
.audio-btn.on {
  color: var(--earth-glow);
  border-color: var(--earth);
  box-shadow: 0 0 20px rgba(154, 112, 80, 0.25);
}

/* ═══════════════════════════════════════════════════════════════════
   RESPONSIVE
   ═══════════════════════════════════════════════════════════════════ */
@media (max-width: 600px) {
  .main { padding: 85px 20px 140px; }
  .choices { gap: 14px; }
  .choice { padding: 16px 20px; }
  .match-grid { gap: 12px; }
  .phone-toggle { right: 16px; bottom: 60px; }
  #phone-container { width: 85vw; bottom: 60px; }
}
</style>
</head>
<body>

<!-- Loading Overlay -->
<div id="loading-overlay">
  <svg class="seed-loading" viewBox="0 0 100 100">
    <defs>
      <radialGradient id="sgLoad" cx="50%" cy="50%">
        <stop offset="0%" stop-color="#a8e6a3" stop-opacity="0.75"/>
        <stop offset="100%" stop-color="#558b2f" stop-opacity="0.3"/>
      </radialGradient>
      <filter id="seedGlow">
        <feGaussianBlur stdDeviation="2.5" result="blur"/>
        <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
      </filter>
    </defs>
    <ellipse cx="50" cy="50" rx="22" ry="35" fill="url(#sgLoad)" transform="rotate(-15 50 50)" filter="url(#seedGlow)">
      <animate attributeName="ry" values="35;38;35" dur="3.5s" repeatCount="indefinite"/>
    </ellipse>
    <ellipse cx="50" cy="34" rx="8" ry="5" fill="#c8e6c9" transform="rotate(-15 50 34)"/>
    <path d="M38 16 Q50 2 62 16" stroke="#81c784" stroke-width="3" fill="none" stroke-linecap="round">
      <animate attributeName="d" values="M38 16 Q50 2 62 16;M38 12 Q50 -2 62 12;M38 16 Q50 2 62 16" dur="3.5s" repeatCount="indefinite"/>
    </path>
  </svg>
  <h1>SIDE A: SOIL</h1>
  <div class="sub">where it all began</div>
  <div class="boot-text" id="boot-text"></div>
</div>

<!-- Main CRT Screen -->
<div class="crt-screen">
  <div class="scan-bar"></div>
  
  <div id="vhs-layer"><canvas id="vhs-canvas"></canvas></div>
  <div id="noise-layer"></div>
  
  <!-- ★ BEDROOM SCENE — Interactive vector space (1000x800 logical coordinates) -->
  <div id="bedroom-scene">
    <svg id="bedroom-svg" viewBox="0 0 1000 800" preserveAspectRatio="xMidYMid slice">
      <defs>
        <!-- Gradients -->
        <linearGradient id="wallGrad" x1="0%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%" stop-color="#1a1510"/>
          <stop offset="100%" stop-color="#0f0a08"/>
        </linearGradient>
        <linearGradient id="floorGrad" x1="0%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%" stop-color="#1a1208"/>
          <stop offset="100%" stop-color="#0a0804"/>
        </linearGradient>
        <linearGradient id="windowGlow" x1="0%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%" stop-color="#0a1020" stop-opacity="0.6"/>
          <stop offset="100%" stop-color="#050810" stop-opacity="0.3"/>
        </linearGradient>
        <radialGradient id="lampGlow" cx="50%" cy="50%">
          <stop offset="0%" stop-color="#e8d080" stop-opacity="0.3"/>
          <stop offset="100%" stop-color="transparent"/>
        </radialGradient>
        <filter id="roomGlow">
          <feGaussianBlur stdDeviation="4" result="blur"/>
          <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
        </filter>
        <filter id="softBlur"><feGaussianBlur stdDeviation="2"/></filter>
      </defs>
      
      <!-- Room Structure -->
      <rect x="0" y="0" width="1000" height="550" fill="url(#wallGrad)"/>
      <rect x="0" y="550" width="1000" height="250" fill="url(#floorGrad)"/>
      <line x1="0" y1="550" x2="1000" y2="550" stroke="#2a2015" stroke-width="3" opacity="0.4"/>
      
      <!-- Fairy lights string across top -->
      <path d="M50 40 Q200 55 350 42 Q500 30 650 48 Q720 52 780 38" stroke="#3a3020" stroke-width="1.5" fill="none" opacity="0.4"/>
      <g class="fairy-lights">
        <circle cx="120" cy="48" r="3" fill="#ffeeaa" opacity="0"><animate attributeName="opacity" values="0;0.8;0" dur="3s" repeatCount="indefinite"/></circle>
        <circle cx="220" cy="52" r="2.5" fill="#ffeedd" opacity="0"><animate attributeName="opacity" values="0;0.7;0" dur="3.5s" begin="0.5s" repeatCount="indefinite"/></circle>
        <circle cx="350" cy="44" r="3" fill="#ffeeaa" opacity="0"><animate attributeName="opacity" values="0;0.9;0" dur="2.8s" begin="1s" repeatCount="indefinite"/></circle>
        <circle cx="480" cy="36" r="2.5" fill="#ffeedd" opacity="0"><animate attributeName="opacity" values="0;0.6;0" dur="4s" begin="0.3s" repeatCount="indefinite"/></circle>
        <circle cx="580" cy="46" r="3" fill="#ffeeaa" opacity="0"><animate attributeName="opacity" values="0;0.8;0" dur="3.2s" begin="0.8s" repeatCount="indefinite"/></circle>
        <circle cx="680" cy="50" r="2.5" fill="#ffeedd" opacity="0"><animate attributeName="opacity" values="0;0.7;0" dur="3.8s" begin="1.5s" repeatCount="indefinite"/></circle>
      </g>
      
      <!-- ═══ WINDOW (Left Wall) ═══ -->
      <g class="room-item" data-item="window" tabindex="0">
        <rect x="50" y="80" width="180" height="240" rx="4" fill="url(#windowGlow)" stroke="#3a3020" stroke-width="3"/>
        <line x1="140" y1="80" x2="140" y2="320" stroke="#3a3020" stroke-width="2"/>
        <line x1="50" y1="200" x2="230" y2="200" stroke="#3a3020" stroke-width="2"/>
        <!-- Moon -->
        <circle cx="100" cy="140" r="20" fill="#e8e4d8" opacity="0.2" filter="url(#softBlur)"/>
        <!-- Stars -->
        <circle cx="70" cy="110" r="2" fill="#fff" opacity="0.4">
          <animate attributeName="opacity" values="0.2;0.6;0.2" dur="4s" repeatCount="indefinite"/>
        </circle>
        <circle cx="190" cy="130" r="1.5" fill="#fff" opacity="0.3">
          <animate attributeName="opacity" values="0.3;0.7;0.3" dur="3s" begin="1s" repeatCount="indefinite"/>
        </circle>
        <circle cx="160" cy="170" r="1" fill="#fff" opacity="0.5"/>
        <!-- Window light cast on floor -->
        <path d="M50 320 L-20 800 L200 800 L230 320" fill="rgba(10,16,32,0.15)" opacity="0.5"/>
      </g>
      
      <!-- ═══ PAINTING — Golden Sea (Center Wall) ═══ -->
      <g class="room-item" data-item="painting" tabindex="0" transform="translate(400, 60)">
        <rect x="0" y="0" width="200" height="140" rx="3" fill="#1a1510" stroke="#4a3828" stroke-width="4"/>
        <rect x="8" y="8" width="184" height="124" rx="1" fill="#0a0805"/>
        <!-- Golden sea painting content -->
        <rect x="8" y="80" width="184" height="52" fill="#c8a040" opacity="0.3"/>
        <path d="M8 95 Q60 75 110 92 Q160 108 192 88" stroke="#d4af37" stroke-width="2" fill="none" opacity="0.5"/>
        <path d="M8 115 Q70 95 130 115 Q170 130 192 105" stroke="#c8a040" stroke-width="1.5" fill="none" opacity="0.4"/>
        <circle cx="140" cy="50" r="25" fill="#e8b040" opacity="0.2" filter="url(#softBlur)"/>
        <!-- Frame shadow -->
        <rect x="0" y="140" width="200" height="8" rx="2" fill="#000" opacity="0.2" filter="url(#softBlur)"/>
        <text x="100" y="160" text-anchor="middle" font-family="'Caveat', cursive" font-size="10" fill="#4a3828" opacity="0.5">Golden Sea</text>
      </g>
      
      <!-- ═══ SKATEBOARD (Right Wall) — CLICKABLE ═══ -->
      <g class="room-item" data-item="skateboard" tabindex="0" transform="translate(800, 100) rotate(-12)">
        <rect x="0" y="0" width="40" height="160" rx="20" fill="#2a1a10" stroke="#4a3020" stroke-width="2"/>
        <!-- Deck graphic -->
        <rect x="5" y="30" width="30" height="50" rx="4" fill="#802845" opacity="0.6"/>
        <rect x="5" y="90" width="30" height="40" rx="4" fill="#4a8040" opacity="0.5"/>
        <!-- Trucks -->
        <rect x="10" y="10" width="20" height="8" rx="2" fill="#666"/>
        <rect x="10" y="142" width="20" height="8" rx="2" fill="#666"/>
        <!-- Wheels -->
        <circle cx="10" cy="6" r="5" fill="#555"/>
        <circle cx="30" cy="6" r="5" fill="#555"/>
        <circle cx="10" cy="154" r="5" fill="#555"/>
        <circle cx="30" cy="154" r="5" fill="#555"/>
      </g>
      
      <!-- ═══ TV (Left Floor) — CLICKABLE ═══ -->
      <g class="room-item" data-item="tv" tabindex="0" transform="translate(80, 380)">
        <rect x="0" y="0" width="220" height="140" rx="8" fill="#0a0a0a" stroke="#2a2520" stroke-width="3"/>
        <rect x="10" y="10" width="200" height="110" rx="4" fill="#080808"/>
        <!-- Screen content -->
        <rect x="15" y="15" width="190" height="100" rx="2" fill="#0a0f18">
          <animate attributeName="fill" values="#0a0f18;#0c1220;#0a0f18" dur="4s" repeatCount="indefinite"/>
        </rect>
        <!-- Static lines -->
        <line x1="30" y1="40" x2="180" y2="40" stroke="#1a2030" stroke-width="1" opacity="0.5"/>
        <line x1="30" y1="60" x2="160" y2="60" stroke="#1a2030" stroke-width="1" opacity="0.3"/>
        <line x1="30" y1="80" x2="170" y2="80" stroke="#1a2030" stroke-width="1" opacity="0.4"/>
        <!-- Power LED -->
        <circle cx="200" cy="125" r="4" fill="#ff3030" opacity="0.6">
          <animate attributeName="opacity" values="0.4;0.8;0.4" dur="2s" repeatCount="indefinite"/>
        </circle>
        <!-- Stand -->
        <rect x="90" y="140" width="40" height="12" fill="#1a1510"/>
        <rect x="105" y="152" width="10" height="20" fill="#1a1510"/>
      </g>
      
      <!-- ═══ BED (Center Floor) ═══ -->
      <g transform="translate(350, 420)">
        <rect x="0" y="0" width="300" height="180" rx="8" fill="#1a1208" stroke="#2a1e10" stroke-width="2"/>
        <!-- Mattress -->
        <rect x="10" y="10" width="280" height="160" rx="4" fill="#1e1510"/>
        <!-- Pillow -->
        <ellipse cx="80" cy="40" rx="60" ry="25" fill="#2a2218" stroke="#3a3020" stroke-width="1"/>
        <!-- Blanket (messy) -->
        <path d="M10 80 Q150 60 290 90 Q300 120 290 170 L10 170 Z" fill="#2a1e14" stroke="#3a2818" stroke-width="1"/>
        <path d="M10 90 Q100 80 200 100 Q270 115 290 100" stroke="#3a2818" stroke-width="1" fill="none" opacity="0.5"/>
        
        <!-- ═══ SALAD ON BED (Easter Egg) ═══ -->
        <g class="room-item" data-item="salad" tabindex="0" transform="translate(200, 100)">
          <circle cx="0" cy="0" r="18" fill="#4a8040" opacity="0.5"/>
          <circle cx="-6" cy="-6" r="10" fill="#558b2f" opacity="0.7"/>
          <circle cx="6" cy="6" r="8" fill="#6b9b4f" opacity="0.6"/>
          <ellipse cx="0" cy="0" rx="12" ry="8" fill="#3a6030" opacity="0.4"/>
        </g>
      </g>
      
      <!-- ═══ DESK (Right Floor) ═══ -->
      <g transform="translate(700, 350)">
        <rect x="0" y="0" width="280" height="12" rx="2" fill="#2a1e14" stroke="#3a2818"/>
        <rect x="15" y="12" width="12" height="140" fill="#1a1208"/>
        <rect x="253" y="12" width="12" height="140" fill="#1a1208"/>
        <rect x="15" y="100" width="240" height="6" rx="1" fill="#1a1208" opacity="0.5"/>
        
        <!-- Monitor -->
        <rect x="40" y="-80" width="160" height="100" rx="4" fill="#0a0a0a" stroke="#222" stroke-width="2"/>
        <rect x="48" y="-72" width="144" height="84" rx="2" fill="#0a1020">
          <animate attributeName="fill" values="#0a1020;#0c1225;#0a1020" dur="6s" repeatCount="indefinite"/>
        </rect>
        <text x="120" y="-35" text-anchor="middle" font-family="'VT323', monospace" font-size="10" fill="#2a3a50" opacity="0.6">roblox.com</text>
        <!-- Monitor stand -->
        <rect x="105" y="20" width="30" height="10" fill="#1a1a1a"/>
        <rect x="95" y="28" width="50" height="5" rx="2" fill="#1a1a1a"/>
      </g>
      
      <!-- ═══ CONTROLLER on desk — CLICKABLE (Mini-game) ═══ -->
      <g class="room-item" data-item="controller" tabindex="0" transform="translate(620, 320)">
        <ellipse cx="0" cy="0" rx="35" ry="20" fill="#1a1a1a" stroke="#333" stroke-width="1.5"/>
        <circle cx="-15" cy="-5" r="6" fill="none" stroke="#444" stroke-width="1"/>
        <circle cx="15" cy="-5" r="4" fill="#4a8040"/>
        <circle cx="22" cy="2" r="4" fill="#aa4444"/>
        <circle cx="8" cy="2" r="4" fill="#4444aa"/>
        <rect x="-8" y="-12" width="16" height="5" rx="2" fill="#333"/>
      </g>
      
      <!-- ═══ NEWSPAPER on floor — CLICKABLE (3 languages) ═══ -->
      <g class="room-item" data-item="newspaper" tabindex="0" transform="translate(550, 650) rotate(-8)">
        <rect x="0" y="0" width="70" height="50" rx="2" fill="#d8d0b8" stroke="#a89878" stroke-width="1"/>
        <text x="8" y="15" font-family="serif" font-size="6" fill="#1a1a1a" opacity="0.6">日本経済新聞</text>
        <line x1="5" y1="20" x2="65" y2="20" stroke="#aaa" stroke-width="0.5"/>
        <rect x="5" y="23" width="25" height="18" fill="#ccc8b0" opacity="0.5"/>
        <line x1="32" y1="25" x2="65" y2="25" stroke="#999" stroke-width="0.3"/>
        <line x1="32" y1="30" x2="65" y2="30" stroke="#999" stroke-width="0.3"/>
        <line x1="32" y1="35" x2="60" y2="35" stroke="#999" stroke-width="0.3"/>
      </g>
      
      <!-- ═══ MOTORBIKE KEYS on wall hook — CLICKABLE ═══ -->
      <g class="room-item" data-item="keys" tabindex="0" transform="translate(920, 200)">
        <!-- Hook -->
        <path d="M0 0 Q5 -10 10 0" stroke="#666" stroke-width="3" fill="none"/>
        <!-- Key ring -->
        <circle cx="5" cy="12" r="10" fill="none" stroke="#888" stroke-width="1.5"/>
        <!-- Keys -->
        <rect x="-2" y="22" width="5" height="22" rx="1" fill="#aaa" transform="rotate(-10)"/>
        <rect x="8" y="22" width="4" height="18" rx="1" fill="#999" transform="rotate(8)"/>
        <!-- Key fob -->
        <rect x="-5" y="18" width="15" height="10" rx="4" fill="#333" stroke="#555" stroke-width="0.5"/>
        <circle cx="2.5" cy="23" r="2" fill="#ff3030" opacity="0.5">
          <animate attributeName="opacity" values="0.3;0.7;0.3" dur="3s" repeatCount="indefinite"/>
        </circle>
      </g>
      
      <!-- ═══ PHONE on desk — CLICKABLE ═══ -->
      <g class="room-item" data-item="phone-desk" tabindex="0" transform="translate(850, 280)">
        <rect x="0" y="0" width="40" height="28" rx="5" fill="#0a0a0a" stroke="#222" stroke-width="1"/>
        <rect x="3" y="4" width="34" height="18" rx="2" fill="#0f0f0f"/>
        <rect x="4" y="5" width="32" height="16" rx="1.5" fill="#1a1020">
          <animate attributeName="fill" values="#1a1020;#251530;#1a1020" dur="5s" repeatCount="indefinite"/>
        </rect>
        <!-- Notification dot -->
        <circle cx="35" cy="3" r="3" fill="#FFFC00" opacity="0.7">
          <animate attributeName="opacity" values="0.4;1;0.4" dur="2s" repeatCount="indefinite"/>
        </circle>
      </g>
      
      <!-- Ambient dust motes -->
      <circle r="2" fill="#ffeedd" opacity="0">
        <animate attributeName="cx" values="100;150;100" dur="20s" repeatCount="indefinite"/>
        <animate attributeName="cy" values="200;150;200" dur="15s" repeatCount="indefinite"/>
        <animate attributeName="opacity" values="0;0.15;0" dur="8s" repeatCount="indefinite"/>
      </circle>
      <circle r="1.5" fill="#ffeedd" opacity="0">
        <animate attributeName="cx" values="600;650;600" dur="18s" repeatCount="indefinite"/>
        <animate attributeName="cy" values="300;250;300" dur="22s" repeatCount="indefinite"/>
        <animate attributeName="opacity" values="0;0.12;0" dur="6s" begin="3s" repeatCount="indefinite"/>
      </circle>
      <circle r="2.5" fill="#ffeedd" opacity="0">
        <animate attributeName="cx" values="650;700;650" dur="25s" repeatCount="indefinite"/>
        <animate attributeName="cy" values="180;130;180" dur="20s" repeatCount="indefinite"/>
        <animate attributeName="opacity" values="0;0.1;0" dur="10s" begin="5s" repeatCount="indefinite"/>
      </circle>
    </svg>
  </div>
  
  <!-- Phone Toggle Button -->
  <button class="phone-toggle" id="phone-toggle" aria-label="Toggle phone">
    <svg viewBox="0 0 24 24"><path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/></svg>
  </button>
  
  <!-- Phone Container with HTML screen -->
  <div id="phone-container">
    <svg class="phone-svg" viewBox="0 0 280 560" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <linearGradient id="phoneBody" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" stop-color="#252525"/>
          <stop offset="50%" stop-color="#151515"/>
          <stop offset="100%" stop-color="#0a0a0a"/>
        </linearGradient>
        <linearGradient id="snapYellow" x1="0%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%" stop-color="#FFFC00"/>
          <stop offset="100%" stop-color="#E0D000"/>
        </linearGradient>
        <filter id="phoneShadow">
          <feDropShadow dx="0" dy="0" stdDeviation="8" flood-opacity="0.5"/>
        </filter>
      </defs>
      
      <!-- Phone body -->
      <rect x="12" y="12" width="256" height="536" rx="40" fill="url(#phoneBody)" stroke="#333" stroke-width="2" filter="url(#phoneShadow)"/>
      
      <!-- Screen bezel -->
      <rect x="20" y="65" width="240" height="430" rx="8" fill="#080808" stroke="#222" stroke-width="1"/>
      
      <!-- Screen area -->
      <rect x="24" y="69" width="232" height="422" rx="6" fill="#050505"/>
      
      <!-- Notch -->
      <rect x="95" y="24" width="90" height="32" rx="16" fill="#0a0a0a"/>
      <circle cx="140" cy="40" r="7" fill="#151515"/>
      <circle cx="140" cy="40" r="4" fill="#1a1a1a"/>
      
      <!-- Snapchat header -->
      <rect x="24" y="69" width="232" height="55" fill="url(#snapYellow)" rx="6"/>
      
      <!-- Ghost icon -->
      <g transform="translate(44, 78)">
        <path d="M16 6 Q16 0 22 0 Q28 0 28 6 L28 24 Q28 32 22 32 Q19 32 18 29 L16 26 L14 29 Q13 32 10 32 Q4 32 4 24 L4 6 Q4 0 10 0 Q16 0 16 6 Z" fill="#fff" transform="scale(0.9)"/>
      </g>
      <text x="140" y="102" text-anchor="middle" font-family="'Space Mono', monospace" font-size="16" font-weight="700" fill="#1a1a1a">Snapchat</text>
      
      <!-- Time -->
      <text x="140" y="52" text-anchor="middle" id="phone-time" font-family="'Space Mono', monospace" font-size="14" fill="#666">2:47 PM</text>
      
      <!-- Home indicator -->
      <rect x="105" y="475" width="70" height="6" rx="3" fill="#333"/>
    </svg>
    <!-- HTML overlay for messages (text wrapping works!) -->
    <div id="phone-html-screen"></div>
  </div>
  
  <!-- Room Modal -->
  <div class="room-modal" id="room-modal">
    <div class="room-modal-content" id="room-modal-content">
      <button class="modal-close" id="modal-close" aria-label="Close">✕</button>
      <div id="modal-body"></div>
    </div>
  </div>
  
  <!-- Header -->
  <div class="header">
    <a href="index.html" class="back-btn">◀ EJECT</a>
    <div class="tape-label">SIDE A: SOIL</div>
    <div class="scene-counter" id="counter"></div>
  </div>
  
  <!-- Audio button -->
  <button class="audio-btn" id="audio-btn">♪ SOUND OFF</button>
  
  <!-- Main content -->
  <div class="main" id="main">
    <div class="sheepy-container" id="sheepy">
      <div class="sheepy-glow" id="sglow"></div>
      <div class="sheepy-text" id="stxt"></div>
      <div class="sheepy-controls" id="sheepy-controls">
        <button class="speed-btn active" data-speed="slow">Slow</button>
        <button class="speed-btn" data-speed="normal">Normal</button>
        <button class="speed-btn" data-speed="fast">Fast</button>
      </div>
    </div>
    <div class="scene" id="scene"></div>
    <div class="choices" id="choices"></div>
    <div class="match-container" id="match" style="display: none;"></div>
  </div>
  
  <!-- HUD -->
  <div class="hud" id="hud">
    <div style="font-size: 11px; font-family: var(--font-crt); color: var(--dim); letter-spacing: 3px; margin-bottom: 12px; text-transform: uppercase;">Emotional State</div>
    <div class="meter">
      <span class="meter-label">TRUST</span>
      <div class="meter-bar"><div class="meter-fill trust" id="tbar" style="width: 0%;"></div></div>
      <span class="meter-value" id="tval">0</span>
    </div>
    <div class="meter">
      <span class="meter-label">GUARD</span>
      <div class="meter-bar"><div class="meter-fill guard" id="gbar" style="width: 0%;"></div></div>
      <span class="meter-value" id="gval">0</span>
    </div>
  </div>
  
  <!-- ★ Continue Overlay — rgba(0,0,0,0.005) captures mobile touches -->
  <div id="continue-overlay"></div>
  
  <!-- Continue Prompt -->
  <div class="continue-prompt" id="continue-prompt">
    <div class="continue-text">TAP TO CONTINUE</div>
    <div class="continue-icon">
      <svg viewBox="0 0 24 24"><path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"/></svg>
    </div>
  </div>
</div>

<script>
'use strict';

/* ═══════════════════════════════════════════════════════════════════
   UTILITIES — PhD-grade helper functions
   ═══════════════════════════════════════════════════════════════════ */
const $ = id => document.getElementById(id);
const sleep = ms => new Promise(r => setTimeout(r, ms));
const clamp = (v, lo, hi) => Math.max(lo, Math.min(hi, v));
const lerp = (a, b, t) => a + (b - a) * t;
const smoothstep = t => t * t * (3 - 2 * t);

/* Text speed — DEFAULT TO SLOW for readability */
const SPEEDS = { slow: 55, normal: 36, fast: 18 };
let textSpeed = 'slow';

/* ═══════════════════════════════════════════════════════════════════
   STATE MANAGEMENT — Full decision tree tracking
   ═══════════════════════════════════════════════════════════════════ */
const FX_DEF = {
  e_trust_1:{t:'stat',s:'trust',d:1},e_trust_2:{t:'stat',s:'trust',d:2},e_trust_3:{t:'stat',s:'trust',d:3},
  e_guard_1:{t:'stat',s:'guard',d:1},e_guard_2:{t:'stat',s:'guard',d:2},
  e_replied_fast:{t:'flag'},e_replied_slow:{t:'flag'},
  e_first_impression_eager:{t:'flag'},e_first_impression_guarded:{t:'flag'},e_first_impression_passive:{t:'flag'},
  e_hesitated:{t:'flag'},e_honesty_moment:{t:'flag'},e_tension_built:{t:'flag'},
  e_caught_smiling:{t:'flag'},e_warmth_shown:{t:'flag'},e_curious:{t:'flag'},
  e_learning_her_language:{t:'flag'},e_sought_connection:{t:'flag'},
  e_time_invested:{t:'flag'},e_shared_laughter:{t:'flag'},e_game_memory:{t:'flag'},
  e_observer_role:{t:'flag'},e_vulnerability_shown:{t:'flag'},e_playful_dynamic:{t:'flag'},
  e_physical_contact:{t:'flag'},e_intimacy_first:{t:'flag'},e_crossed_boundary:{t:'flag'},
  e_distance_kept:{t:'flag'},e_safety_chose:{t:'flag'},e_observer_deepened:{t:'flag'},e_silent_caring:{t:'flag'},
  e_voice_heard_3am:{t:'flag'},e_sunrise_together:{t:'flag'},e_missed_moment:{t:'flag'},
  e_voice_shared:{t:'flag'},e_intimate_medium:{t:'flag'},
  e_territorial:{t:'flag'},e_claimed_space:{t:'flag'},e_jealousy_shown:{t:'flag'},
  e_jealousy_hidden:{t:'flag'},e_sought_place:{t:'flag'},e_different_answer:{t:'flag'},
  e_mask_worn:{t:'flag'},e_feeling_denied:{t:'flag'},
  e_fear_chose:{t:'flag'},e_retreated:{t:'flag'},e_committed:{t:'flag'},e_patience_shown:{t:'flag'},
  e_soil_rich:{t:'arc'},e_soil_rocky:{t:'arc'},e_soil_barren:{t:'arc'},
  e_high_stakes:{t:'flag'},e_full_investment:{t:'flag'},e_cautious_hope:{t:'flag'},
  e_waiting_still:{t:'flag'},e_time_needed:{t:'flag'},
  e_tiktok_bond:{t:'flag'},e_discord_server:{t:'flag'},e_video_exchange:{t:'flag'},e_snapchat_daily:{t:'flag'}
};

const DEC_DEF = {
  d_tape1_reply_speed:{o:[
    {id:'reply_immediately',fx:['e_trust_1','e_replied_fast','e_first_impression_eager']},
    {id:'wait_hours',fx:['e_guard_1','e_replied_slow','e_first_impression_guarded']},
    {id:'stare_screen',fx:['e_replied_slow','e_first_impression_passive','e_hesitated']}
  ]},
  d_tape1_sigma_reaction:{o:[
    {id:'call_annoying',fx:['e_guard_1','e_honesty_moment','e_tension_built']},
    {id:'say_nothing_smile',fx:['e_trust_1','e_caught_smiling','e_warmth_shown']},
    {id:'ask_meaning',fx:['e_curious','e_learning_her_language','e_sought_connection']}
  ]},
  d_tape1_platform:{o:[
    {id:'tiktok',fx:['e_trust_1','e_tiktok_bond','e_video_exchange']},
    {id:'discord',fx:['e_guard_1','e_discord_server','e_observer_role']},
    {id:'snapchat',fx:['e_trust_1','e_snapchat_daily','e_sought_connection']}
  ]},
  d_tape1_princess_tycoon:{o:[
    {id:'play_complain',fx:['e_trust_1','e_time_invested','e_shared_laughter','e_game_memory']},
    {id:'refuse_watch',fx:['e_guard_1','e_observer_role','e_game_memory']},
    {id:'make_challenge',fx:['e_trust_1','e_vulnerability_shown','e_playful_dynamic','e_game_memory']}
  ]},
  d_tape1_scratch:{o:[
    {id:'take_hand',fx:['e_trust_2','e_physical_contact','e_intimacy_first','e_crossed_boundary']},
    {id:'look_away',fx:['e_guard_1','e_distance_kept','e_safety_chose']},
    {id:'file_away',fx:['e_observer_deepened','e_silent_caring']}
  ]},
  d_tape1_late_night:{o:[
    {id:'voice_note',fx:['e_trust_2','e_vulnerability_shown','e_voice_shared','e_intimate_medium']},
    {id:'text_back_safe',fx:['e_guard_1','e_safety_chose','e_missed_moment']},
    {id:'stay_up_talking',fx:['e_trust_2','e_sunrise_together','e_time_invested']}
  ]},
  d_tape1_jealousy:{o:[
    {id:'tell_her_busy',fx:['e_guard_1','e_territorial','e_claimed_space','e_jealousy_shown']},
    {id:'annoying_how',fx:['e_trust_1','e_sought_place','e_jealousy_shown','e_different_answer']},
    {id:'change_subject',fx:['e_mask_worn','e_jealousy_hidden','e_feeling_denied']}
  ]},
  d_tape1_realization:{o:[
    {id:'pull_back',fx:['e_guard_2','e_fear_chose','e_retreated']},
    {id:'lean_in',fx:['e_trust_2','e_vulnerability_shown','e_committed']},
    {id:'watch_grow',fx:['e_observer_deepened','e_patience_shown']}
  ]},
  d_tape1_soil_choice:{o:[
    {id:'rich_soil',fx:['e_trust_3','e_soil_rich','e_high_stakes','e_full_investment']},
    {id:'rocky_soil',fx:['e_guard_2','e_soil_rocky','e_cautious_hope']},
    {id:'barren_soil',fx:['e_soil_barren','e_waiting_still','e_time_needed']}
  ]}
};

const State = {
  trust:0, guard:0, flags:new Set(), choices:{},
  apply(ids) {
    const r=[];
    for(const id of ids){
      const e=FX_DEF[id]; if(!e) continue;
      if(e.t==='stat'){this[e.s]=clamp(this[e.s]+e.d,0,100);r.push({type:'stat',stat:e.s,delta:e.d})}
      else{this.flags.add(id);r.push({type:e.t,id})}
    }
    return r;
  },
  has(id){return this.flags.has(id)},
  save(){
    try{
      const s=JSON.parse(localStorage.getItem('seed_archive_v3')||'{}');
      s.tape1={complete:true,trust:this.trust,guard:this.guard,
        soil:this.has('e_soil_rich')?'rich':this.has('e_soil_rocky')?'rocky':'barren',
        flags:[...this.flags]};
      localStorage.setItem('seed_archive_v3',JSON.stringify(s));
    }catch{}
  },
  updateHUD(){
    $('tbar').style.width=Math.min(this.trust,100)+'%';
    $('gbar').style.width=Math.min(this.guard,100)+'%';
    $('tval').textContent=this.trust;
    $('gval').textContent=this.guard;
  }
};

/* ═══════════════════════════════════════════════════════════════════
   AUDIO — Characterful synthesized sound design
   ═══════════════════════════════════════════════════════════════════ */
const Snd = {
  ctx:null, master:null, on:false,
  
  init(){
    if(this.ctx)return;
    this.ctx=new(window.AudioContext||window.webkitAudioContext)();
    this.master=this.ctx.createGain();
    this.master.gain.value=0;
    this.master.connect(this.ctx.destination);
  },
  
  resume(){if(this.ctx?.state==='suspended')this.ctx.resume()},
  
  vol(v,t=0.5){
    if(!this.master)return;
    const now=this.ctx.currentTime;
    this.master.gain.cancelScheduledValues(now);
    this.master.gain.setValueAtTime(this.master.gain.value,now);
    this.master.gain.linearRampToValueAtTime(v,now+t);
  },
  
  _osc(freq,dur,type='sine',vol=0.05,delay=0){
    if(!this.ctx||!this.on)return;
    const t=this.ctx.currentTime+delay;
    const o=this.ctx.createOscillator(),g=this.ctx.createGain();
    o.type=type;o.frequency.value=freq;
    g.gain.setValueAtTime(0,t);
    g.gain.linearRampToValueAtTime(vol,t+0.02);
    g.gain.exponentialRampToValueAtTime(0.001,t+dur);
    o.connect(g);g.connect(this.master);
    o.start(t);o.stop(t+dur+0.05);
  },
  
  _noise(dur,vol=0.04,delay=0){
    if(!this.ctx||!this.on)return;
    const sr=this.ctx.sampleRate,len=sr*dur|0;
    const buf=this.ctx.createBuffer(1,len,sr),d=buf.getChannelData(0);
    for(let i=0;i<len;i++)d[i]=(Math.random()*2-1)*Math.pow(1-i/len,1.8);
    const s=this.ctx.createBufferSource(),g=this.ctx.createGain();
    const t=this.ctx.currentTime+delay;
    s.buffer=buf;g.gain.setValueAtTime(vol,t);
    g.gain.exponentialRampToValueAtTime(0.001,t+dur);
    s.connect(g);g.connect(this.master);s.start(t);
  },
  
  type(){this._osc(700+Math.random()*600,0.02,'triangle',0.025);this._osc(1200+Math.random()*400,0.015,'sine',0.015);},
  click(){this._osc(550,0.05,'sine',0.08);this._osc(850,0.035,'sine',0.04,0.025);},
  hover(){this._osc(350,0.1,'sine',0.03);this._osc(550,0.07,'sine',0.02,0.04);},
  select(){this._osc(420,0.18,'sine',0.07);this._osc(640,0.18,'sine',0.06,0.08);},
  emotional(){[210,265,320,385,440].forEach((f,i)=>{this._osc(f,0.9,'sine',0.05,i*0.15);this._osc(f*2,0.6,'triangle',0.02,i*0.15);});},
  glitch(){this._noise(0.12,0.12);this._osc(70+Math.random()*80,0.15,'square',0.06);},
  powerOn(){this._osc(30,0.7,'sawtooth',0.05);this._osc(70,0.5,'sine',0.035,0.25);this._noise(0.35,0.07);},
  whoosh(){this._noise(0.4,0.05);this._osc(180,0.25,'sine',0.025,0.06);this._osc(380,0.18,'sine',0.02,0.12);},
  phoneNotify(){this._osc(750,0.1,'sine',0.09);this._osc(950,0.07,'sine',0.07,0.1);this._osc(750,0.1,'sine',0.055,0.2);},
  flip(){this._osc(320,0.08,'triangle',0.05);this._osc(650,0.05,'sine',0.03,0.025);},
  match(){[385,515,650].forEach((f,i)=>{this._osc(f,0.4,'sine',0.055,i*0.1);this._osc(f*1.5,0.28,'triangle',0.025,i*0.1);});},
  wrong(){this._osc(105,0.25,'sawtooth',0.07);this._osc(112,0.25,'square',0.045);this._noise(0.15,0.06);},
  complete(){[385,485,575,770].forEach((f,i)=>this._osc(f,0.8,'sine',0.055,i*0.14));},
  continueReady(){this._osc(480,0.15,'sine',0.03);this._osc(620,0.12,'sine',0.025,0.1);},
  
  ensure(){
    this.init();this.resume();
    if(!this.on){
      this.on=true;this.vol(0.5,1.2);
      $('audio-btn').textContent='♪ SOUND ON';
      $('audio-btn').classList.add('on');
    }
  },
  
  toggle(){
    this.init();this.resume();
    this.on=!this.on;
    if(this.on){this.vol(0.5,1);$('audio-btn').textContent='♪ SOUND ON';$('audio-btn').classList.add('on');}
    else{this.vol(0,0.6);$('audio-btn').textContent='♪ SOUND OFF';$('audio-btn').classList.remove('on');}
  }
};

/* ═══════════════════════════════════════════════════════════════════
   VHS BACKGROUND — Particle atmosphere
   ═══════════════════════════════════════════════════════════════════ */
const VHS = {
  canvas:null,ctx:null,w:0,h:0,pts:[],
  init(){
    this.canvas=$('vhs-canvas');this.ctx=this.canvas.getContext('2d');
    this.resize();window.addEventListener('resize',()=>this.resize());
    for(let i=0;i<55;i++)this.pts.push({
      x:Math.random()*this.w,y:Math.random()*this.h,
      vx:(Math.random()-0.5)*0.4,vy:-0.14-Math.random()*0.28,
      sz:1.2+Math.random()*5,op:0.018+Math.random()*0.06,
      ph:Math.random()*6.28
    });
    this.loop();
  },
  resize(){this.w=this.canvas.width=innerWidth;this.h=this.canvas.height=innerHeight},
  loop(){
    const c=this.ctx;if(!this.w){requestAnimationFrame(()=>this.loop());return}
    c.fillStyle='rgba(3,3,3,0.07)';c.fillRect(0,0,this.w,this.h);
    for(const p of this.pts){
      p.x+=p.vx+Math.sin(p.ph+=0.0035)*0.45;p.y+=p.vy;
      if(p.y<-18){p.y=this.h+18;p.x=Math.random()*this.w}
      if(p.x<-18)p.x=this.w+18;if(p.x>this.w+18)p.x=-18;
      c.beginPath();c.arc(p.x,p.y,p.sz,0,6.28);
      c.fillStyle=`rgba(154,112,80,${p.op})`;c.fill();
    }
    if(Math.random()<0.012){
      c.fillStyle='rgba(154,112,80,0.018)';
      c.fillRect(0,Math.random()*this.h,this.w,3+Math.random()*10);
    }
    requestAnimationFrame(()=>this.loop());
  }
};

/* ═══════════════════════════════════════════════════════════════════
   PHONE — HTML screen for text wrapping + Toggle
   ═══════════════════════════════════════════════════════════════════ */
const Phone = {
  visible: false,
  show(){ 
    $('phone-container').classList.add('active'); 
    this.visible=true;
    $('phone-toggle').classList.add('show');
  },
  hide(){ 
    $('phone-container').classList.remove('active'); 
    this.visible=false;
  },
  toggle(){ this.visible ? this.hide() : this.show(); },
  setTime(t){ $('phone-time').textContent=t; },
  
  setMessages(msgs){
    const screen=$('phone-html-screen');
    screen.innerHTML='';
    msgs.forEach((m,i)=>{
      const div=document.createElement('div');
      div.className=`msg-bubble ${m.her?'msg-her':'msg-me'}`;
      div.textContent=m.text;
      div.style.animationDelay=`${i*0.1}s`;
      screen.appendChild(div);
    });
    screen.scrollTop=screen.scrollHeight;
  }
};

$('phone-toggle').addEventListener('click',(e)=>{
  e.stopPropagation();
  Phone.toggle();
  Snd.click();
});

/* ═══════════════════════════════════════════════════════════════════
   ROOM INTERACTIONS — Diegetic UI system
   ═══════════════════════════════════════════════════════════════════ */
const RoomItems = {
  init(){
    document.querySelectorAll('.room-item[data-item]').forEach(item=>{
      item.addEventListener('click',e=>{
        e.stopPropagation();
        const id=item.dataset.item;
        if(this.handlers[id]){
          this.handlers[id]();
          Snd.click();
        }
      });
      item.addEventListener('keydown',e=>{
        if(e.key==='Enter'||e.key===' '){
          e.preventDefault();
          const id=item.dataset.item;
          if(this.handlers[id]){this.handlers[id]();Snd.click();}
        }
      });
    });
    
    $('modal-close').addEventListener('click',e=>{
      e.stopPropagation();
      this.closeModal();
      Snd.click();
    });
    
    $('room-modal').addEventListener('click',e=>{
      if(e.target===$('room-modal')){this.closeModal();Snd.click();}
    });
  },
  
  openModal(html){
    $('modal-body').innerHTML=html;
    $('room-modal').classList.add('show');
  },
  
  closeModal(){$('room-modal').classList.remove('show');},
  
  handlers:{
    painting(){
      RoomItems.openModal(`
        <div class="modal-title">Golden Sea</div>
        <div style="width:100%;aspect-ratio:16/10;background:linear-gradient(180deg,#1a1830 0%,#2a1820 30%,#c8a040 50%,#d4af37 60%,#e8c060 70%,#a08030 100%);border-radius:8px;margin-bottom:16px;position:relative;overflow:hidden">
          <div style="position:absolute;top:15%;left:60%;width:60px;height:60px;background:radial-gradient(circle,#e8d080,transparent);border-radius:50%;opacity:0.6"></div>
          <div style="position:absolute;bottom:30%;left:0;right:0;height:3px;background:rgba(255,255,255,0.1)"></div>
        </div>
        <div class="modal-meta">"A picture of the Golden Sea." Yeah. Classic photo that my mum got. It's been on the wall since before I can remember. She says it reminds her of somewhere she's never been.</div>
      `);
    },
    
    skateboard(){
      RoomItems.openModal(`
        <div class="modal-title">The Skateboard</div>
        <div style="text-align:center;padding:30px 0">
          <svg width="60" height="200" viewBox="0 0 60 200">
            <rect x="10" y="10" width="40" height="180" rx="20" fill="#2a1a10" stroke="#4a3020" stroke-width="3"/>
            <rect x="14" y="40" width="32" height="50" rx="4" fill="#802845" opacity="0.7"/>
            <rect x="14" y="100" width="32" height="40" rx="4" fill="#4a8040" opacity="0.6"/>
            <circle cx="22" cy="6" r="6" fill="#555"/><circle cx="38" cy="6" r="6" fill="#555"/>
            <circle cx="22" cy="194" r="6" fill="#555"/><circle cx="38" cy="194" r="6" fill="#555"/>
          </svg>
        </div>
        <div class="modal-meta">"Wonder when I'll get my lazy self to actually skateboard today..."<br><br>It's been on the wall for three months. The grip tape is still clean. That tells you everything you need to know.</div>
      `);
    },
    
    keys(){
      RoomItems.openModal(`
        <div class="modal-title">Motorbike Keys</div>
        <div style="text-align:center;padding:20px 0">
          <svg width="80" height="100" viewBox="0 0 80 100">
            <circle cx="40" cy="25" r="14" fill="none" stroke="#888" stroke-width="3"/>
            <rect x="32" y="38" width="6" height="35" rx="2" fill="#aaa" transform="rotate(-8 35 55)"/>
            <rect x="42" y="38" width="5" height="28" rx="2" fill="#999" transform="rotate(10 44 52)"/>
            <rect x="28" y="35" width="20" height="12" rx="5" fill="#333" stroke="#555" stroke-width="1"/>
            <circle cx="38" cy="41" r="3" fill="#ff3030" opacity="0.6"/>
          </svg>
        </div>
        <div class="modal-meta">The keys to freedom. A 125cc that sounds like an angry lawnmower but feels like a spaceship. She doesn't know about the bike yet. Saving that for later.</div>
      `);
    },
    
    'phone-desk'(){Phone.toggle();},
    
    tv(){
      const channels=[
        {name:'NHK NEWS 9',content:'BREAKING: Local cat found sleeping on keyboard — sends 47 emails to CEO. The cat, named "Mittens," accidentally approved a $2.3 million budget for the snack room.'},
        {name:'COOKING CH',content:'"Tonight we\'re making... hold on... squints at notes ...I can\'t read my own handwriting. It says either \'beef stew\' or \'beef shoe.\' We\'re going with stew."'},
        {name:'STATIC',content:'3 AM and nothing\'s on. Story of your life.'}
      ];
      const ch=channels[Math.floor(Math.random()*channels.length)];
      RoomItems.openModal(`
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
          <div class="modal-title" style="margin:0">📺 TV</div>
          <div style="background:#cc2200;color:#fff;font-family:var(--font-crt);font-size:11px;padding:4px 10px;border-radius:3px">${ch.name}</div>
        </div>
        <div style="background:#0a0a0a;padding:20px;border-radius:8px;border:2px solid #333;font-family:var(--font-serif);color:#ccc;line-height:1.6">
          ${ch.content}
        </div>
        <div class="modal-meta">You watch too much TV. She'd say that if she were here.</div>
      `);
    },
    
    controller(){
      RoomItems.openModal(`
        <div class="modal-title">🎮 Reaction Test</div>
        <div style="font-family:var(--font-hand);color:var(--dim);margin-bottom:16px">How fast are your reflexes? Click the green circle when it appears.</div>
        <div id="game-arena" style="width:100%;height:180px;background:#0a0a0a;border-radius:12px;border:2px solid #222;display:flex;align-items:center;justify-content:center;cursor:pointer;position:relative;overflow:hidden">
          <div id="game-target" style="width:60px;height:60px;border-radius:50%;background:#aa3333;transition:all 0.2s;display:flex;align-items:center;justify-content:center;color:#fff;font-family:var(--font-crt);font-size:12px">WAIT</div>
        </div>
        <div id="game-result" style="text-align:center;margin-top:14px;font-family:var(--font-serif);color:var(--earth-pale);min-height:2em"></div>
      `);
      setTimeout(()=>{
        const arena=$('game-arena'),target=$('game-target'),result=$('game-result');
        if(!arena)return;
        let active=false,startTime=0;
        const nextRound=()=>{
          target.style.background='#aa3333';
          target.textContent='WAIT';
          result.textContent='';
          active=false;
          setTimeout(()=>{
            target.style.background='#33aa33';
            target.textContent='TAP!';
            active=true;
            startTime=Date.now();
          },1000+Math.random()*2000);
        };
        arena.addEventListener('click',()=>{
          if(active){
            const elapsed=Date.now()-startTime;
            result.innerHTML=`<span style="color:var(--trust)">${elapsed}ms!</span>`;
            Snd.match();
            active=false;
            setTimeout(nextRound,1000);
          }else{
            result.innerHTML='<span style="color:#aa4444">Too early!</span>';
            Snd.wrong();
          }
        });
        nextRound();
      },100);
    },
    
    newspaper(){
      const pages=[
        {lang:'日本語',title:'日本経済新聞',headline:'東京の猫カフェ、過去最高の来客数を記録',caption:'You can\'t read this. But you kept the paper anyway.'},
        {lang:'English',title:'THE DAILY OBSERVER',headline:'LOCAL MAN DISCOVERS HE HAS FEELINGS, REFUSES TO ACT ON THEM',caption:'This one cuts a little close to home.'},
        {lang:'中文',title:'晨報日刊',headline:'秋天的最后一片叶子终于落下',caption:'Something about leaves knowing when to let go.'}
      ];
      let page=0;
      const render=()=>{
        const p=pages[page];
        $('modal-body').innerHTML=`
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
            <div class="modal-title" style="margin:0">📰 ${p.title}</div>
            <span style="font-family:var(--font-crt);color:var(--dim);font-size:12px">${p.lang}</span>
          </div>
          <div style="background:#d8d0b8;color:#1a1a1a;padding:24px;border-radius:8px;font-family:serif">
            <h2 style="font-size:clamp(1rem,2.5vw,1.3rem);line-height:1.4;margin-bottom:14px;font-family:'DM Serif Display',serif">${p.headline}</h2>
            <p style="font-size:0.9rem;line-height:1.8;color:#2a2a2a">[Article text continues... The newspaper doesn't know your life.]</p>
          </div>
          <div class="modal-meta">${p.caption}</div>
          <div style="display:flex;justify-content:center;gap:12px;margin-top:20px">
            <button id="np-prev" style="background:var(--earth);color:#fff;border:none;padding:8px 18px;border-radius:6px;cursor:pointer;font-family:var(--font-crt)">◀ PREV</button>
            <span style="color:var(--dim);font-family:var(--font-crt);padding:8px">${page+1}/3</span>
            <button id="np-next" style="background:var(--earth);color:#fff;border:none;padding:8px 18px;border-radius:6px;cursor:pointer;font-family:var(--font-crt)">NEXT ▶</button>
          </div>
        `;
        $('np-prev').onclick=()=>{page=(page-1+3)%3;render();Snd.flip();};
        $('np-next').onclick=()=>{page=(page+1)%3;render();Snd.flip();};
      };
      render();
    },
    
    salad(){
      RoomItems.openModal(`
        <div class="modal-title">🥗 Salad on the Bed</div>
        <div style="text-align:center;padding:20px;font-size:4rem">🥗</div>
        <div class="modal-meta">Yes, there's literally a salad on the bed. Don't ask why. It's been there since lunch. You'll eat it eventually. Maybe.</div>
      `);
    },
    
    window(){
      RoomItems.openModal(`
        <div class="modal-title">🌙 The Window</div>
        <div style="width:100%;aspect-ratio:4/3;background:linear-gradient(180deg,#0a1020,#050810);border-radius:8px;position:relative;overflow:hidden;margin-bottom:16px">
          <div style="position:absolute;top:20%;left:30%;width:40px;height:40px;background:#e8e4d8;border-radius:50%;opacity:0.3;filter:blur(2px)"></div>
          <div style="position:absolute;top:40%;left:20%;width:2px;height:2px;background:#fff;opacity:0.8"></div>
          <div style="position:absolute;top:30%;left:70%;width:2px;height:2px;background:#fff;opacity:0.6"></div>
        </div>
        <div class="modal-meta">2:47 AM. You should be asleep. Instead you're looking at the moon and thinking about her.</div>
      `);
    }
  }
};

/* ═══════════════════════════════════════════════════════════════════
   SHEEPY — Narrator character
   ═══════════════════════════════════════════════════════════════════ */
const Sheepy = {
  mouths:{nervous:'M-6 6 Q-4 3 0 5 Q4 7 6 5',happy:'M-7 4 Q0 14 7 4',sad:'M-7 8 Q0 2 7 8',thoughtful:'M-5 5 Q0 8 5 5'},
  svg(sz,mood='nervous',hold=false){
    const m=this.mouths[mood]||this.mouths.nervous;
    return`<svg width="${sz}" height="${sz}" viewBox="0 0 120 120" style="animation:bounce 5s infinite"><ellipse cx="60" cy="78" rx="38" ry="30" fill="#e4dcd0"/><ellipse cx="36" cy="70" rx="14" ry="12" fill="#faf8f5"/><ellipse cx="84" cy="70" rx="14" ry="12" fill="#faf8f5"/><ellipse cx="60" cy="32" rx="22" ry="18" fill="#ffeef2"/><ellipse cx="30" cy="22" rx="8" ry="6" fill="#d0c4b8" transform="rotate(-20 30 22)"/><ellipse cx="90" cy="22" rx="8" ry="6" fill="#d0c4b8" transform="rotate(20 90 22)"/><ellipse cx="48" cy="30" rx="5" ry="6" fill="#1a1a1a"><animate attributeName="ry" values="6;6;1;6;6" keyTimes="0;.4;.5;.6;1" dur="5s" repeatCount="indefinite"/></ellipse><ellipse cx="72" cy="30" rx="5" ry="6" fill="#1a1a1a"><animate attributeName="ry" values="6;6;1;6;6" keyTimes="0;.4;.5;.6;1" dur="5s" repeatCount="indefinite"/></ellipse><circle cx="49" cy="28" r="2" fill="#fff"/><circle cx="73" cy="28" r="2" fill="#fff"/><ellipse cx="60" cy="44" rx="4" ry="3" fill="#b8a098"/><g transform="translate(60 52)"><path d="${m}" stroke="#a89088" stroke-width="2.5" fill="none" stroke-linecap="round"/></g>${hold?'<g transform="translate(78 52)"><rect width="24" height="18" rx="3" fill="#fff8e8" stroke="#705020"/><circle cx="12" cy="9" r="4" fill="#705020"/></g>':''}</svg>`;
  },
  show(mood,hold=false){$('sglow').innerHTML=this.svg(130,mood,hold)},
  async say(text){
    const spd=SPEEDS[textSpeed];
    const el=$('stxt');el.innerHTML='';
    for(let i=0;i<text.length;i++){
      if(text[i]==='<'){const j=text.indexOf('>',i);el.innerHTML+=text.substring(i,j+1);i=j}
      else{el.innerHTML+=text[i];Snd.type();await sleep(spd)}
    }
    await sleep(500);
  }
};

/* Speed controls */
document.querySelectorAll('.speed-btn').forEach(btn=>{
  btn.addEventListener('click',()=>{
    document.querySelectorAll('.speed-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    textSpeed=btn.dataset.speed;
    Snd.click();
  });
});

/* ═══════════════════════════════════════════════════════════════════
   ★ UI — FIXED CONTINUE SYSTEM (Critical for mobile)
   ═══════════════════════════════════════════════════════════════════ */
const UI = {
  scene:$('scene'), choices:$('choices'), match:$('match'),
  prompt:$('continue-prompt'), overlay:$('continue-overlay'),
  _resolver:null, _active:false,
  
  clear(){
    this.scene.innerHTML='';
    this.choices.innerHTML='';this.choices.classList.remove('show');
    this.match.style.display='none';
    this._hidePrompt();
  },
  
  p(html){
    const el=document.createElement('p');el.innerHTML=html;
    this.scene.appendChild(el);return el;
  },
  
  async show(el,dur=1000){
    el.classList.add('show');
    await sleep(dur);
  },
  
  _showPrompt(){
    this.prompt.classList.add('show');
    this.overlay.classList.add('show');
    this._active=true;
    Snd.continueReady();
  },
  
  _hidePrompt(){
    this.prompt.classList.remove('show');
    this.overlay.classList.remove('show');
    this._active=false;
  },
  
  waitClick(){
    return new Promise(resolve=>{
      setTimeout(()=>{
        this._resolver=resolve;
        this._showPrompt();
      },250);
    });
  },
  
  _handleTap(){
    if(!this._active||!this._resolver)return;
    const fn=this._resolver;
    this._resolver=null;
    this._hidePrompt();
    Snd.click();
    fn();
  }
};

/* ★ CRITICAL: Multiple input methods for continue (fixes mobile + Tab key) */
['click','touchend'].forEach(evt=>{
  $('continue-overlay').addEventListener(evt,e=>{
    e.preventDefault();e.stopPropagation();UI._handleTap();
  },{passive:false});
  $('continue-prompt').addEventListener(evt,e=>{
    e.preventDefault();e.stopPropagation();UI._handleTap();
  },{passive:false});
});

// Fallback document click (skips interactive elements)
document.addEventListener('click',e=>{
  if(e.target.closest('.choice, .match-card, .speed-btn, .audio-btn, .room-item, .modal-close, .phone-toggle'))return;
  UI._handleTap();
});

// Keyboard support — Enter, Space, AND Tab (all mapped to continue)
document.addEventListener('keydown',e=>{
  if(e.key==='Enter'||e.key===' '||e.key==='Tab'){
    e.preventDefault();
    UI._handleTap();
  }
});

/* ═══════════════════════════════════════════════════════════════════
   VFX
   ═══════════════════════════════════════════════════════════════════ */
const VFX = {
  glitch(){$('noise-layer').style.opacity='0.15';setTimeout(()=>$('noise-layer').style.opacity='0.04',200);Snd.glitch();},
  emotional(){Snd.emotional();},
  flash(){document.body.style.background='#1a0a0a';setTimeout(()=>document.body.style.background='',100);}
};

const updateCounter=(c,t)=>$('counter').textContent=`${c}/${t}`;

/* ═══════════════════════════════════════════════════════════════════
   CHOICES
   ═══════════════════════════════════════════════════════════════════ */
function choose(decId,opts){
  return new Promise(resolve=>{
    UI.choices.innerHTML='';
    const dec=DEC_DEF[decId];
    for(const opt of opts){
      const btn=document.createElement('button');btn.className='choice';
      btn.innerHTML=`<span class="choice-text">${opt.text}</span>`;
      if(opt.preview)btn.innerHTML+=`<span style="display:block;font-size:0.7rem;color:var(--dim);margin-top:8px;font-family:var(--font-hand)">${opt.preview}</span>`;
      btn.addEventListener('mouseenter',()=>Snd.hover());
      btn.onclick=()=>{
        Snd.select();
        document.querySelectorAll('.choice').forEach(b=>b.disabled=true);
        btn.classList.add('selected');
        const def=dec?.o?.find(o=>o.id===opt.id);
        if(def){
          const r=State.apply(def.fx);State.choices[decId]=opt.id;State.updateHUD();
          const td=r.filter(x=>x.type==='stat'&&x.stat==='trust').reduce((s,x)=>s+x.delta,0);
          const gd=r.filter(x=>x.type==='stat'&&x.stat==='guard').reduce((s,x)=>s+x.delta,0);
          let fx='';
          if(td>0)fx+=`Trust +${td}  `;if(gd>0)fx+=`Guard +${gd}`;
          if(fx)btn.innerHTML+=`<span style="display:block;font-size:0.7rem;color:var(--earth-pale);font-family:var(--font-crt);margin-top:8px">${fx.trim()}</span>`;
        }
        if(opt.emotional)VFX.emotional();
        setTimeout(()=>resolve(opt.id),1800);
      };
      UI.choices.appendChild(btn);
    }
    UI.choices.classList.add('show');
  });
}

/* ═══════════════════════════════════════════════════════════════════
   MEMORY MATCH
   ═══════════════════════════════════════════════════════════════════ */
const PAIRS=[
  {id:1,a:'snap add',b:'finger slip',story:'She\'ll call it an accident for months.'},
  {id:2,a:'"i\'m sigma"',b:'zero apology',story:'She walked in like she owned the place.'},
  {id:3,a:'princess tycoon',b:'two hours gone',story:'Seventeen turrets. She laughed at your shoebox.'},
  {id:4,a:'the scratch',b:'three seconds',story:'You held her hand for three seconds.'},
  {id:5,a:'tiktok videos',b:'always behind',story:'Her videos pile up. You never catch up.'},
  {id:6,a:'3:08 AM snap',b:'streak preserved',story:'The streak matters more than sleep.'},
  {id:7,a:'"he\'s annoying"',b:'jaw set',story:'Your body reacted before your brain.'},
  {id:8,a:'"whatever"',b:'screen saved',story:'You saved what you denied feeling.'}
];
const shuffle=a=>{for(let i=a.length-1;i>0;i--){const j=Math.random()*(i+1)|0;[a[i],a[j]]=[a[j],a[i]]}return a};

async function memoryMatch(){
  UI.clear();
  $('match').style.display='block';
  $('match').classList.add('show');
  $('match').innerHTML=`<div class="match-header"><div class="match-title">MEMORY MATCH</div><div style="font-family:var(--font-hand);color:var(--earth-pale);opacity:0.65">Each pair reveals something buried</div></div><div style="display:flex;justify-content:center;gap:40px;margin:24px 0"><div style="display:flex;flex-direction:column;align-items:center;gap:8px"><span style="font-size:11px;font-family:var(--font-crt);color:var(--dim);letter-spacing:2px">PAIRS</span><span style="font-size:22px;font-family:var(--font-crt);color:var(--gold)" id="pc">0/8</span></div></div><div class="match-grid" id="mgrid"></div><div id="mstory" style="margin-top:32px;text-align:center;min-height:80px;font-family:var(--font-serif);font-size:1.1rem;color:var(--gold-light);font-style:italic;line-height:2.2;opacity:0;transform:translateY(15px);transition:all 0.8s"></div>`;
  
  const cards=[];PAIRS.forEach(p=>{cards.push({pid:p.id,text:p.a});cards.push({pid:p.id,text:p.b})});
  shuffle(cards);
  const grid=$('mgrid'),story=$('mstory');
  let flipped=[],matched=0,lock=false;
  
  cards.forEach(c=>{
    const card=document.createElement('div');card.className='match-card';
    card.innerHTML=`<div class="card-inner">${c.text}</div>`;
    card.onclick=()=>{
      if(lock||card.classList.contains('flipped')||card.classList.contains('matched'))return;
      Snd.flip();card.classList.add('flipped');flipped.push({card,pid:c.pid});
      if(flipped.length===2){
        lock=true;
        if(flipped[0].pid===flipped[1].pid){
          Snd.match();matched++;
          const p=PAIRS.find(x=>x.id===flipped[0].pid);
          if(p){story.textContent=p.story;story.style.opacity=1;story.style.transform='translateY(0)';}
          $('pc').textContent=`${matched}/8`;
          setTimeout(()=>{
            flipped.forEach(f=>f.card.classList.add('matched'));
            flipped=[];lock=false;
            if(matched>=8)setTimeout(()=>{VFX.emotional();Snd.complete()},700);
          },500);
        }else{
          Snd.wrong();
          setTimeout(()=>{
            flipped.forEach(f=>f.card.classList.remove('flipped'));
            flipped=[];lock=false;
          },900);
        }
      }
    };
    grid.appendChild(card);
  });
  return new Promise(r=>{const iv=setInterval(()=>{if(matched>=8){clearInterval(iv);setTimeout(r,1800)}},200)});
}

/* ═══════════════════════════════════════════════════════════════════
   BOOT SEQUENCE
   ═══════════════════════════════════════════════════════════════════ */
async function typeBootLine(el,text,spd=22){
  for(let i=0;i<text.length;i++){el.textContent+=text[i];await sleep(spd)}
  el.textContent+='\n';
}

async function boot(){
  const bt=$('boot-text');
  await sleep(1400);
  await typeBootLine(bt,'> SEED ARCHIVE v3.0',18);await sleep(450);
  await typeBootLine(bt,'> LOADING SIDE A: SOIL...',20);await sleep(400);
  await typeBootLine(bt,'> 8 DECISIONS DETECTED',16);await sleep(350);
  await typeBootLine(bt,'> EMOTIONAL PAYLOAD: ARMED',18);await sleep(400);
  await typeBootLine(bt,'> SHEEPY PROTOCOL: ACTIVE',16);await sleep(350);
  Snd.ensure();Snd.powerOn();
  await typeBootLine(bt,'> READY.',28);
  const cur=document.createElement('span');cur.className='boot-cursor';bt.appendChild(cur);
  await sleep(1800);
  $('loading-overlay').classList.add('hidden');
  await sleep(3000);
  story();
}

/* ═══════════════════════════════════════════════════════════════════
   ★ MAIN STORY — Complete Interactive Experience
   ═══════════════════════════════════════════════════════════════════ */
async function story(){
  VHS.init();
  $('bedroom-scene').classList.add('active');
  $('hud').classList.add('show');
  $('sheepy-controls').classList.add('show');
  State.updateHUD();
  RoomItems.init();
  
  const T=22;let idx=0,p;

  // ═══ ACT 1: THE SNAPCHAT ADD ═══
  idx++;updateCounter(idx,T);VFX.flash();
  
  $('sheepy').classList.add('show');
  Sheepy.show('nervous',true);
  await Sheepy.say('<span class="hand">baa.</span> Before this starts...');
  await sleep(700);
  await Sheepy.say('I need you to understand:');
  await sleep(400);
  await Sheepy.say('he almost didn\'t add her back.');
  await sleep(600);
  await Sheepy.say('<span class="whisper">That\'s the whole story.</span>');
  await sleep(900);
  $('sheepy').classList.add('hide');await sleep(800);$('sheepy').classList.remove('show','hide');

  UI.clear();

  p=UI.p('<span class="time">2:47 PM. Tuesday. Doing nothing important.</span>');
  await UI.show(p);await sleep(600);

  p=UI.p('<span class="narrator">Your phone buzzes. <span class="snapchat">Snapchat</span> notification.</span>');
  await UI.show(p);await sleep(500);

  p=UI.p('<span class="narrator">Someone added you by username.</span>');
  await UI.show(p);await sleep(500);

  Phone.setTime('2:47 PM');
  Phone.setMessages([{her:true,text:'omg wait wrong person'}]);
  Snd.phoneNotify();Phone.show();await sleep(1400);

  p=UI.p('<span style="color:var(--pink-light);font-family:var(--font-mono)">minji_added_you</span>');
  await UI.show(p);await sleep(500);

  Phone.hide();await sleep(400);

  p=UI.p('<span class="narrator">A finger slip. That\'s what she\'ll say.</span>');
  await UI.show(p);await sleep(600);

  p=UI.p('<span class="memory">You will think about this moment for months. The ordinary Tuesday that split your life in two.</span>');
  await UI.show(p,1200);
  await UI.waitClick();

  const c1=await choose('d_tape1_reply_speed',[
    {text:'Add back instantly. Send something sarcastic.',id:'reply_immediately',preview:'Curiosity dressed as humor',emotional:true},
    {text:'Wait three hours. Add back casually.',id:'wait_hours',preview:'Protection over connection'},
    {text:'Stare at the notification. Thumb hovering.',id:'stare_screen',preview:'Feeling before acting'}
  ]);

  // ═══ ACT 2: FIRST CONTACT ═══
  idx++;updateCounter(idx,T);Snd.whoosh();UI.clear();

  if(c1==='reply_immediately'){
    Phone.setTime('2:48 PM');
    Phone.setMessages([{her:true,text:'omg wait wrong person'},{me:true,text:'lol who were u adding'}]);
    Phone.show();Snd.phoneNotify();await sleep(1400);Phone.hide();await sleep(400);
    p=UI.p('<span class="narrator">Forty-seven seconds. That\'s how fast you added back a stranger.</span>');await UI.show(p);await sleep(600);
    p=UI.p('<span class="me">Later you\'ll tell yourself it was boredom. You weren\'t bored. You were curious.</span>');await UI.show(p);await sleep(500);
    p=UI.p('<span class="me">There is a canyon between those two things.</span>');await UI.show(p);await sleep(600);
    p=UI.p('<span class="memory">Curiosity is just hope trying to look casual.</span>');await UI.show(p,1200);
  }else if(c1==='wait_hours'){
    p=UI.p('<span class="narrator">Three hours. You open the app four times. Close it twice.</span>');await UI.show(p);await sleep(600);
    Phone.setTime('5:52 PM');
    Phone.setMessages([{her:true,text:'omg wait wrong person'},{me:true,text:'happens to the best of us'}]);
    Phone.show();Snd.phoneNotify();await sleep(1300);Phone.hide();await sleep(400);
    p=UI.p('<span class="narrator">Six words. Eleven minutes of editing. She\'ll never know.</span>');await UI.show(p);await sleep(600);
    p=UI.p('<span class="memory">The distance between what you feel and what you show could fill an ocean.</span>');await UI.show(p,1200);
  }else{
    p=UI.p('<span class="narrator">Your thumb hovers. Screen dims. Lock. Unlock. Lock.</span>');await UI.show(p);await sleep(600);
    Phone.setTime('3:12 PM');
    Phone.setMessages([{her:true,text:'omg wait wrong person'},{her:true,text:'hello?? u there lol'}]);
    Phone.show();Snd.phoneNotify();await sleep(1300);Phone.hide();await sleep(400);
    p=UI.p('<span class="me">She snapped again. She didn\'t have to. The universe chose for you.</span>');await UI.show(p);await sleep(600);
    p=UI.p('<span class="memory">Sometimes freezing is the most honest thing you can do. It means something already matters.</span>');await UI.show(p,1200);
  }
  await UI.waitClick();

  // ═══ ACT 3: PLATFORMS ═══
  idx++;updateCounter(idx,T);Snd.whoosh();UI.clear();

  p=UI.p('<span class="narrator">Weeks pass. The conversation spreads across apps.</span>');
  await UI.show(p);await sleep(600);

  p=UI.p('<span class="narrator">Each platform a different version of the same story.</span>');
  await UI.show(p);await sleep(600);

  await UI.waitClick();

  const c2=await choose('d_tape1_platform',[
    {text:'TikTok. She found your personal. Videos pile up.',id:'tiktok',preview:'Endless content exchange'},
    {text:'Discord. Old servers. Quiet observation.',id:'discord',preview:'Watched from the margins'},
    {text:'Snapchat. Daily driver. Everything happens here.',id:'snapchat',preview:'The main thread',emotional:true}
  ]);

  idx++;updateCounter(idx,T);Snd.whoosh();UI.clear();

  if(c2==='tiktok'){
    p=UI.p('<span class="narrator">She found your personal account somehow. Started following.</span>');await UI.show(p);await sleep(500);
    p=UI.p('<span class="narrator">Her videos pile up in your notifications. You\'re always behind schedule.</span>');await UI.show(p);await sleep(600);
    p=UI.p('<span class="me">Every time you got busy, you\'d slowly progress toward thinking about her.</span>');await UI.show(p);await sleep(600);
    p=UI.p('<span class="memory">Content is just intimacy with plausible deniability.</span>');await UI.show(p,1200);
  }else if(c2==='discord'){
    p=UI.p('<span class="narrator">You had servers together. A reminder of who you were before.</span>');await UI.show(p);await sleep(500);
    p=UI.p('<span class="narrator">You didn\'t open up much. Didn\'t care about anyone or anything.</span>');await UI.show(p);await sleep(600);
    p=UI.p('<span class="me">The servers became museums of a person you used to be.</span>');await UI.show(p);await sleep(600);
    p=UI.p('<span class="memory">Distance is safe. Distance doesn\'t ask anything of you.</span>');await UI.show(p,1200);
  }else{
    p=UI.p('<span class="narrator">The daily driver. Everything important happened here.</span>');await UI.show(p);await sleep(500);
    p=UI.p('<span class="narrator">Day-to-day conversations. The streak becoming sacred.</span>');await UI.show(p);await sleep(600);
    p=UI.p('<span class="me">Snapchat was where the real story lived. Everything else was just noise.</span>');await UI.show(p);await sleep(600);
    p=UI.p('<span class="memory">Disappearing messages make everything feel more permanent.</span>');await UI.show(p,1200);
  }
  await UI.waitClick();

  // ═══ ACT 4: SIGMA ═══
  idx++;updateCounter(idx,T);Snd.whoosh();UI.clear();

  p=UI.p('<span class="her">"I\'m sigma."</span>');await UI.show(p,1100);await sleep(600);

  p=UI.p('<span class="narrator">She says this mid-bite of something. Doesn\'t even look up.</span>');await UI.show(p);await sleep(600);

  p=UI.p('<span class="narrator">Most people enter your life apologizing for the space they take.</span>');await UI.show(p);await sleep(500);

  p=UI.p('<span class="narrator">She walks in like she designed the floor plan.</span>');await UI.show(p);await sleep(700);

  p=UI.p('<span class="me">Your mouth does something you don\'t authorize.</span>');await UI.show(p);
  await UI.waitClick();

  const c3=await choose('d_tape1_sigma_reaction',[
    {text:'"That\'s the most unhinged thing anyone has said to me."',id:'call_annoying',preview:'Push back'},
    {text:'Say nothing. You\'re fighting your own face.',id:'say_nothing_smile',preview:'Let her in',emotional:true},
    {text:'"Explain. Use small words."',id:'ask_meaning',preview:'Curiosity wins'}
  ]);

  idx++;updateCounter(idx,T);Snd.whoosh();UI.clear();

  if(c3==='call_annoying'){
    p=UI.p('<span class="narrator">She laughs. Not politely. Full volume.</span>');await UI.show(p);await sleep(600);
    p=UI.p('<span class="her">"Good. Annoyed means you\'re paying attention."</span>');await UI.show(p);await sleep(600);
    p=UI.p('<span class="me">She\'s right. Which annoys you more.</span>');await UI.show(p);await sleep(600);
    p=UI.p('<span class="memory">She tests you by being impossible. You respect impossible.</span>');await UI.show(p,1200);
  }else if(c3==='say_nothing_smile'){
    VFX.emotional();
    p=UI.p('<span class="narrator">Your mouth curves. You kill it immediately. Too late.</span>');await UI.show(p);await sleep(600);
    p=UI.p('<span class="her">"Caught you."</span>');await UI.show(p,700);await sleep(700);
    p=UI.p('<span class="narrator">Two words. With the confidence of someone watching you closer than you realized.</span>');await UI.show(p);await sleep(600);
    p=UI.p('<span class="memory">The first crack in your wall was a smile you couldn\'t suppress.</span>');await UI.show(p,1200);
  }else{
    p=UI.p('<span class="her">"Means I don\'t need anyone to tell me I\'m worth something. I already know."</span>');await UI.show(p);await sleep(600);
    p=UI.p('<span class="narrator">No arrogance. Like stating that water is wet.</span>');await UI.show(p);await sleep(600);
    p=UI.p('<span class="me">You\'ve never met someone this certain. It terrifies you. It makes you want to stay.</span>');await UI.show(p);await sleep(600);
    p=UI.p('<span class="memory">Understanding someone is the first form of intimacy.</span>');await UI.show(p,1200);
  }
  await UI.waitClick();

  // ═══ ACT 5: PRINCESS TYCOON ═══
  idx++;updateCounter(idx,T);Snd.whoosh();UI.clear();

  p=UI.p('<span class="her">"play princess tycoon with me"</span>');await UI.show(p,900);await sleep(600);

  p=UI.p('<span class="narrator">Princess. Tycoon. Roblox. Dead serious.</span>');await UI.show(p);await sleep(600);

  p=UI.p('<span class="me">You should say no. Every cool part of you says no.</span>');await UI.show(p);
  await UI.waitClick();

  const c4=await choose('d_tape1_princess_tycoon',[
    {text:'Play. Complain the whole time. Best night of your month.',id:'play_complain',preview:'Show up completely',emotional:true},
    {text:'Refuse. Watch her play. Run commentary.',id:'refuse_watch',preview:'Dignity intact'},
    {text:'"Only if you promise to lose." Make it personal.',id:'make_challenge',preview:'Engage on your terms'}
  ]);

  idx++;updateCounter(idx,T);Snd.whoosh();UI.clear();

  if(c4==='play_complain'){
    p=UI.p('<span class="narrator">Two hours. Your castle: depressed shoebox.</span>');await UI.show(p);await sleep(500);
    p=UI.p('<span class="narrator">Hers: seventeen turrets. A moat.</span>');await UI.show(p);await sleep(600);
    p=UI.p('<span class="me">Worst game you\'ve ever played. You\'ll play again tomorrow.</span>');await UI.show(p);await sleep(600);
    p=UI.p('<span class="memory">Time can\'t be faked. You spent two hours on turrets for someone you didn\'t expect.</span>');await UI.show(p,1200);
  }else if(c4==='refuse_watch'){
    p=UI.p('<span class="me">"Your turret placement is objectively wrong."</span>');await UI.show(p);await sleep(500);
    p=UI.p('<span class="her">"Your FACE is objectively wrong."</span>');await UI.show(p);await sleep(600);
    p=UI.p('<span class="narrator">Your commentary makes her laugh harder than the game.</span>');await UI.show(p);await sleep(600);
    p=UI.p('<span class="memory">Distance is just another way of being present.</span>');await UI.show(p,1200);
  }else{
    VFX.emotional();
    p=UI.p('<span class="her">"deal"</span>');await UI.show(p,600);await sleep(500);
    p=UI.p('<span class="narrator">She wins by a margin suggesting she\'s played since birth.</span>');await UI.show(p);await sleep(600);
    p=UI.p('<span class="her">"didn\'t promise to TRY to lose"</span>');await UI.show(p);await sleep(600);
    p=UI.p('<span class="memory">Losing to someone and smiling is your body surrendering.</span>');await UI.show(p,1200);
  }
  await UI.waitClick();

  // ═══ ACT 6: MEMORY MATCH ═══
  idx++;updateCounter(idx,T);
  $('sheepy').classList.add('show');Sheepy.show('thoughtful');
  await Sheepy.say('Pause.');await sleep(450);
  await Sheepy.say('Before we go further...');await sleep(450);
  await Sheepy.say('Prove you remember what matters.');
  await sleep(700);
  $('sheepy').classList.add('hide');await sleep(800);$('sheepy').classList.remove('show','hide');
  await memoryMatch();

  idx++;updateCounter(idx,T);UI.clear();
  $('sheepy').classList.add('show');Sheepy.show('happy');
  await Sheepy.say('Good. You remember more than you let on.');await sleep(550);
  await Sheepy.say('<span class="hand">Now the hard part.</span>');
  await sleep(700);
  $('sheepy').classList.add('hide');await sleep(800);$('sheepy').classList.remove('show','hide');
  await UI.waitClick();

  // ═══ ACT 7: THE SCRATCH ═══
  idx++;updateCounter(idx,T);Snd.whoosh();UI.clear();

  p=UI.p('<span class="narrator">Weeks blur. You stop counting days since she added you.</span>');await UI.show(p);await sleep(600);
  p=UI.p('<span class="narrator">Then: a scratch on her hand. Small. Most wouldn\'t notice.</span>');await UI.show(p);await sleep(600);
  p=UI.p('<span class="me">You notice before she does.</span>');await UI.show(p);
  await UI.waitClick();

  const c5=await choose('d_tape1_scratch',[
    {text:'"Show me." Take her hand.',id:'take_hand',preview:'Cross the line',emotional:true},
    {text:'"Be more careful." Look away.',id:'look_away',preview:'Protect the wall'},
    {text:'Say nothing. Add to the catalog.',id:'file_away',preview:'Silent devotion'}
  ]);

  idx++;updateCounter(idx,T);Snd.whoosh();UI.clear();

  if(c5==='take_hand'){
    VFX.emotional();
    p=UI.p('<span class="narrator">You take her hand. Turn it over.</span>');await UI.show(p);await sleep(600);
    p=UI.p('<span class="narrator">Three seconds. Examining a wound that doesn\'t exist.</span>');await UI.show(p);await sleep(700);
    p=UI.p('<span class="narrator">She doesn\'t pull away. She doesn\'t breathe.</span>');await UI.show(p);await sleep(700);
    p=UI.p('<span class="memory">The first touch is never dramatic. It\'s disguised as concern.</span>');await UI.show(p,1200);
  }else if(c5==='look_away'){
    p=UI.p('<span class="me">"Be more careful." Like you say that to everyone.</span>');await UI.show(p);await sleep(600);
    p=UI.p('<span class="narrator">You don\'t. She knows.</span>');await UI.show(p);await sleep(600);
    p=UI.p('<span class="memory">Caring silently hurts differently. You chose your pain.</span>');await UI.show(p,1200);
  }else{
    p=UI.p('<span class="narrator">You file it away. Her scratches. Her laugh. How she tucks hair behind her left ear.</span>');await UI.show(p);await sleep(600);
    p=UI.p('<span class="me">Building a cathedral of observations she doesn\'t know exists.</span>');await UI.show(p);await sleep(600);
    p=UI.p('<span class="memory">Observation is devotion\'s quietest dialect.</span>');await UI.show(p,1200);
  }
  await UI.waitClick();

  // ═══ ACT 8: 3 AM ═══
  idx++;updateCounter(idx,T);Snd.whoosh();UI.clear();

  p=UI.p('<span class="time">11:47 PM → 1:23 AM → 3:08 AM</span>');await UI.show(p);await sleep(700);

  Phone.setTime('3:08 AM');
  Phone.setMessages([{her:true,text:"can't sleep"},{her:true,text:'talk to me'}]);
  Phone.show();Snd.phoneNotify();await sleep(1400);

  p=UI.p('<span class="narrator">The snaps get later. You never initiate. But your phone is always in hand.</span>');
  await UI.show(p);await sleep(600);Phone.hide();await sleep(400);

  p=UI.p('<span class="me">Four words. The most honest sentence she\'s ever sent.</span>');await UI.show(p);await sleep(500);
  p=UI.p('<span class="me">At 3 AM nobody has the energy to lie.</span>');await UI.show(p);
  await UI.waitClick();

  const c6=await choose('d_tape1_late_night',[
    {text:'Send a voice note. Your real voice at 3 AM.',id:'voice_note',preview:'The middle path',emotional:true},
    {text:'Text back safe. Stay in your lane.',id:'text_back_safe',preview:'Keep distance'},
    {text:'Stay up talking until sunrise. Sleep is optional.',id:'stay_up_talking',preview:'All in'}
  ]);

  idx++;updateCounter(idx,T);Snd.whoosh();UI.clear();

  if(c6==='voice_note'){
    p=UI.p('<span class="narrator">Your voice at 3 AM. Unguarded. The version that only exists with lights off.</span>');await UI.show(p);await sleep(600);
    p=UI.p('<span class="me">"I\'m here. What\'s on your mind?"</span>');await UI.show(p);await sleep(500);
    p=UI.p('<span class="narrator">She sends one back. Five minutes long. You\'ll never tell anyone what she said.</span>');await UI.show(p);await sleep(600);
    p=UI.p('<span class="memory">A voice at 3 AM is a letter that can\'t be screenshotted.</span>');await UI.show(p,1200);
  }else if(c6==='text_back_safe'){
    Phone.setTime('3:10 AM');
    Phone.setMessages([{her:true,text:"can't sleep"},{her:true,text:'talk to me'},{me:true,text:"what's keeping you up"}]);
    Phone.show();Snd.phoneNotify();await sleep(1200);Phone.hide();
    p=UI.p('<span class="narrator">You want to say so much. Type and delete six things.</span>');await UI.show(p);await sleep(600);
    p=UI.p('<span class="me">Send a meme. Safety has a price tag.</span>');await UI.show(p);await sleep(600);
    p=UI.p('<span class="memory">The distance between what you typed and sent could fill a novel.</span>');await UI.show(p,1200);
  }else{
    VFX.emotional();
    p=UI.p('<span class="narrator">You stay up. Snap after snap until the screen catches the first light.</span>');await UI.show(p);await sleep(600);
    p=UI.p('<span class="me">Neither of you mentions how tired you\'ll be. Some things matter more than sleep.</span>');await UI.show(p);await sleep(600);
    p=UI.p('<span class="memory">Shared exhaustion is intimacy by another name.</span>');await UI.show(p,1200);
  }
  await UI.waitClick();

  // ═══ ACT 9: JEALOUSY ═══
  idx++;updateCounter(idx,T);Snd.whoosh();UI.clear();

  p=UI.p('<span class="her">"this guy keeps trying to talk to me lol so annoying"</span>');await UI.show(p);await sleep(700);

  p=UI.p('<span class="me">Your jaw sets. Something tightens in your chest.</span>');await UI.show(p);await sleep(500);
  p=UI.p('<span class="me">You didn\'t authorize this reaction.</span>');await UI.show(p);await sleep(600);

  p=UI.p('<span class="memory">Jealousy is your subconscious filing a police report: something valuable at risk.</span>');await UI.show(p,1200);
  await UI.waitClick();

  const c7=await choose('d_tape1_jealousy',[
    {text:'"Tell him you\'re busy." Let silence talk.',id:'tell_her_busy',preview:'Territorial'},
    {text:'"Annoying like me, or actually annoying?"',id:'annoying_how',preview:'Seek your place',emotional:true},
    {text:'Change subject. Pretend blood pressure normal.',id:'change_subject',preview:'Deny everything'}
  ]);

  idx++;updateCounter(idx,T);Snd.whoosh();UI.clear();

  if(c7==='tell_her_busy'){
    VFX.glitch();
    p=UI.p('<span class="me">"Tell him you\'re busy."</span>');await UI.show(p);await sleep(600);
    p=UI.p('<span class="narrator">Four words. She hears the fifth: <em>with me.</em></span>');await UI.show(p);await sleep(700);
    p=UI.p('<span class="narrator">She doesn\'t mention him again.</span>');await UI.show(p);await sleep(600);
    p=UI.p('<span class="memory">You didn\'t ask her to choose. Just made sure she knew you were an option.</span>');await UI.show(p,1200);
  }else if(c7==='annoying_how'){
    VFX.emotional();
    p=UI.p('<span class="narrator">She laughs. Stops. Something rearranges in her face.</span>');await UI.show(p);await sleep(600);
    p=UI.p('<span class="her">"you\'re not annoying. you\'re... different."</span>');await UI.show(p);await sleep(700);
    p=UI.p('<span class="me">You screenshot. Hate yourself. Keep it anyway.</span>');await UI.show(p);await sleep(600);
    p=UI.p('<span class="memory">"Different" means: everyone else in one category. Then you.</span>');await UI.show(p,1200);
  }else{
    p=UI.p('<span class="me">"anyway did you see that meme"</span>');await UI.show(p);await sleep(600);
    p=UI.p('<span class="narrator">Subject changed. Heart rate: not changed.</span>');await UI.show(p);await sleep(600);
    p=UI.p('<span class="me">She sees through it. Always does.</span>');await UI.show(p);await sleep(600);
    p=UI.p('<span class="memory">The mask fits perfectly. That\'s the problem.</span>');await UI.show(p,1200);
  }
  await UI.waitClick();

  // ═══ ACT 10: REALIZATION ═══
  idx++;updateCounter(idx,T);Snd.whoosh();UI.clear();

  p=UI.p('<span class="narrator">It doesn\'t happen all at once. No movie moment.</span>');await UI.show(p);await sleep(700);
  p=UI.p('<span class="narrator">Just that one day you realize you\'ve been checking <span class="snapchat">Snapchat</span> every four minutes.</span>');await UI.show(p);await sleep(600);
  p=UI.p('<span class="narrator">For weeks.</span>');await UI.show(p);await sleep(800);

  p=UI.p('<span class="narrator">And the thought of her not snapping back—</span>');await UI.show(p);await sleep(900);

  p=UI.p('<span style="color:var(--pink-glow);font-weight:500;font-size:1.15em;text-shadow:0 0 40px rgba(255,80,128,0.6);letter-spacing:2px">Unthinkable.</span>');await UI.show(p,1400);VFX.emotional();await sleep(900);

  p=UI.p('<span class="memory">The seed is already in the ground. Nobody asked permission. It just grew.</span>');await UI.show(p,1200);
  await UI.waitClick();

  const c8=await choose('d_tape1_realization',[
    {text:'Pull back. Protect your walls.',id:'pull_back',preview:'Fear wins'},
    {text:'Lean in. Let it happen.',id:'lean_in',preview:'Courage',emotional:true},
    {text:'Watch. Wait. See what grows.',id:'watch_grow',preview:'Patience'}
  ]);

  // ═══ ACT 11: SOIL ═══
  idx++;updateCounter(idx,T);Snd.whoosh();UI.clear();

  $('sheepy').classList.add('show');Sheepy.show('thoughtful');
  await Sheepy.say('A seed doesn\'t choose where it falls.');await sleep(700);
  await Sheepy.say('But the soil chooses whether to hold it.');await sleep(700);
  await Sheepy.say('<span class="hand">What kind of soil are you?</span>');await sleep(900);
  $('sheepy').classList.add('hide');await sleep(800);$('sheepy').classList.remove('show','hide');

  const soil=await choose('d_tape1_soil_choice',[
    {text:'Rich soil. "I want this. I\'ll water it myself."',id:'rich_soil',preview:'All in',emotional:true},
    {text:'Rocky soil. "I\'m afraid. But I won\'t stop it."',id:'rocky_soil',preview:'Guarded but open'},
    {text:'Frozen ground. "Not ready. Not yet."',id:'barren_soil',preview:'The seed waits'}
  ]);

  idx++;updateCounter(idx,T);Snd.whoosh();UI.clear();

  if(State.has('e_soil_rich')){
    VFX.emotional();
    p=UI.p('<span class="me">The soil is warm. Soft enough to hold something fragile.</span>');await UI.show(p);await sleep(700);
    p=UI.p('<span class="me">You sink in. Not all the way. But enough to mean it.</span>');await UI.show(p);await sleep(700);
    p=UI.p('<span class="narrator" style="color:var(--trust)">The seed found good ground.</span>');await UI.show(p,1200);await sleep(700);
    p=UI.p('<span class="memory">Rich soil doesn\'t promise growth. Just says: whatever you become, I\'m here.</span>');await UI.show(p,1300);
  }else if(State.has('e_soil_rocky')){
    p=UI.p('<span class="me">Cold. Hard. But between stones, gaps.</span>');await UI.show(p);await sleep(700);
    p=UI.p('<span class="me">Roots might find spaces. Harder. But nothing easy survives winter.</span>');await UI.show(p);await sleep(700);
    p=UI.p('<span class="narrator" style="color:var(--earth-pale)">The seed will work harder. Might grow stronger.</span>');await UI.show(p,1200);await sleep(700);
    p=UI.p('<span class="memory">Flowers through rock are the ones no one can pick.</span>');await UI.show(p,1300);
  }else{
    p=UI.p('<span class="me">Frozen. Nothing moves. But there\'s a crack. There\'s always a crack.</span>');await UI.show(p);await sleep(700);
    p=UI.p('<span class="narrator" style="color:var(--dim)">Dormancy isn\'t death. Seeds wait years.</span>');await UI.show(p,1200);await sleep(700);
    p=UI.p('<span class="memory">The patient seed outlasts the impatient gardener.</span>');await UI.show(p,1300);
  }
  await UI.waitClick();

  // ═══ END ═══
  idx++;updateCounter(idx,T);Snd.whoosh();UI.clear();

  $('sheepy').classList.add('show');Sheepy.show('happy');
  await Sheepy.say('SIDE A is done.');await sleep(600);
  await Sheepy.say('The seed is in the ground now.');await sleep(600);
  await Sheepy.say('What happens next depends on the weather.');await sleep(600);
  await Sheepy.say('<span class="hand">And the weather is always changing.</span>');await sleep(900);

  State.save();Snd.complete();VFX.emotional();await sleep(2500);
  UI.clear();
  p=UI.p('<span class="narrator" style="text-align:center;font-size:1.25em;color:var(--earth-glow)">END OF SIDE A — EJECTING...</span>');
  await UI.show(p,1200);await sleep(3500);
  window.location.href='index.html';
}

/* ═══════════════════════════════════════════════════════════════════
   INIT
   ═══════════════════════════════════════════════════════════════════ */
$('audio-btn').addEventListener('click',()=>Snd.toggle());
document.addEventListener('contextmenu',e=>e.preventDefault());
boot();
</script>
</body>
</html>
