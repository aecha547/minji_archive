<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SIDE B: RAIN</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=VT323&family=Cormorant+Garamond:ital,wght@0,600;1,600&display=swap');
body{background:#000;color:#a8e6a3;font-family:'VT323';height:100vh;overflow:hidden;margin:0;display:flex;justify-content:center;align-items:center}
.tv{width:95%;max-width:800px;height:90%;border:2px solid #333;background:#111;position:relative;border-radius:20px;padding:20px;display:flex;flex-direction:column}
.screen{flex:1;background:#050505;border:1px solid #222;border-radius:10px;position:relative;overflow-y:auto;padding:20px;box-shadow:inset 0 0 50px rgba(0,0,0,0.8)}
.text-area{font-size:1.2rem;line-height:1.5;margin-bottom:20px;color:#a8e6a3}
.sheepy{color:#fff;font-size:4rem;text-align:center;margin:20px 0}
.btn{background:transparent;border:1px solid #555;color:#aaa;padding:10px;width:100%;text-align:left;font-family:inherit;font-size:1.1rem;cursor:pointer;margin-top:5px}
.btn:hover{border-color:#a8e6a3;color:#a8e6a3}

/* Simon Game */
.simon-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;max-width:300px;margin:0 auto;display:none}
.s-btn{height:80px;border-radius:10px;opacity:0.3;cursor:pointer;border:2px solid transparent}
.s-btn.active{opacity:1;transform:scale(0.95)}
#b1{background:#ff9ec6} #b2{background:#a8e6a3} #b3{background:#5588bb} #b4{background:#d4af37}
.back-btn{position:absolute;top:10px;right:10px;color:#555;text-decoration:none;z-index:100}
</style>
</head>
<body>
<a href="index.html" class="back-btn">‚èè EJECT</a>
<audio id="bgm" autoplay loop><source src="RAIN.mp3" type="audio/mpeg"></audio>

<div class="tv">
  <div class="screen">
    <div class="text-area" id="txt"></div>
    <div class="sheepy" id="sheepy">üêë</div>
    <div id="opts"></div>
    <div class="simon-grid" id="simon">
      <div class="s-btn" id="b1" onclick="input(1)"></div>
      <div class="s-btn" id="b2" onclick="input(2)"></div>
      <div class="s-btn" id="b3" onclick="input(3)"></div>
      <div class="s-btn" id="b4" onclick="input(4)"></div>
    </div>
  </div>
</div>

<script>
const story = [
  {t: "Some people come into your life for a season.<br>But you... you felt like climate change."},
  {t: "You get jealous easily. You claim you don't.<br>I see it. I see the 2AM texts from parties you hate."},
  {t: "Sheepy says: 'Listen to the pattern. Not the words.'<br>Repeat after Sheepy to sync our frequencies."}
];

const sequence = [];
let playerSeq = [];
let level = 0;
const txt = document.getElementById('txt');
const opts = document.getElementById('opts');
const simon = document.getElementById('simon');

function render(idx){
  if(idx < 2){
    txt.innerHTML = story[idx].t;
    opts.innerHTML = `<button class="btn" onclick="render(${idx+1})">Next</button>`;
  } else if(idx === 2){
    txt.innerHTML = story[2].t;
    opts.innerHTML = `<button class="btn" onclick="startSimon()">Start Sync</button>`;
  } else {
    finish();
  }
}

function startSimon(){
  opts.innerHTML = "";
  simon.style.display = 'grid';
  nextLevel();
}

function nextLevel(){
  level++;
  playerSeq = [];
  sequence.push(Math.floor(Math.random()*4)+1);
  txt.innerHTML = `Level ${level}/3: Watch...`;
  playSeq(0);
}

function playSeq(i){
  if(i >= sequence.length){
    txt.innerHTML = "Your turn.";
    return;
  }
  const id = sequence[i];
  const el = document.getElementById('b'+id);
  el.classList.add('active');
  setTimeout(() => {
    el.classList.remove('active');
    setTimeout(() => playSeq(i+1), 300);
  }, 500);
}

function input(id){
  const el = document.getElementById('b'+id);
  el.classList.add('active');
  setTimeout(() => el.classList.remove('active'), 200);
  playerSeq.push(id);
  
  if(playerSeq[playerSeq.length-1] !== sequence[playerSeq.length-1]){
    txt.innerHTML = "Signal Lost. Retrying...";
    playerSeq = [];
    setTimeout(() => playSeq(0), 1000);
    return;
  }
  
  if(playerSeq.length === sequence.length){
    if(level === 3) setTimeout(finish, 500);
    else setTimeout(nextLevel, 1000);
  }
}

function finish(){
  simon.style.display = 'none';
  document.getElementById('sheepy').innerText = "üíñ";
  txt.innerHTML = "Frequency Synced.<br><br>The rain isn't cold anymore. It's just watering the seeds.";
  opts.innerHTML = `<button class="btn" onclick="save()">SAVE & EJECT</button>`;
}

function save(){
  let s = JSON.parse(localStorage.getItem('seed_progress') || '{}');
  s.tape2 = true;
  localStorage.setItem('seed_progress', JSON.stringify(s));
  window.location.href = 'index.html';
}

render(0);
</script>
</body>
</html>
