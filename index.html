<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>THE SEED OF MANY ENDINGS</title>
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Cdefs%3E%3CradialGradient id='sg' cx='50%25' cy='50%25'%3E%3Cstop offset='0%25' stop-color='%23a8e6a3' stop-opacity='.8'/%3E%3Cstop offset='100%25' stop-color='%23558b2f' stop-opacity='.4'/%3E%3C/radialGradient%3E%3C/defs%3E%3Crect width='32' height='32' fill='%23050505'/%3E%3Cellipse cx='16' cy='18' rx='6' ry='9' fill='url(%23sg)' transform='rotate(-10 16 18)'/%3E%3Cellipse cx='16' cy='11' rx='3' ry='2' fill='%23c8e6c9' transform='rotate(-10 16 11)'/%3E%3Cpath d='M12 6 Q16 2 20 6' stroke='%2381c784' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E">
<style>
@import url('https://fonts.googleapis.com/css2?family=VT323&family=Caveat:wght@400;600;700&family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&display=swap');
:root{
--bg:#030303;--pink:#ff6b9d;--pink-dim:#993d5e;--pink-bright:#ffb3cc;
--gold:#d4af37;--green:#a8e6a3;--warm:#ffeedd;--red:#cc4444;--blue:#5588bb;
--cyan:#00d4aa;--dim:#555;--white:#d4d4d4;--earth:#8B7355;
--font-crt:'VT323',monospace;--font-hand:'Caveat',cursive;
--font-serif:'Cormorant Garamond',serif}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;user-select:none}
html,body{height:100%;overflow:hidden;background:#050505;font-family:var(--font-crt);color:var(--pink)}

/* ═══════════════════════════════════════════════════════════════════
   VHS BACKGROUND LAYER
   ═══════════════════════════════════════════════════════════════════ */
#vhs-bg{position:fixed;inset:0;z-index:0;pointer-events:none;overflow:hidden}
#vhs-bg canvas{position:absolute;inset:0;width:100%;height:100%}
.vhs-particle{position:absolute;border-radius:50%;pointer-events:none;will-change:transform,opacity}
.vhs-particle.rain{width:2px;height:15px;border-radius:1px;background:linear-gradient(180deg,transparent,rgba(85,136,187,.3),transparent)}
.vhs-particle.dust{background:radial-gradient(circle,rgba(255,107,157,.15),transparent)}
.vhs-particle.spark{width:3px;height:3px;background:var(--pink);box-shadow:0 0 6px var(--pink)}
.touch-ripple{position:fixed;border-radius:50%;pointer-events:none;z-index:9999;border:2px solid var(--pink);animation:touchRipple .8s ease-out forwards;opacity:0}
@keyframes touchRipple{0%{transform:scale(0);opacity:.8}100%{transform:scale(4);opacity:0}}
.glitch-flash{position:fixed;inset:0;z-index:9998;pointer-events:none;opacity:0;background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(255,107,157,.1) 2px,rgba(255,107,157,.1) 4px);animation:glitchFlash .15s ease-out}
@keyframes glitchFlash{0%{opacity:.4}100%{opacity:0}}

/* ═══════════════════════════════════════════════════════════════════
   BACKGROUND SCENE ANIMATIONS - The Living TV
   ═══════════════════════════════════════════════════════════════════ */
#bg-scenes{position:absolute;inset:0;z-index:21;pointer-events:none;opacity:0;transition:opacity 2s ease}
#bg-scenes.active{opacity:.15}
.bg-scene{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity 3s ease}
.bg-scene.active{opacity:1}
.bg-scene svg{width:60%;height:60%;max-width:280px;max-height:200px}

/* Scene-specific styles */
.scene-ballet .dancer{transform-origin:center;animation:pirouette 8s ease-in-out infinite}
@keyframes pirouette{0%,100%{transform:rotate(0deg)}50%{transform:rotate(360deg)}}
.scene-ballet .arm-left{transform-origin:70% 90%;animation:armGrace 4s ease-in-out infinite}
.scene-ballet .arm-right{transform-origin:30% 90%;animation:armGrace 4s ease-in-out infinite reverse}
@keyframes armGrace{0%,100%{transform:rotate(-15deg)}50%{transform:rotate(15deg)}}
.scene-ballet .leg{transform-origin:50% 0%;animation:legExtend 4s ease-in-out infinite}
@keyframes legExtend{0%,100%{transform:rotate(0deg)}50%{transform:rotate(-30deg)}}
.scene-ballet .skirt{transform-origin:center top;animation:skirtFlow 2s ease-in-out infinite}
@keyframes skirtFlow{0%,100%{transform:scaleX(1)}50%{transform:scaleX(1.15)}}

.scene-journey .walker{animation:walk 3s ease-in-out infinite}
@keyframes walk{0%,100%{transform:translateY(0)}25%{transform:translateY(-3px)}75%{transform:translateY(-3px)}}
.scene-journey .cloud{animation:cloudDrift 20s linear infinite}
.scene-journey .cloud:nth-child(2){animation-duration:25s;animation-delay:-5s}
.scene-journey .cloud:nth-child(3){animation-duration:30s;animation-delay:-10s}
@keyframes cloudDrift{from{transform:translateX(100px)}to{transform:translateX(-100px)}}
.scene-journey .sun{animation:sunPulse 6s ease-in-out infinite}
@keyframes sunPulse{0%,100%{opacity:.6;transform:scale(1)}50%{opacity:.9;transform:scale(1.1)}}
.scene-journey .path-line{stroke-dasharray:200;stroke-dashoffset:200;animation:drawPath 8s ease-in-out infinite}
@keyframes drawPath{0%{stroke-dashoffset:200}50%{stroke-dashoffset:0}100%{stroke-dashoffset:-200}}

.scene-bird .bird-body{animation:birdFly 6s ease-in-out infinite}
@keyframes birdFly{0%,100%{transform:translate(0,0)}25%{transform:translate(20px,-15px)}50%{transform:translate(40px,0)}75%{transform:translate(20px,10px)}}
.scene-bird .wing{transform-origin:center;animation:wingFlap .3s ease-in-out infinite}
@keyframes wingFlap{0%,100%{transform:rotate(-20deg)}50%{transform:rotate(20deg)}}
.scene-bird .feather{animation:featherFall 4s ease-in-out infinite}
.scene-bird .feather:nth-child(2){animation-delay:1s}
.scene-bird .feather:nth-child(3){animation-delay:2s}
@keyframes featherFall{0%{opacity:0;transform:translate(0,0) rotate(0deg)}20%{opacity:.6}100%{opacity:0;transform:translate(30px,60px) rotate(180deg)}}

.scene-seed .stem{transform-origin:bottom;animation:stemGrow 8s ease-in-out infinite}
@keyframes stemGrow{0%,100%{transform:scaleY(.3)}50%{transform:scaleY(1)}}
.scene-seed .leaf{transform-origin:bottom left;animation:leafUnfold 8s ease-in-out infinite}
.scene-seed .leaf:nth-child(2){animation-delay:.5s;transform-origin:bottom right}
.scene-seed .leaf:nth-child(3){animation-delay:1s}
.scene-seed .leaf:nth-child(4){animation-delay:1.5s;transform-origin:bottom right}
@keyframes leafUnfold{0%,100%{transform:rotate(0deg) scale(.5);opacity:.3}50%{transform:rotate(15deg) scale(1);opacity:1}}
.scene-seed .roots{animation:rootGrow 8s ease-in-out infinite}
@keyframes rootGrow{0%,100%{opacity:.2;transform:scaleY(.5)}50%{opacity:.6;transform:scaleY(1)}}
.scene-seed .petal{transform-origin:center bottom;animation:petalBloom 6s ease-in-out infinite}
.scene-seed .petal:nth-child(2){animation-delay:.2s}
.scene-seed .petal:nth-child(3){animation-delay:.4s}
.scene-seed .petal:nth-child(4){animation-delay:.6s}
.scene-seed .petal:nth-child(5){animation-delay:.8s}
@keyframes petalBloom{0%,100%{transform:rotate(0deg) scale(.3);opacity:.3}50%{transform:rotate(var(--rotate,0deg)) scale(1);opacity:1}}

/* ═══════════════════════════════════════════════════════════════════
   BOOT OVERLAY
   ═══════════════════════════════════════════════════════════════════ */
#boot-overlay{position:fixed;inset:0;z-index:9999;background:#000;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;opacity:1;transition:opacity 2s cubic-bezier(.4,0,.2,1)}
#boot-overlay.hidden{opacity:0;pointer-events:none;transition:opacity 2s cubic-bezier(.4,0,.2,1)}
.seed-svg{width:clamp(80px,20vw,120px);height:clamp(80px,20vw,120px);animation:seedPulse 3s ease-in-out infinite;filter:drop-shadow(0 0 20px rgba(168,230,163,.4))}
@keyframes seedPulse{0%,100%{transform:scale(1);filter:drop-shadow(0 0 20px rgba(168,230,163,.4))}50%{transform:scale(1.08);filter:drop-shadow(0 0 35px rgba(168,230,163,.6))}}
#boot-overlay h1{font-family:var(--font-serif);font-size:clamp(1.8rem,5vw,2.8rem);font-weight:600;color:var(--pink);letter-spacing:-1px;text-shadow:0 0 30px var(--pink),0 0 60px var(--pink-dim);animation:titleFlicker 3s infinite;text-align:center;line-height:1.3;margin-top:20px}
#boot-overlay .sub{font-family:var(--font-hand);font-size:clamp(1rem,2.5vw,1.4rem);color:var(--pink-dim);margin-top:8px;opacity:.7}
.boot-prompt{color:#444;font-size:clamp(1rem,2vw,1.2rem);margin-top:clamp(30px,6vh,50px);animation:pulse 2s infinite;letter-spacing:3px}
.boot-sub{color:var(--pink-dim);font-size:.8rem;margin-top:12px;opacity:.4}
@keyframes titleFlicker{0%,18%,22%,25%,53%,56%,100%{opacity:1}20%,24%,55%{opacity:.6;text-shadow:none}}
@keyframes pulse{0%,100%{opacity:.3}50%{opacity:.8}}
@keyframes blink{50%{opacity:0}}
@keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-5px)}}
@keyframes screenShake{0%,100%{transform:translate(0)}10%{transform:translate(-2px,1px)}30%{transform:translate(2px,-1px)}50%{transform:translate(-1px,2px)}70%{transform:translate(1px,-1px)}90%{transform:translate(-1px,0)}}
@keyframes ledBreathe{0%,100%{opacity:.7}50%{opacity:1}}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
@keyframes fadeInSlow{from{opacity:0}to{opacity:1}}
@keyframes loadPulse{0%,100%{filter:brightness(1)}50%{filter:brightness(1.3)}}
@keyframes warmGlow{0%,100%{background:radial-gradient(circle at center,#0a0a0a 0%,#000 70%)}50%{background:radial-gradient(circle at center,#1a0a0a 0%,#000 60%)}}
@keyframes noSignalPulse{0%,100%{opacity:.7;transform:scale(1)}50%{opacity:1;transform:scale(1.02)}}
@keyframes gentleDrift{0%,100%{transform:translateY(0)}50%{transform:translateY(-3px)}}

/* ═══════════════════════════════════════════════════════════════════
   STATION
   ═══════════════════════════════════════════════════════════════════ */
#particles{position:fixed;inset:0;pointer-events:none;z-index:1;overflow:hidden;contain:strict}
.particle{position:absolute;border-radius:50%;pointer-events:none;will-change:transform,opacity}

#station{display:none;grid-template-columns:1fr minmax(200px,280px);grid-template-rows:1fr;gap:12px;width:min(96vw,1100px);height:min(90vh,760px);position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);opacity:0;contain:layout style}
#station.on{display:grid;animation:stationFadeIn 1.5s ease-out forwards}
@keyframes stationFadeIn{from{opacity:0;transform:translate(-50%,-50%) scale(.95)}to{opacity:1;transform:translate(-50%,-50%) scale(1)}}

.tv-unit{grid-column:1;grid-row:1;background:linear-gradient(145deg,#1a1a1a,#0e0e0e);border-radius:20px;border:2px solid #252525;box-shadow:inset 0 0 50px #000,0 12px 50px rgba(0,0,0,.85);display:flex;flex-direction:column;padding:18px;position:relative;z-index:2;animation:tvPulse 4s ease-in-out infinite}
@keyframes tvPulse{0%,100%{box-shadow:inset 0 0 50px #000,0 12px 50px rgba(0,0,0,.85),0 0 0 rgba(255,107,157,0)}50%{box-shadow:inset 0 0 50px #000,0 12px 50px rgba(0,0,0,.85),0 0 20px rgba(255,107,157,.05)}}
.screen-bezel{flex:1;background:#020202;border-radius:12px;position:relative;overflow:hidden;border:2px solid #181818;box-shadow:inset 0 0 50px rgba(0,0,0,.9),0 0 15px rgba(255,107,157,.04);transition:border-color .5s ease,box-shadow .5s ease}
.screen-bezel.shake{animation:screenShake .5s ease-out}
.screen-bezel.flash{border-color:rgba(255,107,157,.3);box-shadow:inset 0 0 50px rgba(0,0,0,.9),0 0 25px rgba(255,107,157,.08)}
canvas#crt{position:absolute;inset:0;width:100%;height:100%;z-index:5;image-rendering:pixelated;image-rendering:crisp-edges}
canvas#fx{position:absolute;inset:0;width:100%;height:100%;z-index:7;opacity:0;transition:opacity 1s cubic-bezier(.4,0,.2,1);pointer-events:none}
canvas#fx.on{opacity:1}
.crt-warmup{position:absolute;inset:0;z-index:19;background:radial-gradient(circle at center,#0a0a0a 0%,#000 60%);transition:opacity 3s cubic-bezier(.25,.46,.45,.94);pointer-events:none;animation:warmGlow 2s ease-in-out}
.crt-warmup.off{opacity:0}
.scanlines{position:absolute;inset:0;pointer-events:none;z-index:30;background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,0,0,.15) 2px,rgba(0,0,0,.15) 4px);opacity:.5}
.vignette{position:absolute;inset:0;pointer-events:none;z-index:31;background:radial-gradient(ellipse at center,transparent 45%,rgba(0,0,0,.8) 100%)}
.glass-glare{position:absolute;inset:0;pointer-events:none;z-index:32;background:linear-gradient(135deg,rgba(255,255,255,.03) 0%,transparent 35%)}
.scan-bar{position:absolute;top:0;left:0;width:100%;height:6px;background:linear-gradient(180deg,transparent,rgba(255,255,255,.06),transparent);opacity:.4;z-index:33;pointer-events:none;animation:scanbar 5s linear infinite}
.tracking-bar{position:absolute;left:0;width:100%;height:4px;background:linear-gradient(180deg,transparent,rgba(255,255,255,.08),transparent);opacity:0;z-index:34;pointer-events:none;transition:opacity .3s}
.tracking-bar.on{opacity:1;animation:trackDrift 3s linear infinite}
@keyframes scanbar{from{top:-4%}to{top:104%}}
@keyframes trackDrift{0%{top:-2%}100%{top:102%}}
.screen-glow{position:absolute;inset:-15px;z-index:-1;border-radius:22px;pointer-events:none;transition:background 2.5s cubic-bezier(.4,0,.2,1)}

/* ═══════════════════════════════════════════════════════════════════
   SCREEN TRANSITIONS
   ═══════════════════════════════════════════════════════════════════ */
#screen{position:absolute;inset:0;z-index:25;display:flex;flex-direction:column;justify-content:center;align-items:center;padding:20px;opacity:1;transition:opacity 1s cubic-bezier(.4,0,.2,1)}
#screen.fade-out{opacity:0;transition:opacity 1s cubic-bezier(.4,0,.2,1)}
#screen.fade-in{animation:screenFadeIn 1s cubic-bezier(.4,0,.2,1) forwards}
@keyframes screenFadeIn{from{opacity:0;filter:blur(3px)}to{opacity:1;filter:blur(0)}}
.channel-id{position:absolute;top:14px;left:16px;font-size:1.6rem;color:var(--pink-dim);opacity:.45;text-shadow:0 0 6px var(--pink-dim);letter-spacing:2px;z-index:35;transition:opacity .4s}
.counter{position:absolute;top:14px;right:16px;font-size:1.1rem;color:rgba(255,255,255,.5);opacity:0;z-index:35;letter-spacing:1px;text-shadow:0 0 4px rgba(255,255,255,.2);transition:opacity .5s}
.counter.on{opacity:1}
.rec-ind{position:absolute;top:14px;right:16px;font-size:1rem;color:var(--red);opacity:0;transition:opacity .4s;z-index:35}
.rec-ind.on{opacity:1;animation:blink 1s infinite}
.screen-msg{font-size:clamp(1rem,2.5vw,1.6rem);color:var(--pink-dim);text-shadow:0 0 10px var(--pink-dim);letter-spacing:3px;text-align:center;animation:fadeInSlow 1.2s ease-out,noSignalPulse 4s ease-in-out 1.2s infinite}

.dlg-box{position:absolute;bottom:16px;left:50%;transform:translateX(-50%);z-index:40;text-align:center;color:var(--pink-bright);font-family:var(--font-serif);font-size:clamp(1rem,2vw,1.25rem);text-shadow:0 0 8px var(--pink);background:rgba(8,3,8,.92);padding:12px 20px;border-radius:4px;border:1px solid rgba(255,107,157,.15);max-width:88%;line-height:1.5;opacity:0;transition:opacity .6s ease;pointer-events:none;backdrop-filter:blur(4px)}
.dlg-box.vis{opacity:1}

.boot-text{width:88%;text-align:left;color:var(--pink);font-size:clamp(12px,1.8vw,15px);line-height:1.9;text-shadow:0 0 6px rgba(255,107,157,.12);white-space:pre-wrap}
.boot-line{opacity:0;animation:fadeIn .5s ease-out forwards}
.boot-text .cursor{display:inline-block;width:7px;height:1.1em;background:var(--pink);vertical-align:text-bottom;margin-left:2px;animation:blink .8s step-end infinite}

/* ═══════════════════════════════════════════════════════════════════
   SHEEPY INTRO
   ═══════════════════════════════════════════════════════════════════ */
.sheepy-intro{display:flex;flex-direction:column;align-items:center;gap:16px;width:100%;animation:fadeIn 1.2s ease-out}
.sheepy-glow{width:clamp(140px,30vw,180px);height:clamp(140px,30vw,180px);background:radial-gradient(circle,rgba(255,182,193,.2) 0%,transparent 70%);border-radius:50%;animation:sheepyGlow 3s ease-in-out infinite;display:flex;align-items:center;justify-content:center;position:relative}
.sheepy-glow::before{content:'';position:absolute;inset:-10px;border-radius:50%;background:radial-gradient(circle,rgba(255,107,157,.1) 0%,transparent 70%);animation:sheepyGlow 3s ease-in-out infinite .5s}
@keyframes sheepyGlow{0%,100%{opacity:.6;transform:scale(1)}50%{opacity:.9;transform:scale(1.05)}}
.intro-line{font-family:var(--font-serif);font-size:clamp(1.1rem,2.2vw,1.4rem);color:var(--pink-bright);text-align:center;min-height:2.5em;display:flex;align-items:center;justify-content:center;transition:opacity .8s ease,transform .8s ease;opacity:0;transform:translateY(6px)}
.intro-line.show{opacity:1;transform:translateY(0);animation:introLineIn .8s ease-out}
.intro-line.hiding{opacity:0;transform:translateY(-4px)}
.intro-line .hand{font-family:var(--font-hand);font-size:1.15em;color:var(--gold)}
@keyframes introLineIn{from{opacity:0;transform:translateY(10px);filter:blur(2px)}to{opacity:1;transform:translateY(0);filter:blur(0)}}

.load-display{text-align:center;width:80%;animation:fadeIn 1s ease-out}
.load-title{font-size:14px;margin-bottom:4px;letter-spacing:.1em}
.load-desc{font-family:var(--font-serif);font-size:12px;color:var(--pink-dim);margin-bottom:12px;font-style:italic;opacity:0;animation:fadeInSlow 1s ease-out .5s forwards}
.load-bar{width:200px;height:6px;border-radius:3px;overflow:hidden;margin:0 auto;border:1px solid var(--pink);background:rgba(255,107,157,.1)}
.load-fill{height:100%;width:0%;transition:width .1s linear;border-radius:2px;animation:loadPulse 1.5s ease-in-out infinite}

.tv-controls{display:flex;align-items:center;justify-content:space-between;padding:8px 14px;margin-top:6px;flex-shrink:0}
.power-section{display:flex;align-items:center;gap:5px}
.led{width:7px;height:7px;border-radius:50%;transition:all .4s;box-shadow:inset 0 0 2px rgba(0,0,0,.6)}
.led.pwr{background:#400}
.led.pwr.on{background:#e44;box-shadow:0 0 5px rgba(238,68,68,.5);animation:ledBreathe 3s ease-in-out infinite}
.led.play{background:#300;margin-left:10px}
.led.play.on{background:#ff6b9d;box-shadow:0 0 5px rgba(255,107,157,.5)}
.ctrl-label{font-size:9px;letter-spacing:.15em;color:#444;text-transform:uppercase;margin-left:3px}

.tape-slot{width:160px;height:26px;background:#040404;border:1.5px solid #2a2a2a;border-radius:3px;cursor:default;box-shadow:inset 0 2px 6px rgba(0,0,0,.8);position:relative;overflow:hidden;transition:all .4s ease;display:flex;align-items:center;justify-content:center}
.slot-label{font-size:9px;letter-spacing:.12em;color:#2a2a2a;transition:color .4s;position:relative;z-index:2}
.tape-slot.active{border-color:var(--pink);box-shadow:inset 0 2px 6px rgba(0,0,0,.8),0 0 10px rgba(255,107,157,.2)}
.tape-slot.active .slot-label{color:var(--pink);animation:pulse 1.5s infinite}
.slot-flap{position:absolute;inset:0;background:linear-gradient(180deg,#1a1a1a,#0e0e0e);transform-origin:top;transition:transform .6s cubic-bezier(.68,-.55,.265,1.55);border-bottom:1px solid #2a2a2a;z-index:1}
.tape-slot.inserting .slot-flap{transform:perspective(80px) rotateX(-95deg)}
.eject-btn{padding:3px 12px;background:linear-gradient(180deg,#222,#161616);border:1.5px solid #333;color:#777;cursor:pointer;font-family:var(--font-crt);font-size:10px;border-radius:3px;letter-spacing:1px;transition:all .2s;box-shadow:0 1px 0 rgba(0,0,0,.4)}
.eject-btn:hover{background:#1a1a1a;color:#bbb;border-color:#444}
.brand-label{font-size:10px;letter-spacing:.25em;color:#222;text-transform:uppercase}

/* ═══════════════════════════════════════════════════════════════════
   TAPE RACK
   ═══════════════════════════════════════════════════════════════════ */
.tape-rack{grid-column:2;grid-row:1;background:linear-gradient(180deg,#101010,#080808);border:2px solid #1f1f1f;border-radius:10px;padding:14px;display:flex;flex-direction:column;gap:12px;overflow-y:auto;box-shadow:inset 0 0 20px #000;scrollbar-width:thin;scrollbar-color:#222 #080808;contain:content}
.rack-header{color:#333;text-align:center;border-bottom:1px solid #1a1a1a;padding-bottom:8px;margin-bottom:2px;letter-spacing:3px;font-size:11px;animation:fadeInSlow .8s ease-out}
.rack-progress{font-size:9px;color:var(--pink-dim);opacity:.6;display:block;margin-top:3px;letter-spacing:1px}

.vhs-tape{min-height:88px;background:linear-gradient(180deg,#1b1b1b,#121212);border-radius:5px;border:1.5px solid #2d2d2d;position:relative;cursor:grab;transition:border-color .3s,opacity .3s,transform .3s ease,box-shadow .3s;display:flex;flex-direction:column;align-items:center;justify-content:center;box-shadow:2px 4px 12px rgba(0,0,0,.5),inset 0 -2px 6px rgba(0,0,0,.25);flex-shrink:0;touch-action:none;opacity:0;animation:tapeSlideIn .6s ease-out forwards}
@keyframes tapeSlideIn{from{opacity:0;transform:translateX(-20px)}to{opacity:1;transform:translateX(0)}}
.vhs-tape:nth-child(2){animation-delay:.1s}
.vhs-tape:nth-child(3){animation-delay:.2s}
.vhs-tape:nth-child(4){animation-delay:.3s}
.vhs-tape:nth-child(5){animation-delay:.4s}
.vhs-tape:nth-child(6){animation-delay:.5s}
.vhs-tape:hover:not(.locked):not(.seq-locked){transform:translateY(-3px) scale(1.02);box-shadow:3px 6px 18px rgba(0,0,0,.6);border-color:#3d3d3d;z-index:5}
.vhs-tape:active{cursor:grabbing;transform:scale(.97)}
.vhs-tape.dragging{opacity:.2!important;transform:scale(.9)}
.vhs-tape.locked,.vhs-tape.seq-locked{opacity:.35!important;cursor:not-allowed}
.vhs-tape.seq-locked{opacity:.5!important}
.vhs-tape.complete::after{content:'✓';position:absolute;top:6px;right:6px;font-size:11px;color:var(--green);text-shadow:0 0 4px var(--green)}

.tape-ghost{position:fixed;z-index:9999;pointer-events:none;width:140px;height:88px;background:linear-gradient(180deg,#1b1b1b,#121212);border:1.5px solid var(--pink);border-radius:5px;box-shadow:0 10px 30px rgba(0,0,0,.8),0 0 15px rgba(255,107,157,.15);transform:rotate(-5deg) scale(1.05);display:flex;flex-direction:column;align-items:center;justify-content:center;transition:transform .2s ease,border-color .2s;will-change:transform,left,top}

.tape-window{position:absolute;top:10px;left:12%;width:76%;height:24px;background:#050505;border-radius:3px;border:1.5px solid #202020;display:flex;align-items:center;justify-content:space-around;padding:0 10px;overflow:hidden;box-shadow:inset 0 0 5px rgba(0,0,0,.6)}
.reel{width:14px;height:14px;border:2px solid #333;border-radius:50%;background:#080808;position:relative;transition:border-color .3s}
.reel::after{content:'';position:absolute;inset:2px;border:1.5px solid #1f1f1f;border-radius:50%;background:#030303}
.vhs-tape:hover:not(.locked):not(.seq-locked) .reel{border-color:#3a3a3a;animation:spin 1.2s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.tape-strip{width:24px;height:1px;background:#1f1f1f}
.tape-label{background:linear-gradient(#e8e0d0,#dcd0bc);color:#1a1a1a;padding:3px 8px;margin-top:28px;width:82%;text-align:center;font-family:var(--font-hand);font-weight:600;font-size:12px;transform:rotate(-.5deg);box-shadow:0 1px 3px rgba(0,0,0,.25);border-radius:2px;line-height:1.2;position:relative;z-index:2}
.tape-status{font-family:var(--font-crt);font-size:8px;color:#777;letter-spacing:.08em;margin-top:1px;display:block}
.tape-color{position:absolute;top:10px;right:6px;width:4px;height:4px;border-radius:50%}
.tape-rating{position:absolute;bottom:6px;left:6px;font-size:7px;color:#444;opacity:.6}

.garden{display:flex;flex-direction:column;align-items:center;gap:20px;animation:fadeIn 3.5s ease-out}
.garden-text{font-family:var(--font-serif);font-size:clamp(1rem,2vw,1.3rem);color:var(--green);text-shadow:0 0 15px rgba(168,230,163,.3);text-align:center;line-height:1.7;animation:gentleDrift 4s ease-in-out infinite}
.garden-sub{font-family:var(--font-hand);font-size:clamp(.9rem,2vw,1.1rem);color:var(--pink-dim);opacity:0;animation:fadeInSlow 2s ease-out 1.5s forwards}

.audio-btn{position:fixed;top:10px;right:10px;z-index:200;background:rgba(0,0,0,.65);border:1px solid #2a2a2a;border-radius:3px;color:#555;font-family:var(--font-crt);font-size:11px;padding:4px 10px;cursor:pointer;transition:all .3s}
.audio-btn:hover,.audio-btn.on{color:var(--pink);border-color:var(--pink)}

.bgm-debug{position:fixed;bottom:4px;left:4px;font-size:9px;color:#333;z-index:999;pointer-events:none;font-family:monospace}

@media(max-width:800px){
#station{grid-template-columns:1fr;grid-template-rows:1fr 120px;width:98vw;height:auto;max-height:none;position:relative;top:auto;left:auto;transform:none;padding:6px;gap:8px;margin:4px auto}
#station.on{animation:stationFadeInMobile 1.5s ease-out forwards}
@keyframes stationFadeInMobile{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}
.tv-unit{min-height:50vh}
.tape-rack{flex-direction:row;overflow-x:auto;padding:10px;gap:8px}
.vhs-tape{min-width:130px;min-height:80px}
.channel-id{font-size:1.2rem}.counter{font-size:.9rem}}
@media(max-width:480px){.intro-line{font-size:clamp(.9rem,3.5vw,1.1rem)}}
</style>
</head>
<body>

<div id="vhs-bg"><canvas id="vhsCanvas"></canvas></div>

<div id="boot-overlay">
<svg class="seed-svg" viewBox="0 0 100 100"><defs><radialGradient id="sg" cx="50%" cy="50%"><stop offset="0%" stop-color="#a8e6a3" stop-opacity="0.6"/><stop offset="100%" stop-color="#558b2f" stop-opacity="0.2"/></radialGradient></defs><ellipse cx="50" cy="50" rx="18" ry="28" fill="url(#sg)" transform="rotate(-20 50 50)"><animate attributeName="ry" values="28;30;28" dur="2s" repeatCount="indefinite"/></ellipse><ellipse cx="50" cy="38" rx="6" ry="3" fill="#c8e6c9" transform="rotate(-20 50 38)"/><path d="M42 22 Q50 10 58 22" stroke="#81c784" stroke-width="2" fill="none" stroke-linecap="round"><animate attributeName="d" values="M42 22 Q50 10 58 22;M42 20 Q50 6 58 20;M42 22 Q50 10 58 22" dur="2s" repeatCount="indefinite"/></path><ellipse cx="50" cy="70" rx="2" ry="1" fill="#a5d6a7" opacity="0.6" transform="rotate(-20 50 70)"/></svg>
<h1>THE SEED OF<br>MANY ENDINGS</h1>
<div class="sub">for Minji</div>
<p class="boot-prompt" id="boot-prompt">[ CLICK TO POWER ON ]</p>
<div class="boot-sub">DELIVERED BY SHEEPY // ARCHIVE v2.0</div>
</div>

<button class="audio-btn" id="audio-btn">♪ OFF</button>
<div id="particles"></div>
<div class="bgm-debug" id="bgm-debug"></div>

<div id="station">
<div class="tv-unit">
<div class="screen-glow" id="screen-glow"></div>
<div class="screen-bezel" id="screen-bezel">
<canvas id="crt"></canvas>
<canvas id="fx"></canvas>
<div class="crt-warmup" id="warmup"></div>

<!-- BACKGROUND SCENES - Living animations behind NO SIGNAL -->
<div id="bg-scenes">
  <!-- SCENE 1: BALLET DANCER -->
  <div class="bg-scene scene-ballet" data-scene="0">
    <svg viewBox="0 0 200 200">
      <defs>
        <filter id="blur-ballet"><feGaussianBlur stdDeviation="0.5"/></filter>
        <linearGradient id="grad-ballet" x1="0%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%" stop-color="#ff6b9d" stop-opacity="0.3"/>
          <stop offset="100%" stop-color="#993d5e" stop-opacity="0.1"/>
        </linearGradient>
      </defs>
      <g class="dancer" filter="url(#blur-ballet)">
        <!-- Head -->
        <circle cx="100" cy="45" r="12" fill="url(#grad-ballet)"/>
        <!-- Hair bun -->
        <ellipse cx="100" cy="38" rx="8" ry="6" fill="url(#grad-ballet)"/>
        <!-- Neck -->
        <rect x="96" y="55" width="8" height="12" fill="url(#grad-ballet)"/>
        <!-- Torso -->
        <path d="M85 67 Q100 65 115 67 L112 100 Q100 105 88 100 Z" fill="url(#grad-ballet)"/>
        <!-- Left arm -->
        <g class="arm-left">
          <path d="M85 70 Q65 60 55 75" stroke="url(#grad-ballet)" stroke-width="6" fill="none" stroke-linecap="round"/>
          <circle cx="55" cy="75" r="4" fill="url(#grad-ballet)"/>
        </g>
        <!-- Right arm (raised gracefully) -->
        <g class="arm-right">
          <path d="M115 70 Q135 50 145 40" stroke="url(#grad-ballet)" stroke-width="6" fill="none" stroke-linecap="round"/>
          <circle cx="145" cy="40" r="4" fill="url(#grad-ballet)"/>
        </g>
        <!-- Tutu/Skirt -->
        <ellipse class="skirt" cx="100" cy="105" rx="35" ry="12" fill="url(#grad-ballet)"/>
        <!-- Left leg (standing) -->
        <path d="M92 105 L88 155" stroke="url(#grad-ballet)" stroke-width="7" stroke-linecap="round"/>
        <ellipse cx="86" cy="160" rx="8" ry="4" fill="url(#grad-ballet)"/>
        <!-- Right leg (extended - arabesque) -->
        <g class="leg">
          <path d="M108 105 Q130 115 150 110" stroke="url(#grad-ballet)" stroke-width="7" fill="none" stroke-linecap="round"/>
          <ellipse cx="155" cy="110" rx="10" ry="4" fill="url(#grad-ballet)"/>
        </g>
      </g>
      <!-- Sparkle effects -->
      <circle cx="55" cy="75" r="1.5" fill="#ffb3cc" opacity="0.5"><animate attributeName="opacity" values="0.5;1;0.5" dur="2s" repeatCount="indefinite"/></circle>
      <circle cx="145" cy="40" r="1.5" fill="#ffb3cc" opacity="0.5"><animate attributeName="opacity" values="0.5;1;0.5" dur="2s" repeatCount="indefinite" begin="0.5s"/></circle>
    </svg>
  </div>

  <!-- SCENE 2: JOURNEY -->
  <div class="bg-scene scene-journey" data-scene="1">
    <svg viewBox="0 0 200 200">
      <defs>
        <linearGradient id="sky-grad" x1="0%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%" stop-color="#1a0a1a" stop-opacity="0.2"/>
          <stop offset="100%" stop-color="#0a0a0a" stop-opacity="0.1"/>
        </linearGradient>
        <linearGradient id="ground-grad" x1="0%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%" stop-color="#8B7355" stop-opacity="0.3"/>
          <stop offset="100%" stop-color="#3d2d1d" stop-opacity="0.1"/>
        </linearGradient>
      </defs>
      <!-- Sky -->
      <rect width="200" height="200" fill="url(#sky-grad)"/>
      <!-- Sun -->
      <circle class="sun" cx="160" cy="40" r="20" fill="#d4af37" opacity="0.6"/>
      <!-- Clouds -->
      <g class="cloud">
        <ellipse cx="30" cy="50" rx="20" ry="8" fill="#ffeedd" opacity="0.15"/>
        <ellipse cx="45" cy="48" rx="15" ry="6" fill="#ffeedd" opacity="0.15"/>
      </g>
      <g class="cloud" style="animation-delay: -8s">
        <ellipse cx="80" cy="35" rx="25" ry="10" fill="#ffeedd" opacity="0.12"/>
        <ellipse cx="100" cy="32" rx="18" ry="7" fill="#ffeedd" opacity="0.12"/>
      </g>
      <g class="cloud" style="animation-delay: -15s">
        <ellipse cx="150" cy="60" rx="22" ry="9" fill="#ffeedd" opacity="0.1"/>
      </g>
      <!-- Ground/path -->
      <path d="M0 160 Q50 150 100 160 Q150 170 200 155 L200 200 L0 200 Z" fill="url(#ground-grad)"/>
      <!-- Path line -->
      <path class="path-line" d="M0 165 Q50 155 100 165 Q150 175 200 160" stroke="#ff6b9d" stroke-width="1" fill="none" opacity="0.3"/>
      <!-- Walker silhouette -->
      <g class="walker">
        <!-- Body -->
        <ellipse cx="100" cy="145" rx="6" ry="3" fill="#ff6b9d" opacity="0.4"/>
        <rect x="97" y="125" width="6" height="20" fill="#ff6b9d" opacity="0.4"/>
        <!-- Head -->
        <circle cx="100" cy="118" r="6" fill="#ff6b9d" opacity="0.4"/>
        <!-- Staff/stick -->
        <line x1="108" y1="125" x2="115" y2="155" stroke="#ff6b9d" stroke-width="1.5" opacity="0.3"/>
        <!-- Legs (walking animation) -->
        <line x1="97" y1="145" x2="93" y2="160" stroke="#ff6b9d" stroke-width="2" opacity="0.4"/>
        <line x1="103" y1="145" x2="107" y2="158" stroke="#ff6b9d" stroke-width="2" opacity="0.4"/>
      </g>
      <!-- Distant mountains -->
      <path d="M0 140 L30 110 L50 130 L80 95 L110 125 L140 100 L170 120 L200 105 L200 140 Z" fill="#1a1a1a" opacity="0.3"/>
    </svg>
  </div>

  <!-- SCENE 3: BIRD IN FLIGHT -->
  <div class="bg-scene scene-bird" data-scene="2">
    <svg viewBox="0 0 200 200">
      <defs>
        <linearGradient id="bird-grad" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" stop-color="#ff6b9d" stop-opacity="0.5"/>
          <stop offset="100%" stop-color="#ffb3cc" stop-opacity="0.2"/>
        </linearGradient>
      </defs>
      <!-- Bird body -->
      <g class="bird-body">
        <!-- Body -->
        <ellipse cx="100" cy="100" rx="20" ry="12" fill="url(#bird-grad)"/>
        <!-- Head -->
        <circle cx="115" cy="95" r="8" fill="url(#bird-grad)"/>
        <!-- Beak -->
        <path d="M123 95 L132 93 L123 91 Z" fill="url(#bird-grad)"/>
        <!-- Eye -->
        <circle cx="117" cy="94" r="2" fill="#0a0a0a" opacity="0.5"/>
        <!-- Tail -->
        <path d="M80 100 L60 95 L65 100 L60 105 Z" fill="url(#bird-grad)"/>
        <!-- Wings -->
        <g class="wing">
          <path d="M90 95 Q70 70 50 80 Q70 90 90 100 Z" fill="url(#bird-grad)"/>
        </g>
        <g class="wing" style="animation-delay: 0.15s">
          <path d="M90 105 Q70 130 50 120 Q70 110 90 100 Z" fill="url(#bird-grad)"/>
        </g>
      </g>
      <!-- Floating feathers -->
      <path class="feather" d="M60 80 Q65 85 60 90" stroke="#ffb3cc" stroke-width="1" fill="none" opacity="0.4"/>
      <path class="feather" d="M140 70 Q145 75 140 80" stroke="#ffb3cc" stroke-width="1" fill="none" opacity="0.4"/>
      <path class="feather" d="M130 120 Q135 125 130 130" stroke="#ffb3cc" stroke-width="1" fill="none" opacity="0.4"/>
      <!-- Wind lines -->
      <line x1="20" y1="60" x2="50" y2="60" stroke="#ffeedd" stroke-width="0.5" opacity="0.1"/>
      <line x1="150" y1="140" x2="180" y2="140" stroke="#ffeedd" stroke-width="0.5" opacity="0.1"/>
    </svg>
  </div>

  <!-- SCENE 4: SEED GROWING -->
  <div class="bg-scene scene-seed" data-scene="3">
    <svg viewBox="0 0 200 200">
      <defs>
        <linearGradient id="stem-grad" x1="0%" y1="100%" x2="0%" y2="0%">
          <stop offset="0%" stop-color="#558b2f" stop-opacity="0.4"/>
          <stop offset="100%" stop-color="#a8e6a3" stop-opacity="0.3"/>
        </linearGradient>
        <radialGradient id="flower-grad" cx="50%" cy="50%">
          <stop offset="0%" stop-color="#ffb3cc" stop-opacity="0.5"/>
          <stop offset="100%" stop-color="#ff6b9d" stop-opacity="0.3"/>
        </radialGradient>
      </defs>
      <!-- Roots -->
      <g class="roots">
        <path d="M100 180 L95 195" stroke="#8B7355" stroke-width="1" opacity="0.3"/>
        <path d="M100 180 L105 195" stroke="#8B7355" stroke-width="1" opacity="0.3"/>
        <path d="M100 180 L90 190" stroke="#8B7355" stroke-width="1" opacity="0.3"/>
        <path d="M100 180 L110 190" stroke="#8B7355" stroke-width="1" opacity="0.3"/>
      </g>
      <!-- Stem -->
      <path class="stem" d="M100 180 L100 100" stroke="url(#stem-grad)" stroke-width="3" fill="none"/>
      <!-- Leaves -->
      <g>
        <path class="leaf" d="M100 140 Q80 130 75 145 Q85 150 100 145 Z" fill="url(#stem-grad)"/>
        <path class="leaf" d="M100 140 Q120 130 125 145 Q115 150 100 145 Z" fill="url(#stem-grad)"/>
        <path class="leaf" d="M100 120 Q85 110 80 120 Q88 128 100 123 Z" fill="url(#stem-grad)"/>
        <path class="leaf" d="M100 120 Q115 110 120 120 Q112 128 100 123 Z" fill="url(#stem-grad)"/>
      </g>
      <!-- Flower -->
      <g transform="translate(100, 90)">
        <ellipse class="petal" cx="0" cy="-12" rx="6" ry="12" fill="url(#flower-grad)" style="--rotate:-30deg"/>
        <ellipse class="petal" cx="10" cy="-6" rx="6" ry="12" fill="url(#flower-grad)" style="--rotate:30deg" transform="rotate(72)"/>
        <ellipse class="petal" cx="6" cy="10" rx="6" ry="12" fill="url(#flower-grad)" style="--rotate:144deg" transform="rotate(144)"/>
        <ellipse class="petal" cx="-6" cy="10" rx="6" ry="12" fill="url(#flower-grad)" style="--rotate:216deg" transform="rotate(216)"/>
        <ellipse class="petal" cx="-10" cy="-6" rx="6" ry="12" fill="url(#flower-grad)" style="--rotate:288deg" transform="rotate(288)"/>
        <!-- Center -->
        <circle cx="0" cy="0" r="5" fill="#d4af37" opacity="0.5"/>
      </g>
      <!-- Seed original -->
      <ellipse cx="100" cy="180" rx="8" ry="4" fill="#8B7355" opacity="0.3"/>
    </svg>
  </div>
</div>

<div class="scanlines"></div>
<div class="vignette"></div>
<div class="glass-glare"></div>
<div class="scan-bar"></div>
<div class="tracking-bar" id="tracking-bar"></div>
<div class="channel-id" id="channel-disp">AV-1</div>
<div class="rec-ind" id="rec-ind">● REC</div>
<div class="counter" id="counter">▶ 00:00</div>
<div id="screen"></div>
<div class="dlg-box" id="dlg"></div>
</div>
<div class="tv-controls">
<div class="power-section">
<div class="led pwr" id="led-pwr"></div><span class="ctrl-label">PWR</span>
<div class="led play" id="led-play"></div><span class="ctrl-label">PLAY</span>
</div>
<div class="tape-slot" id="tape-slot">
<div class="slot-flap" id="slot-flap"></div>
<span class="slot-label" id="slot-label">▶ DRAG HERE</span>
</div>
<button class="eject-btn" id="eject-btn">⏏ EJECT</button>
<span class="brand-label">SHEEPY™</span>
</div>
</div>
<div class="tape-rack" id="tape-rack"><div class="rack-header">ARCHIVE</div></div>
</div>

<script>
'use strict';

const $=id=>document.getElementById(id);
const sleep=ms=>new Promise(r=>setTimeout(r,ms));
const dbg=msg=>{const d=$('bgm-debug');if(d)d.textContent=msg};

/* ═══════════════════════════════════════════════════════════════════
   TOUCH EFFECTS
   ═══════════════════════════════════════════════════════════════════ */
const TouchFX={
  init(){
    document.addEventListener('pointerdown',e=>this.ripple(e),{passive:true});
    document.addEventListener('pointerdown',e=>this.glitch(e),{passive:true});
  },
  ripple(e){
    const r=document.createElement('div');
    r.className='touch-ripple';
    r.style.left=(e.clientX-20)+'px';
    r.style.top=(e.clientY-20)+'px';
    r.style.width=r.style.height='40px';
    document.body.appendChild(r);
    setTimeout(()=>r.remove(),800);
  },
  glitch(e){
    if(e.pointerType==='touch'&&e.isPrimary){
      const g=document.createElement('div');
      g.className='glitch-flash';
      document.body.appendChild(g);
      setTimeout(()=>g.remove(),150);
      if(navigator.vibrate)navigator.vibrate(15);
    }
  }
};

/* ═══════════════════════════════════════════════════════════════════
   VHS BACKGROUND CANVAS
   ═══════════════════════════════════════════════════════════════════ */
const VHS_BG={
  canvas:null,ctx:null,w:0,h:0,particles:[],glitchTimer:0,raf:0,
  init(){
    this.canvas=$('vhsCanvas');
    this.ctx=this.canvas.getContext('2d');
    this.resize();
    window.addEventListener('resize',()=>this.resize());
    this.createParticles();
    this.draw();
  },
  resize(){this.w=this.canvas.width=window.innerWidth;this.h=this.canvas.height=window.innerHeight;},
  createParticles(){
    this.particles=[];
    for(let i=0;i<30;i++)this.particles.push({x:Math.random()*this.w,y:Math.random()*this.h,vx:(Math.random()-.5)*.3,vy:-.2-Math.random()*.4,sz:1+Math.random()*2,opacity:.03+Math.random()*.08,type:'dust'});
    for(let i=0;i<8;i++)this.particles.push({x:Math.random()*this.w,y:Math.random()*this.h,vx:(Math.random()-.5)*2,vy:(Math.random()-.5)*2,sz:2,opacity:.1,type:'spark',life:Math.random()*100});
  },
  draw(){
    const ctx=this.ctx,w=this.w,h=this.w;
    if(!this.w||!this.h){this.raf=requestAnimationFrame(()=>this.draw());return}
    ctx.fillStyle='rgba(5,5,5,.15)';
    ctx.fillRect(0,0,this.w,this.h);
    this.glitchTimer++;
    if(this.glitchTimer%60<5&&Math.random()<.3){
      const y=Math.random()*this.h;
      ctx.fillStyle=`rgba(255,107,157,${.02+Math.random()*.03})`;
      ctx.fillRect(0,y,this.w,2+Math.random()*8);
    }
    for(const p of this.particles){
      p.x+=p.vx;p.y+=p.vy;
      if(p.y<-10)p.y=this.h+10,p.x=Math.random()*this.w;
      if(p.x<-10)p.x=this.w+10;
      if(p.x>this.w+10)p.x=-10;
      if(p.type==='dust'){
        ctx.beginPath();ctx.arc(p.x,p.y,p.sz,0,6.28);
        ctx.fillStyle=`rgba(255,107,157,${p.opacity})`;ctx.fill();
      }else if(p.type==='spark'){
        p.life--;
        if(p.life<=0){p.x=Math.random()*this.w;p.y=Math.random()*this.h;p.life=50+Math.random()*100;}
        ctx.beginPath();ctx.arc(p.x,p.y,p.sz,0,6.28);
        ctx.fillStyle=`rgba(255,255,255,${p.opacity*(p.life/100)})`;ctx.fill();
      }
    }
    if(Math.random()<.02){
      ctx.globalCompositeOperation='screen';
      ctx.fillStyle='rgba(255,0,0,.005)';
      ctx.fillRect(1,0,this.w,this.h);
      ctx.fillStyle='rgba(0,255,255,.005)';
      ctx.fillRect(-1,0,this.w,this.h);
      ctx.globalCompositeOperation='source-over';
    }
    this.raf=requestAnimationFrame(()=>this.draw());
  }
};

/* ═══════════════════════════════════════════════════════════════════
   BACKGROUND SCENES MANAGER - The Living TV
   ═══════════════════════════════════════════════════════════════════ */
const BgScenes={
  container:null,scenes:[],current:0,timer:null,duration:8000,active:false,

  init(){
    this.container=$('bg-scenes');
    this.scenes=Array.from(this.container.querySelectorAll('.bg-scene'));
    this.show(0);
  },

  show(idx){
    this.scenes.forEach((s,i)=>{
      s.classList.toggle('active',i===idx);
    });
    this.current=idx;
  },

  next(){
    const nextIdx=(this.current+1)%this.scenes.length;
    this.show(nextIdx);
  },

  start(){
    if(this.active)return;
    this.active=true;
    this.container.classList.add('active');
    this.timer=setInterval(()=>this.next(),this.duration);
  },

  stop(){
    this.active=false;
    this.container.classList.remove('active');
    if(this.timer)clearInterval(this.timer);
    this.timer=null;
  }
};

/* ═══════════════════════════════════════════════════════════════════
   DOM
   ═══════════════════════════════════════════════════════════════════ */
const D={
  boot:$('boot-overlay'),prompt:$('boot-prompt'),audioBtn:$('audio-btn'),
  particles:$('particles'),station:$('station'),bezel:$('screen-bezel'),
  crt:$('crt'),fx:$('fx'),warmup:$('warmup'),glow:$('screen-glow'),screen:$('screen'),
  channel:$('channel-disp'),rec:$('rec-ind'),counter:$('counter'),
  tracking:$('tracking-bar'),slot:$('tape-slot'),slotLabel:$('slot-label'),
  ledPwr:$('led-pwr'),ledPlay:$('led-play'),dlg:$('dlg'),rack:$('tape-rack'),eject:$('eject-btn')
};

/* ═══════════════════════════════════════════════════════════════════
   STATE
   ═══════════════════════════════════════════════════════════════════ */
const KEY='seed_archive_v3';
const loadState=()=>{try{return JSON.parse(localStorage.getItem(KEY))||{}}catch{return{}}};
const isDone=t=>{const s=loadState();return!!(s[t]&&s[t].complete)};
const countDone=()=>TAPES.filter(t=>isDone(t.id)).length;
const allDone=()=>TAPES.every(t=>isDone(t.id));
const REQS={tape1:[],tape2:['tape1'],tape3:['tape2'],tape4:['tape1','tape2','tape3'],tape5:['tape1','tape2','tape3','tape4']};
const canPlay=id=>(REQS[id]||[]).every(isDone);

const TAPES=[
  {id:'tape1',title:'SIDE A: Soil',color:'#8B7355',glow:'rgba(139,115,85,.07)',file:'tape1.html',rating:'9.2/10',desc:'Where it all began'},
  {id:'tape2',title:'SIDE B: Rain',color:'#5588bb',glow:'rgba(85,136,187,.07)',file:'tape2.html',rating:'9.5/10',desc:'Weathering the storms'},
  {id:'tape3',title:'SIDE C: Thorns',color:'#884466',glow:'rgba(136,68,102,.07)',file:'tape3.html',rating:'9.8/10',desc:'Confronting the walls'},
  {id:'tape4',title:'SIDE D: Bloom',color:'#ff6b9d',glow:'rgba(255,107,157,.07)',file:'tape4.html',rating:'10/10',desc:'The answer'},
  {id:'tape5',title:'???: Seasons',color:'#a8e6a3',glow:'rgba(168,230,163,.07)',file:'tape5.html',locked:true,rating:'???',desc:'The future'}
];

let booted=false,inserting=false,bootDone=false,dlgTimer=0,bgmStarted=false;

/* ═══════════════════════════════════════════════════════════════════
   SCREEN FADE
   ═══════════════════════════════════════════════════════════════════ */
async function fadeToScreen(buildFn){
  D.screen.classList.add('fade-out');
  D.screen.classList.remove('fade-in');
  await sleep(1000);
  D.screen.innerHTML='';
  buildFn();
  D.screen.classList.remove('fade-out');
  D.screen.classList.add('fade-in');
  await sleep(1000);
}

/* ═══════════════════════════════════════════════════════════════════
   AUDIO ENGINE
   ═══════════════════════════════════════════════════════════════════ */
const Snd={
  ctx:null,master:null,clickBuf:null,bgm:null,bgmFadeId:0,bgmFading:false,on:false,
  humOsc:null,humGain:null,bgmReady:false,bgmAudio:null,

  init(){
    if(this.ctx)return;
    this.ctx=new(window.AudioContext||window.webkitAudioContext)();
    this.master=this.ctx.createGain();this.master.gain.value=0;
    this.master.connect(this.ctx.destination);
    const sr=this.ctx.sampleRate,len=sr*.008|0;
    this.clickBuf=this.ctx.createBuffer(1,len,sr);
    const d=this.clickBuf.getChannelData(0);
    for(let i=0;i<len;i++)d[i]=(.5-Math.random())*.15*Math.exp(-i/(len*.15));
  },
  resume(){if(this.ctx?.state==='suspended')this.ctx.resume()},
  vol(v){if(!this.master)return;const t=this.ctx.currentTime;this.master.gain.cancelScheduledValues(t);this.master.gain.setValueAtTime(this.master.gain.value,t);this.master.gain.linearRampToValueAtTime(v,t+.4)},
  note(f,dur,type='triangle',vol=.06){if(!this.ctx)return;const o=this.ctx.createOscillator(),g=this.ctx.createGain(),t=this.ctx.currentTime;o.type=type;o.frequency.value=f;g.gain.setValueAtTime(.001,t);g.gain.linearRampToValueAtTime(vol,t+.01);g.gain.exponentialRampToValueAtTime(.001,t+dur);o.connect(g);g.connect(this.master);o.start();o.stop(t+dur+.05)},
  noise(dur,vol=.06){if(!this.ctx)return;const sz=this.ctx.sampleRate*dur|0,buf=this.ctx.createBuffer(1,sz,this.ctx.sampleRate),d=buf.getChannelData(0);for(let i=0;i<sz;i++)d[i]=Math.random()*2-1;const s=this.ctx.createBufferSource(),g=this.ctx.createGain(),t=this.ctx.currentTime;s.buffer=buf;g.gain.setValueAtTime(vol,t);g.gain.exponentialRampToValueAtTime(.001,t+dur);s.connect(g);g.connect(this.master);s.start()},
  typeClick(){if(!this.ctx||!this.clickBuf)return;const s=this.ctx.createBufferSource();s.buffer=this.clickBuf;s.connect(this.master);s.start()},
  startHum(){if(!this.ctx||this.humOsc)return;this.humOsc=this.ctx.createOscillator();this.humGain=this.ctx.createGain();this.humOsc.type='sine';this.humOsc.frequency.value=60;this.humGain.gain.value=.008;this.humOsc.connect(this.humGain);this.humGain.connect(this.master);this.humOsc.start()},
  stopHum(){if(this.humOsc){this.humOsc.stop();this.humOsc=null;this.humGain=null}},
  sfxPowerOn(){this.noise(.4,.16);this.note(220,.12,'square',.1);setTimeout(()=>this.note(55,.15,'sawtooth',.07),80)},
  sfxClunk(){this.note(70,.15,'square',.12);this.noise(.06,.1);setTimeout(()=>this.note(45,.12,'sawtooth',.08),50)},
  sfxSnap(){this.note(700,.04,'sine',.08);setTimeout(()=>this.note(180,.05,'sine',.05),30)},
  sfxWhoosh(){this.noise(.15,.03);this.note(200,.08,'sine',.02);this.note(400,.06,'sine',.015)},
  sfxMotor(){if(!this.ctx)return;const t=this.ctx.currentTime;const o=this.ctx.createOscillator(),g=this.ctx.createGain();const lfo=this.ctx.createOscillator(),lg=this.ctx.createGain();o.type='sawtooth';o.frequency.value=55;lfo.type='sine';lfo.frequency.value=2.5;lg.gain.value=1.8;lfo.connect(lg);lg.connect(o.frequency);g.gain.setValueAtTime(.03,t);g.gain.linearRampToValueAtTime(0,t+1.2);o.connect(g);g.connect(this.master);o.start();lfo.start();o.stop(t+1.3);lfo.stop(t+1.3)},
  sfxHover(){this.note(800,.025,'sine',.018)},
  sfxReady(){this.note(440,.15,'sine',.04);setTimeout(()=>this.note(550,.15,'sine',.04),120);setTimeout(()=>this.note(660,.2,'sine',.04),240)},
  sfxGlitch(){this.noise(.08,.05);this.note(150+Math.random()*100,.06,'sawtooth',.03)},
  sfxTape(id){if(id==='tape1'){this.note(55,.7,'sine',.07);this.note(82,.6,'triangle',.04);this.noise(.35,.035)}else if(id==='tape2'){for(let i=0;i<7;i++)setTimeout(()=>this.note(600+Math.random()*900,.05,'sine',.03),i*65)}else if(id==='tape3'){this.note(110,.9,'sawtooth',.055);this.note(117,.9,'square',.035);this.note(55,.7,'square',.04)}else if(id==='tape4'){this.note(262,.55,'sine',.055);setTimeout(()=>this.note(330,.55,'sine',.055),180);setTimeout(()=>this.note(392,.7,'sine',.055),360)}else if(id==='tape5'){for(let i=0;i<5;i++)setTimeout(()=>this.note(220*Math.pow(1.5,i),.9,'sine',.035),i*220)}},

  preloadBGM(){
    if(this.bgmAudio)return;
    dbg('BGM: preloading...');
    const a=new window.Audio();
    a.loop=true;a.volume=0;a.preload='auto';
    const onReady=()=>{a.removeEventListener('canplay',onReady);a.removeEventListener('loadeddata',onReady);this.bgmReady=true;dbg('BGM: ready ✓')};
    a.addEventListener('canplay',onReady,{once:true});
    a.addEventListener('loadeddata',onReady,{once:true});
    a.addEventListener('error',()=>{dbg('BGM: preload error')});
    a.src='MEMORY.mp3';
    this.bgmAudio=a;
  },
  playBGM(){if(!this.bgmAudio||!this.bgmReady){dbg('BGM: not ready');return}if(bgmStarted)return;bgmStarted=true;const a=this.bgmAudio;cancelAnimationFrame(this.bgmFadeId);this.bgmFading=false;dbg('BGM: starting...');try{a.currentTime=8.0}catch(e){dbg('BGM: seek fail')}a.play().then(()=>{dbg('BGM: playing ✓');this.bgm=a;const fade=()=>{if(!this.bgm||this.bgmFading)return;if(this.bgm.volume<.18){this.bgm.volume=Math.min(this.bgm.volume+.0015,.18);this.bgmFadeId=requestAnimationFrame(fade)}else dbg('BGM: full volume')};this.bgmFadeId=requestAnimationFrame(fade)}).catch(()=>{dbg('BGM: play fail')})},
  stopBGM(){if(!this.bgm)return;cancelAnimationFrame(this.bgmFadeId);this.bgmFading=true;const a=this.bgm;this.bgm=null;const fade=()=>{if(a.volume>.005){a.volume=Math.max(a.volume-.003,0);requestAnimationFrame(fade)}else{a.pause();a.currentTime=0;dbg('BGM: stopped')}};requestAnimationFrame(fade)},
  ensure(){this.init();this.resume();if(!this.on){this.on=true;this.vol(.35);this.startHum();D.audioBtn.textContent='♪ ON';D.audioBtn.classList.add('on');this.preloadBGM()}},
  toggle(){this.init();this.resume();this.on=!this.on;this.vol(this.on?.35:0);if(this.on){if(!this.bgm&&this.bgmReady)this.playBGM();this.startHum()}else{this.stopBGM();this.stopHum()}D.audioBtn.textContent=this.on?'♪ ON':'♪ OFF';D.audioBtn.classList.toggle('on',this.on)}
};

/* ═══════════════════════════════════════════════════════════════════
   CRT NOISE
   ═══════════════════════════════════════════════════════════════════ */
const CRT={
  ctx:null,fxCtx:null,w:0,h:0,fxW:0,fxH:0,noiseTex:null,burstTex:null,isBurst:false,rafId:0,resizeTimer:0,
  genTex(density){const c=document.createElement('canvas');c.width=512;c.height=512;const ctx=c.getContext('2d'),img=ctx.createImageData(512,512);const buf=new Uint32Array(img.data.buffer);const dk=0xFF080808,cols=[0xFF2A3028,0xFF282820,0xFF2C2A26,0xFF262830,0xFF302826];for(let i=0;i<buf.length;i++)buf[i]=Math.random()<density?cols[Math.random()*5|0]:dk;ctx.putImageData(img,0,0);return c},
  init(){this.ctx=D.crt.getContext('2d',{alpha:false});this.fxCtx=D.fx.getContext('2d',{alpha:true});this.noiseTex=this.genTex(.08);this.burstTex=this.genTex(.55);this.resize();window.addEventListener('resize',()=>{clearTimeout(this.resizeTimer);this.resizeTimer=setTimeout(()=>this.resize(),150)});this.draw()},
  resize(){const r=D.bezel.getBoundingClientRect();this.w=D.crt.width=Math.min(r.width*.5,400)|0;this.h=D.crt.height=Math.min(r.height*.5,300)|0;this.fxW=D.fx.width=r.width|0;this.fxH=D.fx.height=r.height|0},
  burst(dur=350){this.isBurst=true;setTimeout(()=>this.isBurst=false,dur)},
  draw(){if(this.w&&this.h){const tex=this.isBurst?this.burstTex:this.noiseTex;const ox=Math.random()*(512-this.w)|0,oy=Math.random()*(512-this.h)|0;this.ctx.drawImage(tex,ox,oy,this.w,this.h,0,0,this.w,this.h);if(Math.random()<.03){const y=Math.random()*this.h|0,bh=2+Math.random()*6|0,shift=(Math.random()-.5)*20|0;this.ctx.drawImage(D.crt,0,y,this.w,bh,shift,y,this.w,bh)}}this.rafId=requestAnimationFrame(()=>this.draw())},
  stop(){cancelAnimationFrame(this.rafId)}
};

/* ═══════════════════════════════════════════════════════════════════
   FX TRANSITIONS
   ═══════════════════════════════════════════════════════════════════ */
const FX={
  rafId:0,active:false,
  start(tapeId){this.stop();this.active=true;D.fx.classList.add('on');CRT.resize();const ctx=CRT.fxCtx,w=CRT.fxW,h=CRT.fxH;if(!w||!h)return;const N=tapeId==='tape2'?40:tapeId==='tape5'?35:25;const pts=Array.from({length:N},()=>({x:Math.random()*w,y:tapeId==='tape2'?-Math.random()*h:h+Math.random()*50,vx:(Math.random()-.5)*1.5,vy:tapeId==='tape2'?1+Math.random()*3:-(1+Math.random()*3),sz:2+Math.random()*4,a:.3+Math.random()*.5,rot:Math.random()*Math.PI*2,rv:(Math.random()-.5)*.1}));const t0=performance.now();const render=now=>{if(!this.active)return;const p=Math.min((now-t0)/5000,1);ctx.clearRect(0,0,w,h);const fade=p>.8?1-(p-.8)/.2:Math.min(p/.2,1);if(tapeId==='tape1'){const g=ctx.createLinearGradient(0,h,0,0);g.addColorStop(0,'rgba(139,115,85,.12)');g.addColorStop(1,'transparent');ctx.fillStyle=g;ctx.fillRect(0,0,w,h);ctx.fillStyle='#8B7355';for(const pt of pts){pt.y+=pt.vy*.4;pt.x+=pt.vx*.15;ctx.globalAlpha=pt.a*fade;ctx.beginPath();ctx.arc(pt.x,pt.y,pt.sz,0,6.28);ctx.fill()}}else if(tapeId==='tape2'){ctx.strokeStyle='rgba(85,136,187,.5)';ctx.lineWidth=1.5;for(const pt of pts){pt.y+=pt.vy*.6;pt.x+=pt.vx*.1;if(pt.y>h){pt.y=-5;pt.x=Math.random()*w}ctx.globalAlpha=pt.a*fade*.6;ctx.beginPath();ctx.moveTo(pt.x,pt.y);ctx.lineTo(pt.x-pt.vx,pt.y-12);ctx.stroke()}}else if(tapeId==='tape3'){const cx=w/2,cy=h/2;const g=ctx.createRadialGradient(cx,cy,0,cx,cy,Math.max(w,h)*.6);g.addColorStop(0,'transparent');g.addColorStop(1,'rgba(136,68,102,.1)');ctx.fillStyle=g;ctx.fillRect(0,0,w,h);ctx.fillStyle='#884466';for(const pt of pts){const dx=cx-pt.x,dy=cy-pt.y,d=Math.sqrt(dx*dx+dy*dy)||1;pt.x+=dx/d;pt.y+=dy/d;pt.rot+=pt.rv;ctx.save();ctx.translate(pt.x,pt.y);ctx.rotate(pt.rot);ctx.globalAlpha=pt.a*fade;ctx.beginPath();ctx.moveTo(0,-pt.sz);ctx.lineTo(pt.sz*.6,0);ctx.lineTo(0,pt.sz);ctx.lineTo(-pt.sz*.6,0);ctx.closePath();ctx.fill();ctx.restore()}}else if(tapeId==='tape4'){const cx=w/2,cy=h/2,rad=Math.min(w,h)*.4*p;const g=ctx.createRadialGradient(cx,cy,0,cx,cy,rad||1);g.addColorStop(0,'rgba(255,107,157,.12)');g.addColorStop(1,'transparent');ctx.fillStyle=g;ctx.fillRect(0,0,w,h);ctx.fillStyle='rgba(255,180,200,.4)';for(const pt of pts){pt.y+=pt.vy*.35;pt.x+=Math.sin(pt.rot)*.8;pt.rot+=pt.rv;ctx.save();ctx.translate(pt.x,pt.y);ctx.rotate(pt.rot);ctx.globalAlpha=pt.a*fade*.5;ctx.beginPath();ctx.ellipse(0,0,pt.sz,pt.sz*.5,0,0,6.28);ctx.fill();ctx.restore()}}else if(tapeId==='tape5'){const cols=['#8B7355','#5588bb','#884466','#ff6b9d','#a8e6a3'];const ci=Math.floor((p*4)%5);ctx.fillStyle=cols[ci];for(const pt of pts){pt.y+=pt.vy*.4;pt.x+=Math.sin(pt.rot+p*4);pt.rot+=pt.rv;ctx.globalAlpha=pt.a*fade*.4;ctx.beginPath();ctx.arc(pt.x,pt.y,pt.sz,0,6.28);ctx.fill()}}ctx.globalAlpha=1;if(p<1)this.rafId=requestAnimationFrame(render);else this.stop()};this.rafId=requestAnimationFrame(render)},
  stop(){this.active=false;cancelAnimationFrame(this.rafId);D.fx.classList.remove('on');if(CRT.fxCtx&&CRT.fxW)CRT.fxCtx.clearRect(0,0,CRT.fxW,CRT.fxH)}
};

/* ═══════════════════════════════════════════════════════════════════
   PARTICLE POOL
   ═══════════════════════════════════════════════════════════════════ */
const Dust={
  pool:[],anims:[],idx:0,iv:0,SIZE:25,
  init(){for(let i=0;i<this.SIZE;i++){const p=document.createElement('div');p.className='particle';p.style.cssText='opacity:0;width:3px;height:3px';D.particles.appendChild(p);this.pool.push(p);this.anims.push(null)}},
  spawn(){const i=this.idx%this.SIZE;this.idx++;if(this.anims[i])this.anims[i].cancel();const p=this.pool[i],sz=2+Math.random()*4,dur=10000+Math.random()*14000;const dx=(Math.random()-.5)*80,op=.05+Math.random()*.12;p.style.cssText=`left:${Math.random()*100}%;bottom:-10px;width:${sz}px;height:${sz}px;background:radial-gradient(circle,rgba(255,107,157,${.12+Math.random()*.12}),transparent);opacity:0`;this.anims[i]=p.animate([{transform:'translateY(0) translateX(0)',opacity:0},{opacity:op,offset:.1},{opacity:op,offset:.9},{transform:`translateY(calc(-100vh - 20px)) translateX(${dx}px)`,opacity:0}],{duration:dur,fill:'forwards'})},
  start(){if(!this.iv)this.iv=setInterval(()=>this.spawn(),1100)},
  stop(){clearInterval(this.iv);this.iv=0}
};

/* ═══════════════════════════════════════════════════════════════════
   UI
   ═══════════════════════════════════════════════════════════════════ */
const UI={
  async typeInto(el,text,spd=22){for(let i=0;i<text.length;i++){el.textContent+=text[i];Snd.typeClick();await sleep(spd)}},
  showDlg(text,dur=0){clearTimeout(dlgTimer);D.dlg.textContent=text;D.dlg.classList.add('vis');if(dur)dlgTimer=setTimeout(()=>D.dlg.classList.remove('vis'),dur)},
  hideDlg(){clearTimeout(dlgTimer);D.dlg.classList.remove('vis')},
  screenClear(){D.screen.innerHTML=''},
  screenNoSignal(){this.screenClear();const m=document.createElement('div');m.className='screen-msg';m.textContent='NO SIGNAL';D.screen.appendChild(m);D.channel.textContent='AV-1'},
  setGlow(rgba){D.glow.style.background=`radial-gradient(ellipse,${rgba} 0%,transparent 60%)`},
  glitch(){Snd.sfxGlitch();D.bezel.classList.add('shake');setTimeout(()=>D.bezel.classList.remove('shake'),200)}
};

let cIv=0,cSec=0;
const startCounter=()=>{cSec=0;D.counter.classList.add('on');cIv=setInterval(()=>{cSec++;D.counter.textContent='▶ '+String(cSec/60|0).padStart(2,'0')+':'+String(cSec%60).padStart(2,'0')},1000)};
const stopCounter=()=>{clearInterval(cIv);D.counter.classList.remove('on')};

/* ═══════════════════════════════════════════════════════════════════
   SHEEPY SVG
   ═══════════════════════════════════════════════════════════════════ */
const sheepySVG=(size,hold=false,expr='nervous')=>{
  const M={happy:'M-5 2 Q0 8 5 2',sad:'M-5 5 Q0 0 5 5',nervous:'M-4 4 Q-2 2 0 4 Q2 6 4 4',neutral:'M-4 3 L4 3'};
  return `<svg width="${size}" height="${size}" viewBox="0 0 120 120" style="animation:bounce 2.5s ease-in-out infinite"><ellipse cx="60" cy="75" rx="34" ry="28" fill="#f5f5f5"/><ellipse cx="40" cy="70" rx="11" ry="9" fill="#fafafa"/><ellipse cx="80" cy="70" rx="11" ry="9" fill="#fafafa"/><ellipse cx="55" cy="62" rx="9" ry="7" fill="#fafafa"/><ellipse cx="65" cy="62" rx="9" ry="7" fill="#fafafa"/><ellipse cx="60" cy="35" rx="20" ry="16" fill="#ffeef5"/><ellipse cx="35" cy="28" rx="7" ry="4" fill="#ffc0cb" transform="rotate(-18 35 28)"/><ellipse cx="85" cy="28" rx="7" ry="4" fill="#ffc0cb" transform="rotate(18 85 28)"/><ellipse cx="42" cy="40" rx="4" ry="2" fill="#ff8fab" opacity=".45"/><ellipse cx="78" cy="40" rx="4" ry="2" fill="#ff8fab" opacity=".45"/><ellipse cx="50" cy="33" rx="4" ry="5" fill="#222"><animate attributeName="ry" values="5;5;.5;5;5" keyTimes="0;.45;.5;.55;1" dur="4s" repeatCount="indefinite"/></ellipse><ellipse cx="70" cy="33" rx="4" ry="5" fill="#222"><animate attributeName="ry" values="5;5;.5;5;5" keyTimes="0;.45;.5;.55;1" dur="4s" repeatCount="indefinite"/></ellipse><circle cx="52" cy="31" r="1.5" fill="#fff"/><circle cx="72" cy="31" r="1.5" fill="#fff"/><ellipse cx="60" cy="42" rx="3" ry="2" fill="#ff8fab"/><g transform="translate(60 50)"><path d="${M[expr]||M.neutral}" stroke="#ff8fab" stroke-width="1.5" fill="none" stroke-linecap="round"/></g>${hold?'<g transform="translate(82 55)"><rect width="20" height="14" rx="1" fill="#fff5e6" stroke="#ff69b4"/><path d="M0 0 L10 7 L20 0" stroke="#ff69b4" fill="none"/><circle cx="10" cy="7" r="2.5" fill="#ff69b4"/></g>':''}</svg>`;
};

/* ═══════════════════════════════════════════════════════════════════
   SHEEPY INTRO
   ═══════════════════════════════════════════════════════════════════ */
async function showSheepyIntro(){
  Snd.sfxWhoosh();
  await fadeToScreen(()=>{
    const wrap=document.createElement('div');wrap.className='sheepy-intro';
    const glow=document.createElement('div');glow.className='sheepy-glow';
    const txt=document.createElement('div');txt.className='intro-line';txt.id='introLine';
    wrap.appendChild(glow);wrap.appendChild(txt);D.screen.appendChild(wrap);
    glow.innerHTML=sheepySVG(140,true,'nervous');
  });
  const txt=$('introLine');
  await sleep(600);
  txt.classList.add('show');
  const lines=[
    {html:'<span class="hand">baa.</span>',ms:2200},
    {html:'Sheepy here. She asked me to deliver something.',ms:3500},
    {html:'But you\u2026 you wanted to respond.',ms:3200},
    {html:'So I\'m carrying your reply.',ms:2800},
    {html:'Each tape is a possible ending.',ms:3000,bgmPrep:true},
    {html:'None of them are true. All of them are true.',ms:3500,bgmStart:true},
    {html:'A seed has many fates.',ms:3000},
    {html:'<span class="hand">Drag a tape to the slot to begin.</span>',ms:3500}
  ];
  for(let i=0;i<lines.length;i++){
    const line=lines[i];
    if(i>0){txt.classList.remove('show');txt.classList.add('hiding');await sleep(500);txt.classList.remove('hiding')}
    if(line.bgmPrep)Snd.preloadBGM();
    if(line.bgmStart){dbg('BGM: starting during Sheepy intro');Snd.playBGM()}
    txt.innerHTML=line.html;txt.classList.add('show');await sleep(line.ms);
  }
  const glow=D.screen.querySelector('.sheepy-glow');
  if(glow)glow.innerHTML=sheepySVG(140,false,'happy');
  await sleep(800);
}

/* ═══════════════════════════════════════════════════════════════════
   LOADING SCREEN
   ═══════════════════════════════════════════════════════════════════ */
async function screenLoading(tape){
  Snd.sfxWhoosh();
  await fadeToScreen(()=>{CRT.burst(400);const d=document.createElement('div');d.className='load-display';const title=document.createElement('div');title.className='load-title';title.textContent='▶ PLAYING: '+tape.title;const desc=document.createElement('div');desc.className='load-desc';desc.textContent='"'+tape.desc+'"';const bar=document.createElement('div');bar.className='load-bar';bar.style.borderColor=tape.color;const fill=document.createElement('div');fill.className='load-fill';fill.id='loadFill';fill.style.background=tape.color;fill.style.boxShadow='0 0 8px '+tape.color;bar.appendChild(fill);d.appendChild(title);d.appendChild(desc);d.appendChild(bar);D.screen.appendChild(d)});
  const fill=$('loadFill');let w=0;
  await new Promise(r=>{const iv=setInterval(()=>{w+=Math.random()*3.5+1.5;fill.style.width=Math.min(w,100)+'%';if(w>=100){clearInterval(iv);r()}},65)});
  await sleep(600);
}

/* ═══════════════════════════════════════════════════════════════════
   GARDEN
   ═══════════════════════════════════════════════════════════════════ */
function showGarden(){UI.screenClear();UI.setGlow('rgba(168,230,163,.08)');const g=document.createElement('div');g.className='garden';const sv=document.createElement('div');sv.innerHTML=sheepySVG(120,false,'happy');const t=document.createElement('div');t.className='garden-text';t.innerHTML='The seed has grown into something beautiful.<br>Every ending was real. Every path was yours.';const s=document.createElement('div');s.className='garden-sub';s.textContent='🌱 Replay any tape from the archive.';g.appendChild(sv);g.appendChild(t);g.appendChild(s);D.screen.appendChild(g)}

/* ═══════════════════════════════════════════════════════════════════
   DRAG SYSTEM
   ═══════════════════════════════════════════════════════════════════ */
const Drag={
  active:false,ghost:null,tape:null,srcEl:null,sx:0,sy:0,moved:false,_move:null,_up:null,
  begin(e,tape,el){if(this.active||inserting||!bootDone)return;Snd.ensure();this.tape=tape;this.srcEl=el;this.sx=e.clientX;this.sy=e.clientY;this.moved=false;UI.setGlow('transparent');this._move=me=>this.onMove(me);this._up=()=>this.onUp();document.addEventListener('pointermove',this._move);document.addEventListener('pointerup',this._up)},
  mkGhost(){const r=this.srcEl.getBoundingClientRect();this.ghost=document.createElement('div');this.ghost.className='tape-ghost';const lbl=this.srcEl.querySelector('.tape-label');if(lbl)this.ghost.appendChild(lbl.cloneNode(true));this.ghost.style.width=r.width+'px';this.ghost.style.height=r.height+'px';document.body.appendChild(this.ghost);this.srcEl.classList.add('dragging');this.active=true},
  onMove(e){if(!this.moved){const dx=e.clientX-this.sx,dy=e.clientY-this.sy;if(dx*dx+dy*dy>25){this.moved=true;this.mkGhost();this.posGhost(e);UI.glitch()}return}this.posGhost(e)},
  posGhost(e){if(!this.ghost)return;this.ghost.style.left=(e.clientX-70)+'px';this.ghost.style.top=(e.clientY-44)+'px';const sr=D.slot.getBoundingClientRect(),gr=this.ghost.getBoundingClientRect();const hit=!(gr.left>sr.right||gr.right<sr.left||gr.top>sr.bottom||gr.bottom<sr.top);D.slot.classList.toggle('active',hit);D.slotLabel.textContent=hit?'▶ DROP':'▶ DRAG HERE';this.ghost.style.transform=hit?'rotate(0deg) scale(1.1)':'rotate(-5deg) scale(1.05)';this.ghost.style.borderColor=hit?'var(--green)':'var(--pink)'},
  onUp(){document.removeEventListener('pointermove',this._move);document.removeEventListener('pointerup',this._up);if(!this.moved)insertTape(this.tape);else if(this.ghost){const sr=D.slot.getBoundingClientRect(),gr=this.ghost.getBoundingClientRect();if(!(gr.left>sr.right||gr.right<sr.left||gr.top>sr.bottom||gr.bottom<sr.top))insertTape(this.tape);else UI.showDlg('Drop the tape into the slot!',2000)}this.cleanup()},
  cleanup(){if(this.srcEl)this.srcEl.classList.remove('dragging');if(this.ghost)this.ghost.remove();this.ghost=null;this.tape=null;this.srcEl=null;this.active=false;this.moved=false;D.slot.classList.remove('active');D.slotLabel.textContent='▶ DRAG HERE'}
};

/* ═══════════════════════════════════════════════════════════════════
   BUILD RACK
   ═══════════════════════════════════════════════════════════════════ */
function buildRack(){
  D.rack.innerHTML='';
  const hdr=document.createElement('div');hdr.className='rack-header';
  hdr.innerHTML=`ARCHIVE<span class="rack-progress">${countDone()}/${TAPES.length} PLAYED</span>`;
  D.rack.appendChild(hdr);
  for(const t of TAPES){
    const completed=isDone(t.id),avail=canPlay(t.id);
    const locked=t.locked&&!completed,seqLock=!t.locked&&!completed&&!avail;
    const el=document.createElement('div');
    el.className='vhs-tape'+(completed?' complete':'')+(locked?' locked':seqLock?' seq-locked':'');
    el.dataset.id=t.id;
    el.innerHTML=`<div class="tape-color" style="background:${t.color}"></div><div class="tape-window"><div class="reel"></div><div class="tape-strip"></div><div class="reel"></div></div><div class="tape-label">${t.title}<span class="tape-status">${locked?'LOCKED':seqLock?'PLAY PREV':completed?'✓ PLAYED':'NEW'}</span></div><div class="tape-rating">${t.rating}</div>`;
    if(!locked&&avail){el.addEventListener('pointerdown',e=>{e.preventDefault();Drag.begin(e,t,el)});el.addEventListener('pointerenter',()=>{if(!Drag.active&&!inserting){UI.setGlow(t.glow);Snd.sfxHover()}});el.addEventListener('pointerleave',()=>{if(!Drag.active)UI.setGlow('transparent')})}else if(seqLock){el.addEventListener('click',()=>UI.showDlg('Complete the previous tape first.',2500))}else if(locked){el.addEventListener('click',()=>UI.showDlg('This tape is sealed. Complete all others to unlock.',3000))}
    D.rack.appendChild(el);
  }
}

/* ═══════════════════════════════════════════════════════════════════
   INSERT TAPE
   ═══════════════════════════════════════════════════════════════════ */
async function insertTape(tape){
  if(!tape?.file||inserting||!bootDone)return;
  inserting=true;
  BgScenes.stop();
  Snd.stopBGM();Snd.stopHum();
  Snd.sfxClunk();D.slot.classList.add('inserting');await sleep(500);
  Snd.sfxSnap();D.slot.classList.add('active');D.slotLabel.textContent='▶ LOADING...';await sleep(400);
  Snd.sfxMotor();D.ledPlay.classList.add('on');await sleep(350);
  D.channel.textContent='▶ TAPE';D.bezel.classList.add('shake','flash');UI.setGlow(tape.glow);CRT.burst(1000);UI.glitch();await sleep(500);
  Snd.sfxTape(tape.id);D.rec.classList.add('on');D.tracking.classList.add('on');startCounter();FX.start(tape.id);await sleep(800);
  D.slot.classList.remove('inserting');D.bezel.classList.remove('shake');await sleep(400);D.bezel.classList.remove('flash');
  D.ledPlay.classList.remove('on');await sleep(150);D.ledPlay.classList.add('on');await sleep(500);
  await screenLoading(tape);stopCounter();FX.stop();
  D.screen.classList.add('fade-out');await sleep(1000);
  window.location.href=tape.file;
}

/* ═══════════════════════════════════════════════════════════════════
   AMBIENT
   ═══════════════════════════════════════════════════════════════════ */
const Amb={
  flickIv:0,crackTO:0,
  start(){this.flickIv=setInterval(()=>{if(Math.random()<.08&&!inserting){D.bezel.style.opacity='.94';setTimeout(()=>{D.bezel.style.opacity='1'},60+Math.random()*100)}},4000);this.crackle()},
  crackle(){if(Snd.on&&!inserting)Snd.noise(.01+Math.random()*.015,.005+Math.random()*.005);this.crackTO=setTimeout(()=>this.crackle(),2500+Math.random()*4000)},
  stop(){clearInterval(this.flickIv);clearTimeout(this.crackTO)}
};

/* ═══════════════════════════════════════════════════════════════════
   BOOT SEQUENCE
   ═══════════════════════════════════════════════════════════════════ */
async function boot(){
  if(booted)return;booted=true;
  D.boot.classList.add('hidden');await sleep(2000);
  D.station.classList.add('on');await sleep(500);
  CRT.init();CRT.burst(500);D.ledPwr.classList.add('on');Dust.init();Dust.start();Snd.ensure();Snd.sfxPowerOn();
  setTimeout(()=>D.warmup.classList.add('off'),500);
  BgScenes.init();

  const returning=isDone('tape1');
  const complete=allDone();

  if(complete){await sleep(1500);showGarden();buildRack();Amb.start();BgScenes.start();bootDone=true;return}
  if(returning){await sleep(1200);UI.screenNoSignal();BgScenes.start();await sleep(600);buildRack();const hint=isDone('tape4')?'A secret tape has appeared… 🌱':'Welcome back. Choose a tape. 🐑';UI.showDlg(hint,5000);Amb.start();bootDone=true;return}

  await sleep(1200);
  UI.screenClear();
  const bootDiv=document.createElement('div');bootDiv.className='boot-text';D.screen.appendChild(bootDiv);
  const lines=[{text:'> SEED ARCHIVE v2.0',spd:14,pause:500},{text:'> LOADING EMOTIONAL PAYLOAD...',spd:16,pause:600},{text:'> 5 RECORDINGS FOUND',spd:14,pause:400},{text:'> INITIALIZING SHEEPY PROTOCOL',spd:18,pause:500},{text:'',spd:0,pause:350},{text:'> READY.',spd:45,pause:1000}];
  for(const line of lines){if(!line.text){bootDiv.appendChild(document.createElement('br'));await sleep(line.pause);continue}const span=document.createElement('span');span.className='boot-line';span.style.animationDelay=(lines.indexOf(line)*.08)+'s';bootDiv.appendChild(span);await UI.typeInto(span,line.text,line.spd);bootDiv.appendChild(document.createElement('br'));await sleep(line.pause)}
  Snd.sfxReady();
  const cursor=document.createElement('span');cursor.className='cursor';bootDiv.appendChild(cursor);await sleep(1500);
  CRT.burst(300);
  await showSheepyIntro();
  Snd.sfxWhoosh();
  await fadeToScreen(()=>UI.screenNoSignal());
  await sleep(500);
  BgScenes.start();
  buildRack();
  UI.showDlg('Drag a tape to the slot. 🐑',6000);
  Amb.start();
  bootDone=true;
}

/* ═══════════════════════════════════════════════════════════════════
   EVENTS
   ═══════════════════════════════════════════════════════════════════ */
TouchFX.init();
VHS_BG.init();
D.boot.addEventListener('click',boot);
D.boot.addEventListener('touchend',e=>{e.preventDefault();boot()},{passive:false});
D.audioBtn.addEventListener('click',()=>Snd.toggle());
D.slot.addEventListener('click',()=>{if(!inserting&&bootDone)UI.showDlg('Drag a tape from the rack to the slot.',2500)});
D.eject.addEventListener('click',()=>{if(bootDone){Snd.sfxClunk();UI.showDlg('No tape inserted. The slot is empty.',2000)}});
document.addEventListener('contextmenu',e=>e.preventDefault());

/* ═══════════════════════════════════════════════════════════════════
   CLEANUP
   ═══════════════════════════════════════════════════════════════════ */
window.addEventListener('beforeunload',()=>{CRT.stop();FX.stop();Dust.stop();Amb.stop();BgScenes.stop();stopCounter();Snd.stopHum();if(Snd.bgm){Snd.bgm.pause();Snd.bgm=null}});
</script>
</body>
</html>
