<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>THE SEED OF MANY ENDINGS</title>
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Cdefs%3E%3CradialGradient id='sg' cx='50%25' cy='50%25'%3E%3Cstop offset='0%25' stop-color='%23a8e6a3' stop-opacity='.8'/%3E%3Cstop offset='100%25' stop-color='%23558b2f' stop-opacity='.4'/%3E%3C/radialGradient%3E%3C/defs%3E%3Crect width='32' height='32' fill='%23050505'/%3E%3Cellipse cx='16' cy='18' rx='6' ry='9' fill='url(%23sg)' transform='rotate(-10 16 18)'/%3E%3Cellipse cx='16' cy='11' rx='3' ry='2' fill='%23c8e6c9' transform='rotate(-10 16 11)'/%3E%3Cpath d='M12 6 Q16 2 20 6' stroke='%2381c784' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E">
<style>
@import url('https://fonts.googleapis.com/css2?family=VT323&family=Caveat:wght@400;600;700&family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&display=swap');
:root{
--bg:#030303;--pink:#ff6b9d;--pink-dim:#993d5e;--pink-bright:#ffb3cc;
--gold:#d4af37;--green:#a8e6a3;--warm:#ffeedd;--red:#cc4444;--blue:#5588bb;
--cyan:#00d4aa;--dim:#555;--white:#d4d4d4;--earth:#8B7355;
--font-crt:'VT323',monospace;--font-hand:'Caveat',cursive;
--font-serif:'Cormorant Garamond',serif}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;user-select:none}
html,body{height:100%;overflow:hidden;background:#050505;font-family:var(--font-crt);color:var(--pink)}

/* ═══ VHS BACKGROUND ═══ */
#vhs-bg{position:fixed;inset:0;z-index:0;pointer-events:none;overflow:hidden}
#vhs-bg canvas{position:absolute;inset:0;width:100%;height:100%}
.touch-ripple{position:fixed;border-radius:50%;pointer-events:none;z-index:9999;border:2px solid var(--pink);animation:touchRipple .8s ease-out forwards;opacity:0}
@keyframes touchRipple{0%{transform:scale(0);opacity:.8}100%{transform:scale(4);opacity:0}}
.glitch-flash{position:fixed;inset:0;z-index:9998;pointer-events:none;opacity:0;background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(255,107,157,.1) 2px,rgba(255,107,157,.1) 4px);animation:glitchFlash .15s ease-out}
@keyframes glitchFlash{0%{opacity:.4}100%{opacity:0}}

/* ═══ BACKGROUND SCENES ═══ */
#bg-scenes{position:absolute;inset:0;z-index:21;pointer-events:none;opacity:0;transition:opacity 2s ease}
#bg-scenes.active{opacity:.4}
.bg-scene{position:absolute;inset:0;opacity:0;transition:opacity 3s ease;overflow:hidden}
.bg-scene.active{opacity:1}
.bg-scene svg{position:absolute;inset:0;width:100%;height:100%}

/* ═══ AMBIENT LIGHT RAYS INSIDE TV ═══ */
.ambient-rays{position:absolute;inset:0;z-index:22;pointer-events:none;opacity:0;transition:opacity 3s}
.ambient-rays.on{opacity:1}
.ambient-ray{position:absolute;width:200%;height:200%;top:-50%;left:-50%;background:conic-gradient(from 0deg at 50% 50%,transparent 0%,rgba(255,107,157,.015) 5%,transparent 10%,transparent 25%,rgba(212,175,55,.01) 30%,transparent 35%,transparent 50%,rgba(168,230,163,.012) 55%,transparent 60%,transparent 75%,rgba(255,107,157,.01) 80%,transparent 85%);animation:rayRotate 30s linear infinite}
.ambient-ray:nth-child(2){animation-direction:reverse;animation-duration:45s;opacity:.7}
@keyframes rayRotate{to{transform:rotate(360deg)}}

/* ═══ FLOATING EMBERS AROUND STATION ═══ */
.ember{position:fixed;border-radius:50%;pointer-events:none;z-index:3;will-change:transform,opacity}

/* ═══ SCENE 1: BALLET — CSS only for non-dancer elements ═══ */
.scene-ballet .stage-floor{fill:url(#stageGrad)}
.scene-ballet .curtain-left,.scene-ballet .curtain-right{fill:#1a0a0a;opacity:.7}
.scene-ballet .curtain-left{animation:curtainSway 6s ease-in-out infinite;transform-origin:left}
.scene-ballet .curtain-right{animation:curtainSway 6s ease-in-out infinite reverse;transform-origin:right}
@keyframes curtainSway{0%,100%{transform:skewX(0deg)}50%{transform:skewX(2deg)}}
.scene-ballet .spotlight{animation:spotlightPulse 4s ease-in-out infinite;transform-origin:center top}
@keyframes spotlightPulse{0%,100%{opacity:.15;transform:scale(1)}50%{opacity:.3;transform:scale(1.08)}}
.scene-ballet .music-note{animation:noteFloat 6s ease-in-out infinite}
.scene-ballet .music-note:nth-child(2){animation-delay:1s;animation-duration:7s}
.scene-ballet .music-note:nth-child(3){animation-delay:2s;animation-duration:5s}
.scene-ballet .music-note:nth-child(4){animation-delay:3s;animation-duration:8s}
.scene-ballet .music-note:nth-child(5){animation-delay:4s;animation-duration:6s}
@keyframes noteFloat{0%,100%{opacity:0;transform:translateY(0) rotate(0deg)}10%{opacity:.5}90%{opacity:.4}100%{opacity:0;transform:translateY(-80px) rotate(20deg)}}
.scene-ballet .sparkle{animation:sparkle 2s ease-in-out infinite}
.scene-ballet .sparkle:nth-child(2){animation-delay:.3s}
.scene-ballet .sparkle:nth-child(3){animation-delay:.6s}
.scene-ballet .sparkle:nth-child(4){animation-delay:.9s}
.scene-ballet .sparkle:nth-child(5){animation-delay:1.2s}
.scene-ballet .sparkle:nth-child(6){animation-delay:1.5s}
.scene-ballet .sparkle:nth-child(7){animation-delay:1.8s}
.scene-ballet .sparkle:nth-child(8){animation-delay:2.1s}
@keyframes sparkle{0%,100%{opacity:0;transform:scale(0)}50%{opacity:.9;transform:scale(1.2)}}
.scene-ballet .rose-petal{animation:petalFall 8s linear infinite}
.scene-ballet .rose-petal:nth-child(2){animation-delay:1.5s;animation-duration:10s}
.scene-ballet .rose-petal:nth-child(3){animation-delay:3s;animation-duration:7s}
.scene-ballet .rose-petal:nth-child(4){animation-delay:4.5s;animation-duration:9s}
.scene-ballet .rose-petal:nth-child(5){animation-delay:6s;animation-duration:11s}
.scene-ballet .rose-petal:nth-child(6){animation-delay:7s;animation-duration:8s}
@keyframes petalFall{0%{opacity:0;transform:translate(0,0) rotate(0deg)}10%{opacity:.6}100%{opacity:0;transform:translate(50px,120px) rotate(220deg)}}

/* ═══ SCENE 2: JOURNEY ═══ */
.scene-journey .sky-gradient{animation:skyShift 12s ease-in-out infinite}
@keyframes skyShift{0%,100%{opacity:1}50%{opacity:.8}}
.scene-journey .sun{animation:sunRise 10s ease-in-out infinite;transform-origin:center}
@keyframes sunRise{0%,100%{transform:translateY(0) scale(1);opacity:.5}50%{transform:translateY(-15px) scale(1.15);opacity:.7}}
.scene-journey .sun-ray{animation:sunRayRotate 20s linear infinite;transform-origin:center}
@keyframes sunRayRotate{to{transform:rotate(360deg)}}
.scene-journey .cloud{animation:cloudDrift 25s linear infinite}
.scene-journey .cloud:nth-child(2){animation-duration:35s;animation-delay:-10s}
.scene-journey .cloud:nth-child(3){animation-duration:30s;animation-delay:-5s}
.scene-journey .cloud:nth-child(4){animation-duration:40s;animation-delay:-15s}
.scene-journey .cloud:nth-child(5){animation-duration:28s;animation-delay:-20s}
@keyframes cloudDrift{from{transform:translateX(150%)}to{transform:translateX(-150%)}}
.scene-journey .mountain{animation:mountainFade 8s ease-in-out infinite}
.scene-journey .mountain:nth-child(2){animation-delay:2s}
.scene-journey .mountain:nth-child(3){animation-delay:4s}
@keyframes mountainFade{0%,100%{opacity:.4}50%{opacity:.6}}
.scene-journey .tree{animation:treeSway 5s ease-in-out infinite;transform-origin:bottom center}
.scene-journey .tree:nth-child(2){animation-delay:.5s;animation-duration:4.5s}
.scene-journey .tree:nth-child(3){animation-delay:1s;animation-duration:5.5s}
.scene-journey .tree:nth-child(4){animation-delay:1.5s;animation-duration:4s}
@keyframes treeSway{0%,100%{transform:rotate(-1.5deg)}50%{transform:rotate(1.5deg)}}
/* Walker is JS-driven now */
.scene-journey .bird-flock{animation:flockFly 15s linear infinite}
@keyframes flockFly{0%{transform:translateX(-20px)}100%{transform:translateX(calc(100% + 20px))}}
.scene-journey .bird-small{animation:birdFlap .3s ease-in-out infinite}
.scene-journey .bird-small:nth-child(2){animation-delay:.1s}
.scene-journey .bird-small:nth-child(3){animation-delay:.2s}
@keyframes birdFlap{0%,100%{transform:translateY(0)}50%{transform:translateY(-3px)}}
.scene-journey .path{stroke-dasharray:500;stroke-dashoffset:500;animation:drawPath 10s ease-in-out infinite}
@keyframes drawPath{0%{stroke-dashoffset:500}50%{stroke-dashoffset:0}100%{stroke-dashoffset:-500}}
.scene-journey .dust-particle{animation:dustFloat 6s ease-in-out infinite}
.scene-journey .dust-particle:nth-child(2){animation-delay:1s}
.scene-journey .dust-particle:nth-child(3){animation-delay:2s}
.scene-journey .dust-particle:nth-child(4){animation-delay:3s}
.scene-journey .dust-particle:nth-child(5){animation-delay:4s}
.scene-journey .dust-particle:nth-child(6){animation-delay:.5s}
.scene-journey .dust-particle:nth-child(7){animation-delay:1.5s}
@keyframes dustFloat{0%,100%{opacity:0;transform:translateY(0)}50%{opacity:.4;transform:translateY(-25px)}}

/* ═══ SCENE 3: BIRD FLIGHT ═══ */
.scene-bird .sky-gradient{animation:skyPulse 8s ease-in-out infinite}
@keyframes skyPulse{0%,100%{opacity:1}50%{opacity:.85}}
.scene-bird .cloud-layer{animation:cloudLayer 30s linear infinite}
.scene-bird .cloud-layer:nth-child(2){animation-duration:40s;animation-delay:-10s;opacity:.5}
@keyframes cloudLayer{from{transform:translateX(100%)}to{transform:translateX(-100%)}}
/* Main bird is JS-driven now */
.scene-bird .feather{animation:featherDrift 8s ease-in-out infinite}
.scene-bird .feather:nth-child(2){animation-delay:1.5s;animation-duration:10s}
.scene-bird .feather:nth-child(3){animation-delay:3s;animation-duration:7s}
.scene-bird .feather:nth-child(4){animation-delay:4.5s;animation-duration:9s}
.scene-bird .feather:nth-child(5){animation-delay:6s;animation-duration:11s}
@keyframes featherDrift{0%{opacity:0;transform:translate(0,0) rotate(0deg)}20%{opacity:.6}100%{opacity:0;transform:translate(60px,80px) rotate(360deg)}}
.scene-bird .wind-line{animation:windBlow 3s linear infinite}
.scene-bird .wind-line:nth-child(2){animation-delay:.5s;animation-duration:2.5s}
.scene-bird .wind-line:nth-child(3){animation-delay:1s;animation-duration:3.5s}
.scene-bird .wind-line:nth-child(4){animation-delay:1.5s;animation-duration:2.8s}
.scene-bird .wind-line:nth-child(5){animation-delay:2s;animation-duration:3.2s}
@keyframes windBlow{0%{opacity:0;transform:translateX(-30px)}50%{opacity:.4}100%{opacity:0;transform:translateX(100px)}}
.scene-bird .sun-glow{animation:sunGlow 6s ease-in-out infinite}
@keyframes sunGlow{0%,100%{opacity:.3;transform:scale(1)}50%{opacity:.5;transform:scale(1.15)}}
.scene-bird .distant-bird{animation:distantBirdFly 8s linear infinite}
.scene-bird .distant-bird:nth-child(2){animation-delay:2s;animation-duration:10s}
.scene-bird .distant-bird:nth-child(3){animation-delay:4s;animation-duration:7s}
@keyframes distantBirdFly{from{transform:translateX(-20px)}to{transform:translateX(calc(100% + 20px))}}
.scene-bird .leaf{animation:leafBlow 6s ease-in-out infinite}
.scene-bird .leaf:nth-child(2){animation-delay:1s}
.scene-bird .leaf:nth-child(3){animation-delay:2s}
@keyframes leafBlow{0%,100%{opacity:0;transform:translateX(0) rotate(0deg)}50%{opacity:.4;transform:translateX(80px) rotate(180deg)}}

/* ═══ SCENE 4: SEED GROWING ═══ */
.scene-seed .soil{animation:soilPulse 10s ease-in-out infinite}
@keyframes soilPulse{0%,100%{opacity:.5}50%{opacity:.7}}
.scene-seed .roots{animation:rootGrow 10s ease-in-out infinite}
@keyframes rootGrow{0%,100%{opacity:.2;transform:scaleY(.6)}50%{opacity:.5;transform:scaleY(1)}}
.scene-seed .root-branch{animation:rootSpread 8s ease-in-out infinite;transform-origin:top}
.scene-seed .root-branch:nth-child(2){animation-delay:.3s}
.scene-seed .root-branch:nth-child(3){animation-delay:.6s}
.scene-seed .root-branch:nth-child(4){animation-delay:.9s}
@keyframes rootSpread{0%,100%{transform:scaleX(.8)}50%{transform:scaleX(1)}}
.scene-seed .main-stem{transform-origin:bottom;animation:stemRise 10s ease-in-out infinite}
@keyframes stemRise{0%,100%{transform:scaleY(.4)}50%{transform:scaleY(1)}}
.scene-seed .stem-segment{animation:stemSway 5s ease-in-out infinite;transform-origin:bottom}
.scene-seed .stem-segment:nth-child(2){animation-delay:.5s}
@keyframes stemSway{0%,100%{transform:rotate(-2deg)}50%{transform:rotate(2deg)}}
.scene-seed .leaf{transform-origin:bottom left;animation:leafUnfold 8s ease-in-out infinite}
.scene-seed .leaf:nth-child(2){animation-delay:.8s;transform-origin:bottom right}
.scene-seed .leaf:nth-child(3){animation-delay:1.6s}
.scene-seed .leaf:nth-child(4){animation-delay:2.4s;transform-origin:bottom right}
.scene-seed .leaf:nth-child(5){animation-delay:3.2s}
.scene-seed .leaf:nth-child(6){animation-delay:4s;transform-origin:bottom right}
@keyframes leafUnfold{0%,100%{transform:rotate(0deg) scale(.4);opacity:.3}50%{transform:rotate(20deg) scale(1);opacity:1}}
.scene-seed .flower-center{animation:flowerPulse 4s ease-in-out infinite}
@keyframes flowerPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.15)}}
.scene-seed .petal{transform-origin:center bottom;animation:petalBloom 6s ease-in-out infinite}
.scene-seed .petal:nth-child(2){animation-delay:.15s}
.scene-seed .petal:nth-child(3){animation-delay:.3s}
.scene-seed .petal:nth-child(4){animation-delay:.45s}
.scene-seed .petal:nth-child(5){animation-delay:.6s}
.scene-seed .petal:nth-child(6){animation-delay:.75s}
.scene-seed .petal:nth-child(7){animation-delay:.9s}
.scene-seed .petal:nth-child(8){animation-delay:1.05s}
@keyframes petalBloom{0%,100%{transform:rotate(var(--r,0deg)) scale(.3);opacity:.2}50%{transform:rotate(var(--r,0deg)) scale(1);opacity:1}}
.scene-seed .pollen{animation:pollenFloat 5s ease-in-out infinite}
.scene-seed .pollen:nth-child(2){animation-delay:.5s}
.scene-seed .pollen:nth-child(3){animation-delay:1s}
.scene-seed .pollen:nth-child(4){animation-delay:1.5s}
.scene-seed .pollen:nth-child(5){animation-delay:2s}
@keyframes pollenFloat{0%,100%{opacity:0;transform:translate(0,0)}50%{opacity:.5;transform:translate(20px,-30px)}}
.scene-seed .water-drop{animation:waterDrop 4s ease-in-out infinite}
.scene-seed .water-drop:nth-child(2){animation-delay:.8s}
.scene-seed .water-drop:nth-child(3){animation-delay:1.6s}
.scene-seed .water-drop:nth-child(4){animation-delay:2.4s}
@keyframes waterDrop{0%{opacity:0;transform:translateY(-20px)}20%{opacity:.6}100%{opacity:0;transform:translateY(100px)}}
.scene-seed .butterfly{animation:butterflyFloat 15s ease-in-out infinite}
.scene-seed .butterfly:nth-child(2){animation-delay:3s;animation-duration:12s}
@keyframes butterflyFloat{0%,100%{transform:translate(0,0)}25%{transform:translate(40px,-30px)}50%{transform:translate(80px,0)}75%{transform:translate(40px,20px)}}
.scene-seed .butterfly-wing{animation:wingFlutter .15s ease-in-out infinite;transform-origin:center}
@keyframes wingFlutter{0%,100%{transform:scaleX(1)}50%{transform:scaleX(.3)}}
.scene-seed .grass{animation:grassWave 3s ease-in-out infinite;transform-origin:bottom}
.scene-seed .grass:nth-child(2){animation-delay:.1s}
.scene-seed .grass:nth-child(3){animation-delay:.2s}
.scene-seed .grass:nth-child(4){animation-delay:.3s}
.scene-seed .grass:nth-child(5){animation-delay:.4s}
@keyframes grassWave{0%,100%{transform:rotate(-5deg)}50%{transform:rotate(5deg)}}
.scene-seed .glow-aura{animation:glowPulse 6s ease-in-out infinite}
@keyframes glowPulse{0%,100%{opacity:.1;transform:scale(1)}50%{opacity:.3;transform:scale(1.2)}}

/* ═══ BOOT OVERLAY ═══ */
#boot-overlay{position:fixed;inset:0;z-index:9999;background:#000;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;opacity:1;transition:opacity 2s cubic-bezier(.4,0,.2,1)}
#boot-overlay.hidden{opacity:0;pointer-events:none}
.seed-svg{width:clamp(80px,20vw,120px);height:clamp(80px,20vw,120px);animation:seedPulse 3s ease-in-out infinite;filter:drop-shadow(0 0 20px rgba(168,230,163,.4))}
@keyframes seedPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.08)}}
#boot-overlay h1{font-family:var(--font-serif);font-size:clamp(1.8rem,5vw,2.8rem);font-weight:600;color:var(--pink);letter-spacing:-1px;text-shadow:0 0 30px var(--pink);animation:titleFlicker 3s infinite;text-align:center;line-height:1.3;margin-top:20px}
#boot-overlay .sub{font-family:var(--font-hand);font-size:clamp(1rem,2.5vw,1.4rem);color:var(--pink-dim);margin-top:8px;opacity:.7}
.boot-prompt{color:#444;font-size:clamp(1rem,2vw,1.2rem);margin-top:clamp(30px,6vh,50px);animation:pulse 2s infinite;letter-spacing:3px}
.boot-sub{color:var(--pink-dim);font-size:.8rem;margin-top:12px;opacity:.4}
@keyframes titleFlicker{0%,18%,22%,25%,53%,56%,100%{opacity:1}20%,24%,55%{opacity:.6}}
@keyframes pulse{0%,100%{opacity:.3}50%{opacity:.8}}
@keyframes blink{50%{opacity:0}}
@keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-5px)}}
@keyframes screenShake{0%,100%{transform:translate(0)}10%{transform:translate(-2px,1px)}30%{transform:translate(2px,-1px)}50%{transform:translate(-1px,2px)}70%{transform:translate(1px,-1px)}90%{transform:translate(-1px,0)}}
@keyframes ledBreathe{0%,100%{opacity:.7}50%{opacity:1}}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
@keyframes fadeInSlow{from{opacity:0}to{opacity:1}}
@keyframes loadPulse{0%,100%{filter:brightness(1)}50%{filter:brightness(1.3)}}
@keyframes warmGlow{0%,100%{background:radial-gradient(circle at center,#0a0a0a 0%,#000 70%)}50%{background:radial-gradient(circle at center,#1a0a0a 0%,#000 60%)}}
@keyframes noSignalPulse{0%,100%{opacity:.7;transform:scale(1)}50%{opacity:1;transform:scale(1.02)}}
@keyframes gentleDrift{0%,100%{transform:translateY(0)}50%{transform:translateY(-3px)}}

/* ═══ STATION ═══ */
#particles{position:fixed;inset:0;pointer-events:none;z-index:1;overflow:hidden;contain:strict}
.particle{position:absolute;border-radius:50%;pointer-events:none;will-change:transform,opacity}
#station{display:none;grid-template-columns:1fr minmax(200px,280px);grid-template-rows:1fr;gap:12px;width:min(96vw,1100px);height:min(90vh,760px);position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);opacity:0;contain:layout style}
#station.on{display:grid;animation:stationFadeIn 1.5s ease-out forwards}
@keyframes stationFadeIn{from{opacity:0;transform:translate(-50%,-50%) scale(.95)}to{opacity:1;transform:translate(-50%,-50%) scale(1)}}
.tv-unit{grid-column:1;grid-row:1;background:linear-gradient(145deg,#1a1a1a,#0e0e0e);border-radius:20px;border:2px solid #252525;box-shadow:inset 0 0 50px #000,0 12px 50px rgba(0,0,0,.85);display:flex;flex-direction:column;padding:18px;position:relative;z-index:2;animation:tvPulse 4s ease-in-out infinite}
@keyframes tvPulse{0%,100%{box-shadow:inset 0 0 50px #000,0 12px 50px rgba(0,0,0,.85)}50%{box-shadow:inset 0 0 50px #000,0 12px 50px rgba(0,0,0,.85),0 0 20px rgba(255,107,157,.05)}}
.screen-bezel{flex:1;background:#020202;border-radius:12px;position:relative;overflow:hidden;border:2px solid #181818;box-shadow:inset 0 0 50px rgba(0,0,0,.9);transition:border-color .5s,box-shadow .5s}
.screen-bezel.shake{animation:screenShake .5s ease-out}
.screen-bezel.flash{border-color:rgba(255,107,157,.3);box-shadow:inset 0 0 50px rgba(0,0,0,.9),0 0 25px rgba(255,107,157,.08)}
canvas#crt{position:absolute;inset:0;width:100%;height:100%;z-index:5;image-rendering:pixelated}
canvas#fx{position:absolute;inset:0;width:100%;height:100%;z-index:7;opacity:0;transition:opacity 1s;pointer-events:none}
canvas#fx.on{opacity:1}
.crt-warmup{position:absolute;inset:0;z-index:19;background:radial-gradient(circle at center,#0a0a0a 0%,#000 60%);transition:opacity 3s;pointer-events:none;animation:warmGlow 2s ease-in-out}
.crt-warmup.off{opacity:0}
.scanlines{position:absolute;inset:0;pointer-events:none;z-index:30;background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,0,0,.15) 2px,rgba(0,0,0,.15) 4px);opacity:.5}
.vignette{position:absolute;inset:0;pointer-events:none;z-index:31;background:radial-gradient(ellipse at center,transparent 45%,rgba(0,0,0,.8) 100%)}
.glass-glare{position:absolute;inset:0;pointer-events:none;z-index:32;background:linear-gradient(135deg,rgba(255,255,255,.03) 0%,transparent 35%)}
.scan-bar{position:absolute;top:0;left:0;width:100%;height:6px;background:linear-gradient(180deg,transparent,rgba(255,255,255,.06),transparent);opacity:.4;z-index:33;pointer-events:none;animation:scanbar 5s linear infinite}
.tracking-bar{position:absolute;left:0;width:100%;height:4px;background:linear-gradient(180deg,transparent,rgba(255,255,255,.08),transparent);opacity:0;z-index:34;pointer-events:none;transition:opacity .3s}
.tracking-bar.on{opacity:1;animation:trackDrift 3s linear infinite}
@keyframes scanbar{from{top:-4%}to{top:104%}}
@keyframes trackDrift{0%{top:-2%}100%{top:102%}}
.screen-glow{position:absolute;inset:-15px;z-index:-1;border-radius:22px;pointer-events:none;transition:background 2.5s}

/* ═══ SCREEN CONTENT ═══ */
#screen{position:absolute;inset:0;z-index:25;display:flex;flex-direction:column;justify-content:center;align-items:center;padding:20px;opacity:1;transition:opacity 1s}
#screen.fade-out{opacity:0}
#screen.fade-in{animation:screenFadeIn 1s forwards}
@keyframes screenFadeIn{from{opacity:0;filter:blur(3px)}to{opacity:1;filter:blur(0)}}
.channel-id{position:absolute;top:14px;left:16px;font-size:1.6rem;color:var(--pink-dim);opacity:.45;text-shadow:0 0 6px var(--pink-dim);letter-spacing:2px;z-index:35}
.counter{position:absolute;top:14px;right:16px;font-size:1.1rem;color:rgba(255,255,255,.5);opacity:0;z-index:35;transition:opacity .5s}
.counter.on{opacity:1}
.rec-ind{position:absolute;top:14px;right:16px;font-size:1rem;color:var(--red);opacity:0;transition:opacity .4s;z-index:35}
.rec-ind.on{opacity:1;animation:blink 1s infinite}
.screen-msg{font-size:clamp(1rem,2.5vw,1.6rem);color:var(--pink-dim);text-shadow:0 0 10px var(--pink-dim);letter-spacing:3px;text-align:center;animation:fadeInSlow 1.2s,noSignalPulse 4s ease-in-out 1.2s infinite}
.dlg-box{position:absolute;bottom:16px;left:50%;transform:translateX(-50%);z-index:40;text-align:center;color:var(--pink-bright);font-family:var(--font-serif);font-size:clamp(1rem,2vw,1.25rem);text-shadow:0 0 8px var(--pink);background:rgba(8,3,8,.92);padding:12px 20px;border-radius:4px;border:1px solid rgba(255,107,157,.15);max-width:88%;line-height:1.5;opacity:0;transition:opacity .6s;pointer-events:none}
.dlg-box.vis{opacity:1}
.boot-text{width:88%;text-align:left;color:var(--pink);font-size:clamp(12px,1.8vw,15px);line-height:1.9;white-space:pre-wrap}
.boot-line{opacity:0;animation:fadeIn .5s forwards}
.boot-text .cursor{display:inline-block;width:7px;height:1.1em;background:var(--pink);vertical-align:text-bottom;margin-left:2px;animation:blink .8s step-end infinite}

/* ═══ SHEEPY INTRO ═══ */
.sheepy-intro{display:flex;flex-direction:column;align-items:center;gap:16px;width:100%;animation:fadeIn 1.2s}
.sheepy-glow{width:clamp(140px,30vw,180px);height:clamp(140px,30vw,180px);background:radial-gradient(circle,rgba(255,182,193,.2) 0%,transparent 70%);border-radius:50%;animation:sheepyGlow 3s infinite;display:flex;align-items:center;justify-content:center}
@keyframes sheepyGlow{0%,100%{opacity:.6;transform:scale(1)}50%{opacity:.9;transform:scale(1.05)}}
.intro-line{font-family:var(--font-serif);font-size:clamp(1.1rem,2.2vw,1.4rem);color:var(--pink-bright);text-align:center;min-height:2.5em;display:flex;align-items:center;justify-content:center;transition:opacity .8s,transform .8s;opacity:0;transform:translateY(6px)}
.intro-line.show{opacity:1;transform:translateY(0)}
.intro-line.hiding{opacity:0;transform:translateY(-4px)}
.intro-line .hand{font-family:var(--font-hand);font-size:1.15em;color:var(--gold)}
.load-display{text-align:center;width:80%;animation:fadeIn 1s}
.load-title{font-size:14px;margin-bottom:4px;letter-spacing:.1em}
.load-desc{font-family:var(--font-serif);font-size:12px;color:var(--pink-dim);margin-bottom:12px;font-style:italic;opacity:0;animation:fadeInSlow 1s .5s forwards}
.load-bar{width:200px;height:6px;border-radius:3px;overflow:hidden;margin:0 auto;border:1px solid var(--pink);background:rgba(255,107,157,.1)}
.load-fill{height:100%;width:0%;transition:width .1s;animation:loadPulse 1.5s infinite}
.tv-controls{display:flex;align-items:center;justify-content:space-between;padding:8px 14px;margin-top:6px;flex-shrink:0}
.power-section{display:flex;align-items:center;gap:5px}
.led{width:7px;height:7px;border-radius:50%;transition:all .4s;box-shadow:inset 0 0 2px rgba(0,0,0,.6)}
.led.pwr{background:#400}
.led.pwr.on{background:#e44;box-shadow:0 0 5px rgba(238,68,68,.5);animation:ledBreathe 3s infinite}
.led.play{background:#300;margin-left:10px}
.led.play.on{background:#ff6b9d;box-shadow:0 0 5px rgba(255,107,157,.5)}
.ctrl-label{font-size:9px;letter-spacing:.15em;color:#444;text-transform:uppercase;margin-left:3px}
.tape-slot{width:160px;height:26px;background:#040404;border:1.5px solid #2a2a2a;border-radius:3px;cursor:default;box-shadow:inset 0 2px 6px rgba(0,0,0,.8);position:relative;overflow:hidden;transition:all .4s;display:flex;align-items:center;justify-content:center}
.slot-label{font-size:9px;letter-spacing:.12em;color:#2a2a2a;transition:color .4s;position:relative;z-index:2}
.tape-slot.active{border-color:var(--pink);box-shadow:inset 0 2px 6px rgba(0,0,0,.8),0 0 10px rgba(255,107,157,.2)}
.tape-slot.active .slot-label{color:var(--pink);animation:pulse 1.5s infinite}
.slot-flap{position:absolute;inset:0;background:linear-gradient(180deg,#1a1a1a,#0e0e0e);transform-origin:top;transition:transform .6s;border-bottom:1px solid #2a2a2a;z-index:1}
.tape-slot.inserting .slot-flap{transform:perspective(80px) rotateX(-95deg)}
.eject-btn{padding:3px 12px;background:linear-gradient(180deg,#222,#161616);border:1.5px solid #333;color:#777;cursor:pointer;font-family:var(--font-crt);font-size:10px;border-radius:3px;letter-spacing:1px;transition:all .2s}
.eject-btn:hover{background:#1a1a1a;color:#bbb;border-color:#444}
.brand-label{font-size:10px;letter-spacing:.25em;color:#222;text-transform:uppercase}

/* ═══ TAPE RACK ═══ */
.tape-rack{grid-column:2;grid-row:1;background:linear-gradient(180deg,#101010,#080808);border:2px solid #1f1f1f;border-radius:10px;padding:14px;display:flex;flex-direction:column;gap:12px;overflow-y:auto;box-shadow:inset 0 0 20px #000;scrollbar-width:thin;scrollbar-color:#222 #080808;contain:content}
.rack-header{color:#333;text-align:center;border-bottom:1px solid #1a1a1a;padding-bottom:8px;margin-bottom:2px;letter-spacing:3px;font-size:11px;animation:fadeInSlow .8s}
.rack-progress{font-size:9px;color:var(--pink-dim);opacity:.6;display:block;margin-top:3px}
.vhs-tape{min-height:88px;background:linear-gradient(180deg,#1b1b1b,#121212);border-radius:5px;border:1.5px solid #2d2d2d;position:relative;cursor:grab;transition:border-color .3s,opacity .3s,transform .3s,box-shadow .3s;display:flex;flex-direction:column;align-items:center;justify-content:center;box-shadow:2px 4px 12px rgba(0,0,0,.5);flex-shrink:0;touch-action:none;opacity:0;animation:tapeSlideIn .6s forwards}
@keyframes tapeSlideIn{from{opacity:0;transform:translateX(-20px)}to{opacity:1;transform:translateX(0)}}
.vhs-tape:nth-child(2){animation-delay:.1s}
.vhs-tape:nth-child(3){animation-delay:.2s}
.vhs-tape:nth-child(4){animation-delay:.3s}
.vhs-tape:nth-child(5){animation-delay:.4s}
.vhs-tape:nth-child(6){animation-delay:.5s}
.vhs-tape:hover:not(.locked):not(.seq-locked){transform:translateY(-3px) scale(1.02);box-shadow:3px 6px 18px rgba(0,0,0,.6);border-color:#3d3d3d;z-index:5}
.vhs-tape:active{cursor:grabbing;transform:scale(.97)}
.vhs-tape.dragging{opacity:.2!important;transform:scale(.9)}
.vhs-tape.locked,.vhs-tape.seq-locked{opacity:.35!important;cursor:not-allowed}
.vhs-tape.seq-locked{opacity:.5!important}
.vhs-tape.complete::after{content:'✓';position:absolute;top:6px;right:6px;font-size:11px;color:var(--green);text-shadow:0 0 4px var(--green)}
.tape-ghost{position:fixed;z-index:9999;pointer-events:none;width:140px;height:88px;background:linear-gradient(180deg,#1b1b1b,#121212);border:1.5px solid var(--pink);border-radius:5px;box-shadow:0 10px 30px rgba(0,0,0,.8),0 0 15px rgba(255,107,157,.15);transform:rotate(-5deg) scale(1.05);display:flex;flex-direction:column;align-items:center;justify-content:center;transition:transform .2s}
.tape-window{position:absolute;top:10px;left:12%;width:76%;height:24px;background:#050505;border-radius:3px;border:1.5px solid #202020;display:flex;align-items:center;justify-content:space-around;padding:0 10px;overflow:hidden;box-shadow:inset 0 0 5px rgba(0,0,0,.6)}
.reel{width:14px;height:14px;border:2px solid #333;border-radius:50%;background:#080808;position:relative;transition:border-color .3s}
.reel::after{content:'';position:absolute;inset:2px;border:1.5px solid #1f1f1f;border-radius:50%;background:#030303}
.vhs-tape:hover:not(.locked):not(.seq-locked) .reel{border-color:#3a3a3a;animation:spin 1.2s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.tape-strip{width:24px;height:1px;background:#1f1f1f}
.tape-label{background:linear-gradient(#e8e0d0,#dcd0bc);color:#1a1a1a;padding:3px 8px;margin-top:28px;width:82%;text-align:center;font-family:var(--font-hand);font-weight:600;font-size:12px;transform:rotate(-.5deg);box-shadow:0 1px 3px rgba(0,0,0,.25);border-radius:2px;line-height:1.2}
.tape-status{font-family:var(--font-crt);font-size:8px;color:#777;letter-spacing:.08em;margin-top:1px}
.tape-color{position:absolute;top:10px;right:6px;width:4px;height:4px;border-radius:50%}
.tape-rating{position:absolute;bottom:6px;left:6px;font-size:7px;color:#444;opacity:.6}
.garden{display:flex;flex-direction:column;align-items:center;gap:20px;animation:fadeIn 3.5s}
.garden-text{font-family:var(--font-serif);font-size:clamp(1rem,2vw,1.3rem);color:var(--green);text-shadow:0 0 15px rgba(168,230,163,.3);text-align:center;line-height:1.7;animation:gentleDrift 4s infinite}
.garden-sub{font-family:var(--font-hand);font-size:clamp(.9rem,2vw,1.1rem);color:var(--pink-dim);opacity:0;animation:fadeInSlow 2s 1.5s forwards}
.audio-btn{position:fixed;top:10px;right:10px;z-index:200;background:rgba(0,0,0,.65);border:1px solid #2a2a2a;border-radius:3px;color:#555;font-family:var(--font-crt);font-size:11px;padding:4px 10px;cursor:pointer;transition:all .3s}
.audio-btn:hover,.audio-btn.on{color:var(--pink);border-color:var(--pink)}
.bgm-debug{position:fixed;bottom:4px;left:4px;font-size:9px;color:#333;z-index:999;pointer-events:none;font-family:monospace}

@media(max-width:800px){
#station{grid-template-columns:1fr;grid-template-rows:1fr 120px;width:98vw;height:auto;max-height:none;position:relative;top:auto;left:auto;transform:none;padding:6px;gap:8px;margin:4px auto}
#station.on{animation:stationFadeInMobile 1.5s forwards}
@keyframes stationFadeInMobile{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}
.tv-unit{min-height:50vh}
.tape-rack{flex-direction:row;overflow-x:auto;padding:10px;gap:8px}
.vhs-tape{min-width:130px;min-height:80px}}
@media(max-width:480px){.intro-line{font-size:clamp(.9rem,3.5vw,1.1rem)}}
</style>
</head>
<body>
<div id="vhs-bg"><canvas id="vhsCanvas"></canvas></div>

<div id="boot-overlay">
<svg class="seed-svg" viewBox="0 0 100 100"><defs><radialGradient id="sg" cx="50%" cy="50%"><stop offset="0%" stop-color="#a8e6a3" stop-opacity="0.6"/><stop offset="100%" stop-color="#558b2f" stop-opacity="0.2"/></radialGradient></defs><ellipse cx="50" cy="50" rx="18" ry="28" fill="url(#sg)" transform="rotate(-20 50 50)"><animate attributeName="ry" values="28;30;28" dur="2s" repeatCount="indefinite"/></ellipse><ellipse cx="50" cy="38" rx="6" ry="3" fill="#c8e6c9" transform="rotate(-20 50 38)"/><path d="M42 22 Q50 10 58 22" stroke="#81c784" stroke-width="2" fill="none" stroke-linecap="round"><animate attributeName="d" values="M42 22 Q50 10 58 22;M42 20 Q50 6 58 20;M42 22 Q50 10 58 22" dur="2s" repeatCount="indefinite"/></path></svg>
<h1>THE SEED OF<br>MANY ENDINGS</h1>
<div class="sub">for Minji</div>
<p class="boot-prompt">[ CLICK TO POWER ON ]</p>
<div class="boot-sub">DELIVERED BY SHEEPY // ARCHIVE v2.0</div>
</div>

<button class="audio-btn" id="audio-btn">♪ OFF</button>
<div id="particles"></div>
<div class="bgm-debug" id="bgm-debug"></div>

<div id="station">
<div class="tv-unit">
<div class="screen-glow" id="screen-glow"></div>
<div class="screen-bezel" id="screen-bezel">
<canvas id="crt"></canvas>
<canvas id="fx"></canvas>
<div class="crt-warmup" id="warmup"></div>

<!-- ★ AMBIENT LIGHT RAYS -->
<div class="ambient-rays" id="ambient-rays">
  <div class="ambient-ray"></div>
  <div class="ambient-ray"></div>
</div>

<!-- ═══ BACKGROUND SCENES ═══ -->
<div id="bg-scenes">

<!-- ★ SCENE 1: BALLET — Dancer SVG restructured with IDs for JS animation -->
<div class="bg-scene scene-ballet" data-scene="0">
<svg viewBox="0 0 400 300" preserveAspectRatio="xMidYMid slice">
<defs>
<linearGradient id="stageGrad" x1="0%" y1="0%" x2="0%" y2="100%">
<stop offset="0%" stop-color="#1a0a10"/><stop offset="100%" stop-color="#0a0505"/>
</linearGradient>
<radialGradient id="spotGrad" cx="50%" cy="0%" r="70%">
<stop offset="0%" stop-color="#ffeedd" stop-opacity="0.3"/><stop offset="100%" stop-color="transparent"/>
</radialGradient>
<linearGradient id="curtainGrad" x1="0%" y1="0%" x2="100%" y2="0%">
<stop offset="0%" stop-color="#2a0a15"/><stop offset="50%" stop-color="#1a0510"/><stop offset="100%" stop-color="#2a0a15"/>
</linearGradient>
<linearGradient id="dancerGrad" x1="0%" y1="0%" x2="0%" y2="100%">
<stop offset="0%" stop-color="#ff6b9d" stop-opacity="0.7"/><stop offset="100%" stop-color="#993d5e" stop-opacity="0.4"/>
</linearGradient>
<filter id="glow"><feGaussianBlur stdDeviation="2" result="blur"/><feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
<radialGradient id="spotFloor" cx="50%" cy="50%"><stop offset="0%" stop-color="#ffeedd" stop-opacity="0.15"/><stop offset="100%" stop-color="transparent"/></radialGradient>
</defs>

<!-- Stage -->
<rect class="stage-floor" x="0" y="220" width="400" height="80" fill="url(#stageGrad)"/>
<rect x="0" y="0" width="400" height="220" fill="#0a0508"/>
<rect class="curtain-left" x="-20" y="0" width="80" height="300" fill="url(#curtainGrad)"/>
<rect class="curtain-right" x="340" y="0" width="80" height="300" fill="url(#curtainGrad)"/>
<ellipse class="spotlight" cx="200" cy="220" rx="120" ry="40" fill="url(#spotGrad)"/>
<ellipse cx="200" cy="222" rx="60" ry="8" fill="url(#spotFloor)"/>

<!-- Stage lights -->
<circle cx="80" cy="18" r="6" fill="#ffeedd" opacity="0.15"><animate attributeName="opacity" values="0.15;0.35;0.15" dur="2s" repeatCount="indefinite"/></circle>
<circle cx="160" cy="12" r="7" fill="#ffeedd" opacity="0.2"><animate attributeName="opacity" values="0.2;0.4;0.2" dur="2.8s" repeatCount="indefinite"/></circle>
<circle cx="200" cy="10" r="9" fill="#ffeedd" opacity="0.25"><animate attributeName="opacity" values="0.25;0.5;0.25" dur="2.2s" repeatCount="indefinite"/></circle>
<circle cx="240" cy="12" r="7" fill="#ffeedd" opacity="0.2"><animate attributeName="opacity" values="0.2;0.4;0.2" dur="3s" repeatCount="indefinite"/></circle>
<circle cx="320" cy="18" r="6" fill="#ffeedd" opacity="0.15"><animate attributeName="opacity" values="0.15;0.35;0.15" dur="2.5s" repeatCount="indefinite"/></circle>

<!-- ★ JS-DRIVEN DANCER — no CSS animations, all controlled by Ballet module -->
<g id="ballet-dancer" filter="url(#glow)" transform="translate(200,155)">
  <ellipse id="b-shadow" cx="0" cy="65" rx="28" ry="5" fill="#000" opacity="0.2"/>
  <g id="b-leg-stand">
    <line x1="-2" y1="35" x2="-6" y2="65" stroke="url(#dancerGrad)" stroke-width="5" stroke-linecap="round"/>
    <ellipse cx="-8" cy="67" rx="8" ry="3" fill="url(#dancerGrad)"/>
  </g>
  <line id="b-leg-ext-line" x1="4" y1="35" x2="35" y2="40" stroke="url(#dancerGrad)" stroke-width="5" stroke-linecap="round"/>
  <ellipse id="b-foot-ext" cx="40" cy="41" rx="8" ry="3" fill="url(#dancerGrad)"/>
  <ellipse id="b-tutu" cx="0" cy="35" rx="30" ry="9" fill="url(#dancerGrad)"/>
  <path id="b-torso" d="M-10 5 Q0 0 10 5 L8 35 Q0 38 -8 35 Z" fill="url(#dancerGrad)"/>
  <path id="b-arm-l" d="M-10 8 Q-30 -5 -40 15" stroke="url(#dancerGrad)" stroke-width="4" fill="none" stroke-linecap="round"/>
  <circle id="b-hand-l" cx="-42" cy="17" r="3.5" fill="url(#dancerGrad)"/>
  <path id="b-arm-r" d="M10 8 Q30 -5 40 -10" stroke="url(#dancerGrad)" stroke-width="4" fill="none" stroke-linecap="round"/>
  <circle id="b-hand-r" cx="42" cy="-12" r="3.5" fill="url(#dancerGrad)"/>
  <g id="b-head">
    <circle cx="0" cy="-8" r="10" fill="url(#dancerGrad)"/>
    <ellipse cx="0" cy="-17" rx="7" ry="5" fill="url(#dancerGrad)"/>
  </g>
</g>

<!-- Music notes -->
<text class="music-note" x="70" y="80" fill="#ffb3cc" opacity="0.5" font-size="16">♪</text>
<text class="music-note" x="330" y="100" fill="#ffb3cc" opacity="0.5" font-size="14">♫</text>
<text class="music-note" x="140" y="55" fill="#ffb3cc" opacity="0.5" font-size="12">♪</text>
<text class="music-note" x="270" y="65" fill="#ffb3cc" opacity="0.5" font-size="18">♫</text>
<text class="music-note" x="200" y="45" fill="#ffb3cc" opacity="0.5" font-size="14">♪</text>

<!-- Sparkles -->
<circle class="sparkle" cx="145" cy="115" r="2" fill="#fff"/>
<circle class="sparkle" cx="255" cy="95" r="2.5" fill="#fff"/>
<circle class="sparkle" cx="165" cy="175" r="2" fill="#fff"/>
<circle class="sparkle" cx="235" cy="155" r="1.5" fill="#fff"/>
<circle class="sparkle" cx="175" cy="85" r="2" fill="#fff"/>
<circle class="sparkle" cx="225" cy="185" r="1.5" fill="#fff"/>
<circle class="sparkle" cx="190" cy="140" r="2" fill="#ffe0ec"/>
<circle class="sparkle" cx="210" cy="105" r="1.5" fill="#ffe0ec"/>

<!-- Rose petals — more of them -->
<ellipse class="rose-petal" cx="55" cy="45" rx="4" ry="2" fill="#ff6b9d" opacity="0.5"/>
<ellipse class="rose-petal" cx="115" cy="25" rx="3" ry="1.5" fill="#ff8fab" opacity="0.4"/>
<ellipse class="rose-petal" cx="285" cy="35" rx="4" ry="2" fill="#ff6b9d" opacity="0.5"/>
<ellipse class="rose-petal" cx="345" cy="55" rx="3" ry="1.5" fill="#ff8fab" opacity="0.4"/>
<ellipse class="rose-petal" cx="170" cy="40" rx="3.5" ry="1.8" fill="#ff6b9d" opacity="0.45"/>
<ellipse class="rose-petal" cx="240" cy="30" rx="3" ry="1.5" fill="#ffb3cc" opacity="0.35"/>
</svg>
</div>

<!-- SCENE 2: JOURNEY -->
<div class="bg-scene scene-journey" data-scene="1">
<svg viewBox="0 0 400 300" preserveAspectRatio="xMidYMid slice">
<defs>
<linearGradient id="journeySky" x1="0%" y1="0%" x2="0%" y2="100%">
<stop offset="0%" stop-color="#1a1020"/><stop offset="50%" stop-color="#0a0810"/><stop offset="100%" stop-color="#050505"/>
</linearGradient>
<radialGradient id="journeySun" cx="50%" cy="50%">
<stop offset="0%" stop-color="#d4af37" stop-opacity="0.8"/><stop offset="50%" stop-color="#d4af37" stop-opacity="0.3"/><stop offset="100%" stop-color="transparent"/>
</radialGradient>
<linearGradient id="groundGrad" x1="0%" y1="0%" x2="0%" y2="100%">
<stop offset="0%" stop-color="#2a1a10"/><stop offset="100%" stop-color="#0a0505"/>
</linearGradient>
<linearGradient id="walkerGrad" x1="0%" y1="0%" x2="0%" y2="100%">
<stop offset="0%" stop-color="#ff6b9d" stop-opacity="0.6"/><stop offset="100%" stop-color="#993d5e" stop-opacity="0.4"/>
</linearGradient>
</defs>
<rect class="sky-gradient" x="0" y="0" width="400" height="300" fill="url(#journeySky)"/>
<g transform="translate(320, 60)">
<circle class="sun" cx="0" cy="0" r="30" fill="url(#journeySun)"/>
<g class="sun-ray" opacity="0.3">
<line x1="0" y1="-45" x2="0" y2="-55" stroke="#d4af37" stroke-width="2"/>
<line x1="32" y1="-32" x2="39" y2="-39" stroke="#d4af37" stroke-width="2"/>
<line x1="45" y1="0" x2="55" y2="0" stroke="#d4af37" stroke-width="2"/>
<line x1="32" y1="32" x2="39" y2="39" stroke="#d4af37" stroke-width="2"/>
<line x1="-32" y1="-32" x2="-39" y2="-39" stroke="#d4af37" stroke-width="2"/>
<line x1="-45" y1="0" x2="-55" y2="0" stroke="#d4af37" stroke-width="2"/>
</g>
</g>
<g class="mountains">
<path class="mountain" d="M0 200 L60 120 L100 160 L160 80 L220 150 L280 100 L340 140 L400 90 L400 200 Z" fill="#1a1520" opacity="0.4"/>
<path class="mountain" d="M0 220 L40 180 L80 200 L140 140 L200 190 L260 150 L320 180 L400 130 L400 220 Z" fill="#15101a" opacity="0.5"/>
<path class="mountain" d="M0 240 L50 210 L100 230 L180 170 L250 210 L320 190 L400 220 L400 240 Z" fill="#10101a" opacity="0.6"/>
</g>
<g class="clouds">
<g class="cloud" transform="translate(50, 50)"><ellipse cx="0" cy="0" rx="30" ry="12" fill="#ffeedd" opacity="0.1"/><ellipse cx="20" cy="-5" rx="20" ry="8" fill="#ffeedd" opacity="0.1"/></g>
<g class="cloud" transform="translate(150, 35)"><ellipse cx="0" cy="0" rx="35" ry="14" fill="#ffeedd" opacity="0.08"/><ellipse cx="25" cy="-3" rx="22" ry="9" fill="#ffeedd" opacity="0.08"/></g>
<g class="cloud" transform="translate(280, 55)"><ellipse cx="0" cy="0" rx="25" ry="10" fill="#ffeedd" opacity="0.1"/></g>
<g class="cloud" transform="translate(380, 40)"><ellipse cx="0" cy="0" rx="28" ry="11" fill="#ffeedd" opacity="0.08"/></g>
<g class="cloud" transform="translate(100, 70)"><ellipse cx="0" cy="0" rx="20" ry="8" fill="#ffeedd" opacity="0.06"/></g>
</g>
<path d="M0 250 Q100 240 200 250 Q300 260 400 245 L400 300 L0 300 Z" fill="url(#groundGrad)"/>
<path class="path" d="M0 260 Q100 250 200 260 Q300 270 400 255" stroke="#ff6b9d" stroke-width="1" fill="none" opacity="0.3"/>
<g class="trees">
<g class="tree" transform="translate(50, 230)"><line x1="0" y1="0" x2="0" y2="-25" stroke="#2a1a10" stroke-width="3"/><path d="M-12 -25 Q0 -45 12 -25 Q0 -30 -12 -25" fill="#1a2a1a" opacity="0.4"/></g>
<g class="tree" transform="translate(350, 225)"><line x1="0" y1="0" x2="0" y2="-30" stroke="#2a1a10" stroke-width="3"/><path d="M-15 -30 Q0 -55 15 -30 Q0 -38 -15 -30" fill="#1a2a1a" opacity="0.4"/></g>
<g class="tree" transform="translate(280, 235)"><line x1="0" y1="0" x2="0" y2="-20" stroke="#2a1a10" stroke-width="2"/><path d="M-8 -20 Q0 -35 8 -20" fill="#1a2a1a" opacity="0.3"/></g>
<g class="tree" transform="translate(120, 238)"><line x1="0" y1="0" x2="0" y2="-18" stroke="#2a1a10" stroke-width="2"/><path d="M-7 -18 Q0 -32 7 -18" fill="#1a2a1a" opacity="0.3"/></g>
</g>

<!-- ★ JS-DRIVEN WALKER -->
<g id="journey-walker" transform="translate(50, 240)">
  <ellipse id="jw-shadow" cx="0" cy="20" rx="8" ry="2" fill="#000" opacity="0.15"/>
  <g id="jw-body">
    <circle id="jw-head" cx="0" cy="-14" r="5" fill="url(#walkerGrad)"/>
    <rect x="-3" y="-8" width="6" height="16" rx="2" fill="url(#walkerGrad)"/>
    <line id="jw-leg-l" x1="-2" y1="8" x2="-5" y2="20" stroke="url(#walkerGrad)" stroke-width="2.5" stroke-linecap="round"/>
    <line id="jw-leg-r" x1="2" y1="8" x2="5" y2="20" stroke="url(#walkerGrad)" stroke-width="2.5" stroke-linecap="round"/>
    <line id="jw-arm-l" x1="-3" y1="0" x2="-8" y2="10" stroke="url(#walkerGrad)" stroke-width="2" stroke-linecap="round"/>
    <line id="jw-arm-r" x1="3" y1="0" x2="8" y2="10" stroke="url(#walkerGrad)" stroke-width="2" stroke-linecap="round"/>
    <line id="jw-staff" x1="6" y1="-5" x2="12" y2="20" stroke="url(#walkerGrad)" stroke-width="1.5" opacity="0.6"/>
  </g>
</g>

<g class="bird-flock" transform="translate(100, 80)">
<g class="bird-small" transform="translate(0, 0)"><path d="M-5 0 Q0 -3 5 0" stroke="#ffeedd" stroke-width="1" fill="none" opacity="0.3"/></g>
<g class="bird-small" transform="translate(15, 5)"><path d="M-4 0 Q0 -2 4 0" stroke="#ffeedd" stroke-width="1" fill="none" opacity="0.25"/></g>
<g class="bird-small" transform="translate(8, -8)"><path d="M-3 0 Q0 -2 3 0" stroke="#ffeedd" stroke-width="1" fill="none" opacity="0.2"/></g>
</g>
<circle class="dust-particle" cx="150" cy="250" r="1" fill="#ffeedd" opacity="0.2"/>
<circle class="dust-particle" cx="220" cy="255" r="1.5" fill="#ffeedd" opacity="0.15"/>
<circle class="dust-particle" cx="180" cy="260" r="1" fill="#ffeedd" opacity="0.2"/>
<circle class="dust-particle" cx="250" cy="248" r="1" fill="#ffeedd" opacity="0.15"/>
<circle class="dust-particle" cx="300" cy="252" r="1.5" fill="#ffeedd" opacity="0.2"/>
<circle class="dust-particle" cx="100" cy="258" r="1" fill="#ffeedd" opacity="0.18"/>
<circle class="dust-particle" cx="340" cy="246" r="1.5" fill="#ffeedd" opacity="0.15"/>
</svg>
</div>

<!-- SCENE 3: BIRD FLIGHT -->
<div class="bg-scene scene-bird" data-scene="2">
<svg viewBox="0 0 400 300" preserveAspectRatio="xMidYMid slice">
<defs>
<linearGradient id="birdSky" x1="0%" y1="0%" x2="0%" y2="100%">
<stop offset="0%" stop-color="#151020"/><stop offset="50%" stop-color="#0a0815"/><stop offset="100%" stop-color="#050508"/>
</linearGradient>
<linearGradient id="birdGrad" x1="0%" y1="0%" x2="100%" y2="100%">
<stop offset="0%" stop-color="#ff6b9d" stop-opacity="0.7"/><stop offset="100%" stop-color="#ffb3cc" stop-opacity="0.4"/>
</linearGradient>
<radialGradient id="sunGlowGrad" cx="50%" cy="50%">
<stop offset="0%" stop-color="#d4af37" stop-opacity="0.4"/><stop offset="100%" stop-color="transparent"/>
</radialGradient>
</defs>
<rect class="sky-gradient" x="0" y="0" width="400" height="300" fill="url(#birdSky)"/>
<circle class="sun-glow" cx="350" cy="50" r="60" fill="url(#sunGlowGrad)"/>
<g class="cloud-layer" transform="translate(0, 30)">
<ellipse cx="50" cy="20" rx="50" ry="20" fill="#ffeedd" opacity="0.05"/>
<ellipse cx="150" cy="40" rx="60" ry="25" fill="#ffeedd" opacity="0.04"/>
<ellipse cx="280" cy="15" rx="45" ry="18" fill="#ffeedd" opacity="0.05"/>
</g>
<g class="cloud-layer" transform="translate(0, 80)">
<ellipse cx="100" cy="30" rx="40" ry="15" fill="#ffeedd" opacity="0.03"/>
<ellipse cx="220" cy="20" rx="55" ry="22" fill="#ffeedd" opacity="0.04"/>
</g>

<!-- ★ JS-DRIVEN MAIN BIRD -->
<g id="bird-main" transform="translate(180, 130)">
  <ellipse id="bird-body" cx="0" cy="0" rx="35" ry="18" fill="url(#birdGrad)"/>
  <circle cx="28" cy="-8" r="12" fill="url(#birdGrad)"/>
  <path d="M40 -8 L55 -10 L40 -6 Z" fill="url(#birdGrad)"/>
  <circle cx="32" cy="-10" r="3" fill="#0a0a0a" opacity="0.5"/>
  <circle cx="33" cy="-11" r="1" fill="#fff" opacity="0.5"/>
   <path id="bird-tail" d="M-35 0 L-60 -8 L-55 0 L-60 8 Z" fill="url(#birdGrad)"/>
  <path id="bird-wing-top" d="M-25 -15 Q-50 -40 -75 -30 Q-50 -20 -25 5 Z" fill="url(#birdGrad)"/>
  <path id="bird-wing-bot" d="M-25 15 Q-50 40 -75 30 Q-50 20 -25 -5 Z" fill="url(#birdGrad)"/>
</g>

<!-- Feathers -->
<path class="feather" d="M80 100 Q90 105 85 115" stroke="#ffb3cc" stroke-width="1.5" fill="none" opacity="0.4"/>
<path class="feather" d="M300 80 Q310 85 305 95" stroke="#ffb3cc" stroke-width="1.5" fill="none" opacity="0.35"/>
<path class="feather" d="M150 150 Q160 155 155 165" stroke="#ffb3cc" stroke-width="1.5" fill="none" opacity="0.4"/>
<path class="feather" d="M250 180 Q260 185 255 195" stroke="#ffb3cc" stroke-width="1.5" fill="none" opacity="0.3"/>
<path class="feather" d="M100 200 Q110 205 105 215" stroke="#ffb3cc" stroke-width="1.5" fill="none" opacity="0.35"/>

<!-- Wind lines -->
<line class="wind-line" x1="20" y1="100" x2="80" y2="100" stroke="#ffeedd" stroke-width="1" opacity="0.1"/>
<line class="wind-line" x1="30" y1="150" x2="100" y2="150" stroke="#ffeedd" stroke-width="1" opacity="0.08"/>
<line class="wind-line" x1="10" y1="200" x2="70" y2="200" stroke="#ffeedd" stroke-width="1" opacity="0.1"/>
<line class="wind-line" x1="40" y1="120" x2="90" y2="120" stroke="#ffeedd" stroke-width="1" opacity="0.06"/>
<line class="wind-line" x1="15" y1="180" x2="75" y2="180" stroke="#ffeedd" stroke-width="1" opacity="0.08"/>

<!-- Distant birds -->
<g class="distant-bird" transform="translate(50, 60)"><path d="M-6 0 Q0 -4 6 0" stroke="#ffeedd" stroke-width="1" fill="none" opacity="0.2"/></g>
<g class="distant-bird" transform="translate(120, 45)"><path d="M-5 0 Q0 -3 5 0" stroke="#ffeedd" stroke-width="1" fill="none" opacity="0.15"/></g>
<g class="distant-bird" transform="translate(320, 70)"><path d="M-4 0 Q0 -2 4 0" stroke="#ffeedd" stroke-width="1" fill="none" opacity="0.2"/></g>

<!-- Leaves -->
<ellipse class="leaf" cx="60" cy="180" rx="4" ry="2" fill="#558b2f" opacity="0.3"/>
<ellipse class="leaf" cx="140" cy="200" rx="3" ry="1.5" fill="#558b2f" opacity="0.25"/>
<ellipse class="leaf" cx="90" cy="220" rx="4" ry="2" fill="#558b2f" opacity="0.3"/>
</svg>
</div>

<!-- SCENE 4: SEED GROWING -->
<div class="bg-scene scene-seed" data-scene="3">
<svg viewBox="0 0 400 300" preserveAspectRatio="xMidYMid slice">
<defs>
<linearGradient id="soilGrad" x1="0%" y1="0%" x2="0%" y2="100%">
<stop offset="0%" stop-color="#3a2515"/><stop offset="50%" stop-color="#2a1a0a"/><stop offset="100%" stop-color="#1a0a05"/>
</linearGradient>
<linearGradient id="stemGrad" x1="0%" y1="100%" x2="0%" y2="0%">
<stop offset="0%" stop-color="#558b2f" stop-opacity="0.6"/><stop offset="100%" stop-color="#a8e6a3" stop-opacity="0.5"/>
</linearGradient>
<radialGradient id="flowerGrad" cx="50%" cy="50%">
<stop offset="0%" stop-color="#ffb3cc" stop-opacity="0.7"/><stop offset="100%" stop-color="#ff6b9d" stop-opacity="0.5"/>
</radialGradient>
<radialGradient id="glowAura" cx="50%" cy="30%">
<stop offset="0%" stop-color="#a8e6a3" stop-opacity="0.15"/><stop offset="100%" stop-color="transparent"/>
</radialGradient>
<linearGradient id="skyGradSeed" x1="0%" y1="0%" x2="0%" y2="100%">
<stop offset="0%" stop-color="#0a0a10"/><stop offset="100%" stop-color="#050508"/>
</linearGradient>
</defs>
<rect x="0" y="0" width="400" height="180" fill="url(#skyGradSeed)"/>
<ellipse class="glow-aura" cx="200" cy="80" rx="100" ry="80" fill="url(#glowAura)"/>
<rect class="soil" x="0" y="200" width="400" height="100" fill="url(#soilGrad)"/>
<g opacity="0.2">
<circle cx="50" cy="220" r="3" fill="#4a3520"/><circle cx="120" cy="235" r="2" fill="#4a3520"/>
<circle cx="200" cy="225" r="4" fill="#4a3520"/><circle cx="280" cy="240" r="2" fill="#4a3520"/>
<circle cx="350" cy="230" r="3" fill="#4a3520"/><circle cx="80" cy="250" r="2" fill="#4a3520"/>
<circle cx="160" cy="260" r="3" fill="#4a3520"/><circle cx="240" cy="255" r="2" fill="#4a3520"/>
<circle cx="320" cy="265" r="2" fill="#4a3520"/>
</g>
<g class="roots" transform="translate(200, 200)">
<g class="root-branch"><path d="M0 0 Q-20 30 -40 50" stroke="#5a3a20" stroke-width="3" fill="none" opacity="0.4"/></g>
<g class="root-branch"><path d="M0 0 Q15 35 30 60" stroke="#5a3a20" stroke-width="3" fill="none" opacity="0.4"/></g>
<g class="root-branch"><path d="M0 0 Q-5 40 -15 70" stroke="#5a3a20" stroke-width="2" fill="none" opacity="0.3"/></g>
<g class="root-branch"><path d="M0 0 Q25 25 45 45" stroke="#5a3a20" stroke-width="2" fill="none" opacity="0.3"/></g>
</g>
<g transform="translate(200, 200)">
<g class="main-stem">
<g class="stem-segment"><path d="M0 0 Q-5 -30 0 -60" stroke="url(#stemGrad)" stroke-width="6" fill="none"/></g>
<g class="stem-segment" transform="translate(0, -60)"><path d="M0 0 Q5 -30 0 -60" stroke="url(#stemGrad)" stroke-width="5" fill="none"/></g>
</g>
<g class="leaves" transform="translate(0, -40)">
<path class="leaf" d="M0 0 Q-35 -15 -45 10 Q-30 15 0 5 Z" fill="url(#stemGrad)"/>
<path class="leaf" d="M0 0 Q35 -15 45 10 Q30 15 0 5 Z" fill="url(#stemGrad)"/>
</g>
<g class="leaves" transform="translate(0, -80)">
<path class="leaf" d="M0 0 Q-30 -10 -40 8 Q-25 12 0 4 Z" fill="url(#stemGrad)"/>
<path class="leaf" d="M0 0 Q30 -10 40 8 Q25 12 0 4 Z" fill="url(#stemGrad)"/>
</g>
<g class="leaves" transform="translate(0, -110)">
<path class="leaf" d="M0 0 Q-25 -8 -35 6 Q-20 10 0 3 Z" fill="url(#stemGrad)"/>
<path class="leaf" d="M0 0 Q25 -8 35 6 Q20 10 0 3 Z" fill="url(#stemGrad)"/>
</g>
</g>
<g transform="translate(200, 75)">
<g class="flower-petals">
<ellipse class="petal" cx="0" cy="-20" rx="12" ry="22" fill="url(#flowerGrad)" style="--r:-20deg"/>
<ellipse class="petal" cx="19" cy="-6" rx="12" ry="22" fill="url(#flowerGrad)" style="--r:20deg" transform="rotate(51)"/>
<ellipse class="petal" cx="12" cy="16" rx="12" ry="22" fill="url(#flowerGrad)" style="--r:20deg" transform="rotate(103)"/>
<ellipse class="petal" cx="-12" cy="16" rx="12" ry="22" fill="url(#flowerGrad)" style="--r:-20deg" transform="rotate(154)"/>
<ellipse class="petal" cx="-19" cy="-6" rx="12" ry="22" fill="url(#flowerGrad)" style="--r:-20deg" transform="rotate(206)"/>
<ellipse class="petal" cx="-19" cy="-6" rx="12" ry="22" fill="url(#flowerGrad)" style="--r:-20deg" transform="rotate(257)"/>
<ellipse class="petal" cx="0" cy="-20" rx="12" ry="22" fill="url(#flowerGrad)" style="--r:-20deg" transform="rotate(309)"/>
<ellipse class="petal" cx="19" cy="-6" rx="12" ry="22" fill="url(#flowerGrad)" style="--r:20deg" transform="rotate(350)"/>
</g>
<circle class="flower-center" cx="0" cy="0" r="10" fill="#d4af37" opacity="0.6"/>
</g>
<circle class="pollen" cx="180" cy="60" r="2" fill="#d4af37" opacity="0.4"/>
<circle class="pollen" cx="220" cy="50" r="1.5" fill="#d4af37" opacity="0.3"/>
<circle class="pollen" cx="200" cy="45" r="2" fill="#d4af37" opacity="0.4"/>
<circle class="pollen" cx="190" cy="70" r="1.5" fill="#d4af37" opacity="0.35"/>
<circle class="pollen" cx="210" cy="55" r="2" fill="#d4af37" opacity="0.4"/>
<ellipse class="water-drop" cx="150" cy="100" rx="2" ry="4" fill="#5588bb" opacity="0.3"/>
<ellipse class="water-drop" cx="250" cy="120" rx="2" ry="4" fill="#5588bb" opacity="0.25"/>
<ellipse class="water-drop" cx="180" cy="140" rx="2" ry="4" fill="#5588bb" opacity="0.3"/>
<ellipse class="water-drop" cx="230" cy="130" rx="2" ry="4" fill="#5588bb" opacity="0.25"/>
<g class="butterfly" transform="translate(80, 100)">
<ellipse class="butterfly-wing" cx="-6" cy="0" rx="6" ry="4" fill="#ff6b9d" opacity="0.4"/>
<ellipse class="butterfly-wing" cx="6" cy="0" rx="6" ry="4" fill="#ff6b9d" opacity="0.4"/>
<ellipse cx="0" cy="0" rx="1.5" ry="4" fill="#993d5e" opacity="0.5"/>
</g>
<g class="butterfly" transform="translate(320, 80)">
<ellipse class="butterfly-wing" cx="-5" cy="0" rx="5" ry="3" fill="#ffb3cc" opacity="0.35"/>
<ellipse class="butterfly-wing" cx="5" cy="0" rx="5" ry="3" fill="#ffb3cc" opacity="0.35"/>
<ellipse cx="0" cy="0" rx="1" ry="3" fill="#993d5e" opacity="0.4"/>
</g>
<g class="grass-group" transform="translate(0, 200)">
<path class="grass" d="M30 0 Q35 -20 30 -35" stroke="#558b2f" stroke-width="2" fill="none" opacity="0.3"/>
<path class="grass" d="M50 0 Q55 -25 50 -40" stroke="#558b2f" stroke-width="2" fill="none" opacity="0.25"/>
<path class="grass" d="M70 0 Q75 -18 70 -32" stroke="#558b2f" stroke-width="2" fill="none" opacity="0.3"/>
<path class="grass" d="M320 0 Q325 -22 320 -38" stroke="#558b2f" stroke-width="2" fill="none" opacity="0.3"/>
<path class="grass" d="M340 0 Q345 -20 340 -35" stroke="#558b2f" stroke-width="2" fill="none" opacity="0.25"/>
</g>
</svg>
</div>
</div><!-- /bg-scenes -->

<div class="scanlines"></div>
<div class="vignette"></div>
<div class="glass-glare"></div>
<div class="scan-bar"></div>
<div class="tracking-bar" id="tracking-bar"></div>
<div class="channel-id" id="channel-disp">AV-1</div>
<div class="rec-ind" id="rec-ind">● REC</div>
<div class="counter" id="counter">▶ 00:00</div>
<div id="screen"></div>
<div class="dlg-box" id="dlg"></div>
</div>
<div class="tv-controls">
<div class="power-section">
<div class="led pwr" id="led-pwr"></div><span class="ctrl-label">PWR</span>
<div class="led play" id="led-play"></div><span class="ctrl-label">PLAY</span>
</div>
<div class="tape-slot" id="tape-slot">
<div class="slot-flap" id="slot-flap"></div>
<span class="slot-label" id="slot-label">▶ DRAG HERE</span>
</div>
<button class="eject-btn" id="eject-btn">⏏ EJECT</button>
<span class="brand-label">SHEEPY™</span>
</div>
</div>
<div class="tape-rack" id="tape-rack"><div class="rack-header">ARCHIVE</div></div>
</div>

<script>
'use strict';
const $=id=>document.getElementById(id);
const sleep=ms=>new Promise(r=>setTimeout(r,ms));
const dbg=msg=>{const d=$('bgm-debug');if(d)d.textContent=msg};
const lerp=(a,b,t)=>a+(b-a)*t;
const smoothstep=(t)=>t*t*(3-2*t);

/* ═══════════════════════════════════════════════════════════════════
   TOUCH EFFECTS
   ═══════════════════════════════════════════════════════════════════ */
const TouchFX={
  init(){
    document.addEventListener('pointerdown',e=>this.ripple(e),{passive:true});
    document.addEventListener('pointerdown',e=>this.glitch(e),{passive:true});
  },
  ripple(e){
    const r=document.createElement('div');
    r.className='touch-ripple';
    r.style.left=(e.clientX-20)+'px';
    r.style.top=(e.clientY-20)+'px';
    r.style.width=r.style.height='40px';
    document.body.appendChild(r);
    setTimeout(()=>r.remove(),800);
  },
  glitch(e){
    if(e.pointerType==='touch'&&e.isPrimary){
      const g=document.createElement('div');
      g.className='glitch-flash';
      document.body.appendChild(g);
      setTimeout(()=>g.remove(),150);
      if(navigator.vibrate)navigator.vibrate(15);
    }
  }
};

/* ═══════════════════════════════════════════════════════════════════
   ★ ENHANCED VHS BACKGROUND — 3x particles, nebula washes, stars
   ═══════════════════════════════════════════════════════════════════ */
const VHS_BG={
  canvas:null,ctx:null,w:0,h:0,
  dust:[],sparks:[],nebulas:[],stars:[],
  glitchTimer:0,raf:0,mouseX:.5,mouseY:.5,
  init(){
    this.canvas=$('vhsCanvas');
    this.ctx=this.canvas.getContext('2d');
    this.resize();
    window.addEventListener('resize',()=>this.resize());
    document.addEventListener('pointermove',e=>{
      this.mouseX=e.clientX/this.w;
      this.mouseY=e.clientY/this.h;
    },{passive:true});
    this.createAll();
    this.draw();
  },
  resize(){this.w=this.canvas.width=window.innerWidth;this.h=this.canvas.height=window.innerHeight;},
  createAll(){
    this.dust=[];this.sparks=[];this.nebulas=[];this.stars=[];
    // 80 flowing dust motes
    for(let i=0;i<80;i++) this.dust.push({
      x:Math.random()*this.w, y:Math.random()*this.h,
      vx:(Math.random()-.5)*.2, vy:-.15-Math.random()*.35,
      sz:1+Math.random()*3, baseOp:.02+Math.random()*.08,
      phase:Math.random()*Math.PI*2, freq:.3+Math.random()*.5,
      hue:Math.random()<.6?'pink':'white'
    });
    // 15 sparks
    for(let i=0;i<15;i++) this.sparks.push({
      x:Math.random()*this.w, y:Math.random()*this.h,
      vx:(Math.random()-.5)*1.5, vy:(Math.random()-.5)*1.5,
      sz:1.5+Math.random(), life:Math.random()*200,maxLife:100+Math.random()*200
    });
    // 4 slow nebula color patches
    for(let i=0;i<4;i++) this.nebulas.push({
      x:Math.random()*this.w, y:Math.random()*this.h,
      vx:(Math.random()-.5)*.15, vy:(Math.random()-.5)*.15,
      r:80+Math.random()*120, phase:Math.random()*Math.PI*2,
      color:['255,107,157','212,175,55','168,230,163','85,136,187'][i]
    });
    // 60 static stars
    for(let i=0;i<60;i++) this.stars.push({
      x:Math.random()*this.w, y:Math.random()*this.h,
      sz:.5+Math.random()*1.5, phase:Math.random()*Math.PI*2,
      speed:.5+Math.random()*2
    });
  },
  draw(){
    const ctx=this.ctx, w=this.w, h=this.h, t=performance.now()*.001;
    if(!w||!h){this.raf=requestAnimationFrame(()=>this.draw());return}

    // Fade trail
    ctx.fillStyle='rgba(5,5,5,.12)';
    ctx.fillRect(0,0,w,h);

    // Stars — twinkling
    for(const s of this.stars){
      const twinkle=.3+.7*(.5+.5*Math.sin(t*s.speed+s.phase));
      ctx.beginPath();ctx.arc(s.x,s.y,s.sz,0,6.28);
      ctx.fillStyle=`rgba(255,255,255,${.03*twinkle})`;ctx.fill();
    }

    // Nebula washes
    for(const n of this.nebulas){
      n.x+=n.vx; n.y+=n.vy;
      if(n.x<-n.r)n.x=w+n.r; if(n.x>w+n.r)n.x=-n.r;
      if(n.y<-n.r)n.y=h+n.r; if(n.y>h+n.r)n.y=-n.r;
      const pulse=.008+.006*Math.sin(t*.3+n.phase);
      const g=ctx.createRadialGradient(n.x,n.y,0,n.x,n.y,n.r);
      g.addColorStop(0,`rgba(${n.color},${pulse})`);
      g.addColorStop(1,'transparent');
      ctx.fillStyle=g;ctx.fillRect(n.x-n.r,n.y-n.r,n.r*2,n.r*2);
    }

    // Dust — organic sine-wave flow
    for(const p of this.dust){
      p.phase+=.008;
      p.x+=p.vx+Math.sin(p.phase*p.freq)*.4;
      p.y+=p.vy;
      // Mouse repulsion
      const dx=p.x-this.mouseX*w, dy=p.y-this.mouseY*h;
      const md=Math.sqrt(dx*dx+dy*dy);
      if(md<150){const f=(150-md)/150*.3;p.x+=dx/md*f;p.y+=dy/md*f;}
      if(p.y<-10){p.y=h+10;p.x=Math.random()*w;}
      if(p.x<-10)p.x=w+10; if(p.x>w+10)p.x=-10;
      const op=p.baseOp*(.7+.3*Math.sin(t*1.5+p.phase));
      ctx.beginPath();ctx.arc(p.x,p.y,p.sz,0,6.28);
      ctx.fillStyle=p.hue==='pink'?`rgba(255,107,157,${op})`:`rgba(255,238,221,${op})`;
      ctx.fill();
    }

    // Sparks
    for(const s of this.sparks){
      s.x+=s.vx; s.y+=s.vy; s.life--;
      if(s.life<=0){s.x=Math.random()*w;s.y=Math.random()*h;s.life=s.maxLife;s.vx=(Math.random()-.5)*1.5;s.vy=(Math.random()-.5)*1.5;}
      const fade=Math.min(s.life/s.maxLife,1)*Math.min((s.maxLife-s.life)/20,1);
      ctx.beginPath();ctx.arc(s.x,s.y,s.sz,0,6.28);
      ctx.fillStyle=`rgba(255,255,255,${.12*fade})`;ctx.fill();
    }

    // Glitch lines
    this.glitchTimer++;
    if(this.glitchTimer%80<4&&Math.random()<.4){
      const y=Math.random()*h;
      ctx.fillStyle=`rgba(255,107,157,${.015+Math.random()*.025})`;
      ctx.fillRect(0,y,w,1+Math.random()*6);
    }
    // Occasional chromatic shift
    if(Math.random()<.015){
      ctx.globalCompositeOperation='screen';
      ctx.fillStyle='rgba(255,50,80,.004)';ctx.fillRect(2,0,w,h);
      ctx.fillStyle='rgba(50,200,255,.004)';ctx.fillRect(-2,0,w,h);
      ctx.globalCompositeOperation='source-over';
    }

    this.raf=requestAnimationFrame(()=>this.draw());
  }
};

/* ═══════════════════════════════════════════════════════════════════
   ★ BALLET DANCER — JS pose interpolation for fluid movement
   ═══════════════════════════════════════════════════════════════════ */
const Ballet={
  els:null, raf:0, active:false, t0:0,
  /* Each pose: [legExtX2,legExtY2, footX,footY, armL_curve, armR_curve, handLx,handLy, handRx,handRy, headTilt, tutuScaleX, bodyTiltDeg, standLegAngle] */
  poses:[
    // 0: Arabesque — leg back, arms extended
    { legExt:[35,40], foot:[40,41], armL:'M-10 8 Q-35 -15 -50 5', armR:'M10 8 Q35 -20 50 -15',
      handL:[-52,7], handR:[52,-17], headTilt:-3, tutuSX:1.0, bodyTilt:5, standAng:0 },
    // 1: Passé — leg tucked, arms crown
    { legExt:[10,20], foot:[12,22], armL:'M-10 8 Q-25 -25 -15 -35', armR:'M10 8 Q25 -25 15 -35',
      handL:[-17,-37], handR:[17,-37], headTilt:0, tutuSX:1.1, bodyTilt:0, standAng:0 },
    // 2: Développé à la seconde — leg side, arms wide
    { legExt:[50,15], foot:[58,16], armL:'M-10 8 Q-40 -5 -55 10', armR:'M10 8 Q40 -5 55 10',
      handL:[-57,12], handR:[57,12], headTilt:3, tutuSX:1.15, bodyTilt:-2, standAng:2 },
    // 3: Port de bras — gentle arch, one arm up
    { legExt:[20,50], foot:[24,53], armL:'M-10 8 Q-30 10 -40 25', armR:'M10 8 Q20 -30 10 -45',
      handL:[-42,27], handR:[12,-47], headTilt:-5, tutuSX:1.05, bodyTilt:3, standAng:-1 },
    // 4: Attitude croisée — leg bent back, classical arms
    { legExt:[-20,25], foot:[-25,28], armL:'M-10 8 Q-35 -10 -45 10', armR:'M10 8 Q30 -25 25 -40',
      handL:[-47,12], handR:[27,-42], headTilt:-2, tutuSX:1.0, bodyTilt:4, standAng:1 },
    // 5: Fifth position relevé — tight, both legs close, arms rounded
    { legExt:[5,60], foot:[6,63], armL:'M-10 8 Q-20 -15 -18 -28', armR:'M10 8 Q20 -15 18 -28',
      handL:[-20,-30], handR:[20,-30], headTilt:0, tutuSX:.95, bodyTilt:0, standAng:0 },
  ],
  init(){
    this.els={
      group: $('ballet-dancer'),
      legLine: $('b-leg-ext-line'),
      foot: $('b-foot-ext'),
      tutu: $('b-tutu'),
      armL: $('b-arm-l'), handL: $('b-hand-l'),
      armR: $('b-arm-r'), handR: $('b-hand-r'),
      head: $('b-head'),
      shadow: $('b-shadow'),
    };
    if(!this.els.group) return;
    this.t0=performance.now();
  },
  start(){
    if(this.active||!this.els?.group) return;
    this.active=true; this.loop();
  },
  stop(){ this.active=false; cancelAnimationFrame(this.raf); },
  loop(){
    if(!this.active) return;
    const now=performance.now();
    const elapsed=(now-this.t0)*.001;

    // Cycle through poses: each pose lasts ~4s with 1.5s transition
    const poseDur=4, transDur=1.8;
    const totalCycle=this.poses.length*poseDur;
    const cycleT=elapsed%totalCycle;
    const poseIdx=Math.floor(cycleT/poseDur)%this.poses.length;
    const nextIdx=(poseIdx+1)%this.poses.length;
    const poseProgress=(cycleT%poseDur)/poseDur;

    // Smooth transition in first portion of each pose
    const transRatio=transDur/poseDur;
    let t=poseProgress<transRatio ? smoothstep(poseProgress/transRatio) : 1;

    const A=this.poses[poseIdx], B=this.poses[nextIdx];

    // Breathing overlay
    const breath=Math.sin(elapsed*1.2)*.8;
    // Gentle sway
    const sway=Math.sin(elapsed*.7)*1.5;

    // Interpolate leg
    const lx=lerp(A.legExt[0],B.legExt[0],t);
    const ly=lerp(A.legExt[1],B.legExt[1],t);
    this.els.legLine.setAttribute('x2',lx);
    this.els.legLine.setAttribute('y2',ly);
    const fx=lerp(A.foot[0],B.foot[0],t);
    const fy=lerp(A.foot[1],B.foot[1],t);
    this.els.foot.setAttribute('cx',fx+5);
    this.els.foot.setAttribute('cy',fy+1);

    // Arms — interpolate path d attribute via control points
    this.els.armL.setAttribute('d', t<1 ? this.lerpPath(A.armL, B.armL, t) : B.armL);
    this.els.armR.setAttribute('d', t<1 ? this.lerpPath(A.armR, B.armR, t) : B.armR);

    // Hands
    this.els.handL.setAttribute('cx', lerp(A.handL[0],B.handL[0],t));
    this.els.handL.setAttribute('cy', lerp(A.handL[1],B.handL[1],t)+breath*.3);
    this.els.handR.setAttribute('cx', lerp(A.handR[0],B.handR[0],t));
    this.els.handR.setAttribute('cy', lerp(A.handR[1],B.handR[1],t)+breath*.3);

    // Head tilt with follow-through delay
    const headT=Math.max(0,Math.min(1,(poseProgress-.05)/transRatio));
    const ht=lerp(A.headTilt,B.headTilt,smoothstep(headT))+sway*.3;
    this.els.head.setAttribute('transform',`rotate(${ht})`);

    // Tutu reactive to movement
    const tsx=lerp(A.tutuSX,B.tutuSX,t)+Math.sin(elapsed*2)*.02;
    this.els.tutu.setAttribute('rx',30*tsx);

    // Body tilt
    const bt=lerp(A.bodyTilt,B.bodyTilt,t)+sway+breath*.3;
    this.els.group.setAttribute('transform',`translate(200,${155+breath}) rotate(${bt} 0 30)`);

    // Shadow responds
    const sr=28+Math.abs(bt)*.5;
    this.els.shadow.setAttribute('rx',sr);
    this.els.shadow.setAttribute('opacity',.15+.05*Math.cos(elapsed));

    this.raf=requestAnimationFrame(()=>this.loop());
  },
  // Interpolate SVG path string (for Q curves with same structure)
  lerpPath(pathA, pathB, t){
    const numsA=pathA.match(/-?\d+\.?\d*/g).map(Number);
    const numsB=pathB.match(/-?\d+\.?\d*/g).map(Number);
    if(numsA.length!==numsB.length) return t<.5?pathA:pathB;
    const result=numsA.map((a,i)=>lerp(a,numsB[i],t).toFixed(1));
    let idx=0;
    return pathA.replace(/-?\d+\.?\d*/g,()=>result[idx++]);
  }
};

/* ═══════════════════════════════════════════════════════════════════
   ★ JOURNEY WALKER — JS-driven walking with proper gait
   ═══════════════════════════════════════════════════════════════════ */
const Walker={
  el:null, body:null, legL:null, legR:null, armL:null, armR:null, head:null,
  raf:0, active:false, x:0, speed:.12,
  init(){
    this.el=$('journey-walker');
    this.legL=$('jw-leg-l'); this.legR=$('jw-leg-r');
    this.armL=$('jw-arm-l'); this.armR=$('jw-arm-r');
    this.head=$('jw-head'); this.body=$('jw-body');
  },
  start(){
    if(this.active||!this.el) return;
    this.active=true; this.x=-30; this.loop();
  },
  stop(){ this.active=false; cancelAnimationFrame(this.raf); },
  loop(){
    if(!this.active) return;
    const t=performance.now()*.001;
    this.x+=this.speed;
    if(this.x>430) this.x=-30;

    // Walking gait
    const stride=Math.sin(t*4)*12;
    const bob=Math.abs(Math.sin(t*4))*-2.5;

    this.el.setAttribute('transform',`translate(${this.x},${240+bob})`);

    // Legs swing
    this.legL.setAttribute('x2',-2+stride*.3);
    this.legL.setAttribute('y2',20+Math.abs(stride)*.15);
    this.legR.setAttribute('x2',2-stride*.3);
    this.legR.setAttribute('y2',20+Math.abs(-stride)*.15);

    // Arms counter-swing
    this.armL.setAttribute('x2',-8-stride*.25);
    this.armL.setAttribute('y2',10+stride*.15);
    this.armR.setAttribute('x2',8+stride*.25);
    this.armR.setAttribute('y2',10-stride*.15);

    // Head gentle bob
    this.head.setAttribute('cy',-14+bob*.3);

    this.raf=requestAnimationFrame(()=>this.loop());
  }
};

/* ═══════════════════════════════════════════════════════════════════
   ★ BIRD FLIGHT — JS-driven soaring with wing beats
   ═══════════════════════════════════════════════════════════════════ */
const BirdFly={
  el:null, wingTop:null, wingBot:null, tail:null,
  raf:0, active:false,
  init(){
    this.el=$('bird-main');
    this.wingTop=$('bird-wing-top');
    this.wingBot=$('bird-wing-bot');
    this.tail=$('bird-tail');
  },
  start(){
    if(this.active||!this.el) return;
    this.active=true; this.loop();
  },
  stop(){ this.active=false; cancelAnimationFrame(this.raf); },
  loop(){
    if(!this.active) return;
    const t=performance.now()*.001;

    // Soaring figure-8 path
    const px=180+Math.sin(t*.25)*60;
    const py=130+Math.sin(t*.4)*25+Math.cos(t*.15)*10;
    const tilt=Math.cos(t*.25)*8;
    this.el.setAttribute('transform',`translate(${px},${py}) rotate(${tilt})`);

    // Wing beats — glide then flap rhythm
    const flapCycle=t*3;
    const glidePhase=Math.sin(t*.5);
    let wingAngle;
    if(glidePhase>0.3){
      // Gliding — wings mostly still
      wingAngle=Math.sin(flapCycle)*5;
    } else {
      // Flapping
      wingAngle=Math.sin(flapCycle*2.5)*30;
    }
    this.wingTop.setAttribute('transform',`rotate(${-wingAngle} -25 -5)`);
    this.wingBot.setAttribute('transform',`rotate(${wingAngle} -25 5)`);

    // Tail wag
    const tailWag=Math.sin(t*1.5)*5;
    this.tail.setAttribute('transform',`rotate(${tailWag} -35 0)`);

    this.raf=requestAnimationFrame(()=>this.loop());
  }
};

/* ═══════════════════════════════════════════════════════════════════
   BACKGROUND SCENES MANAGER
   ═══════════════════════════════════════════════════════════════════ */
const BgScenes={
  container:null,scenes:[],current:0,timer:null,duration:10000,active:false,
  init(){
    this.container=$('bg-scenes');
    this.scenes=Array.from(this.container.querySelectorAll('.bg-scene'));
    Ballet.init(); Walker.init(); BirdFly.init();
    this.show(0);
  },
  show(idx){
    this.scenes.forEach((s,i)=>s.classList.toggle('active',i===idx));
    // Start/stop JS animation engines per scene
    Ballet.stop(); Walker.stop(); BirdFly.stop();
    if(idx===0) Ballet.start();
    else if(idx===1) Walker.start();
    else if(idx===2) BirdFly.start();
    this.current=idx;
  },
  next(){this.show((this.current+1)%this.scenes.length)},
  start(){
    if(this.active)return;
    this.active=true;
    this.container.classList.add('active');
    $('ambient-rays').classList.add('on');
    this.show(this.current);
    this.timer=setInterval(()=>this.next(),this.duration);
  },
  stop(){
    this.active=false;
    this.container.classList.remove('active');
    $('ambient-rays').classList.remove('on');
    Ballet.stop(); Walker.stop(); BirdFly.stop();
    if(this.timer)clearInterval(this.timer);
    this.timer=null;
  }
};

/* ═══════════════════════════════════════════════════════════════════
   DOM REFS
   ═══════════════════════════════════════════════════════════════════ */
const D={
  boot:$('boot-overlay'),prompt:$('boot-prompt'),audioBtn:$('audio-btn'),
  particles:$('particles'),station:$('station'),bezel:$('screen-bezel'),
  crt:$('crt'),fx:$('fx'),warmup:$('warmup'),glow:$('screen-glow'),screen:$('screen'),
  channel:$('channel-disp'),rec:$('rec-ind'),counter:$('counter'),
  tracking:$('tracking-bar'),slot:$('tape-slot'),slotLabel:$('slot-label'),
  ledPwr:$('led-pwr'),ledPlay:$('led-play'),dlg:$('dlg'),rack:$('tape-rack'),eject:$('eject-btn')
};

/* ═══════════════════════════════════════════════════════════════════
   STATE
   ═══════════════════════════════════════════════════════════════════ */
const KEY='seed_archive_v3';
const loadState=()=>{try{return JSON.parse(localStorage.getItem(KEY))||{}}catch{return{}}};
const isDone=t=>{const s=loadState();return!!(s[t]&&s[t].complete)};
const countDone=()=>TAPES.filter(t=>isDone(t.id)).length;
const allDone=()=>TAPES.every(t=>isDone(t.id));
const REQS={tape1:[],tape2:['tape1'],tape3:['tape2'],tape4:['tape1','tape2','tape3'],tape5:['tape1','tape2','tape3','tape4']};
const canPlay=id=>(REQS[id]||[]).every(isDone);
const TAPES=[
  {id:'tape1',title:'SIDE A: Soil',color:'#8B7355',glow:'rgba(139,115,85,.07)',file:'tape1.html',rating:'9.2/10',desc:'Where it all began'},
  {id:'tape2',title:'SIDE B: Rain',color:'#5588bb',glow:'rgba(85,136,187,.07)',file:'tape2.html',rating:'9.5/10',desc:'Weathering the storms'},
  {id:'tape3',title:'SIDE C: Thorns',color:'#884466',glow:'rgba(136,68,102,.07)',file:'tape3.html',rating:'9.8/10',desc:'Confronting the walls'},
  {id:'tape4',title:'SIDE D: Bloom',color:'#ff6b9d',glow:'rgba(255,107,157,.07)',file:'tape4.html',rating:'10/10',desc:'The answer'},
  {id:'tape5',title:'???: Seasons',color:'#a8e6a3',glow:'rgba(168,230,163,.07)',file:'tape5.html',locked:true,rating:'???',desc:'The future'}
];
let booted=false,inserting=false,bootDone=false,dlgTimer=0,bgmStarted=false;

/* Screen Fade */
async function fadeToScreen(buildFn){
  D.screen.classList.add('fade-out');
  D.screen.classList.remove('fade-in');
  await sleep(1000);
  D.screen.innerHTML='';
  buildFn();
  D.screen.classList.remove('fade-out');
  D.screen.classList.add('fade-in');
  await sleep(1000);
}

/* ═══════════════════════════════════════════════════════════════════
   AUDIO ENGINE
   ═══════════════════════════════════════════════════════════════════ */
const Snd={
  ctx:null,master:null,clickBuf:null,bgm:null,bgmFadeId:0,bgmFading:false,on:false,
  humOsc:null,humGain:null,bgmReady:false,bgmAudio:null,
  init(){
    if(this.ctx)return;
    this.ctx=new(window.AudioContext||window.webkitAudioContext)();
    this.master=this.ctx.createGain();this.master.gain.value=0;
    this.master.connect(this.ctx.destination);
    const sr=this.ctx.sampleRate,len=sr*.008|0;
    this.clickBuf=this.ctx.createBuffer(1,len,sr);
    const d=this.clickBuf.getChannelData(0);
    for(let i=0;i<len;i++)d[i]=(.5-Math.random())*.15*Math.exp(-i/(len*.15));
  },
  resume(){if(this.ctx?.state==='suspended')this.ctx.resume()},
  vol(v){if(!this.master)return;const t=this.ctx.currentTime;this.master.gain.cancelScheduledValues(t);this.master.gain.setValueAtTime(this.master.gain.value,t);this.master.gain.linearRampToValueAtTime(v,t+.4)},
  note(f,dur,type='triangle',vol=.06){if(!this.ctx)return;const o=this.ctx.createOscillator(),g=this.ctx.createGain(),t=this.ctx.currentTime;o.type=type;o.frequency.value=f;g.gain.setValueAtTime(.001,t);g.gain.linearRampToValueAtTime(vol,t+.01);g.gain.exponentialRampToValueAtTime(.001,t+dur);o.connect(g);g.connect(this.master);o.start();o.stop(t+dur+.05)},
  noise(dur,vol=.06){if(!this.ctx)return;const sz=this.ctx.sampleRate*dur|0,buf=this.ctx.createBuffer(1,sz,this.ctx.sampleRate),d=buf.getChannelData(0);for(let i=0;i<sz;i++)d[i]=Math.random()*2-1;const s=this.ctx.createBufferSource(),g=this.ctx.createGain(),t=this.ctx.currentTime;s.buffer=buf;g.gain.setValueAtTime(vol,t);g.gain.exponentialRampToValueAtTime(.001,t+dur);s.connect(g);g.connect(this.master);s.start()},
  typeClick(){if(!this.ctx||!this.clickBuf)return;const s=this.ctx.createBufferSource();s.buffer=this.clickBuf;s.connect(this.master);s.start()},
  startHum(){if(!this.ctx||this.humOsc)return;this.humOsc=this.ctx.createOscillator();this.humGain=this.ctx.createGain();this.humOsc.type='sine';this.humOsc.frequency.value=60;this.humGain.gain.value=.008;this.humOsc.connect(this.humGain);this.humGain.connect(this.master);this.humOsc.start()},
  stopHum(){if(this.humOsc){this.humOsc.stop();this.humOsc=null;this.humGain=null}},
  sfxPowerOn(){this.noise(.4,.16);this.note(220,.12,'square',.1);setTimeout(()=>this.note(55,.15,'sawtooth',.07),80)},
  sfxClunk(){this.note(70,.15,'square',.12);this.noise(.06,.1);setTimeout(()=>this.note(45,.12,'sawtooth',.08),50)},
  sfxSnap(){this.note(700,.04,'sine',.08);setTimeout(()=>this.note(180,.05,'sine',.05),30)},
  sfxWhoosh(){this.noise(.15,.03);this.note(200,.08,'sine',.02);this.note(400,.06,'sine',.015)},
  sfxMotor(){if(!this.ctx)return;const t=this.ctx.currentTime;const o=this.ctx.createOscillator(),g=this.ctx.createGain();const lfo=this.ctx.createOscillator(),lg=this.ctx.createGain();o.type='sawtooth';o.frequency.value=55;lfo.type='sine';lfo.frequency.value=2.5;lg.gain.value=1.8;lfo.connect(lg);lg.connect(o.frequency);g.gain.setValueAtTime(.03,t);g.gain.linearRampToValueAtTime(0,t+1.2);o.connect(g);g.connect(this.master);o.start();lfo.start();o.stop(t+1.3);lfo.stop(t+1.3)},
  sfxHover(){this.note(800,.025,'sine',.018)},
  sfxReady(){this.note(440,.15,'sine',.04);setTimeout(()=>this.note(550,.15,'sine',.04),120);setTimeout(()=>this.note(660,.2,'sine',.04),240)},
  sfxGlitch(){this.noise(.08,.05);this.note(150+Math.random()*100,.06,'sawtooth',.03)},
  sfxTape(id){if(id==='tape1'){this.note(55,.7,'sine',.07);this.note(82,.6,'triangle',.04);this.noise(.35,.035)}else if(id==='tape2'){for(let i=0;i<7;i++)setTimeout(()=>this.note(600+Math.random()*900,.05,'sine',.03),i*65)}else if(id==='tape3'){this.note(110,.9,'sawtooth',.055);this.note(117,.9,'square',.035);this.note(55,.7,'square',.04)}else if(id==='tape4'){this.note(262,.55,'sine',.055);setTimeout(()=>this.note(330,.55,'sine',.055),180);setTimeout(()=>this.note(392,.7,'sine',.055),360)}else if(id==='tape5'){for(let i=0;i<5;i++)setTimeout(()=>this.note(220*Math.pow(1.5,i),.9,'sine',.035),i*220)}},
  preloadBGM(){if(this.bgmAudio)return;dbg('BGM: preloading...');const a=new window.Audio();a.loop=true;a.volume=0;a.preload='auto';const onReady=()=>{a.removeEventListener('canplay',onReady);a.removeEventListener('loadeddata',onReady);this.bgmReady=true;dbg('BGM: ready ✓')};a.addEventListener('canplay',onReady,{once:true});a.addEventListener('loadeddata',onReady,{once:true});a.addEventListener('error',()=>{dbg('BGM: preload error')});a.src='MEMORY.mp3';this.bgmAudio=a},
  playBGM(){if(!this.bgmAudio||!this.bgmReady){dbg('BGM: not ready');return}if(bgmStarted)return;bgmStarted=true;const a=this.bgmAudio;cancelAnimationFrame(this.bgmFadeId);this.bgmFading=false;dbg('BGM: starting...');try{a.currentTime=8.0}catch(e){dbg('BGM: seek fail')}a.play().then(()=>{dbg('BGM: playing ✓');this.bgm=a;const fade=()=>{if(!this.bgm||this.bgmFading)return;if(this.bgm.volume<.18){this.bgm.volume=Math.min(this.bgm.volume+.0015,.18);this.bgmFadeId=requestAnimationFrame(fade)}else dbg('BGM: full volume')};this.bgmFadeId=requestAnimationFrame(fade)}).catch(()=>{dbg('BGM: play fail')})},
  stopBGM(){if(!this.bgm)return;cancelAnimationFrame(this.bgmFadeId);this.bgmFading=true;const a=this.bgm;this.bgm=null;const fade=()=>{if(a.volume>.005){a.volume=Math.max(a.volume-.003,0);requestAnimationFrame(fade)}else{a.pause();a.currentTime=0;dbg('BGM: stopped')}};requestAnimationFrame(fade)},
  ensure(){this.init();this.resume();if(!this.on){this.on=true;this.vol(.35);this.startHum();D.audioBtn.textContent='♪ ON';D.audioBtn.classList.add('on');this.preloadBGM()}},
  toggle(){this.init();this.resume();this.on=!this.on;this.vol(this.on?.35:0);if(this.on){if(!this.bgm&&this.bgmReady)this.playBGM();this.startHum()}else{this.stopBGM();this.stopHum()}D.audioBtn.textContent=this.on?'♪ ON':'♪ OFF';D.audioBtn.classList.toggle('on',this.on)}
};

/* ═══════════════════════════════════════════════════════════════════
   CRT NOISE
   ═══════════════════════════════════════════════════════════════════ */
const CRT={
  ctx:null,fxCtx:null,w:0,h:0,fxW:0,fxH:0,noiseTex:null,burstTex:null,isBurst:false,rafId:0,resizeTimer:0,
  genTex(density){const c=document.createElement('canvas');c.width=512;c.height=512;const ctx=c.getContext('2d'),img=ctx.createImageData(512,512);const buf=new Uint32Array(img.data.buffer);const dk=0xFF080808,cols=[0xFF2A3028,0xFF282820,0xFF2C2A26,0xFF262830,0xFF302826];for(let i=0;i<buf.length;i++)buf[i]=Math.random()<density?cols[Math.random()*5|0]:dk;ctx.putImageData(img,0,0);return c},
  init(){this.ctx=D.crt.getContext('2d',{alpha:false});this.fxCtx=D.fx.getContext('2d',{alpha:true});this.noiseTex=this.genTex(.08);this.burstTex=this.genTex(.55);this.resize();window.addEventListener('resize',()=>{clearTimeout(this.resizeTimer);this.resizeTimer=setTimeout(()=>this.resize(),150)});this.draw()},
  resize(){const r=D.bezel.getBoundingClientRect();this.w=D.crt.width=Math.min(r.width*.5,400)|0;this.h=D.crt.height=Math.min(r.height*.5,300)|0;this.fxW=D.fx.width=r.width|0;this.fxH=D.fx.height=r.height|0},
  burst(dur=350){this.isBurst=true;setTimeout(()=>this.isBurst=false,dur)},
  draw(){if(this.w&&this.h){const tex=this.isBurst?this.burstTex:this.noiseTex;const ox=Math.random()*(512-this.w)|0,oy=Math.random()*(512-this.h)|0;this.ctx.drawImage(tex,ox,oy,this.w,this.h,0,0,this.w,this.h);if(Math.random()<.03){const y=Math.random()*this.h|0,bh=2+Math.random()*6|0,shift=(Math.random()-.5)*20|0;this.ctx.drawImage(D.crt,0,y,this.w,bh,shift,y,this.w,bh)}}this.rafId=requestAnimationFrame(()=>this.draw())},
  stop(){cancelAnimationFrame(this.rafId)}
};

/* ═══════════════════════════════════════════════════════════════════
   FX TRANSITIONS
   ═══════════════════════════════════════════════════════════════════ */
const FX={
  rafId:0,active:false,
  start(tapeId){this.stop();this.active=true;D.fx.classList.add('on');CRT.resize();const ctx=CRT.fxCtx,w=CRT.fxW,h=CRT.fxH;if(!w||!h)return;const N=tapeId==='tape2'?40:tapeId==='tape5'?35:25;const pts=Array.from({length:N},()=>({x:Math.random()*w,y:tapeId==='tape2'?-Math.random()*h:h+Math.random()*50,vx:(Math.random()-.5)*1.5,vy:tapeId==='tape2'?1+Math.random()*3:-(1+Math.random()*3),sz:2+Math.random()*4,a:.3+Math.random()*.5,rot:Math.random()*Math.PI*2,rv:(Math.random()-.5)*.1}));const t0=performance.now();const render=now=>{if(!this.active)return;const p=Math.min((now-t0)/5000,1);ctx.clearRect(0,0,w,h);const fade=p>.8?1-(p-.8)/.2:Math.min(p/.2,1);if(tapeId==='tape1'){const g=ctx.createLinearGradient(0,h,0,0);g.addColorStop(0,'rgba(139,115,85,.12)');g.addColorStop(1,'transparent');ctx.fillStyle=g;ctx.fillRect(0,0,w,h);ctx.fillStyle='#8B7355';for(const pt of pts){pt.y+=pt.vy*.4;pt.x+=pt.vx*.15;ctx.globalAlpha=pt.a*fade;ctx.beginPath();ctx.arc(pt.x,pt.y,pt.sz,0,6.28);ctx.fill()}}else if(tapeId==='tape2'){ctx.strokeStyle='rgba(85,136,187,.5)';ctx.lineWidth=1.5;for(const pt of pts){pt.y+=pt.vy*.6;pt.x+=pt.vx*.1;if(pt.y>h){pt.y=-5;pt.x=Math.random()*w}ctx.globalAlpha=pt.a*fade*.6;ctx.beginPath();ctx.moveTo(pt.x,pt.y);ctx.lineTo(pt.x-pt.vx,pt.y-12);ctx.stroke()}}else if(tapeId==='tape3'){const cx=w/2,cy=h/2;const g=ctx.createRadialGradient(cx,cy,0,cx,cy,Math.max(w,h)*.6);g.addColorStop(0,'transparent');g.addColorStop(1,'rgba(136,68,102,.1)');ctx.fillStyle=g;ctx.fillRect(0,0,w,h);ctx.fillStyle='#884466';for(const pt of pts){const dx=cx-pt.x,dy=cy-pt.y,d=Math.sqrt(dx*dx+dy*dy)||1;pt.x+=dx/d;pt.y+=dy/d;pt.rot+=pt.rv;ctx.save();ctx.translate(pt.x,pt.y);ctx.rotate(pt.rot);ctx.globalAlpha=pt.a*fade;ctx.beginPath();ctx.moveTo(0,-pt.sz);ctx.lineTo(pt.sz*.6,0);ctx.lineTo(0,pt.sz);ctx.lineTo(-pt.sz*.6,0);ctx.closePath();ctx.fill();ctx.restore()}}else if(tapeId==='tape4'){const cx=w/2,cy=h/2,rad=Math.min(w,h)*.4*p;const g=ctx.createRadialGradient(cx,cy,0,cx,cy,rad||1);g.addColorStop(0,'rgba(255,107,157,.12)');g.addColorStop(1,'transparent');ctx.fillStyle=g;ctx.fillRect(0,0,w,h);ctx.fillStyle='rgba(255,180,200,.4)';for(const pt of pts){pt.y+=pt.vy*.35;pt.x+=Math.sin(pt.rot)*.8;pt.rot+=pt.rv;ctx.save();ctx.translate(pt.x,pt.y);ctx.rotate(pt.rot);ctx.globalAlpha=pt.a*fade*.5;ctx.beginPath();ctx.ellipse(0,0,pt.sz,pt.sz*.5,0,0,6.28);ctx.fill();ctx.restore()}}else if(tapeId==='tape5'){const cols=['#8B7355','#5588bb','#884466','#ff6b9d','#a8e6a3'];const ci=Math.floor((p*4)%5);ctx.fillStyle=cols[ci];for(const pt of pts){pt.y+=pt.vy*.4;pt.x+=Math.sin(pt.rot+p*4);pt.rot+=pt.rv;ctx.globalAlpha=pt.a*fade*.4;ctx.beginPath();ctx.arc(pt.x,pt.y,pt.sz,0,6.28);ctx.fill()}}ctx.globalAlpha=1;if(p<1)this.rafId=requestAnimationFrame(render);else this.stop()};this.rafId=requestAnimationFrame(render)},
  stop(){this.active=false;cancelAnimationFrame(this.rafId);D.fx.classList.remove('on');if(CRT.fxCtx&&CRT.fxW)CRT.fxCtx.clearRect(0,0,CRT.fxW,CRT.fxH)}
};

/* ═══════════════════════════════════════════════════════════════════
   ★ ENHANCED PARTICLE POOL — Canvas-based for smooth flow
   ═══════════════════════════════════════════════════════════════════ */
const Dust={
  canvas:null,ctx:null,w:0,h:0,
  particles:[],raf:0,active:false,COUNT:120,
  init(){
    this.canvas=document.createElement('canvas');
    this.canvas.style.cssText='position:fixed;inset:0;width:100%;height:100%;pointer-events:none;z-index:1';
    D.particles.appendChild(this.canvas);
    this.ctx=this.canvas.getContext('2d');
    this.resize();
    window.addEventListener('resize',()=>this.resize());
    for(let i=0;i<this.COUNT;i++){
      this.particles.push({
        x:Math.random()*this.w,
        y:Math.random()*this.h,
        vx:(Math.random()-.5)*.3,
        vy:-.3-Math.random()*.8,
        sz:1.5+Math.random()*4,
        opacity:.04+Math.random()*.1,
        phase:Math.random()*Math.PI*2,
        freq:.2+Math.random()*.6,
        color:Math.random()<.5?[255,107,157]:[255,238,221],
        wobble:.5+Math.random()*1.5
      });
    }
  },
  resize(){
    this.w=this.canvas.width=window.innerWidth;
    this.h=this.canvas.height=window.innerHeight;
  },
  start(){
    if(this.active)return;
    this.active=true;
    this.loop();
  },
  stop(){this.active=false;cancelAnimationFrame(this.raf)},
  loop(){
    if(!this.active)return;
    const ctx=this.ctx,w=this.w,h=this.h;
    ctx.clearRect(0,0,w,h);
    const t=performance.now()*.001;
    for(const p of this.particles){
      p.phase+=.005;
      p.x+=p.vx+Math.sin(p.phase*p.freq)*p.wobble*.3;
      p.y+=p.vy;
      if(p.y<-20){p.y=h+20;p.x=Math.random()*w;}
      if(p.x<-20)p.x=w+20;
      if(p.x>w+20)p.x=-20;
      const breathe=.6+.4*Math.sin(t+p.phase);
      const op=p.opacity*breathe;
      ctx.beginPath();
      ctx.arc(p.x,p.y,p.sz,0,6.28);
      ctx.fillStyle=`rgba(${p.color[0]},${p.color[1]},${p.color[2]},${op})`;
      ctx.fill();
    }
    this.raf=requestAnimationFrame(()=>this.loop());
  }
};

/* ═══════════════════════════════════════════════════════════════════
   UI HELPERS
   ═══════════════════════════════════════════════════════════════════ */
const UI={
  async typeInto(el,text,spd=22){for(let i=0;i<text.length;i++){el.textContent+=text[i];Snd.typeClick();await sleep(spd)}},
  showDlg(text,dur=0){clearTimeout(dlgTimer);D.dlg.textContent=text;D.dlg.classList.add('vis');if(dur)dlgTimer=setTimeout(()=>D.dlg.classList.remove('vis'),dur)},
  hideDlg(){clearTimeout(dlgTimer);D.dlg.classList.remove('vis')},
  screenClear(){D.screen.innerHTML=''},
  screenNoSignal(){this.screenClear();const m=document.createElement('div');m.className='screen-msg';m.textContent='NO SIGNAL';D.screen.appendChild(m);D.channel.textContent='AV-1'},
  setGlow(rgba){D.glow.style.background=`radial-gradient(ellipse,${rgba} 0%,transparent 60%)`},
  glitch(){Snd.sfxGlitch();D.bezel.classList.add('shake');setTimeout(()=>D.bezel.classList.remove('shake'),200)}
};

let cIv=0,cSec=0;
const startCounter=()=>{cSec=0;D.counter.classList.add('on');cIv=setInterval(()=>{cSec++;D.counter.textContent='▶ '+String(cSec/60|0).padStart(2,'0')+':'+String(cSec%60).padStart(2,'0')},1000)};
const stopCounter=()=>{clearInterval(cIv);D.counter.classList.remove('on')};

/* ═══════════════════════════════════════════════════════════════════
   SHEEPY SVG
   ═══════════════════════════════════════════════════════════════════ */
const sheepySVG=(size,hold=false,expr='nervous')=>{
  const M={happy:'M-5 2 Q0 8 5 2',sad:'M-5 5 Q0 0 5 5',nervous:'M-4 4 Q-2 2 0 4 Q2 6 4 4',neutral:'M-4 3 L4 3'};
  return `<svg width="${size}" height="${size}" viewBox="0 0 120 120" style="animation:bounce 2.5s infinite"><ellipse cx="60" cy="75" rx="34" ry="28" fill="#f5f5f5"/><ellipse cx="40" cy="70" rx="11" ry="9" fill="#fafafa"/><ellipse cx="80" cy="70" rx="11" ry="9" fill="#fafafa"/><ellipse cx="55" cy="62" rx="9" ry="7" fill="#fafafa"/><ellipse cx="65" cy="62" rx="9" ry="7" fill="#fafafa"/><ellipse cx="60" cy="35" rx="20" ry="16" fill="#ffeef5"/><ellipse cx="35" cy="28" rx="7" ry="4" fill="#ffc0cb" transform="rotate(-18 35 28)"/><ellipse cx="85" cy="28" rx="7" ry="4" fill="#ffc0cb" transform="rotate(18 85 28)"/><ellipse cx="50" cy="33" rx="4" ry="5" fill="#222"><animate attributeName="ry" values="5;5;.5;5;5" keyTimes="0;.45;.5;.55;1" dur="4s" repeatCount="indefinite"/></ellipse><ellipse cx="70" cy="33" rx="4" ry="5" fill="#222"><animate attributeName="ry" values="5;5;.5;5;5" keyTimes="0;.45;.5;.55;1" dur="4s" repeatCount="indefinite"/></ellipse><circle cx="52" cy="31" r="1.5" fill="#fff"/><circle cx="72" cy="31" r="1.5" fill="#fff"/><ellipse cx="60" cy="42" rx="3" ry="2" fill="#ff8fab"/><g transform="translate(60 50)"><path d="${M[expr]||M.neutral}" stroke="#ff8fab" stroke-width="1.5" fill="none" stroke-linecap="round"/></g>${hold?'<g transform="translate(82 55)"><rect width="20" height="14" rx="1" fill="#fff5e6" stroke="#ff69b4"/><path d="M0 0 L10 7 L20 0" stroke="#ff69b4" fill="none"/><circle cx="10" cy="7" r="2.5" fill="#ff69b4"/></g>':''}</svg>`;
};

/* ═══════════════════════════════════════════════════════════════════
   SHEEPY INTRO
   ═══════════════════════════════════════════════════════════════════ */
async function showSheepyIntro(){
  Snd.sfxWhoosh();
  await fadeToScreen(()=>{
    const wrap=document.createElement('div');wrap.className='sheepy-intro';
    const glow=document.createElement('div');glow.className='sheepy-glow';
    const txt=document.createElement('div');txt.className='intro-line';txt.id='introLine';
    wrap.appendChild(glow);wrap.appendChild(txt);D.screen.appendChild(wrap);
    glow.innerHTML=sheepySVG(140,true,'nervous');
  });
  const txt=$('introLine');
  await sleep(600);
  txt.classList.add('show');
  const lines=[
    {html:'<span class="hand">baa.</span>',ms:2200},
    {html:'Sheepy here. She asked me to deliver something.',ms:3500},
    {html:'But you\u2026 you wanted to respond.',ms:3200},
    {html:'So I\'m carrying your reply.',ms:2800},
    {html:'Each tape is a possible ending.',ms:3000,bgmPrep:true},
    {html:'None of them are true. All of them are true.',ms:3500,bgmStart:true},
    {html:'A seed has many fates.',ms:3000},
    {html:'<span class="hand">Drag a tape to the slot to begin.</span>',ms:3500}
  ];
  for(let i=0;i<lines.length;i++){
    const line=lines[i];
    if(i>0){txt.classList.remove('show');txt.classList.add('hiding');await sleep(500);txt.classList.remove('hiding')}
    if(line.bgmPrep)Snd.preloadBGM();
    if(line.bgmStart){dbg('BGM: starting during Sheepy intro');Snd.playBGM()}
    txt.innerHTML=line.html;txt.classList.add('show');await sleep(line.ms);
  }
  const glow=D.screen.querySelector('.sheepy-glow');
  if(glow)glow.innerHTML=sheepySVG(140,false,'happy');
  await sleep(800);
}

/* Loading Screen */
async function screenLoading(tape){
  Snd.sfxWhoosh();
  await fadeToScreen(()=>{CRT.burst(400);const d=document.createElement('div');d.className='load-display';const title=document.createElement('div');title.className='load-title';title.textContent='▶ PLAYING: '+tape.title;const desc=document.createElement('div');desc.className='load-desc';desc.textContent='"'+tape.desc+'"';const bar=document.createElement('div');bar.className='load-bar';bar.style.borderColor=tape.color;const fill=document.createElement('div');fill.className='load-fill';fill.id='loadFill';fill.style.background=tape.color;fill.style.boxShadow='0 0 8px '+tape.color;bar.appendChild(fill);d.appendChild(title);d.appendChild(desc);d.appendChild(bar);D.screen.appendChild(d)});
  const fill=$('loadFill');let w=0;
  await new Promise(r=>{const iv=setInterval(()=>{w+=Math.random()*3.5+1.5;fill.style.width=Math.min(w,100)+'%';if(w>=100){clearInterval(iv);r()}},65)});
  await sleep(600);
}

/* Garden */
function showGarden(){UI.screenClear();UI.setGlow('rgba(168,230,163,.08)');const g=document.createElement('div');g.className='garden';const sv=document.createElement('div');sv.innerHTML=sheepySVG(120,false,'happy');const t=document.createElement('div');t.className='garden-text';t.innerHTML='The seed has grown into something beautiful.<br>Every ending was real. Every path was yours.';const s=document.createElement('div');s.className='garden-sub';s.textContent='🌱 Replay any tape from the archive.';g.appendChild(sv);g.appendChild(t);g.appendChild(s);D.screen.appendChild(g)}

/* ═══════════════════════════════════════════════════════════════════
   DRAG SYSTEM
   ═══════════════════════════════════════════════════════════════════ */
const Drag={
  active:false,ghost:null,tape:null,srcEl:null,sx:0,sy:0,moved:false,_move:null,_up:null,
  begin(e,tape,el){if(this.active||inserting||!bootDone)return;Snd.ensure();this.tape=tape;this.srcEl=el;this.sx=e.clientX;this.sy=e.clientY;this.moved=false;UI.setGlow('transparent');this._move=me=>this.onMove(me);this._up=()=>this.onUp();document.addEventListener('pointermove',this._move);document.addEventListener('pointerup',this._up)},
  mkGhost(){const r=this.srcEl.getBoundingClientRect();this.ghost=document.createElement('div');this.ghost.className='tape-ghost';const lbl=this.srcEl.querySelector('.tape-label');if(lbl)this.ghost.appendChild(lbl.cloneNode(true));this.ghost.style.width=r.width+'px';this.ghost.style.height=r.height+'px';document.body.appendChild(this.ghost);this.srcEl.classList.add('dragging');this.active=true},
  onMove(e){if(!this.moved){const dx=e.clientX-this.sx,dy=e.clientY-this.sy;if(dx*dx+dy*dy>25){this.moved=true;this.mkGhost();this.posGhost(e);UI.glitch()}return}this.posGhost(e)},
  posGhost(e){if(!this.ghost)return;this.ghost.style.left=(e.clientX-70)+'px';this.ghost.style.top=(e.clientY-44)+'px';const sr=D.slot.getBoundingClientRect(),gr=this.ghost.getBoundingClientRect();const hit=!(gr.left>sr.right||gr.right<sr.left||gr.top>sr.bottom||gr.bottom<sr.top);D.slot.classList.toggle('active',hit);D.slotLabel.textContent=hit?'▶ DROP':'▶ DRAG HERE';this.ghost.style.transform=hit?'rotate(0deg) scale(1.1)':'rotate(-5deg) scale(1.05)';this.ghost.style.borderColor=hit?'var(--green)':'var(--pink)'},
  onUp(){document.removeEventListener('pointermove',this._move);document.removeEventListener('pointerup',this._up);if(!this.moved)insertTape(this.tape);else if(this.ghost){const sr=D.slot.getBoundingClientRect(),gr=this.ghost.getBoundingClientRect();if(!(gr.left>sr.right||gr.right<sr.left||gr.top>sr.bottom||gr.bottom<sr.top))insertTape(this.tape);else UI.showDlg('Drop the tape into the slot!',2000)}this.cleanup()},
  cleanup(){if(this.srcEl)this.srcEl.classList.remove('dragging');if(this.ghost)this.ghost.remove();this.ghost=null;this.tape=null;this.srcEl=null;this.active=false;this.moved=false;D.slot.classList.remove('active');D.slotLabel.textContent='▶ DRAG HERE'}
};

/* ═══════════════════════════════════════════════════════════════════
   BUILD RACK
   ═══════════════════════════════════════════════════════════════════ */
function buildRack(){
  D.rack.innerHTML='';
  const hdr=document.createElement('div');hdr.className='rack-header';
  hdr.innerHTML=`ARCHIVE<span class="rack-progress">${countDone()}/${TAPES.length} PLAYED</span>`;
  D.rack.appendChild(hdr);
  for(const t of TAPES){
    const completed=isDone(t.id),avail=canPlay(t.id);
    const locked=t.locked&&!completed,seqLock=!t.locked&&!completed&&!avail;
    const el=document.createElement('div');
    el.className='vhs-tape'+(completed?' complete':'')+(locked?' locked':seqLock?' seq-locked':'');
    el.dataset.id=t.id;
    el.innerHTML=`<div class="tape-color" style="background:${t.color}"></div><div class="tape-window"><div class="reel"></div><div class="tape-strip"></div><div class="reel"></div></div><div class="tape-label">${t.title}<span class="tape-status">${locked?'LOCKED':seqLock?'PLAY PREV':completed?'✓ PLAYED':'NEW'}</span></div><div class="tape-rating">${t.rating}</div>`;
    if(!locked&&avail){el.addEventListener('pointerdown',e=>{e.preventDefault();Drag.begin(e,t,el)});el.addEventListener('pointerenter',()=>{if(!Drag.active&&!inserting){UI.setGlow(t.glow);Snd.sfxHover()}});el.addEventListener('pointerleave',()=>{if(!Drag.active)UI.setGlow('transparent')})}else if(seqLock){el.addEventListener('click',()=>UI.showDlg('Complete the previous tape first.',2500))}else if(locked){el.addEventListener('click',()=>UI.showDlg('This tape is sealed. Complete all others to unlock.',3000))}
    D.rack.appendChild(el);
  }
}

/* ═══════════════════════════════════════════════════════════════════
   INSERT TAPE
   ═══════════════════════════════════════════════════════════════════ */
async function insertTape(tape){
  if(!tape?.file||inserting||!bootDone)return;
  inserting=true;
  BgScenes.stop();
  Snd.stopBGM();Snd.stopHum();
  Snd.sfxClunk();D.slot.classList.add('inserting');await sleep(500);
  Snd.sfxSnap();D.slot.classList.add('active');D.slotLabel.textContent='▶ LOADING...';await sleep(400);
  Snd.sfxMotor();D.ledPlay.classList.add('on');await sleep(350);
  D.channel.textContent='▶ TAPE';D.bezel.classList.add('shake','flash');UI.setGlow(tape.glow);CRT.burst(1000);UI.glitch();await sleep(500);
  Snd.sfxTape(tape.id);D.rec.classList.add('on');D.tracking.classList.add('on');startCounter();FX.start(tape.id);await sleep(800);
  D.slot.classList.remove('inserting');D.bezel.classList.remove('shake');await sleep(400);D.bezel.classList.remove('flash');
  D.ledPlay.classList.remove('on');await sleep(150);D.ledPlay.classList.add('on');await sleep(500);
  await screenLoading(tape);stopCounter();FX.stop();
  D.screen.classList.add('fade-out');await sleep(1000);
  window.location.href=tape.file;
}

/* ═══════════════════════════════════════════════════════════════════
   AMBIENT
   ═══════════════════════════════════════════════════════════════════ */
const Amb={
  flickIv:0,crackTO:0,
  start(){this.flickIv=setInterval(()=>{if(Math.random()<.08&&!inserting){D.bezel.style.opacity='.94';setTimeout(()=>{D.bezel.style.opacity='1'},60+Math.random()*100)}},4000);this.crackle()},
  crackle(){if(Snd.on&&!inserting)Snd.noise(.01+Math.random()*.015,.005+Math.random()*.005);this.crackTO=setTimeout(()=>this.crackle(),2500+Math.random()*4000)},
  stop(){clearInterval(this.flickIv);clearTimeout(this.crackTO)}
};

/* ═══════════════════════════════════════════════════════════════════
   BOOT SEQUENCE
   ═══════════════════════════════════════════════════════════════════ */
async function boot(){
  if(booted)return;booted=true;
  D.boot.classList.add('hidden');await sleep(2000);
  D.station.classList.add('on');await sleep(500);
  CRT.init();CRT.burst(500);D.ledPwr.classList.add('on');Dust.init();Dust.start();Snd.ensure();Snd.sfxPowerOn();
  setTimeout(()=>D.warmup.classList.add('off'),500);
  BgScenes.init();
  const returning=isDone('tape1');
  const complete=allDone();
  if(complete){await sleep(1500);showGarden();buildRack();Amb.start();BgScenes.start();bootDone=true;return}
  if(returning){await sleep(1200);UI.screenNoSignal();BgScenes.start();await sleep(600);buildRack();const hint=isDone('tape4')?'A secret tape has appeared… 🌱':'Welcome back. Choose a tape. 🐑';UI.showDlg(hint,5000);Amb.start();bootDone=true;return}
  await sleep(1200);
  UI.screenClear();
  const bootDiv=document.createElement('div');bootDiv.className='boot-text';D.screen.appendChild(bootDiv);
  const lines=[{text:'> SEED ARCHIVE v2.0',spd:14,pause:500},{text:'> LOADING EMOTIONAL PAYLOAD...',spd:16,pause:600},{text:'> 5 RECORDINGS FOUND',spd:14,pause:400},{text:'> INITIALIZING SHEEPY PROTOCOL',spd:18,pause:500},{text:'',spd:0,pause:350},{text:'> READY.',spd:45,pause:1000}];
  for(const line of lines){if(!line.text){bootDiv.appendChild(document.createElement('br'));await sleep(line.pause);continue}const span=document.createElement('span');span.className='boot-line';span.style.animationDelay=(lines.indexOf(line)*.08)+'s';bootDiv.appendChild(span);await UI.typeInto(span,line.text,line.spd);bootDiv.appendChild(document.createElement('br'));await sleep(line.pause)}
  Snd.sfxReady();
  const cursor=document.createElement('span');cursor.className='cursor';bootDiv.appendChild(cursor);await sleep(1500);
  CRT.burst(300);
  await showSheepyIntro();
  Snd.sfxWhoosh();
  await fadeToScreen(()=>UI.screenNoSignal());
  await sleep(500);
  BgScenes.start();
  buildRack();
  UI.showDlg('Drag a tape to the slot. 🐑',6000);
  Amb.start();
  bootDone=true;
}

/* ═══════════════════════════════════════════════════════════════════
   EVENTS
   ═══════════════════════════════════════════════════════════════════ */
TouchFX.init();
VHS_BG.init();
D.boot.addEventListener('click',boot);
D.boot.addEventListener('touchend',e=>{e.preventDefault();boot()},{passive:false});
D.audioBtn.addEventListener('click',()=>Snd.toggle());
D.slot.addEventListener('click',()=>{if(!inserting&&bootDone)UI.showDlg('Drag a tape from the rack to the slot.',2500)});
D.eject.addEventListener('click',()=>{if(bootDone){Snd.sfxClunk();UI.showDlg('No tape inserted. The slot is empty.',2000)}});
document.addEventListener('contextmenu',e=>e.preventDefault());

/* Cleanup */
window.addEventListener('beforeunload',()=>{CRT.stop();FX.stop();Dust.stop();Amb.stop();BgScenes.stop();stopCounter();Snd.stopHum();Ballet.stop();Walker.stop();BirdFly.stop();if(Snd.bgm){Snd.bgm.pause();Snd.bgm=null}});
</script>
</body>
</html>
