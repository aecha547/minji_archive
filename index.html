<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>MINJI_ARCHIVE.vhs</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=VT323&family=Caveat:wght@400;600&family=Cinzel:wght@400;600&display=swap');
:root{
/* CHASE ATLANTIC PALETTE */
--bg:#050002;
--phosphor:#ff66aa; /* Pink */
--phosphor-dim:#5e1e38;
--phosphor-bright:#ffb3d9;
--accent:#aa66ff; /* Purple */
--gold:#ffcc00;
--red:#ff3333;
--glass:rgba(255, 102, 170, 0.05);
--font-crt:'VT323',monospace;
--font-hand:'Caveat',cursive;
--font-serif:'Cinzel',serif;
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;user-select:none}
html,body{height:100%;overflow:hidden;background:var(--bg);font-family:var(--font-crt);color:var(--phosphor)}

/* ═══ BOOT OVERLAY ═══ */
#boot-overlay{
position:fixed;inset:0;z-index:9999;background:#000;
display:flex;flex-direction:column;align-items:center;justify-content:center;
cursor:pointer;transition:opacity .8s ease-out;
}
#boot-overlay.hidden{opacity:0;pointer-events:none}
#boot-overlay h1{
font-family:var(--font-serif);font-size:clamp(3.5rem,8vw,5.5rem);font-weight:600;
color:var(--phosphor);letter-spacing:4px;position:relative;
text-shadow:0 0 25px var(--phosphor),0 0 60px var(--phosphor-dim);
animation:titleFlicker 3s infinite;
}
#boot-overlay h1::after{
content:'ARCHIVE';position:absolute;bottom:-20px;left:50%;transform:translateX(-50%);
font-family:var(--font-crt);font-size:clamp(1rem,2.5vw,1.4rem);
letter-spacing:8px;color:var(--accent);opacity:.8;
}
.boot-prompt{color:#666;font-size:1.2rem;margin-top:60px;animation:pulse 2s infinite;letter-spacing:2px}
@keyframes titleFlicker{0%,18%,22%,25%,53%,56%,100%{opacity:1}20%,24%,55%{opacity:.7;text-shadow:none}}
@keyframes pulse{0%,100%{opacity:.3}50%{opacity:1}}
@keyframes heartbeat{0%{transform:scale(1);opacity:0.8}10%{transform:scale(1.3);opacity:1}20%{transform:scale(1);opacity:0.8}100%{transform:scale(1);opacity:0.8}}

/* ═══ STATION LAYOUT ═══ */
#station{
display:none;grid-template-columns:1fr 280px;grid-template-rows:1fr;
gap:16px;width:95vw;max-width:1200px;height:88vh;max-height:820px;
position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
opacity:0;transition:opacity .8s;
}
#station.on{display:grid;opacity:1}

/* ═══ TV UNIT ═══ */
.tv-unit{
grid-column:1;grid-row:1;
background:linear-gradient(145deg,#1a0a10,#0a0005);
border-radius:22px;border:1px solid #331122;
box-shadow:inset 0 0 50px #000,0 0 40px rgba(255,102,170,0.1);
display:flex;flex-direction:column;padding:22px;position:relative;
}
.screen-bezel{
flex:1;background:#000;border-radius:12px;position:relative;overflow:hidden;
border:2px solid #22111a;
box-shadow:inset 0 0 35px rgba(0,0,0,.95),0 0 15px rgba(255,102,170,.06);
}
canvas#crt{position:absolute;inset:0;width:100%;height:100%;z-index:5}
.scanlines{position:absolute;inset:0;pointer-events:none;z-index:10;
background:repeating-linear-gradient(0deg,transparent,transparent 1.5px,rgba(0,0,0,.2) 1.5px,rgba(0,0,0,.2) 3px);opacity:.4}
.vignette{position:absolute;inset:0;pointer-events:none;z-index:11;
background:radial-gradient(ellipse at center,transparent 50%,rgba(0,0,0,.85) 100%)}
.screen-glow{position:absolute;inset:-12px;z-index:-1;border-radius:20px;
background:radial-gradient(ellipse,rgba(255,102,170,.05) 0%,transparent 70%);
pointer-events:none;transition:background 1s}

/* Screen content */
#screen{position:absolute;inset:0;z-index:20;
display:flex;flex-direction:column;justify-content:center;align-items:center;padding:24px}
.channel-id{position:absolute;top:18px;left:20px;font-size:1.5rem;color:var(--phosphor-dim);
opacity:.7;text-shadow:0 0 5px var(--phosphor-dim);letter-spacing:2px;z-index:25}
.rec-ind{position:absolute;top:18px;right:20px;font-size:1.1rem;color:var(--red);
opacity:0;transition:opacity .3s;z-index:25}
.rec-ind.on{opacity:1;animation:blink .8s infinite;text-shadow:0 0 8px var(--red)}
@keyframes blink{50%{opacity:0}}

/* Subtitle bar */
.subtitle-box{
position:absolute;bottom:25px;left:50%;transform:translateX(-50%);z-index:25;
text-align:center;color:var(--phosphor-bright);font-size:clamp(1rem,2vw,1.3rem);
text-shadow:0 0 8px var(--phosphor);
background:rgba(20,5,10,.85);padding:10px 22px;border-radius:4px;
border:1px solid rgba(255,102,170,.2);max-width:85%;line-height:1.4;
opacity:0;transition:opacity .4s;pointer-events:none;
}
.subtitle-box.vis{opacity:1}

/* Boot text */
.boot-text{width:85%;text-align:left;color:var(--phosphor);
font-size:clamp(13px,2vw,17px);line-height:1.8;
text-shadow:0 0 5px rgba(255,102,170,.25);white-space:pre-wrap}
.boot-text .cursor{display:inline-block;width:8px;height:1.1em;background:var(--phosphor);
vertical-align:text-bottom;margin-left:2px;animation:blink 1s step-end infinite}

/* Final message */
.final-display{text-align:center;max-width:480px}
.final-display p{font-family:var(--font-serif);font-size:clamp(15px,2.2vw,19px);
line-height:2;color:var(--phosphor-bright);opacity:0;transform:translateY(10px);
transition:all .8s ease;margin-bottom:6px}
.final-display p.show{opacity:1;transform:translateY(0)}
.final-display .gold{color:var(--gold);font-weight:600;text-shadow:0 0 10px rgba(255,204,0,.3)}

/* TV Controls */
.tv-controls{
display:flex;align-items:center;justify-content:space-between;
padding:12px 16px 0;margin-top:8px;flex-shrink:0;border-top:1px solid #331122;
}
.power-section{display:flex;align-items:center;gap:6px}
.led{width:8px;height:8px;border-radius:50%;transition:all .25s;background:#300;box-shadow:inset 0 0 2px #000}
.led.pwr.on{background:#f06;box-shadow:0 0 8px #f06;animation:heartbeat 3s infinite}
.led.play.on{background:#0f8;box-shadow:0 0 8px #0f8}
.ctrl-label{font-size:10px;letter-spacing:.2em;color:#664455;text-transform:uppercase;margin-left:4px}

/* Tape Slot */
.tape-slot{
width:180px;height:26px;background:#0a0508;
border:1px solid #442233;border-radius:3px;cursor:pointer;
box-shadow:inset 0 2px 8px rgba(0,0,0,.9);
position:relative;overflow:hidden;transition:all .3s;
display:flex;align-items:center;justify-content:center;
}
.slot-label{font-size:10px;letter-spacing:.15em;color:#442233;transition:color .3s;position:relative;z-index:2}
.tape-slot.active{border-color:var(--phosphor);box-shadow:inset 0 0 10px rgba(255,102,170,.1)}
.tape-slot.active .slot-label{color:var(--phosphor)}
.slot-flap{position:absolute;inset:0;background:linear-gradient(180deg,#1a0a10,#050005);
transform-origin:top;transition:transform .4s;border-bottom:1px solid #331122;z-index:1}
.tape-slot.inserting .slot-flap{transform:rotateX(-95deg)}

.brand-label{font-size:11px;letter-spacing:.3em;color:#442233;text-transform:uppercase}

/* ═══ TAPE RACK ═══ */
.tape-rack{
grid-column:2;grid-row:1;
background:linear-gradient(180deg,#10050a,#050002);
border:1px solid #331122;border-radius:10px;
padding:16px;display:flex;flex-direction:column;gap:14px;
overflow-y:auto;box-shadow:inset 0 0 25px #000;
scrollbar-width:thin;scrollbar-color:#331122 #050002;
}
.rack-header{color:#664455;text-align:center;border-bottom:1px solid #22111a;
padding-bottom:10px;margin-bottom:4px;letter-spacing:4px;font-size:12px}

/* ═══ VHS TAPE ═══ */
.vhs-tape{
min-height:100px;background:linear-gradient(180deg,#1a1a1a,#0e0e0e);
border-radius:4px;border:1px solid #333;position:relative;cursor:pointer;
transition:all .25s;display:flex;flex-direction:column;align-items:center;justify-content:center;
box-shadow:3px 5px 14px rgba(0,0,0,.6);flex-shrink:0;
}
.vhs-tape:hover{transform:translateY(-3px);border-color:var(--phosphor);z-index:10}
.vhs-tape.selected{border-color:var(--phosphor);box-shadow:0 0 15px rgba(255,102,170,.2)}
.vhs-tape.locked{opacity:.2;pointer-events:none;filter:grayscale(1)}
.tape-window{
position:absolute;top:12px;left:14%;width:72%;height:28px;
background:#050505;border-radius:2px;border:1px solid #222;
display:flex;align-items:center;justify-content:space-around;
}
.reel{width:16px;height:16px;border:2px solid #333;border-radius:50%;background:#111}
.tape-label{
background:#eee;color:#111;padding:4px 8px;margin-top:32px;
width:85%;text-align:center;font-family:var(--font-hand);font-weight:600;
font-size:14px;transform:rotate(-.5deg);box-shadow:0 1px 3px rgba(0,0,0,.5);
}
.tape-status{font-family:var(--font-crt);font-size:9px;color:#888;letter-spacing:.1em;margin-top:2px;display:block;text-transform:uppercase}

/* ═══ RESPONSIVE ═══ */
@media(max-width:900px){
#station{grid-template-columns:1fr;grid-template-rows:1fr 130px;width:96vw;height:auto;gap:10px;margin:10px auto;transform:translate(-50%,-50%);top:50%;left:50%}
.tv-unit{min-height:50vh;padding:12px}
.tape-rack{flex-direction:row;overflow-x:auto;padding:10px}
.vhs-tape{min-width:130px;min-height:85px}
}
</style>
</head>
<body>

<div id="boot-overlay">
<h1>MINJI</h1>
<p class="boot-prompt">[ TAP TO START SYSTEM ]</p>
</div>

<div id="station">
<div class="tv-unit">
<div class="screen-glow" id="screen-glow"></div>
<div class="screen-bezel">
<canvas id="crt"></canvas>
<div class="scanlines"></div>
<div class="vignette"></div>
<div class="channel-id" id="channel-disp">AUX</div>
<div class="rec-ind" id="rec-ind">● REC</div>
<div id="screen"></div>
<div class="subtitle-box" id="subs"></div>
</div>
<div class="tv-controls">
<div class="power-section"><div class="led pwr" id="led-pwr"></div><span class="ctrl-label">PWR</span></div>
<div class="tape-slot" id="tape-slot" onclick="slotClicked()">
<div class="slot-flap"></div><span class="slot-label" id="slot-label">▶ INSERT TAPE</span>
</div>
<span class="brand-label">SONY</span>
</div>
</div>
<div class="tape-rack" id="tape-rack">
<div class="rack-header">PERSONAL ARCHIVE</div>
</div>
</div>

<script>
'use strict';
const $=id=>document.getElementById(id);
const sleep=ms=>new Promise(r=>setTimeout(r,ms));

// STATE MANAGEMENT
const KEY='minji_archive_v1';
function stateGet(){try{return JSON.parse(localStorage.getItem(KEY))||{}}catch{return{}}}
function isDone(t){const s=stateGet();return!!(s[t]&&(s[t]===true||s[t].complete))}
function allDone(){return['tape1','tape2','tape3'].every(t=>isDone(t))}

// AUDIO ENGINE (Dreamy Synth)
let audioCtx,masterGain,audioOn=false;
function synthInit(){
  if(audioCtx)return;audioCtx=new(window.AudioContext||window.webkitAudioContext)();
  masterGain=audioCtx.createGain();masterGain.gain.value=0;masterGain.connect(audioCtx.destination);
}
function ensureAudio(){
  synthInit();if(audioCtx.state==='suspended')audioCtx.resume();
  if(!audioOn){audioOn=true;masterGain.gain.setTargetAtTime(0.35,audioCtx.currentTime,0.1)}
}
function note(f,dur,type='sine'){
  if(!audioCtx)return;const o=audioCtx.createOscillator(),g=audioCtx.createGain();
  o.type=type;o.frequency.value=f;
  g.gain.setValueAtTime(0,audioCtx.currentTime);
  g.gain.linearRampToValueAtTime(0.05,audioCtx.currentTime+0.05);
  g.gain.exponentialRampToValueAtTime(0.001,audioCtx.currentTime+dur);
  o.connect(g);g.connect(masterGain);o.start();o.stop(audioCtx.currentTime+dur+0.1);
}
function sfxInsert(){note(100,0.3,'square');setTimeout(()=>note(60,0.4,'sawtooth'),150)}
function startAmbience(){
  if(!audioCtx)return;
  // Lo-fi drone
  const o=audioCtx.createOscillator(),g=audioCtx.createGain();
  o.type='triangle';o.frequency.value=60;g.gain.value=0.015;
  const lfo=audioCtx.createOscillator();lfo.frequency.value=0.2;
  const lfoG=audioCtx.createGain();lfoG.gain.value=2;
  lfo.connect(lfoG);lfoG.connect(o.frequency);
  o.connect(g);g.connect(masterGain);o.start();lfo.start();
}

// TAPES
const TAPES=[
  {id:'tape1',title:'SIDE A: Glow Up',file:'tape1.html',desc:'The history.'},
  {id:'tape2',title:'TRACKING: Jealousy',file:'tape2.html',desc:'The perception.'},
  {id:'tape3',title:'PLAY: The Static',file:'tape3.html',desc:'The chaos.'},
  {id:'tape4',title:'RECORD: The Seed',file:'tape4.html',desc:'The answer.',final:true},
];

// RACK LOGIC
let selectedTape=null;
function buildRack(){
  const r=$('tape-rack');r.innerHTML='<div class="rack-header">PERSONAL ARCHIVE</div>';
  TAPES.forEach(t=>{
    const done=isDone(t.id);const locked=t.final&&!allDone();
    const d=document.createElement('div');
    d.className=`vhs-tape${done?' complete':''}${locked?' locked':''}`;
    d.innerHTML=`<div class="tape-window"><div class="reel"></div><div class="reel"></div></div>
    <div class="tape-label">${t.title}<span class="tape-status">${locked?'LOCKED':done?'PLAYED':'NEW'}</span></div>`;
    d.onclick=()=>{
      if(locked)return;
      document.querySelectorAll('.vhs-tape').forEach(x=>x.classList.remove('selected'));
      d.classList.add('selected');selectedTape=t;
      $('tape-slot').classList.add('active');$('slot-label').textContent='▶ INSERT TAPE';
      $('subs').textContent=t.desc;$('subs').classList.add('vis');
    };
    r.appendChild(d);
  });
}

async function slotClicked(){
  if(!selectedTape)return;
  ensureAudio();sfxInsert();
  $('tape-slot').classList.add('inserting');$('slot-label').textContent='LOADING...';
  await sleep(800);
  window.location.href=selectedTape.file;
}

// BOOT
async function boot(){
  ensureAudio();
  $('boot-overlay').classList.add('hidden');
  $('station').classList.add('on');
  $('led-pwr').classList.add('on');
  startAmbience();
  
  // Static effect
  const canvas=$('crt'),ctx=canvas.getContext('2d');
  const resize=()=>{canvas.width=canvas.parentElement.offsetWidth/2;canvas.height=canvas.parentElement.offsetHeight/2};
  window.onresize=resize;resize();
  const noise=()=>{
    const w=canvas.width,h=canvas.height,id=ctx.createImageData(w,h),d=id.data;
    for(let i=0;i<d.length;i+=4){const c=Math.random()*255;d[i]=d[i+1]=d[i+2]=c;d[i+3]=Math.random()*15}
    ctx.putImageData(id,0,0);requestAnimationFrame(noise);
  };noise();

  if(isDone('tape4')){
    // Post-game state
    $('screen').innerHTML=`<div class="final-display">
    <p>The seed is planted.</p>
    <p>Now we wait for rain.</p>
    <p class="gold">Happy Valentine's, Minji.</p>
    </div>`;
    setTimeout(()=>{document.querySelectorAll('.final-display p').forEach(p=>p.classList.add('show'))},500);
  } else {
    // Standard boot
    const term=document.createElement('div');term.className='boot-text';$('screen').appendChild(term);
    const txt=`> SYSTEM v3.0 // TARGET: PEASANT\n> LOADING AUDIO DRIVERS... [OK]\n> DETECTED: 4 MEMORY FRAGMENTS\n> WARNING: "Sheepy" protocol active.\n\n> READY.`;
    let out='';
    for(let c of txt){out+=c;term.innerHTML=out+'<span class="cursor"></span>';await sleep(20);if(c==='\n')await sleep(200)}
    await sleep(1500);term.style.opacity=0;
    await sleep(500);term.remove();$('channel-disp').textContent='AV-1';
    buildRack();
  }
}

$('boot-overlay').onclick=boot;
</script>
</body>
</html>
